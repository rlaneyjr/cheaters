<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Completing Different Words</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part428.htm">&lt; Previous</a><span> | </span><a href="../From Bash to Z Shell.html">Contents</a><span> | </span><a href="part430.htm">Next &gt;</a></p><p class="s35" style="padding-left: 42pt;text-indent: 0pt;text-align: left;"><a name="bookmark781">Completing Different Words</a></p><p class="s33" style="padding-top: 5pt;padding-left: 42pt;text-indent: 0pt;line-height: 115%;text-align: justify;">zsh <span class="p">comes with a couple of custom completion widgets that do other things. We have already seen the one for history word completion, and there is also one, generally bound to Ctrl-x m, that completes to the most recently modified file. Both of these can be implemented with</span></p><p class="s33" style="padding-left: 42pt;text-indent: 0pt;text-align: left;">_generic <span class="p">and a few style settings.</span></p><p class="s29" style="padding-top: 3pt;padding-left: 223pt;text-indent: 0pt;text-align: left;"><a name="bookmark818">CHAPTER 15 </a><span class="s28">■ </span>W RIT ING COMP LET ION F UNCTI ON S <span class="s27">407</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 40pt;text-indent: 18pt;line-height: 115%;text-align: left;">For the <span class="s33">most-recent-file </span>widget, what we basically want is menu completion where files are completed in order of how recently modified they are. To enable menu completion, you can specify <span class="s33">menu-complete </span>instead of <span class="s33">complete-word </span>to <span class="s33">zle -C </span>like this:</p><p class="s33" style="padding-top: 7pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">zle -C most-recent-file menu-complete _generic</p><p style="padding-top: 8pt;padding-left: 40pt;text-indent: 18pt;line-height: 115%;text-align: left;">If you have menu selection enabled, it will now be invoked for the widget, which is not what we want. You could adjust your <span class="s33">select </span>style’s context to skip this widget, but a better way is to use the <span class="s33">_menu </span>completer at the beginning of the list of completers. It forces later completers to use menu completion, disabling menu selection in the process. The <span class="s33">_menu </span>completer</p><p style="padding-left: 40pt;text-indent: 0pt;line-height: 10pt;text-align: left;">even overrides the behavior selected with <span class="s33">zle -C</span>, so whether we use <span class="s33">complete-word </span>or</p><p class="s33" style="padding-top: 1pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">menu-complete <span class="p">there is immaterial.</span></p><p style="padding-top: 1pt;padding-left: 40pt;text-indent: 18pt;line-height: 115%;text-align: left;">For our main completer, all we need to do is use <span class="s33">_files</span>. We’ll follow it with <span class="s33">_match </span>so that you can specify a glob pattern to restrict the types of files that will be matches. So we have this style:</p><p class="s33" style="padding-top: 7pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">zstyle &#39;:completion:most-recent-file::::&#39; completer _menu _files _match</p><p style="padding-top: 8pt;padding-left: 40pt;text-indent: 18pt;line-height: 115%;text-align: left;">This has now got us menu completion of files in alphabetical order, but we want the most recently modified file to appear first. Fortunately, <span class="s33">_files </span>looks up a <span class="s33">file-sort </span>style to specify how files should be sorted. Given the value <span class="s33">modification</span>, it will sort files by their last modified times. Other sort criteria such as file size or change and access times are also available. So we just add this style to handle the ordering:</p><p class="s33" style="padding-top: 7pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">zstyle &#39;:completion:most-recent-file:*&#39; file-sort modification</p><p style="padding-top: 8pt;padding-left: 40pt;text-indent: 18pt;line-height: 115%;text-align: left;">In typical usage, this widget is invoked once, and if the filename that appears is not the right one, it is tried again until the right one does appear. Therefore, listing possible matches is not particularly useful. Setting the <span class="s33">hidden </span>style to true hides the list. That leaves the description, which can be removed by setting the <span class="s33">hidden </span>style to <span class="s33">all</span>:</p><p class="s33" style="padding-top: 7pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">zstyle &#39;:completion:most-recent-file:*&#39; hidden all</p><p style="padding-top: 8pt;padding-left: 40pt;text-indent: 18pt;line-height: 115%;text-align: left;">A further change you may or may not want to do is to restrict the files matched to normal files. The <span class="s33">file-patterns </span>style we saw earlier allows that to be done:</p><p class="s33" style="padding-top: 7pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">zstyle &#39;:completion:most-recent-file:*&#39; file-patterns &#39;*(.):normal\ files&#39;</p><p style="padding-top: 8pt;padding-left: 58pt;text-indent: 0pt;text-align: left;">Don’t forget to bind it to a key at the end of all this:</p><p class="s33" style="padding-top: 8pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">bindkey &#39;^Xm&#39; most-recent-file</p><p style="padding-top: 8pt;padding-left: 58pt;text-indent: 0pt;text-align: left;">To give you another example, here is one way to configure history word completion work:</p><p class="s33" style="padding-top: 8pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">zle -C history-complete complete-word _generic</p><p class="s33" style="padding-top: 1pt;padding-left: 40pt;text-indent: 0pt;line-height: 115%;text-align: justify;">zstyle &#39;:completion:history-complete::::&#39; completer _history zstyle &#39;:completion:history-complete:*&#39; remove-all-dups true zstyle &#39;:completion:history-complete:*&#39; sort true</p><p class="s33" style="padding-left: 40pt;text-indent: 0pt;line-height: 10pt;text-align: left;">bindkey &#39;\e/&#39; history-complete</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s37" style="padding-top: 7pt;text-indent: 0pt;text-align: right;">e</p><p class="s29" style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: left;"><a name="bookmark819"><span class="s27">408 </span></a>C HA P T E R 15 <span class="s28">■ </span>W R I T I NG COMP LET I ON F UNCTI ON S</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part428.htm">&lt; Previous</a><span> | </span><a href="../From Bash to Z Shell.html">Contents</a><span> | </span><a href="part430.htm">Next &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
