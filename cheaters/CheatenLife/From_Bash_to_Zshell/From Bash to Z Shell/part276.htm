<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Approximate Completion</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part275.htm">&lt; Previous</a><span> | </span><a href="../From Bash to Z Shell.html">Contents</a><span> | </span><a href="part277.htm">Next &gt;</a></p><p class="s35" style="padding-left: 40pt;text-indent: 0pt;text-align: left;"><a name="bookmark497">Approximate Completion</a></p><p style="padding-top: 5pt;padding-left: 40pt;text-indent: 0pt;line-height: 115%;text-align: justify;">Approximate completion provides a way of using the completion system to correct typos and spelling mistakes. It is controlled by the <span class="s33">_approximate </span>completer. Typically, you would put this after the normal <span class="s33">_complete </span>completer to give <span class="s33">_complete </span>precedence.</p><p style="padding-left: 40pt;text-indent: 18pt;line-height: 115%;text-align: left;">Approximate completion is done by first looking for matches that differ by one error from what was typed. An error could be an additional character, a missing character, an incorrect character, or two characters transposed. Additional characters at the cursor position don’t count as an error, though: when doing completion you generally expect extra characters to be filled in where the cursor is positioned. Anyway, if matches differing from the original string by one error are found, they are added as matches. Otherwise, the completion system goes on to look for matches with two errors, then three errors, and so on.</p><p style="padding-left: 40pt;text-indent: 17pt;line-height: 115%;text-align: left;">Obviously, there needs to be a point at which <span class="s33">_approximate </span>gives up; otherwise, it would be able to transform your word into something that doesn’t even vaguely resemble the original. You can, therefore, use a <span class="s33">max-errors </span>style, which allows you to specify a maximum number of errors that should be allowed. The following should give you an example of approximate completion in action:</p><p class="s29" style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: left;"><a name="bookmark527"><span class="s27">248 </span></a>C HA P T E R 10 <span class="s28">■ </span>C O M P L E T I O N</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s33" style="padding-left: 42pt;text-indent: 0pt;text-align: left;">%  <b>zstyle  &#39;:completion:::::&#39;  completer  _complete  _approximate</b></p><p class="s33" style="padding-top: 1pt;padding-left: 41pt;text-indent: 0pt;text-align: left;">%  <b>zstyle  &#39;:completion:*:approximate:*&#39;  max-errors  2</b></p><p class="s33" style="padding-top: 1pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">%  <b>zstyle  &#39;:completion:*:corrections&#39;  format  &#39;%B%d  (errors:  %e)%b&#39;</b></p><p class="s33" style="padding-top: 1pt;padding-left: 42pt;text-indent: 0pt;line-height: 115%;text-align: left;">%  <b>nowhere</b>&lt;tab&gt; <b>corrections  (errors:  2)</b></p><p class="s33" style="padding-left: 41pt;text-indent: 0pt;line-height: 10pt;text-align: left;">where                      whereis                  whereis-archive</p><p class="s46" style="padding-top: 1pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">original</p><p class="s33" style="padding-top: 1pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">nowhere</p><p class="s33" style="padding-top: 1pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">% <b>gerp&lt;tab&gt;</b></p><p class="s67" style="padding-top: 1pt;padding-left: 51pt;text-indent: 0pt;text-align: left;">➤ <span class="s33">grep</span></p><p style="padding-top: 8pt;padding-left: 42pt;text-indent: 17pt;line-height: 115%;text-align: left;">The <span class="s33">format </span>style with the <span class="s33">corrections </span>tag allows it to print the number of errors in the heading above the matches.</p><p style="padding-left: 42pt;text-indent: 18pt;line-height: 115%;text-align: justify;">If you set the maximum number of errors to a fixed number such as 2, you might find that this setting makes the approximate completion mechanism overly aggressive with short words and insufficient for longer words. Making the style depend on the number of characters of the word typed so far requires more information than is contained in the <span class="s33">zstyle </span>context. Fortunately, there is a way. By using the <span class="s33">-e </span>option with <span class="s33">zstyle</span>, you can use the final arguments as a string to be evaluated each time the style is looked up. This evaluated string returns a value in the <span class="s33">reply </span>array. So for example:</p><p class="s33" style="padding-top: 7pt;padding-left: 59pt;text-indent: -17pt;line-height: 115%;text-align: left;">zstyle  -e  &#39;:completion:*:approximate:*&#39;  max-errors  \ &#39;reply=(  $((  ($#PREFIX+$#SUFFIX)/3  ))  )&#39;</p><p style="padding-top: 7pt;padding-left: 42pt;text-indent: 17pt;line-height: 115%;text-align: left;">The word currently being completed is stored in the <span class="s33">PREFIX </span>and <span class="s33">SUFFIX </span>variables—they contain the parts before and after the cursor, respectively. So taking their combined length in characters divided by 3, as here, allows one mistake for every three characters typed.</p><p style="padding-left: 42pt;text-indent: 18pt;line-height: 115%;text-align: left;">There is also a very similar completer named <span class="s33">_correct</span>. It is identical to <span class="s33">_approximate </span>except that it doesn’t allow extra characters at the cursor position. If you use both in your list of completers, <span class="s33">_correct </span>should therefore either come before <span class="s33">_approximate </span>or have a larger</p><p class="s33" style="padding-left: 42pt;text-indent: 0pt;line-height: 10pt;text-align: left;">max-errors <span class="p">value.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part275.htm">&lt; Previous</a><span> | </span><a href="../From Bash to Z Shell.html">Contents</a><span> | </span><a href="part277.htm">Next &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
