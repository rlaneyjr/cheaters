<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>More Options for Manipulating History</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part132.htm">&lt; Previous</a><span> | </span><a href="../From Bash to Z Shell.html">Contents</a><span> | </span><a href="part134.htm">Next &gt;</a></p><h4 style="padding-left: 40pt;text-indent: 0pt;text-align: left;"><a name="bookmark259">More Options for Manipulating History</a></h4><p class="s33" style="padding-top: 6pt;padding-left: 40pt;text-indent: 0pt;line-height: 115%;text-align: left;">zsh <span class="p">allows you to show the history in more detail with some extra options to </span>history<span class="p">. It records internally the time when each command started. That’s useful later on when you’re trying to remember what you’ve just done. For example: How long did a certain command take? Did I run that program before I went for lunch as I meant to? You can show this with these options:</span></p><p style="padding-top: 7pt;padding-left: 56pt;text-indent: 0pt;text-align: left;">• <span class="s33">-d </span>for the time the command started.</p><p style="padding-top: 8pt;padding-left: 56pt;text-indent: 0pt;text-align: left;">• <span class="s33">-E </span>for the time and date in European format (day.month.year).</p><p style="padding-top: 8pt;padding-left: 56pt;text-indent: 0pt;text-align: left;">• <span class="s33">-i </span>for the time and date in international format (year-month-day).</p><p style="padding-top: 8pt;padding-left: 56pt;text-indent: 0pt;text-align: left;">• <span class="s33">-f </span>for the time and date in U.S. format (month/day/year).</p><p style="padding-top: 8pt;padding-left: 66pt;text-indent: -10pt;line-height: 115%;text-align: left;">• <span class="s33">-D </span>for the elapsed time of each command. You can combine this option with one of the others, or use it on its own; this prints the elapsed time of each command. The “elapsed” time is the time between the command starting and it stopping, not the amount of time running on the processor. It’s not just the difference between the timestamps, though, since it does measure the actual execution time, not including any idle time while you were editing.</p><p style="padding-top: 7pt;padding-left: 40pt;text-indent: 18pt;line-height: 115%;text-align: left;">For example, here is the end of my command history. Each line shows the history line number, the time taken to execute the command, and the command executed:</p><p class="s33" style="padding-top: 7pt;padding-bottom: 2pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">zsh% <b>history -D</b></p><table style="border-collapse:collapse;margin-left:42.1991pt" cellspacing="0"><tr style="height:11pt"><td style="width:25pt"><p class="s49" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">1067</p></td><td style="width:27pt"><p class="s49" style="padding-left: 3pt;padding-right: 3pt;text-indent: 0pt;line-height: 10pt;text-align: center;">0:00</p></td><td style="width:259pt"><p class="s49" style="padding-left: 4pt;text-indent: 0pt;line-height: 10pt;text-align: left;">grep PWS *.dtd</p></td></tr><tr style="height:12pt"><td style="width:25pt"><p class="s49" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">1068</p></td><td style="width:27pt"><p class="s49" style="padding-left: 3pt;padding-right: 3pt;text-indent: 0pt;text-align: center;">0:08</p></td><td style="width:259pt"><p class="s49" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">make chapters</p></td></tr><tr style="height:12pt"><td style="width:25pt"><p class="s49" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">1069</p></td><td style="width:27pt"><p class="s49" style="padding-left: 3pt;padding-right: 3pt;text-indent: 0pt;text-align: center;">0:14</p></td><td style="width:259pt"><p class="s49" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">cvs commit -m &#39;Final(?) changes for getting_started.xml&#39;</p></td></tr><tr style="height:11pt"><td style="width:25pt"><p class="s49" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">1070</p></td><td style="width:27pt"><p class="s49" style="padding-left: 3pt;padding-right: 3pt;text-indent: 0pt;line-height: 10pt;text-align: center;">0:00</p></td><td style="width:259pt"><p class="s49" style="padding-left: 4pt;text-indent: 0pt;line-height: 10pt;text-align: left;">make lint |&amp; l</p></td></tr></table><p style="padding-top: 8pt;padding-left: 40pt;text-indent: 18pt;line-height: 115%;text-align: left;">The extra information for the time options isn’t saved unless you set the shell option <span class="s33">extended_history</span>. Setting the option changes the format of the history file, making it harder to share with other shells. Here is how the history lines shown previously were saved to the history file:</p><p class="s29" style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: left;"><a name="bookmark279"><span class="s27">134 </span></a>CHAPTER 6 <span class="s28">■ </span>MORE ABOUT SHELL H I STORY </p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s33" style="padding-left: 42pt;text-indent: 0pt;text-align: left;">: 1087852429:0;grep PWS *.dtd</p><p class="s33" style="padding-top: 1pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">: 1087852683:0;make chapters</p><p class="s33" style="padding-top: 1pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">:  1087852731:0;cvs  commit  -m  &#39;Final(?)  changes  for  getting_started.xml&#39;</p><p class="s33" style="padding-top: 1pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">: 1087854172:0;make lint |&amp; l</p><p style="padding-top: 8pt;padding-left: 41pt;text-indent: 18pt;line-height: 115%;text-align: left;">There is method to this madness. You can actually execute one of those lines. The part between the colon and the semicolon is ignored, and the command line after is executed. This works in <span class="s33">bash</span>, too, so if you happen to read in a <span class="s33">zsh </span>history file in this format into <span class="s33">bash </span>it will work. It will look rather bizarre on the command line, however.</p><p style="padding-left: 41pt;text-indent: 18pt;line-height: 115%;text-align: left;">Until recently, <span class="s33">bash </span>didn’t handle timestamps in history. This was added in version 3 of <span class="s33">bash</span>. To enable it, you set the variable <span class="s33">HISTTIMEFORMAT </span>to a string that specifies the format for times. It’s in the form used by the Unix <span class="s33">strftime </span>function, which we’ll talk about in Chapter 7. That’s all you need to do; there are no additional options to the <span class="s33">history </span>command.</p><p class="s33" style="padding-left: 59pt;text-indent: 0pt;line-height: 10pt;text-align: left;">bash <span class="p">has two slightly more obscure options for the format of history. If you execute</span></p><p class="s33" style="padding-top: 1pt;padding-left: 41pt;text-indent: 0pt;line-height: 115%;text-align: left;">shopt -s cmdhist<span class="p">, multiline commands appear in the same history entry—this happens in the current shell as well as in the output file. This is done by appending a semicolon and then the next line. This isn’t necessary in </span>zsh<span class="p">, which saves multiline commands complete, and in the form you entered them.</span></p><p style="padding-left: 41pt;text-indent: 18pt;line-height: 115%;text-align: left;">The second option is <span class="s33">histlit</span>; this is only useful if <span class="s33">cmdhist </span>is on. In this case, <span class="s33">bash </span>uses newlines instead of semicolons for multiline entries. This is what <span class="s33">zsh </span>normally does; its more powerful multiline editing features mean that it doesn’t require an option to turn it off.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="toc">&nbsp;</p><div class="toc"><a class="toc0" href="part134.htm">Appending to the History List</a><a class="toc0" href="part135.htm">Sharing History</a><a class="toc0" href="part136.htm">Pruning and Massaging the History List</a><a class="toc1" href="part137.htm">bash Features for Pruning History</a><a class="toc1" href="part138.htm">zsh Features for Pruning History</a></div><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part132.htm">&lt; Previous</a><span> | </span><a href="../From Bash to Z Shell.html">Contents</a><span> | </span><a href="part134.htm">Next &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
