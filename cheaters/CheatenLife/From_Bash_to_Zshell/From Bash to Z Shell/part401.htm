<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Debugging Completion Functions</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part400.htm">&lt; Previous</a><span> | </span><a href="../From Bash to Z Shell.html">Contents</a><span> | </span><a href="part402.htm">Next &gt;</a></p><p class="s35" style="padding-left: 42pt;text-indent: 0pt;text-align: left;"><a name="bookmark753">Debugging Completion Functions</a></p><p style="padding-top: 5pt;padding-left: 41pt;text-indent: 0pt;line-height: 115%;text-align: left;">Because completion is interactive in nature, it can be quite hard to debug. Turning the <span class="s33">xtrace </span>option on or putting print statements in the function is not ideal because all the output gets mixed up on the terminal.</p><p style="padding-left: 42pt;text-indent: 18pt;line-height: 115%;text-align: left;">To solve the problem for <span class="s33">xtrace </span>output, there is a widget in <span class="s33">zsh </span>named <span class="s33">_complete_debug</span>. It is normally bound to the key combination Ctrl-x ?. You use it where you would have otherwise pressed Tab, and it captures the trace output in a temporary file. A command to view this temporary file is then placed in your shell history, from which it can quickly be retrieved using the Up Arrow key. That just leaves you with the problem of going through the output and working out what the problem is. It will include trace information for all the helper functions you call along with the completers.</p><p style="padding-left: 42pt;text-indent: 18pt;line-height: 115%;text-align: left;">For simple debug information, you can just use <span class="s33">_message</span>, which is described later on, or <span class="s33">zle -M</span>, which we saw in the section “Outputting Messages” in Chapter 14. These have their limits, however, and are not an option from <span class="s33">bash</span>. The most effective solution is to redirect your debug output into a different terminal window. This is easy enough to do: just open up a new terminal window and run the <span class="s33">tty </span>command (or look in the <span class="s33">TTY </span>shell variable) to see the name of the device corresponding to the terminal. You can then redirect your debug output to this other terminal with a line similar to this:</p><p class="s33" style="padding-top: 6pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">print &quot;words: $words&quot; &gt; /dev/pts/3</p><p style="padding-top: 8pt;padding-left: 42pt;text-indent: 18pt;line-height: 115%;text-align: left;">Since it is common to want to see the special completion variables, you might choose to create a function to print them out. For instance, the following function prints a breakdown of the current word using variables, which we will come to in the section “Prefixes and Suffixes” later in this chapter. We have chosen these because they are often useful to see. The <span class="s33">-c </span>option to <span class="s33">print </span>used here causes the arguments to be listed in columns:</p><p class="s33" style="padding-top: 7pt;padding-left: 51pt;text-indent: -9pt;line-height: 115%;text-align: left;">compstatus() { print -c \</p><p class="s33" style="padding-left: 59pt;text-indent: 0pt;line-height: 115%;text-align: left;">&quot;PREFIX: &lt;$PREFIX&gt;&quot; \ &quot;SUFFIX: &lt;$SUFFIX&gt;&quot; \ &quot;IPREFIX: &lt;$IPREFIX&gt;&quot; \ &quot;ISUFFIX: &lt;$ISUFFIX&gt;&quot;</p><p class="s33" style="padding-left: 42pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part400.htm">&lt; Previous</a><span> | </span><a href="../From Bash to Z Shell.html">Contents</a><span> | </span><a href="part402.htm">Next &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
