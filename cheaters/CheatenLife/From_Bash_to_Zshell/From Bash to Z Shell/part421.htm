<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Tag Loops</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part420.htm">&lt; Previous</a><span> | </span><a href="../From Bash to Z Shell.html">Contents</a><span> | </span><a href="part422.htm">Next &gt;</a></p><p class="s35" style="padding-left: 40pt;text-indent: 0pt;text-align: left;"><a name="bookmark773">Tag Loops</a></p><p style="padding-top: 5pt;padding-left: 40pt;text-indent: 0pt;line-height: 115%;text-align: left;">Tag loops enable the <span class="s33">tag-order </span>style to work. When you see the full form of a tag loop, its workings will become clearer, but there are a number of helper functions that make it simpler by factoring out common constructs.</p><p style="padding-left: 40pt;text-indent: 18pt;line-height: 115%;text-align: left;">At the simplest level, the <span class="s33">_wanted </span>function implements an entire tag loop for you; however, it is restricted to completing one type of thing. For example, the following is similar to the example for <span class="s33">_description</span>:</p><p class="s33" style="padding-top: 7pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">local expl</p><p class="s33" style="padding-top: 1pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">_wanted files expl &#39;PostScript file&#39; _files -g &#39;*.ps(-.)&#39;</p><p style="padding-top: 8pt;padding-left: 40pt;text-indent: 17pt;line-height: 115%;text-align: justify;">The difference functionally between this and <span class="s33">_description </span>is that the <span class="s33">tag-order </span>style can be used to either disable completion in this context or to separate it out for several labels. You will see <span class="s33">_wanted </span>used quite a lot in existing completion functions. You would generally use</p><p class="s33" style="padding-left: 40pt;text-indent: 0pt;line-height: 115%;text-align: left;">_description <span class="p">when calling a function like </span>_users <span class="p">that already contains its own tag loop for the same single tag but where you want a different description from the default.</span></p><p style="padding-left: 40pt;text-indent: 18pt;line-height: 115%;text-align: left;">As with all the functions mentioned here, <span class="s33">_wanted </span>defaults to passing the <span class="s33">compadd </span>options for the description as the first argument to the command it is given (<span class="s33">_files </span>in the previous example). However, when you write your own completion function, descriptions passed to your function should take precedence. A single hyphen can be used to indicate where <span class="s33">_wanted </span>should put the description options. So in this case, you would instead use</p><p class="s33" style="padding-top: 6pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">local expl</p><p class="s33" style="padding-top: 1pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">_wanted files expl &#39;PostScript file&#39; _files &quot;$@&quot; - -g &#39;*.ps(-.)&#39;</p><p style="padding-top: 8pt;padding-left: 40pt;text-indent: 18pt;line-height: 115%;text-align: left;">If you need to complete more than one type of thing, you will need to construct the tag loop yourself. To do this, you first need to initialize the list of tags with a single call to the <span class="s33">_tags </span>function, passing it a list of the possible tags. Then you need a <span class="s33">while </span>loop that runs <span class="s33">_tags </span>without arguments for its condition. Inside the tag loop, you can use the <span class="s33">_requested </span>function in exactly the same way as <span class="s33">_wanted</span>. For example:</p><p class="s33" style="padding-top: 6pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">local expl ret=1</p><p class="s33" style="padding-left: 40pt;text-indent: 0pt;line-height: 24pt;text-align: left;">_tags bookmarks users hosts while _tags; do</p><p class="s33" style="padding-top: 1pt;padding-left: 49pt;text-indent: 0pt;text-align: left;">_requested bookmarks expl bookmark compadd - foo bar &amp;&amp; ret=0</p><p class="s33" style="padding-top: 1pt;padding-left: 49pt;text-indent: 0pt;text-align: left;">_requested users &amp;&amp; _users &amp;&amp; ret=0</p><p class="s33" style="padding-top: 1pt;padding-left: 49pt;text-indent: 0pt;text-align: left;">_requested hosts &amp;&amp; _hosts &amp;&amp; ret=0</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s33" style="padding-left: 49pt;text-indent: 0pt;text-align: left;">(( ret )) || break # <i>leave the loop if matches were added</i></p><p class="s33" style="padding-top: 1pt;padding-left: 40pt;text-indent: 0pt;line-height: 231%;text-align: left;">done return ret</p><p class="s29" style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: left;"><a name="bookmark813"><span class="s27">402 </span></a>CHAPTER 15 <span class="s28">■ </span>W RIT ING COMP LET ION F UNCTI ON S</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 41pt;text-indent: 18pt;line-height: 115%;text-align: justify;">Both <span class="s33">_users </span>and <span class="s33">_hosts </span>have their own tag loops and a suitable default description, so we don’t need to run them directly from <span class="s33">_requested</span>. This skips the unnecessary label loop, which we’ll see in the next section.</p><p style="padding-left: 41pt;text-indent: 18pt;line-height: 115%;text-align: left;">In a situation like this where you don’t need several lines of code to complete one of the things, you can use the <span class="s33">_alternative </span>function instead. It takes <span class="s33">_arguments </span>like specifications. The equivalent, using it, would be</p><p class="s33" style="padding-top: 7pt;padding-left: 50pt;text-indent: -9pt;line-height: 115%;text-align: left;">_alternative  \ &#39;bookmarks:bookmark:(foo  bar)&#39;  \ &#39;users:  :_users&#39;  \</p><p class="s33" style="padding-left: 50pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&#39;hosts:  :_hosts&#39;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part420.htm">&lt; Previous</a><span> | </span><a href="../From Bash to Z Shell.html">Contents</a><span> | </span><a href="part422.htm">Next &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
