<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Case Study 4: Chaining Widgets Together</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part385.htm">&lt; Previous</a><span> | </span><a href="../From Bash to Z Shell.html">Contents</a><span> | </span><a href="part387.htm">Next &gt;</a></p><h4 style="padding-left: 42pt;text-indent: 0pt;text-align: left;"><a name="bookmark717">Case Study 4: Chaining Widgets Together</a></h4><p style="padding-top: 6pt;padding-left: 41pt;text-indent: 0pt;line-height: 115%;text-align: left;">Sometimes it’s useful to know the name of the most recently executed widget. As we’ll see, when you chain a series of widgets together you can sometimes help the user if a later widget takes account of what the previous one was doing. The widget in question is stored in the vari- able <span class="s33">LASTWIDGET</span>. When you enter a widget called by the keyboard or Esc x, the last widget was the previous widget called in that fashion. In other words, it’s the name of the editor action the user thinks they executed before the current one. Remember that typing a key that inserts a character is also a widget, namely <span class="s33">self-insert</span>.</p><p style="padding-left: 41pt;text-indent: 18pt;line-height: 115%;text-align: left;">Here’s an example that uses <span class="s33">LASTWIDGET </span>to maintain your position on the command line when you move up the history list to the line you’ve just entered. In the following example, the position of the cursor is saved in the variable<u> </u><span class="s33">savepos</span>. We do this by changing <span class="s33">accept-line </span>as we did earlier in the chapter. The function <span class="s33">up-history</span>, which is designed to override the real widget of that name, checks whether we’ve just called <span class="s33">accept-line </span>and have set<u> </u><span class="s33">savepos</span>. If we have, we go back up a line and restore the cursor position. Otherwise, we just go back up a line.</p><p class="s29" style="padding-top: 3pt;padding-left: 241pt;text-indent: 0pt;text-align: left;"><a name="bookmark738">CHAP TER 14 </a><span class="s28">■ </span>WRITING EDITOR COMMANDS <span class="s27">361</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s33" style="padding-left: 40pt;text-indent: 0pt;text-align: left;">accept-line() {</p><p class="s33" style="padding-top: 1pt;padding-left: 49pt;text-indent: 0pt;text-align: left;">#  <i>Execute  the  line  as  normal,  but  first  save  the  position.</i></p><p class="s72" style="padding-top: 1pt;padding-left: 49pt;text-indent: 0pt;line-height: 115%;text-align: left;">   <span class="s33">savepos=$CURSOR zle .accept-line</span></p><p class="s33" style="padding-left: 40pt;text-indent: 0pt;text-align: left;">}</p><p class="s33" style="padding-top: 1pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">up-history() {</p><p class="s33" style="padding-top: 1pt;padding-left: 49pt;text-indent: 0pt;text-align: left;">#  <i>Only  use  the  special  behavior  if  we  just  executed  a  line,</i></p><p class="s33" style="padding-top: 1pt;padding-left: 49pt;text-indent: 0pt;text-align: left;"># <i>and only if that left us a saved position.</i></p><p class="s33" style="padding-top: 1pt;padding-left: 49pt;text-indent: 0pt;text-align: left;">if [[ $LASTWIDGET = accept-line ]] &amp;&amp; (( $+<u> </u>savepos )); then</p><p class="s33" style="padding-top: 1pt;padding-left: 58pt;text-indent: 0pt;text-align: left;"># <i>Go up a line and save the position.</i></p><p class="s33" style="padding-top: 1pt;padding-left: 58pt;text-indent: 0pt;line-height: 115%;text-align: left;">zle .up-history CURSOR=<u> </u>savepos</p><p class="s33" style="padding-left: 49pt;text-indent: 0pt;line-height: 10pt;text-align: left;">else</p><p class="s33" style="padding-top: 1pt;padding-left: 58pt;text-indent: 0pt;text-align: left;"># <i>Just go up a line normally</i></p><p class="s33" style="padding-top: 1pt;padding-left: 58pt;text-indent: 0pt;text-align: left;">zle .up-history</p><p class="s33" style="padding-top: 1pt;padding-left: 49pt;text-indent: 0pt;text-align: left;">fi</p><p class="s33" style="padding-top: 1pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part385.htm">&lt; Previous</a><span> | </span><a href="../From Bash to Z Shell.html">Contents</a><span> | </span><a href="part387.htm">Next &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
