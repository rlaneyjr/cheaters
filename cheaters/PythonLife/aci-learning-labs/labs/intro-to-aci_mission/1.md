# Mission: Build a Tenant Using WebArya and Cobra

### Superheroes and Villains Inc.
Superheroes and Villains is an entertainment company facing the challenges of a rapidly changing industry. New leaders in the company have put an emphasis on applications that keep the customers engaged. In order to meet these new requirements, the app teams need to move new applications from test to development to production in a few days, rather than in months that has become the standard.

Superheroes and Villains' IT department is also struggling to keep up with the new demands. New applications are being prototyped and moved to production faster than they are able to prepare the infrastructure and configure the network policies. The application teams have begun to use the Public Cloud as a means to deploy their apps faster, but the leadership has concerns about the security and costs of this approach. In addition to the difficulties of configuring and managing a rapidly changing environment, the infrastructure teams have begun to lose track of what policies are still being used, and what should be removed.

In order to address these concerns, the CTO has decided that ACI will be deployed in their data center. She hopes that its programmability features will alleviate the burden of continuous changes in the network, and help the application teams meet their demands. She also knows that ACI will address the security concerns and help to identify application policies that are no longer in use.

### Application Details
Your boss has asked you to build the first production application on the new ACI fabric using programmability. He has already downloaded a sample configuration from one of the Tenants that was built during the testing phase. He keeps getting interrupted, so he has asked you to correct any mistakes in the JSON configuration file, and to apply the changes to the ACI fabric. This Application, Evolution X, will be used to engage customers through Web, Mobile, and Social Media. The application will belong to a new Tenant called SnV, and they have been allocated the IP range 10.2.10.1/23. It is a 7 tier application composed of:  

  * Web-UI
  * Object-Store
  * API-Gateway
  * Logging
  * Message-Broker
  * User-Data (Database)
  * Analytics (Big Data)

### Prepare Evolution X Configuration
The json file provided by your boss is available in the sample code repo as "evolution_x_boss_config.json," and is also provided below.

#### Edit the configuration file
Open the file in a text editor.
```json
{
    "fvTenant": {
        "attributes": {
            "name": "SnV"
        },
        "children": [
            {
                "fvCtx": {
                    "attributes": {
                        "name": "Superverse"
                    }
                }
            },
            {
                "fvBD": {
                    "attributes": {
                        "name": "antigravity"
                    },
                    "children": [
                        {
                            "fvRsCtx": {
                                "attributes": {
                                    "tnFvCtxName": "Heroes_Only"
                                }
                            }
                        },
                        {
                            "fvSubnet": {
                                "attributes": {
                                    "ip": "10.1.1.1/24",
                                    "name": "Subnet",
                                    "scope": "public"
                                }
                            }
                        }
                    ]
                }
            },
            {
                "vzFilter": {
                    "attributes": {
                        "name": "http"
                    },
                    "children": [
                        {
                            "vzEntry": {
                                "attributes": {
                                    "name": "tcp-80",
                                    "etherT": "ip",
                                    "prot": "tcp",
                                    "dFromPort": "http",
                                    "dToPort": "http"
                                }
                            }
                        }
                    ]
                }
            },
            {
                "vzFilter": {
                    "attributes": {
                        "name": "https"
                    },
                    "children": [
                        {
                            "vzEntry": {
                                "attributes": {
                                    "name": "tcp-443",
                                    "etherT": "ip",
                                    "prot": "tcp",
                                    "dFromPort": "https",
                                    "dToPort": "https"
                                }
                            }
                        }
                    ]
                }
            },
            {
                "vzFilter": {
                    "attributes": {
                        "name": "syslog"
                    },
                    "children": [
                        {
                            "vzEntry": {
                                "attributes": {
                                    "name": "udp-514",
                                    "etherT": "ip",
                                    "prot": "udp",
                                    "dFromPort": "514",
                                    "dToPort": "514"
                                }
                            }
                        }
                    ]
                }
            },
            {
                "vzFilter": {
                    "attributes": {
                        "name": "sql-server"
                    },
                    "children": [
                        {
                            "vzEntry": {
                                "attributes": {
                                    "name": "tcp-1433",
                                    "etherT": "ip",
                                    "prot": "tcp",
                                    "dFromPort": "1433",
                                    "dToPort": "1433"
                                }
                            }
                        }
                    ]
                }
            },
            {
                "vzFilter": {
                    "attributes": {
                        "name": "mqtt"
                    },
                    "children": [
                        {
                            "vzEntry": {
                                "attributes": {
                                    "name": "tcp-1883",
                                    "etherT": "ip",
                                    "prot": "tcp",
                                    "dFromPort": "1883",
                                    "dToPort": "1883"
                                }
                            }
                        }
                    ]
                }
            },
            {
                "vzFilter": {
                    "attributes": {
                        "name": "sql-browser"
                    },
                    "children": [
                        {
                            "vzEntry": {
                                "attributes": {
                                    "name": "udp-1434",
                                    "etherT": "ip",
                                    "prot": "udp",
                                    "dFromPort": "1434",
                                    "dToPort": "1434"
                                }
                            }
                        }
                    ]
                }
            },
            {
                "vzBrCP": {
                    "attributes": {
                        "name": "web-ui"
                    },
                    "children": [
                        {
                            "vzSubj": {
                                "attributes": {
                                    "name": "http"
                                },
                                "children": [
                                    {
                                        "vzRsSubjFiltAtt": {
                                            "attributes": {
                                                "tnVzFilterName": "http"
                                            }
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "vzSubj": {
                                "attributes": {
                                    "name": "https"
                                },
                                "children": [
                                    {
                                        "vzRsSubjFiltAtt": {
                                            "attributes": {
                                                "tnVzFilterName": "https"
                                            }
                                        }
                                    }
                                ]
                            }
                        }
                    ]
                }
            },
            {
                "vzBrCP": {
                    "attributes": {
                        "name": "object-store"
                    },
                    "children": [
                        {
                            "vzSubj": {
                                "attributes": {
                                    "name": "http"
                                },
                                "children": [
                                    {
                                        "vzRsSubjFiltAtt": {
                                            "attributes": {
                                                "tnVzFilterName": "http"
                                            }
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "vzSubj": {
                                "attributes": {
                                    "name": "https"
                                },
                                "children": [
                                    {
                                        "vzRsSubjFiltAtt": {
                                            "attributes": {
                                                "tnVzFilterName": "https"
                                            }
                                        }
                                    }
                                ]
                            }
                        }
                    ]
                }
            },
            {
                "vzBrCP": {
                    "attributes": {
                        "name": "api-gateway"
                    },
                    "children": [
                        {
                            "vzSubj": {
                                "attributes": {
                                    "name": "http"
                                },
                                "children": [
                                    {
                                        "vzRsSubjFiltAtt": {
                                            "attributes": {
                                                "tnVzFilterName": "http"
                                            }
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "vzSubj": {
                                "attributes": {
                                    "name": "https"
                                },
                                "children": [
                                    {
                                        "vzRsSubjFiltAtt": {
                                            "attributes": {
                                                "tnVzFilterName": "https"
                                            }
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "vzSubj": {
                                "attributes": {
                                    "name": "mqtt"
                                },
                                "children": [
                                    {
                                        "vzRsSubjFiltAtt": {
                                            "attributes": {
                                                "tnVzFilterName": "mqtt"
                                            }
                                        }
                                    }
                                ]
                            }
                        }
                    ]
                }
            },
            {
                "vzBrCP": {
                    "attributes": {
                        "name": "logging"
                    },
                    "children": [
                        {
                            "vzSubj": {
                                "attributes": {
                                    "name": "syslog"
                                },
                                "children": [
                                    {
                                        "vzRsSubjFiltAtt": {
                                            "attributes": {
                                                "tnVzFilterName": "syslog"
                                            }
                                        }
                                    }
                                ]
                            }
                        }
                    ]
                }
            },
            {
                "vzBrCP": {
                    "attributes": {
                        "name": "message-broker"
                    },
                    "children": [
                        {
                            "vzSubj": {
                                "attributes": {
                                    "name": "mqtt"
                                },
                                "children": [
                                    {
                                        "vzRsSubjFiltAtt": {
                                            "attributes": {
                                                "tnVzFilterName": "mqtt"
                                            }
                                        }
                                    }
                                ]
                            }
                        }
                    ]
                }
            },
            {
                "vzBrCP": {
                    "attributes": {
                        "name": "user-data"
                    },
                    "children": [
                        {
                            "vzSubj": {
                                "attributes": {
                                    "name": "sql-server"
                                },
                                "children": [
                                    {
                                        "vzRsSubjFiltAtt": {
                                            "attributes": {
                                                "tnVzFilterName": "sql-server"
                                            }
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "vzSubj": {
                                "attributes": {
                                    "name": "sql-browser"
                                },
                                "children": [
                                    {
                                        "vzRsSubjFiltAtt": {
                                            "attributes": {
                                                "tnVzFilterName": "sql-browser"
                                            }
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "vzSubj": {
                                "attributes": {
                                    "name": "mqtt"
                                },
                                "children": [
                                    {
                                        "vzRsSubjFiltAtt": {
                                            "attributes": {
                                                "tnVzFilterName": "mqtt"
                                            }
                                        }
                                    }
                                ]
                            }
                        }
                    ]
                }
            },
            {
                "vzBrCP": {
                    "attributes": {
                        "name": "analytics"
                    },
                    "children": [
                        {
                            "vzSubj": {
                                "attributes": {
                                    "name": "mqtt"
                                },
                                "children": [
                                    {
                                        "vzRsSubjFiltAtt": {
                                            "attributes": {
                                                "tnVzFilterName": "mqtt"
                                            }
                                        }
                                    }
                                ]
                            }
                        }
                    ]
                }
            },
            {
                "fvAp": {
                    "attributes": {
                        "name": "Evolution_X"
                    },
                    "children": [
                        {
                            "fvAEPg": {
                                "attributes": {
                                    "name": "Web-UI"
                                },
                                "children": [
                                    {
                                        "fvRsCons": {
                                            "attributes": {
                                                "tnVzBrCPName": "api-gateway"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsCons": {
                                            "attributes": {
                                                "tnVzBrCPName": "object-store"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsCons": {
                                            "attributes": {
                                                "tnVzBrCPName": "logging"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsPathAtt": {
                                            "attributes": {
                                                "encap": "vlan-110",
                                                "tDn": "topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsPathAtt": {
                                            "attributes": {
                                                "encap": "vlan-110",
                                                "tDn": "topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsDomAtt": {
                                            "attributes": {
                                                "tDn": "uni/phys-SnV_phys"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsBd": {
                                            "attributes": {
                                                "tnFvBDName": ""
                                            }
                                        }
                                    },
                                    {
                                        "fvRsProv": {
                                            "attributes": {
                                                "tnVzBrCPName": "web-ui"
                                            }
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "fvAEPg": {
                                "attributes": {
                                    "name": "Object-Store"
                                },
                                "children": [
                                    {
                                        "fvRsCons": {
                                            "attributes": {
                                                "tnVzBrCPName": "logging"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsPathAtt": {
                                            "attributes": {
                                                "encap": "vlan-111",
                                                "tDn": "topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsPathAtt": {
                                            "attributes": {
                                                "encap": "vlan-111",
                                                "tDn": "topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsDomAtt": {
                                            "attributes": {
                                                "tDn": "uni/phys-SnV_phys"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsBd": {
                                            "attributes": {
                                                "tnFvBDName": "antigravity"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsProv": {
                                            "attributes": {
                                                "tnVzBrCPName": "object-store"
                                            }
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "fvAEPg": {
                                "attributes": {
                                    "name": "API-Gateway"
                                },
                                "children": [
                                    {
                                        "fvRsCons": {
                                            "attributes": {
                                                "tnVzBrCPName": "message-broker"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsCons": {
                                            "attributes": {
                                                "tnVzBrCPName": "logging"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsPathAtt": {
                                            "attributes": {
                                                "encap": "vlan-112",
                                                "tDn": "topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsPathAtt": {
                                            "attributes": {
                                                "encap": "vlan-112",
                                                "tDn": "topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsDomAtt": {
                                            "attributes": {
                                                "tDn": "uni/phys-SnV_phys"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsBd": {
                                            "attributes": {
                                                "tnFvBDName": "antigravity"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsProv": {
                                            "attributes": {
                                                "tnVzBrCPName": "api-gateway"
                                            }
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "fvAEPg": {
                                "attributes": {
                                    "name": "Logging"
                                },
                                "children": [
                                    {
                                        "fvRsPathAtt": {
                                            "attributes": {
                                                "encap": "vlan-112",
                                                "tDn": "topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsPathAtt": {
                                            "attributes": {
                                                "encap": "vlan-112",
                                                "tDn": "topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsDomAtt": {
                                            "attributes": {
                                                "tDn": "uni/phys-SnV_phys"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsBd": {
                                            "attributes": {
                                                "tnFvBDName": "antigravity"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsProv": {
                                            "attributes": {
                                                "tnVzBrCPName": "logging"
                                            }
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "fvAEPg": {
                                "attributes": {
                                    "name": "Message-Broker"
                                },
                                "children": [
                                    {
                                        "fvRsCons": {
                                            "attributes": {
                                                "tnVzBrCPName": "api-gateway"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsCons": {
                                            "attributes": {
                                                "tnVzBrCPName": "user-data"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsCons": {
                                            "attributes": {
                                                "tnVzBrCPName": "analytics"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsCons": {
                                            "attributes": {
                                                "tnVzBrCPName": "logging"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsPathAtt": {
                                            "attributes": {
                                                "encap": "vlan-112",
                                                "tDn": "topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsPathAtt": {
                                            "attributes": {
                                                "encap": "vlan-112",
                                                "tDn": "topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsDomAtt": {
                                            "attributes": {
                                                "tDn": "uni/phys-SnV_phys"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsBd": {
                                            "attributes": {
                                                "tnFvBDName": "antigravity"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsProv": {
                                            "attributes": {
                                                "tnVzBrCPName": "message-broker"
                                            }
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "fvAEPg": {
                                "attributes": {
                                    "name": "User-Data"
                                },
                                "children": [
                                    {
                                        "fvRsCons": {
                                            "attributes": {
                                                "tnVzBrCPName": "message-broker"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsCons": {
                                            "attributes": {
                                                "tnVzBrCPName": "logging"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsPathAtt": {
                                            "attributes": {
                                                "encap": "vlan-112",
                                                "tDn": "topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsPathAtt": {
                                            "attributes": {
                                                "encap": "vlan-112",
                                                "tDn": "topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsDomAtt": {
                                            "attributes": {
                                                "tDn": "uni/phys-SnV_phys"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsBd": {
                                            "attributes": {
                                                "tnFvBDName": "antigravity"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsProv": {
                                            "attributes": {
                                                "tnVzBrCPName": "user-data"
                                            }
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "fvAEPg": {
                                "attributes": {
                                    "name": "Analytics"
                                },
                                "children": [
                                    {
                                        "fvRsCons": {
                                            "attributes": {
                                                "tnVzBrCPName": "message-broker"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsCons": {
                                            "attributes": {
                                                "tnVzBrCPName": "logging"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsPathAtt": {
                                            "attributes": {
                                                "encap": "vlan-112",
                                                "tDn": "topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsPathAtt": {
                                            "attributes": {
                                                "encap": "vlan-112",
                                                "tDn": "topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsDomAtt": {
                                            "attributes": {
                                                "tDn": "uni/phys-SnV_phys"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsBd": {
                                            "attributes": {
                                                "tnFvBDName": "antigravity"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsProv": {
                                            "attributes": {
                                                "tnVzBrCPName": "analytics"
                                            }
                                        }
                                    }
                                ]
                            }
                        }
                    ]
                }
            }
        ]
    }
}
```

#### Correct Bridge Domain Objects
When you open the file, you should notice a few places where your boss forgot to make updates. He has named the VRF `Superverse`. Remember that ACI uses "Context" to refer to the VRF object, and the API uses `fvCtx` as the MO class name.
```json
            {
                "fvCtx": {
                    "attributes": {
                        "name": "Superverse"
                    }
                }
            },
```

However, it looks like the "children" of Bridge Domain still have the configuraton from the test Tenant, "Hereos." In Cobra, the Bridge Domain is named `fvBD`, so find that section and look at the "children" objects. The first child object is for the VRF, and the second child is for the Subnet configuration. Update the proper fields with the new VRF and IP Range (Remember to use the gateway address, and not the Network address).
```json
            {
                "fvBD": {
                    "attributes": {
                        "name": "antigravity"
                    },
                    "children": [
                        {
                            "fvRsCtx": {
                                "attributes": {
                                    "tnFvCtxName": "Heroes_Only"
                                }
                            }
                        },
                        {
                            "fvSubnet": {
                                "attributes": {
                                    "ip": "10.1.1.1/24",
                                    "name": "Subnet",
                                    "scope": "public"
                                }
                            }
                        }
                    ]
                }
            }
```

#### Correct the VLAN assignments
It also looks like the Logging, Message-Broker, User-Data, and Analytics EPGs were copied from the API-Gateway EPG, but the VLAN assignments were not changed. These four EPGs should be assigned from VLAN 113 - 116.
```json
                                    {
                                        "fvRsPathAtt": {
                                            "attributes": {
                                                "encap": "vlan-212",
                                                "tDn": "topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]"
                                            }
                                        }
                                    },
                                    {
                                        "fvRsPathAtt": {
                                            "attributes": {
                                                "encap": "vlan-212",
                                                "tDn": "topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]"
                                            }
                                        }
                                    }
```

### Configure Evolution X

#### Use Arya to build a Python Script
Open WebArya to the main page and load in the corrected JSON data and click "Submit."

![Mission1 WebArya Json](/posts/files/intro-to-aci_mission/assets/images/mission1_webarya_json.png)

You will want to copy the shebang **#!/usr/bin/env python** and from **# list of packages that should be imported for this code to work** to the end of the file. The script is available in the sample code repo as snv_webarya_output.py, and is also provided below:
```python
#!/usr/bin/env python

# list of packages that should be imported for this code to work
import cobra.mit.access
import cobra.mit.request
import cobra.mit.session
import cobra.model.fv
import cobra.model.pol
import cobra.model.vz
from cobra.internal.codec.xmlcodec import toXMLStr

# log into an APIC and create a directory object
ls = cobra.mit.session.LoginSession('https://1.1.1.1', 'admin', 'password')
md = cobra.mit.access.MoDirectory(ls)
md.login()

# the top level object on which operations will be made
topMo = cobra.model.pol.Uni('')


# build the request using cobra syntax
fvTenant = cobra.model.fv.Tenant(topMo, name=u'SnV')
fvCtx = cobra.model.fv.Ctx(fvTenant, name=u'Superverse')
fvBD = cobra.model.fv.BD(fvTenant, name=u'antigravity')
fvRsCtx = cobra.model.fv.RsCtx(fvBD, tnFvCtxName=u'Superverse')
fvSubnet = cobra.model.fv.Subnet(fvBD, ip=u'10.2.10.1/23', name=u'Subnet')
vzFilter = cobra.model.vz.Filter(fvTenant, name=u'http')
vzEntry = cobra.model.vz.Entry(vzFilter, etherT=u'ip', prot=u'tcp', dFromPort=u'http', name=u'tcp-80', dToPort=u'http')
vzFilter2 = cobra.model.vz.Filter(fvTenant, name=u'https')
vzEntry2 = cobra.model.vz.Entry(vzFilter2, etherT=u'ip', prot=u'tcp', dFromPort=u'https', name=u'tcp-443', dToPort=u'https')
vzFilter3 = cobra.model.vz.Filter(fvTenant, name=u'syslog')
vzEntry3 = cobra.model.vz.Entry(vzFilter3, etherT=u'ip', prot=u'udp', dFromPort=u'514', name=u'udp-514', dToPort=u'514')
vzFilter4 = cobra.model.vz.Filter(fvTenant, name=u'sql-server')
vzEntry4 = cobra.model.vz.Entry(vzFilter4, etherT=u'ip', prot=u'tcp', dFromPort=u'1433', name=u'tcp-1433', dToPort=u'1433')
vzFilter5 = cobra.model.vz.Filter(fvTenant, name=u'mqtt')
vzEntry5 = cobra.model.vz.Entry(vzFilter5, etherT=u'ip', prot=u'tcp', dFromPort=u'1883', name=u'tcp-1883', dToPort=u'1883')
vzFilter6 = cobra.model.vz.Filter(fvTenant, name=u'sql-browser')
vzEntry6 = cobra.model.vz.Entry(vzFilter6, etherT=u'ip', prot=u'udp', dFromPort=u'1434', name=u'udp-1434', dToPort=u'1434')
vzBrCP = cobra.model.vz.BrCP(fvTenant, name=u'web-ui')
vzSubj = cobra.model.vz.Subj(vzBrCP, name=u'http')
vzRsSubjFiltAtt = cobra.model.vz.RsSubjFiltAtt(vzSubj, tnVzFilterName=u'http')
vzSubj2 = cobra.model.vz.Subj(vzBrCP, name=u'https')
vzRsSubjFiltAtt2 = cobra.model.vz.RsSubjFiltAtt(vzSubj2, tnVzFilterName=u'https')
vzBrCP2 = cobra.model.vz.BrCP(fvTenant, name=u'object-store')
vzSubj3 = cobra.model.vz.Subj(vzBrCP2, name=u'http')
vzRsSubjFiltAtt3 = cobra.model.vz.RsSubjFiltAtt(vzSubj3, tnVzFilterName=u'http')
vzSubj4 = cobra.model.vz.Subj(vzBrCP2, name=u'https')
vzRsSubjFiltAtt4 = cobra.model.vz.RsSubjFiltAtt(vzSubj4, tnVzFilterName=u'https')
vzBrCP3 = cobra.model.vz.BrCP(fvTenant, name=u'api-gateway')
vzSubj5 = cobra.model.vz.Subj(vzBrCP3, name=u'http')
vzRsSubjFiltAtt5 = cobra.model.vz.RsSubjFiltAtt(vzSubj5, tnVzFilterName=u'http')
vzSubj6 = cobra.model.vz.Subj(vzBrCP3, name=u'https')
vzRsSubjFiltAtt6 = cobra.model.vz.RsSubjFiltAtt(vzSubj6, tnVzFilterName=u'https')
vzSubj7 = cobra.model.vz.Subj(vzBrCP3, name=u'mqtt')
vzRsSubjFiltAtt7 = cobra.model.vz.RsSubjFiltAtt(vzSubj7, tnVzFilterName=u'mqtt')
vzBrCP4 = cobra.model.vz.BrCP(fvTenant, name=u'logging')
vzSubj8 = cobra.model.vz.Subj(vzBrCP4, name=u'syslog')
vzRsSubjFiltAtt8 = cobra.model.vz.RsSubjFiltAtt(vzSubj8, tnVzFilterName=u'syslog')
vzBrCP5 = cobra.model.vz.BrCP(fvTenant, name=u'message-broker')
vzSubj9 = cobra.model.vz.Subj(vzBrCP5, name=u'mqtt')
vzRsSubjFiltAtt9 = cobra.model.vz.RsSubjFiltAtt(vzSubj9, tnVzFilterName=u'mqtt')
vzBrCP6 = cobra.model.vz.BrCP(fvTenant, name=u'user-data')
vzSubj10 = cobra.model.vz.Subj(vzBrCP6, name=u'sql-server')
vzRsSubjFiltAtt10 = cobra.model.vz.RsSubjFiltAtt(vzSubj10, tnVzFilterName=u'sql-server')
vzSubj11 = cobra.model.vz.Subj(vzBrCP6, name=u'sql-browser')
vzRsSubjFiltAtt11 = cobra.model.vz.RsSubjFiltAtt(vzSubj11, tnVzFilterName=u'sql-browser')
vzSubj12 = cobra.model.vz.Subj(vzBrCP6, name=u'mqtt')
vzRsSubjFiltAtt12 = cobra.model.vz.RsSubjFiltAtt(vzSubj12, tnVzFilterName=u'mqtt')
vzBrCP7 = cobra.model.vz.BrCP(fvTenant, name=u'analytics')
vzSubj13 = cobra.model.vz.Subj(vzBrCP7, name=u'mqtt')
vzRsSubjFiltAtt13 = cobra.model.vz.RsSubjFiltAtt(vzSubj13, tnVzFilterName=u'mqtt')
fvAp = cobra.model.fv.Ap(fvTenant, name=u'Evolution_X')
fvAEPg = cobra.model.fv.AEPg(fvAp, name=u'Web-UI')
fvRsCons = cobra.model.fv.RsCons(fvAEPg, tnVzBrCPName=u'api-gateway')
fvRsCons2 = cobra.model.fv.RsCons(fvAEPg, tnVzBrCPName=u'object-store')
fvRsCons3 = cobra.model.fv.RsCons(fvAEPg, tnVzBrCPName=u'logging')
fvRsPathAtt = cobra.model.fv.RsPathAtt(fvAEPg, tDn=u'topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]', encap=u'vlan-110')
fvRsPathAtt2 = cobra.model.fv.RsPathAtt(fvAEPg, tDn=u'topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]', encap=u'vlan-110')
fvRsDomAtt = cobra.model.fv.RsDomAtt(fvAEPg, tDn=u'uni/phys-SnV_phys')
fvRsBd = cobra.model.fv.RsBd(fvAEPg, tnFvBDName=u'')
fvRsProv = cobra.model.fv.RsProv(fvAEPg, tnVzBrCPName=u'web-ui')
fvAEPg2 = cobra.model.fv.AEPg(fvAp, name=u'Object-Store')
fvRsCons4 = cobra.model.fv.RsCons(fvAEPg2, tnVzBrCPName=u'logging')
fvRsPathAtt3 = cobra.model.fv.RsPathAtt(fvAEPg2, tDn=u'topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]', encap=u'vlan-111')
fvRsPathAtt4 = cobra.model.fv.RsPathAtt(fvAEPg2, tDn=u'topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]', encap=u'vlan-111')
fvRsDomAtt2 = cobra.model.fv.RsDomAtt(fvAEPg2, tDn=u'uni/phys-SnV_phys')
fvRsBd2 = cobra.model.fv.RsBd(fvAEPg2, tnFvBDName=u'antigravity')
fvRsProv2 = cobra.model.fv.RsProv(fvAEPg2, tnVzBrCPName=u'object-store')
fvAEPg3 = cobra.model.fv.AEPg(fvAp, name=u'API-Gateway')
fvRsCons5 = cobra.model.fv.RsCons(fvAEPg3, tnVzBrCPName=u'message-broker')
fvRsCons6 = cobra.model.fv.RsCons(fvAEPg3, tnVzBrCPName=u'logging')
fvRsPathAtt5 = cobra.model.fv.RsPathAtt(fvAEPg3, tDn=u'topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]', encap=u'vlan-112')
fvRsPathAtt6 = cobra.model.fv.RsPathAtt(fvAEPg3, tDn=u'topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]', encap=u'vlan-112')
fvRsDomAtt3 = cobra.model.fv.RsDomAtt(fvAEPg3, tDn=u'uni/phys-SnV_phys')
fvRsBd3 = cobra.model.fv.RsBd(fvAEPg3, tnFvBDName=u'antigravity')
fvRsProv3 = cobra.model.fv.RsProv(fvAEPg3, tnVzBrCPName=u'api-gateway')
fvAEPg4 = cobra.model.fv.AEPg(fvAp, name=u'Logging')
fvRsPathAtt7 = cobra.model.fv.RsPathAtt(fvAEPg4, tDn=u'topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]', encap=u'vlan-113')
fvRsPathAtt8 = cobra.model.fv.RsPathAtt(fvAEPg4, tDn=u'topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]', encap=u'vlan-113')
fvRsDomAtt4 = cobra.model.fv.RsDomAtt(fvAEPg4, tDn=u'uni/phys-SnV_phys')
fvRsBd4 = cobra.model.fv.RsBd(fvAEPg4, tnFvBDName=u'antigravity')
fvRsProv4 = cobra.model.fv.RsProv(fvAEPg4, tnVzBrCPName=u'logging')
fvAEPg5 = cobra.model.fv.AEPg(fvAp, name=u'Message-Broker')
fvRsCons7 = cobra.model.fv.RsCons(fvAEPg5, tnVzBrCPName=u'api-gateway')
fvRsCons8 = cobra.model.fv.RsCons(fvAEPg5, tnVzBrCPName=u'user-data')
fvRsCons9 = cobra.model.fv.RsCons(fvAEPg5, tnVzBrCPName=u'analytics')
fvRsCons10 = cobra.model.fv.RsCons(fvAEPg5, tnVzBrCPName=u'logging')
fvRsPathAtt9 = cobra.model.fv.RsPathAtt(fvAEPg5, tDn=u'topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]', encap=u'vlan-114')
fvRsPathAtt10 = cobra.model.fv.RsPathAtt(fvAEPg5, tDn=u'topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]', encap=u'vlan-114')
fvRsDomAtt5 = cobra.model.fv.RsDomAtt(fvAEPg5, tDn=u'uni/phys-SnV_phys')
fvRsBd5 = cobra.model.fv.RsBd(fvAEPg5, tnFvBDName=u'antigravity')
fvRsProv5 = cobra.model.fv.RsProv(fvAEPg5, tnVzBrCPName=u'message-broker')
fvAEPg6 = cobra.model.fv.AEPg(fvAp, name=u'User-Data')
fvRsCons11 = cobra.model.fv.RsCons(fvAEPg6, tnVzBrCPName=u'message-broker')
fvRsCons12 = cobra.model.fv.RsCons(fvAEPg6, tnVzBrCPName=u'logging')
fvRsPathAtt11 = cobra.model.fv.RsPathAtt(fvAEPg6, tDn=u'topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]', encap=u'vlan-115')
fvRsPathAtt12 = cobra.model.fv.RsPathAtt(fvAEPg6, tDn=u'topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]', encap=u'vlan-115')
fvRsDomAtt6 = cobra.model.fv.RsDomAtt(fvAEPg6, tDn=u'uni/phys-SnV_phys')
fvRsBd6 = cobra.model.fv.RsBd(fvAEPg6, tnFvBDName=u'antigravity')
fvRsProv6 = cobra.model.fv.RsProv(fvAEPg6, tnVzBrCPName=u'user-data')
fvAEPg7 = cobra.model.fv.AEPg(fvAp, name=u'Analytics')
fvRsCons13 = cobra.model.fv.RsCons(fvAEPg7, tnVzBrCPName=u'message-broker')
fvRsCons14 = cobra.model.fv.RsCons(fvAEPg7, tnVzBrCPName=u'logging')
fvRsPathAtt13 = cobra.model.fv.RsPathAtt(fvAEPg7, tDn=u'topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]', encap=u'vlan-116')
fvRsPathAtt14 = cobra.model.fv.RsPathAtt(fvAEPg7, tDn=u'topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]', encap=u'vlan-116')
fvRsDomAtt7 = cobra.model.fv.RsDomAtt(fvAEPg7, tDn=u'uni/phys-SnV_phys')
fvRsBd7 = cobra.model.fv.RsBd(fvAEPg7, tnFvBDName=u'antigravity')
fvRsProv7 = cobra.model.fv.RsProv(fvAEPg7, tnVzBrCPName=u'analytics')


# commit the generated code to APIC
print toXMLStr(topMo)
c = cobra.mit.request.ConfigRequest()
c.addMo(topMo)
md.commit(c)

```

#### Update the Python Script
Before the script will execute properly, a couple of lines need to be updated. The first line is the login values need to be updated to the correct URL, Username, and Password. Change `ls = cobra.mit.session.LoginSession('https://1.1.1.1', 'admin', 'password')`
to `ls = cobra.mit.session.LoginSession('https://1.1.1.1', 'admin', 'password')`.

In this example, Arya adds the incorrect object to the configuration request; it should be fvTenant since that is the top level object you are configuring.
Change `c.addMo(topMo)` to `c.addMo(fvTenant)` and the script should be ready for use. The updated script is saved as evolution_x.py in the sample code repo.

Make sure to save the script as evolution_x.py

#### Build the new Tenant and Application
The final step is to execute the python file to build Superheroes and Villains' the first Application in ACI. This is can be done in the terminal window:
```bash
$ python evolution_x.py
polUni status='created,modified'><fvTenant name='SnV' status='created,modified'><fvBD status='created,modified' name='antigravity'><fvSubnet name='Subnet' ip='10.2.10.1/23' status='created,modified'></fvSubnet><fvRsCtx status='created,modified' tnFvCtxName='Superverse'></fvRsCtx></fvBD><vzBrCP name='logging' status='created,modified'><vzSubj name='syslog' status='created,modified'><vzRsSubjFiltAtt status='created,modified' tnVzFilterName='syslog'></vzRsSubjFiltAtt></vzSubj></vzBrCP><vzBrCP name='user-data' status='created,modified'><vzSubj name='sql-browser' status='created,modified'><vzRsSubjFiltAtt status='created,modified' tnVzFilterName='sql-browser'></vzRsSubjFiltAtt></vzSubj><vzSubj name='sql-server' status='created,modified'><vzRsSubjFiltAtt status='created,modified' tnVzFilterName='sql-server'></vzRsSubjFiltAtt></vzSubj><vzSubj name='mqtt' status='created,modified'><vzRsSubjFiltAtt status='created,modified' tnVzFilterName='mqtt'></vzRsSubjFiltAtt></vzSubj></vzBrCP><vzBrCP name='api-gateway' status='created,modified'><vzSubj name='mqtt' status='created,modified'><vzRsSubjFiltAtt status='created,modified' tnVzFilterName='mqtt'></vzRsSubjFiltAtt></vzSubj><vzSubj name='http' status='created,modified'><vzRsSubjFiltAtt status='created,modified' tnVzFilterName='http'></vzRsSubjFiltAtt></vzSubj><vzSubj name='https' status='created,modified'><vzRsSubjFiltAtt status='created,modified' tnVzFilterName='https'></vzRsSubjFiltAtt></vzSubj></vzBrCP><vzBrCP name='analytics' status='created,modified'><vzSubj name='mqtt' status='created,modified'><vzRsSubjFiltAtt status='created,modified' tnVzFilterName='mqtt'></vzRsSubjFiltAtt></vzSubj></vzBrCP><vzBrCP name='web-ui' status='created,modified'><vzSubj name='http' status='created,modified'><vzRsSubjFiltAtt status='created,modified' tnVzFilterName='http'></vzRsSubjFiltAtt></vzSubj><vzSubj name='https' status='created,modified'><vzRsSubjFiltAtt status='created,modified' tnVzFilterName='https'></vzRsSubjFiltAtt></vzSubj></vzBrCP><vzBrCP name='object-store' status='created,modified'><vzSubj name='http' status='created,modified'><vzRsSubjFiltAtt status='created,modified' tnVzFilterName='http'></vzRsSubjFiltAtt></vzSubj><vzSubj name='https' status='created,modified'><vzRsSubjFiltAtt status='created,modified' tnVzFilterName='https'></vzRsSubjFiltAtt></vzSubj></vzBrCP><vzBrCP name='message-broker' status='created,modified'><vzSubj name='mqtt' status='created,modified'><vzRsSubjFiltAtt status='created,modified' tnVzFilterName='mqtt'></vzRsSubjFiltAtt></vzSubj></vzBrCP><fvCtx name='Superverse' status='created,modified'></fvCtx><vzFilter name='http' status='created,modified'><vzEntry status='created,modified' etherT='ip' prot='tcp' dFromPort='http' dToPort='http' name='tcp-80'></vzEntry></vzFilter><vzFilter name='sql-browser' status='created,modified'><vzEntry status='created,modified' etherT='ip' prot='udp' dFromPort='1434' dToPort='1434' name='udp-1434'></vzEntry></vzFilter><vzFilter name='sql-server' status='created,modified'><vzEntry status='created,modified' etherT='ip' prot='tcp' dFromPort='1433' dToPort='1433' name='tcp-1433'></vzEntry></vzFilter><vzFilter name='syslog' status='created,modified'><vzEntry status='created,modified' etherT='ip' prot='udp' dFromPort='514' dToPort='514' name='udp-514'></vzEntry></vzFilter><vzFilter name='mqtt' status='created,modified'><vzEntry status='created,modified' etherT='ip' prot='tcp' dFromPort='1883' dToPort='1883' name='tcp-1883'></vzEntry></vzFilter><vzFilter name='https' status='created,modified'><vzEntry status='created,modified' etherT='ip' prot='tcp' dFromPort='https' dToPort='https' name='tcp-443'></vzEntry></vzFilter><fvAp name='Evolution_X' status='created,modified'><fvAEPg name='Logging' status='created,modified'><fvRsPathAtt status='created,modified' encap='vlan-113' tDn='topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]'></fvRsPathAtt><fvRsPathAtt status='created,modified' encap='vlan-113' tDn='topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]'></fvRsPathAtt><fvRsDomAtt status='created,modified' tDn='uni/phys-SnV_phys'></fvRsDomAtt><fvRsProv status='created,modified' tnVzBrCPName='logging'></fvRsProv><fvRsBd status='created,modified' tnFvBDName='antigravity'></fvRsBd></fvAEPg><fvAEPg name='User-Data' status='created,modified'><fvRsCons status='created,modified' tnVzBrCPName='logging'></fvRsCons><fvRsCons status='created,modified' tnVzBrCPName='message-broker'></fvRsCons><fvRsPathAtt status='created,modified' encap='vlan-115' tDn='topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]'></fvRsPathAtt><fvRsPathAtt status='created,modified' encap='vlan-115' tDn='topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]'></fvRsPathAtt><fvRsDomAtt status='created,modified' tDn='uni/phys-SnV_phys'></fvRsDomAtt><fvRsProv status='created,modified' tnVzBrCPName='user-data'></fvRsProv><fvRsBd status='created,modified' tnFvBDName='antigravity'></fvRsBd></fvAEPg><fvAEPg name='API-Gateway' status='created,modified'><fvRsCons status='created,modified' tnVzBrCPName='logging'></fvRsCons><fvRsCons status='created,modified' tnVzBrCPName='message-broker'></fvRsCons><fvRsPathAtt status='created,modified' encap='vlan-112' tDn='topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]'></fvRsPathAtt><fvRsPathAtt status='created,modified' encap='vlan-112' tDn='topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]'></fvRsPathAtt><fvRsDomAtt status='created,modified' tDn='uni/phys-SnV_phys'></fvRsDomAtt><fvRsProv status='created,modified' tnVzBrCPName='api-gateway'></fvRsProv><fvRsBd status='created,modified' tnFvBDName='antigravity'></fvRsBd></fvAEPg><fvAEPg name='Analytics' status='created,modified'><fvRsCons status='created,modified' tnVzBrCPName='logging'></fvRsCons><fvRsCons status='created,modified' tnVzBrCPName='message-broker'></fvRsCons><fvRsPathAtt status='created,modified' encap='vlan-116' tDn='topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]'></fvRsPathAtt><fvRsPathAtt status='created,modified' encap='vlan-116' tDn='topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]'></fvRsPathAtt><fvRsDomAtt status='created,modified' tDn='uni/phys-SnV_phys'></fvRsDomAtt><fvRsProv status='created,modified' tnVzBrCPName='analytics'></fvRsProv><fvRsBd status='created,modified' tnFvBDName='antigravity'></fvRsBd></fvAEPg><fvAEPg name='Web-UI' status='created,modified'><fvRsCons status='created,modified' tnVzBrCPName='object-store'></fvRsCons><fvRsCons status='created,modified' tnVzBrCPName='logging'></fvRsCons><fvRsCons status='created,modified' tnVzBrCPName='api-gateway'></fvRsCons><fvRsPathAtt status='created,modified' encap='vlan-110' tDn='topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]'></fvRsPathAtt><fvRsPathAtt status='created,modified' encap='vlan-110' tDn='topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]'></fvRsPathAtt><fvRsDomAtt status='created,modified' tDn='uni/phys-SnV_phys'></fvRsDomAtt><fvRsProv status='created,modified' tnVzBrCPName='web-ui'></fvRsProv><fvRsBd status='created,modified' tnFvBDName=''></fvRsBd></fvAEPg><fvAEPg name='Object-Store' status='created,modified'><fvRsCons status='created,modified' tnVzBrCPName='logging'></fvRsCons><fvRsPathAtt status='created,modified' encap='vlan-111' tDn='topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]'></fvRsPathAtt><fvRsPathAtt status='created,modified' encap='vlan-111' tDn='topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]'></fvRsPathAtt><fvRsDomAtt status='created,modified' tDn='uni/phys-SnV_phys'></fvRsDomAtt><fvRsProv status='created,modified' tnVzBrCPName='object-store'></fvRsProv><fvRsBd status='created,modified' tnFvBDName='antigravity'></fvRsBd></fvAEPg><fvAEPg name='Message-Broker' status='created,modified'><fvRsCons status='created,modified' tnVzBrCPName='analytics'></fvRsCons><fvRsCons status='created,modified' tnVzBrCPName='logging'></fvRsCons><fvRsCons status='created,modified' tnVzBrCPName='api-gateway'></fvRsCons><fvRsCons status='created,modified' tnVzBrCPName='user-data'></fvRsCons><fvRsPathAtt status='created,modified' encap='vlan-114' tDn='topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1B]'></fvRsPathAtt><fvRsPathAtt status='created,modified' encap='vlan-114' tDn='topology/pod-1/protpaths-101-102/pathep-[SnV_FI-1A]'></fvRsPathAtt><fvRsDomAtt status='created,modified' tDn='uni/phys-SnV_phys'></fvRsDomAtt><fvRsProv status='created,modified' tnVzBrCPName='message-broker'></fvRsProv><fvRsBd status='created,modified' tnFvBDName='antigravity'></fvRsBd></fvAEPg></fvAp></fvTenant></polUni>
SSL Warning
$
```

You should now see the SnV tenant in the APIC GUI, and it should contain the new Application, Evolution_X, with the 7 EPGs. Each EPG should be fully configured with the correct policies in place.
