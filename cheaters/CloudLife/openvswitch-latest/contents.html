

<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Open vSwitch 2.6.0 documentation</title>
    
    <link rel="stylesheet" href="_static/openvswitch.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/badge_only.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.6.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="None" href="contents.html#document-contents" />
<meta name="viewport" content="width=device-width,initial-scale=1.0">
  
<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://docs.openvswitch.org/en/latest/contents.html" />

<link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'contents'
</script>

<script type="text/javascript" src="_static/readthedocs-dynamic-include.js"></script>

<!-- end RTD <extrahead> --></head>
  <body role="document">
<header role="banner">
  <div class="cp--header collaborative-projects">
    <div class="gray-diagonal">
      <div class="container">
        <a id="cp--logo" href="http://collabprojects.linuxfoundation.org">
          <img src="_static/lf/lfcollabprojects_logo_gray.png" alt="Linux Foundation Collaborative Projects"/>
        </a>
      </div>
    </div>
  </div>
  <div id="logo">
    <div class="container">
      <a href="//openvswitch.org">
        <img src="_static/vswitch.png" alt="Open vSwitch"></a>
    </div>
  </div>
  <div class="subnav">
    <div class="container">
      <nav id="menu">
        <label for="tm" id="toggle-menu">Navigation <span class="drop-icon">▾</span></label>
        <input type="checkbox" id="tm">
        <ul class="main-menu clearfix">
          <li>
            <a href="//openvswitch.org/features">Overview</a>
          </li>
          <li>
            <a href="/">Documentation
              <span class="drop-icon">▾</span>
              <label title="Toggle Drop-down" class="drop-icon" for="sm20">▾</label>
            </a>
            <input type="checkbox" id="sm20">
            <ul class="sub-menu">
              <li>
                <a href="/">Open vSwitch (latest)</a>
              </li>
              <li>
                <a href="//openvswitch.org/support/dist-docs-2.5">Open vSwitch 2.5.x
                </a>
              </li>
              <li>
                <a href="//openvswitch.org/support/dist-docs">Man Pages</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="">Talks &amp; Presentations
              <span class="drop-icon">▾</span>
              <label title="Toggle Drop-down" class="drop-icon" for="sm21">▾</label>
            </a>
            <input type="checkbox" id="sm21">
            <ul class="sub-menu">
              <li>
                <a href="//openvswitch.org/support/ovscon2016">OVScon 2016</a>
              </li>
              <li>
                <a href="//openvswitch.org/support/ovscon2015">OVScon 2015</a>
              </li>
              <li>
                <a href="//openvswitch.org/support/ovscon2014">OVScon 2014</a>
              </li>
              <li>
                <a href="//openvswitch.org/support/papers">Papers</a>
              </li>
              <li>
                <a href="//openvswitch.org/support/slides">Presentations</a>
              </li>
              <li>
                <a href="//openvswitch.org/support/interviews">Interviews</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="//openvswitch.org/download">Download</a>
          </li>
          <li>
            <a href="//mail.openvswitch.org/">Mailing Lists</a>
          </li>
          <li>
            <a href="//openvswitch.org/charter">Charter</a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

<main id="content">
  <div class="container">
    <div class="section group">
      <div class="col-2-3">
        
  <div class="section" id="open-vswitch-documentation-contents">
<h1>Open vSwitch Documentation Contents<a class="headerlink" href="#open-vswitch-documentation-contents" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<span id="document-index"></span><div class="section" id="open-vswitch-documentation">
<h2>Open vSwitch Documentation<a class="headerlink" href="#open-vswitch-documentation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="how-the-documentation-is-organised">
<h3>How the Documentation is Organised<a class="headerlink" href="#how-the-documentation-is-organised" title="Permalink to this headline">¶</a></h3>
<p>The Open vSwitch documentation is organised into multiple sections:</p>
<ul class="simple">
<li><a class="reference internal" href="contents.html#document-intro/install/index"><em>Installation guides</em></a> guide you through
installing Open vSwitch (OVS) and Open Virtual Network (OVN) on a variety of
different platforms</li>
<li><a class="reference internal" href="contents.html#document-tutorials/index"><em>Tutorials</em></a> take you through a series of steps to
configure OVS and OVN in sandboxed environments</li>
<li><a class="reference internal" href="contents.html#document-topics/index"><em>Topic guides</em></a> provide a high level overview of OVS and
OVN internals and operation</li>
<li><a class="reference internal" href="contents.html#document-howto/index"><em>How-to guides</em></a> are recipes or use-cases for OVS and OVN.
They are more advanced than the tutorials.</li>
<li><a class="reference internal" href="contents.html#document-faq/index"><em>Frequently Asked Questions</em></a> provide general insight into
a variety of topics related to configuration and operation of OVS and OVN.</li>
</ul>
</div>
<div class="section" id="first-steps">
<h3>First Steps<a class="headerlink" href="#first-steps" title="Permalink to this headline">¶</a></h3>
<p>Getting started with Open vSwitch (OVS) or Open Virtual Network (OVN) for Open
vSwitch? Start here.</p>
<ul class="simple">
<li><strong>Overview:</strong> <a class="reference internal" href="contents.html#document-intro/what-is-ovs"><em>What Is Open vSwitch?</em></a> |
<a class="reference internal" href="contents.html#document-intro/why-ovs"><em>Why Open vSwitch?</em></a></li>
<li><strong>Install:</strong> <a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a> |
<a class="reference internal" href="contents.html#document-intro/install/userspace"><em>Open vSwitch without Kernel Support</em></a> |
<a class="reference internal" href="contents.html#document-intro/install/netbsd"><em>Open vSwitch on NetBSD</em></a> |
<a class="reference internal" href="contents.html#document-intro/install/windows"><em>Open vSwitch on Windows</em></a> |
<a class="reference internal" href="contents.html#document-intro/install/xenserver"><em>Open vSwitch on Citrix XenServer</em></a> |
<a class="reference internal" href="contents.html#document-intro/install/dpdk"><em>Open vSwitch with DPDK</em></a></li>
<li><strong>Tutorials:</strong> <a class="reference internal" href="contents.html#document-tutorials/ovs-advanced"><em>Open vSwitch Advanced Features</em></a> |</li>
</ul>
</div>
<div class="section" id="deeper-dive">
<h3>Deeper Dive<a class="headerlink" href="#deeper-dive" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>Architecture</strong> <a class="reference internal" href="contents.html#document-topics/design"><em>Design Decisions In Open vSwitch</em></a> |
<a class="reference internal" href="contents.html#document-topics/openflow"><em>OpenFlow Support in Open vSwitch</em></a> |
<a class="reference internal" href="contents.html#document-topics/integration"><em>Integration Guide for Centralized Control</em></a> |
<a class="reference internal" href="contents.html#document-topics/porting"><em>Porting Open vSwitch to New Software or Hardware</em></a></li>
<li><strong>DPDK</strong> <a class="reference internal" href="contents.html#document-howto/dpdk"><em>Using Open vSwitch with DPDK</em></a> |
<a class="reference internal" href="contents.html#document-topics/dpdk/vhost-user"><em>DPDK vHost User Ports</em></a></li>
<li><strong>Windows</strong> <a class="reference internal" href="contents.html#document-topics/windows"><em>OVS-on-Hyper-V Design</em></a></li>
<li><strong>Integrations:</strong> <a class="reference internal" href="contents.html#document-topics/language-bindings"><em>Language Bindings</em></a></li>
<li><strong>Reference Guides:</strong> <a class="reference internal" href="contents.html#document-ref/index"><em>Reference Guide</em></a></li>
<li><strong>Testing</strong> <a class="reference internal" href="contents.html#document-topics/testing"><em>Testing</em></a></li>
<li><strong>Packaging:</strong> <a class="reference internal" href="contents.html#document-intro/install/debian"><em>Debian Packaging for Open vSwitch</em></a> |
<a class="reference internal" href="contents.html#document-intro/install/rhel"><em>RHEL 5.6, 6.x Packaging for Open vSwitch</em></a> |
<a class="reference internal" href="contents.html#document-intro/install/fedora"><em>Fedora, RHEL 7.x Packaging for Open vSwitch</em></a></li>
</ul>
</div>
<div class="section" id="the-open-vswitch-project">
<h3>The Open vSwitch Project<a class="headerlink" href="#the-open-vswitch-project" title="Permalink to this headline">¶</a></h3>
<p>Learn more about the Open vSwitch project and about how you can contribute:</p>
<ul class="simple">
<li><strong>Community:</strong> <a class="reference internal" href="contents.html#document-internals/release-process"><em>Open vSwitch Release Process</em></a> |
<a class="reference internal" href="contents.html#document-internals/authors"><em>Authors</em></a> |
<a class="reference internal" href="contents.html#document-internals/mailing-lists"><em>Mailing Lists</em></a> |
<a class="reference internal" href="contents.html#document-internals/patchwork"><em>Patchwork</em></a> |
<a class="reference internal" href="contents.html#document-internals/bugs"><em>Reporting Bugs in Open vSwitch</em></a> |
<a class="reference internal" href="contents.html#document-internals/security"><em>Open vSwitch&#8217;s Security Process</em></a></li>
<li><strong>Contributing:</strong> <a class="reference internal" href="contents.html#document-internals/contributing/submitting-patches"><em>Submitting Patches</em></a> |
<a class="reference internal" href="contents.html#document-internals/contributing/coding-style"><em>Open vSwitch Coding Style</em></a> |
<a class="reference internal" href="contents.html#document-internals/contributing/coding-style-windows"><em>Open vSwitch Windows Datapath Coding Style</em></a></li>
<li><strong>Maintaining:</strong> <a class="reference internal" href="contents.html#document-internals/maintainers"><em>Committers</em></a> |
<a class="reference internal" href="contents.html#document-internals/committer-responsibilities"><em>Expectations for Developers with Open vSwitch Repo Access</em></a> |
<a class="reference internal" href="contents.html#document-internals/committer-grant-revocation"><em>OVS Committer Grant/Revocation Policy</em></a></li>
<li><strong>Documentation:</strong> <a class="reference internal" href="contents.html#document-internals/contributing/documentation-style"><em>Open vSwitch Documentation Style</em></a> |
<a class="reference internal" href="contents.html#document-intro/install/documentation"><em>Building Open vSwitch Documentation</em></a></li>
</ul>
</div>
<div class="section" id="getting-help">
<h3>Getting Help<a class="headerlink" href="#getting-help" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Seeing an issue of potential bug? Report problems to <a class="reference external" href="mailto:bugs&#37;&#52;&#48;openvswitch&#46;org">bugs<span>&#64;</span>openvswitch<span>&#46;</span>org</a></li>
<li>Looking for specific information? Try the <a class="reference internal" href="genindex.html"><span>Index</span></a>, <a class="reference internal" href="py-modindex.html"><span>Module Index</span></a> or
the <a class="reference internal" href="contents.html#document-contents"><em>detailed table of contents</em></a>.</li>
</ul>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-intro/index"></span><div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>How to get started with Open vSwitch.</p>
<div class="toctree-wrapper compound">
<span id="document-intro/what-is-ovs"></span><div class="section" id="what-is-open-vswitch">
<h3>What Is Open vSwitch?<a class="headerlink" href="#what-is-open-vswitch" title="Permalink to this headline">¶</a></h3>
<img alt="_images/overview.png" class="align-center" src="_images/overview.png" />
<div class="section" id="overview">
<h4>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h4>
<p>Open vSwitch is a multilayer software switch licensed under the open source
Apache 2 license.  Our goal is to implement a production quality switch
platform that supports standard management interfaces and opens the forwarding
functions to programmatic extension and control.</p>
<p>Open vSwitch is well suited to function as a virtual switch in VM environments.
In addition to exposing standard control and visibility interfaces to the
virtual networking layer, it was designed to support distribution across
multiple physical servers.  Open vSwitch supports multiple Linux-based
virtualization technologies including Xen/XenServer, KVM, and VirtualBox.</p>
<p>The bulk of the code is written in platform-independent C and is easily ported
to other environments.  The current release of Open vSwitch supports the
following features:</p>
<ul class="simple">
<li>Standard 802.1Q VLAN model with trunk and access ports</li>
<li>NIC bonding with or without LACP on upstream switch</li>
<li>NetFlow, sFlow(R), and mirroring for increased visibility</li>
<li>QoS (Quality of Service) configuration, plus policing</li>
<li>Geneve, GRE, VXLAN, STT, and LISP tunneling</li>
<li>802.1ag connectivity fault management</li>
<li>OpenFlow 1.0 plus numerous extensions</li>
<li>Transactional configuration database with C and Python bindings</li>
<li>High-performance forwarding using a Linux kernel module</li>
</ul>
<p>The included Linux kernel module supports Linux 3.10 and up.</p>
<p>Open vSwitch can also operate entirely in userspace without assistance from
a kernel module.  This userspace implementation should be easier to port than
the kernel-based switch. OVS in userspace can access Linux or DPDK devices.
Note Open vSwitch with Linux devices in userspace is considered experimental
and comes with a cost in performance.</p>
</div>
<div class="section" id="what-s-here">
<h4>What&#8217;s here?<a class="headerlink" href="#what-s-here" title="Permalink to this headline">¶</a></h4>
<p>The main components of this distribution are:</p>
<ul class="simple">
<li>ovs-vswitchd, a daemon that implements the switch, along with a companion
Linux kernel module for flow-based switching.</li>
<li>ovsdb-server, a lightweight database server that ovs-vswitchd queries to
obtain its configuration.</li>
<li>ovs-dpctl, a tool for configuring the switch kernel module.</li>
<li>Scripts and specs for building RPMs for Citrix XenServer and Red Hat
Enterprise Linux.  The XenServer RPMs allow Open vSwitch to be installed on a
Citrix XenServer host as a drop-in replacement for its switch, with
additional functionality.</li>
<li>ovs-vsctl, a utility for querying and updating the configuration of
ovs-vswitchd.</li>
<li>ovs-appctl, a utility that sends commands to running Open vSwitch daemons.</li>
</ul>
<p>Open vSwitch also provides some tools:</p>
<ul class="simple">
<li>ovs-ofctl, a utility for querying and controlling OpenFlow switches and
controllers.</li>
<li>ovs-pki, a utility for creating and managing the public-key infrastructure
for OpenFlow switches.</li>
<li>ovs-testcontroller, a simple OpenFlow controller that may be useful for</li>
</ul>
</div>
</div>
<span id="document-intro/why-ovs"></span><div class="section" id="why-open-vswitch">
<h3>Why Open vSwitch?<a class="headerlink" href="#why-open-vswitch" title="Permalink to this headline">¶</a></h3>
<p>Hypervisors need the ability to bridge traffic between VMs and with the outside
world. On Linux-based hypervisors, this used to mean using the built-in L2
switch (the Linux bridge), which is fast and reliable. So, it is reasonable to
ask why Open vSwitch is used.</p>
<p>The answer is that Open vSwitch is targeted at multi-server virtualization
deployments, a landscape for which the previous stack is not well suited. These
environments are often characterized by highly dynamic end-points, the
maintenance of logical abstractions, and (sometimes) integration with or
offloading to special purpose switching hardware.</p>
<p>The following characteristics and design considerations help Open vSwitch cope
with the above requirements.</p>
<div class="section" id="the-mobility-of-state">
<h4>The mobility of state<a class="headerlink" href="#the-mobility-of-state" title="Permalink to this headline">¶</a></h4>
<p>All network state associated with a network entity (say a virtual machine)
should be easily identifiable and migratable between different hosts. This may
include traditional &#8220;soft state&#8221; (such as an entry in an L2 learning table), L3
forwarding state, policy routing state, ACLs, QoS policy, monitoring
configuration (e.g. NetFlow, IPFIX, sFlow), etc.</p>
<p>Open vSwitch has support for both configuring and migrating both slow
(configuration) and fast network state between instances. For example, if a VM
migrates between end-hosts, it is possible to not only migrate associated
configuration (SPAN rules, ACLs, QoS) but any live network state (including,
for example, existing state which may be difficult to reconstruct). Further,
Open vSwitch state is typed and backed by a real data-model allowing for the
development of structured automation systems.</p>
</div>
<div class="section" id="responding-to-network-dynamics">
<h4>Responding to network dynamics<a class="headerlink" href="#responding-to-network-dynamics" title="Permalink to this headline">¶</a></h4>
<p>Virtual environments are often characterized by high-rates of change. VMs
coming and going, VMs moving backwards and forwards in time, changes to the
logical network environments, and so forth.</p>
<p>Open vSwitch supports a number of features that allow a network control system
to respond and adapt as the environment changes. This includes simple
accounting and visibility support such as NetFlow, IPFIX, and sFlow. But
perhaps more useful, Open vSwitch supports a network state database (OVSDB)
that supports remote triggers. Therefore, a piece of orchestration software can
&#8220;watch&#8221; various aspects of the network and respond if/when they change. This is
used heavily today, for example, to respond to and track VM migrations.</p>
<p>Open vSwitch also supports OpenFlow as a method of exporting remote access to
control traffic. There are a number of uses for this including global network
discovery through inspection of discovery or link-state traffic (e.g. LLDP,
CDP, OSPF, etc.).</p>
</div>
<div class="section" id="maintenance-of-logical-tags">
<h4>Maintenance of logical tags<a class="headerlink" href="#maintenance-of-logical-tags" title="Permalink to this headline">¶</a></h4>
<p>Distributed virtual switches (such as VMware vDS and Cisco&#8217;s Nexus 1000V) often
maintain logical context within the network through appending or manipulating
tags in network packets. This can be used to uniquely identify a VM (in a
manner resistant to hardware spoofing), or to hold some other context that is
only relevant in the logical domain. Much of the problem of building a
distributed virtual switch is to efficiently and correctly manage these tags.</p>
<p>Open vSwitch includes multiple methods for specifying and maintaining tagging
rules, all of which are accessible to a remote process for orchestration.
Further, in many cases these tagging rules are stored in an optimized form so
they don&#8217;t have to be coupled with a heavyweight network device. This allows,
for example, thousands of tagging or address remapping rules to be configured,
changed, and migrated.</p>
<p>In a similar vein, Open vSwitch supports a GRE implementation that can handle
thousands of simultaneous GRE tunnels and supports remote configuration for
tunnel creation, configuration, and tear-down. This, for example, can be used
to connect private VM networks in different data centers.</p>
</div>
<div class="section" id="hardware-integration">
<h4>Hardware integration<a class="headerlink" href="#hardware-integration" title="Permalink to this headline">¶</a></h4>
<p>Open vSwitch&#8217;s forwarding path (the in-kernel datapath) is designed to be
amenable to &#8220;offloading&#8221; packet processing to hardware chipsets, whether housed
in a classic hardware switch chassis or in an end-host NIC. This allows for the
Open vSwitch control path to be able to both control a pure software
implementation or a hardware switch.</p>
<p>There are many ongoing efforts to port Open vSwitch to hardware chipsets. These
include multiple merchant silicon chipsets (Broadcom and Marvell), as well as a
number of vendor-specific platforms. The &#8220;Porting&#8221; section in the documentation
discusses how one would go about making such a port.</p>
<p>The advantage of hardware integration is not only performance within
virtualized environments. If physical switches also expose the Open vSwitch
control abstractions, both bare-metal and virtualized hosting environments can
be managed using the same mechanism for automated network control.</p>
</div>
<div class="section" id="summary">
<h4>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h4>
<p>In many ways, Open vSwitch targets a different point in the design space than
previous hypervisor networking stacks, focusing on the need for automated and
dynamic network control in large-scale Linux-based virtualization environments.</p>
<p>The goal with Open vSwitch is to keep the in-kernel code as small as possible
(as is necessary for performance) and to re-use existing subsystems when
applicable (for example Open vSwitch uses the existing QoS stack). As of Linux
3.3, Open vSwitch is included as a part of the kernel and packaging for the
userspace utilities are available on most popular distributions.</p>
</div>
</div>
<span id="document-intro/install/index"></span><div class="section" id="installing-open-vswitch">
<h3>Installing Open vSwitch<a class="headerlink" href="#installing-open-vswitch" title="Permalink to this headline">¶</a></h3>
<p>A collection of guides detailing how to install Open vSwitch in a variety of
different environments and using different configurations.</p>
<div class="section" id="installation-from-source">
<h4>Installation from Source<a class="headerlink" href="#installation-from-source" title="Permalink to this headline">¶</a></h4>
<div class="toctree-wrapper compound">
<span id="document-intro/install/general"></span><div class="section" id="open-vswitch-on-linux-freebsd-and-netbsd">
<h5>Open vSwitch on Linux, FreeBSD and NetBSD<a class="headerlink" href="#open-vswitch-on-linux-freebsd-and-netbsd" title="Permalink to this headline">¶</a></h5>
<p>This document describes how to build and install Open vSwitch on a generic
Linux, FreeBSD, or NetBSD host. For specifics around installation on a specific
platform, refer to one of the other installation guides listed in <a class="reference internal" href="contents.html#document-intro/install/index"><em>Installing Open vSwitch</em></a>.</p>
<div class="section" id="build-requirements">
<span id="general-build-reqs"></span><h6>Build Requirements<a class="headerlink" href="#build-requirements" title="Permalink to this headline">¶</a></h6>
<p>To compile the userspace programs in the Open vSwitch distribution, you will
need the following software:</p>
<ul>
<li><p class="first">GNU make</p>
</li>
<li><p class="first">A C compiler, such as:</p>
<ul class="simple">
<li>GCC 4.x.</li>
<li>Clang. Clang 3.4 and later provide useful static semantic analysis and
thread-safety checks. For Ubuntu, there are nightly built packages
available on clang&#8217;s website.</li>
<li>MSVC 2013. Refer to <a class="reference internal" href="contents.html#document-intro/install/windows"><em>Open vSwitch on Windows</em></a> for additional Windows build
instructions.</li>
</ul>
<p>While OVS may be compatible with other compilers, optimal support for atomic
operations may be missing, making OVS very slow (see <code class="docutils literal"><span class="pre">lib/ovs-atomic.h</span></code>).</p>
</li>
<li><p class="first">libssl, from OpenSSL, is optional but recommended if you plan to connect the
Open vSwitch to an OpenFlow controller. libssl is required to establish
confidentiality and authenticity in the connections from an Open vSwitch to
an OpenFlow controller. If libssl is installed, then Open vSwitch will
automatically build with support for it.</p>
</li>
<li><p class="first">libcap-ng, written by Steve Grubb, is optional but recommended. It is
required to run OVS daemons as a non-root user with dropped root privileges.
If libcap-ng is installed, then Open vSwitch will automatically build with
support for it.</p>
</li>
<li><p class="first">Python 2.7. You must also have the Python <code class="docutils literal"><span class="pre">six</span></code> library.</p>
</li>
</ul>
<p>On Linux, you may choose to compile the kernel module that comes with the Open
vSwitch distribution or to use the kernel module built into the Linux kernel
(version 3.3 or later). See the <a class="reference internal" href="contents.html#document-faq/index"><em>Open vSwitch FAQ</em></a> question &#8220;What features are
not available in the Open vSwitch kernel datapath that ships as part of the
upstream Linux kernel?&#8221; for more information on this trade-off. You may also
use the userspace-only implementation, at some cost in features and
performance. Refer to <a class="reference internal" href="contents.html#document-intro/install/userspace"><em>Open vSwitch without Kernel Support</em></a> for details.</p>
<p>To compile the kernel module on Linux, you must also install the
following:</p>
<ul>
<li><p class="first">A supported Linux kernel version.</p>
<p>For optional support of ingress policing, you must enable kernel
configuration options <code class="docutils literal"><span class="pre">NET_CLS_BASIC</span></code>, <code class="docutils literal"><span class="pre">NET_SCH_INGRESS</span></code>, and
<code class="docutils literal"><span class="pre">NET_ACT_POLICE</span></code>, either built-in or as modules. <code class="docutils literal"><span class="pre">NET_CLS_POLICE</span></code> is
obsolete and not needed.)</p>
<p>On kernels before 3.11, the <code class="docutils literal"><span class="pre">ip_gre</span></code> module, for GRE tunnels over IP
(<code class="docutils literal"><span class="pre">NET_IPGRE</span></code>), must not be loaded or compiled in.</p>
<p>To configure HTB or HFSC quality of service with Open vSwitch, you must
enable the respective configuration options.</p>
<p>To use Open vSwitch support for TAP devices, you must enable <code class="docutils literal"><span class="pre">CONFIG_TUN</span></code>.</p>
</li>
<li><p class="first">To build a kernel module, you need the same version of GCC that was used to
build that kernel.</p>
</li>
<li><p class="first">A kernel build directory corresponding to the Linux kernel image the module
is to run on. Under Debian and Ubuntu, for example, each linux-image package
containing a kernel binary has a corresponding linux-headers package with
the required build infrastructure.</p>
</li>
</ul>
<p>If you are working from a Git tree or snapshot (instead of from a distribution
tarball), or if you modify the Open vSwitch build system or the database
schema, you will also need the following software:</p>
<ul class="simple">
<li>Autoconf version 2.63 or later.</li>
<li>Automake version 1.10 or later.</li>
<li>libtool version 2.4 or later. (Older versions might work too.)</li>
</ul>
<p>To run the unit tests, you also need:</p>
<ul class="simple">
<li>Perl. Version 5.10.1 is known to work. Earlier versions should also
work.</li>
</ul>
<p>The datapath tests for userspace and Linux datapaths also rely upon:</p>
<ul class="simple">
<li>pyftpdlib. Version 1.2.0 is known to work. Earlier versions should
also work.</li>
<li>GNU wget. Version 1.16 is known to work. Earlier versions should also
work.</li>
<li>netcat. Several common implementations are known to work.</li>
<li>curl. Version 7.47.0 is known to work. Earlier versions should also work.</li>
<li>tftpy. Version 0.6.2 is known to work. Earlier versions should also work.</li>
</ul>
<p>The ovs-vswitchd.conf.db(5) manpage will include an E-R diagram, in formats
other than plain text, only if you have the following:</p>
<ul class="simple">
<li>dot from graphviz (<a class="reference external" href="http://www.graphviz.org/">http://www.graphviz.org/</a>).</li>
<li>Perl. Version 5.10.1 is known to work. Earlier versions should also
work.</li>
</ul>
<p>If you are going to extensively modify Open vSwitch, consider installing the
following to obtain better warnings:</p>
<ul class="simple">
<li>&#8220;sparse&#8221; version 0.4.4 or later
(<a class="reference external" href="https://www.kernel.org/pub/software/devel/sparse/dist/">https://www.kernel.org/pub/software/devel/sparse/dist/</a>).</li>
<li>GNU make.</li>
<li>clang, version 3.4 or later</li>
<li>flake8 along with the hacking flake8 plugin (for Python code). The automatic
flake8 check that runs against Python code has some warnings enabled that
come from the &#8220;hacking&#8221; flake8 plugin. If it&#8217;s not installed, the warnings
just won&#8217;t occur until it&#8217;s run on a system with &#8220;hacking&#8221; installed.</li>
</ul>
<p>You may find the ovs-dev script found in <code class="docutils literal"><span class="pre">utilities/ovs-dev.py</span></code> useful.</p>
</div>
<div class="section" id="installation-requirements">
<span id="general-install-reqs"></span><h6>Installation Requirements<a class="headerlink" href="#installation-requirements" title="Permalink to this headline">¶</a></h6>
<p>The machine you build Open vSwitch on may not be the one you run it on. To
simply install and run Open vSwitch you require the following software:</p>
<ul class="simple">
<li>libc compatible with the libc used for build.</li>
<li>libssl compatible with the libssl used for build, if OpenSSL was used
for the build.</li>
<li>On Linux, the same kernel version configured as part of the build.</li>
<li>For optional support of ingress policing on Linux, the &#8220;tc&#8221; program
from iproute2 (part of all major distributions and available at
<a class="reference external" href="https://wiki.linuxfoundation.org/networking/iproute2">https://wiki.linuxfoundation.org/networking/iproute2</a>).</li>
<li>Python 2.7. You must also have the Python six library.</li>
</ul>
<p>On Linux you should ensure that <code class="docutils literal"><span class="pre">/dev/urandom</span></code> exists. To support TAP
devices, you must also ensure that <code class="docutils literal"><span class="pre">/dev/net/tun</span></code> exists.</p>
</div>
<div class="section" id="bootstrapping">
<span id="general-bootstrapping"></span><h6>Bootstrapping<a class="headerlink" href="#bootstrapping" title="Permalink to this headline">¶</a></h6>
<p>This step is not needed if you have downloaded a released tarball. If
you pulled the sources directly from an Open vSwitch Git tree or got a
Git tree snapshot, then run boot.sh in the top source directory to build
the &#8220;configure&#8221; script:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./boot.sh
</pre></div>
</div>
</div>
<div class="section" id="configuring">
<span id="general-configuring"></span><h6>Configuring<a class="headerlink" href="#configuring" title="Permalink to this headline">¶</a></h6>
<p>Configure the package by running the configure script. You can usually
invoke configure without any arguments. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./configure
</pre></div>
</div>
<p>By default all files are installed under <code class="docutils literal"><span class="pre">/usr/local</span></code>. Open vSwitch also
expects to find its database in <code class="docutils literal"><span class="pre">/usr/local/etc/openvswitch</span></code> by default. If
you want to install all files into, e.g., <code class="docutils literal"><span class="pre">/usr</span></code> and <code class="docutils literal"><span class="pre">/var</span></code> instead of
<code class="docutils literal"><span class="pre">/usr/local</span></code> and <code class="docutils literal"><span class="pre">/usr/local/var</span></code> and expect to use <code class="docutils literal"><span class="pre">/etc/openvswitch</span></code> as
the default database directory, add options as shown here:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./configure --prefix=/usr --localstatedir=/var --sysconfdir=/etc
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Open vSwitch installed with packages like .rpm (e.g. via <code class="docutils literal"><span class="pre">yum</span> <span class="pre">install</span></code> or
<code class="docutils literal"><span class="pre">rpm</span> <span class="pre">-ivh</span></code>) and .deb (e.g. via <code class="docutils literal"><span class="pre">apt-get</span> <span class="pre">install</span></code> or <code class="docutils literal"><span class="pre">dpkg</span> <span class="pre">-i</span></code>) use the
above configure options.</p>
</div>
<p>By default, static libraries are built and linked against. If you want to use
shared libraries instead:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./configure --enable-shared
</pre></div>
</div>
<p>To use a specific C compiler for compiling Open vSwitch user programs, also
specify it on the configure command line, like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./configure CC=gcc-4.2
</pre></div>
</div>
<p>To use &#8216;clang&#8217; compiler:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./configure CC=clang
</pre></div>
</div>
<p>To supply special flags to the C compiler, specify them as <code class="docutils literal"><span class="pre">CFLAGS</span></code> on the
configure command line. If you want the default CFLAGS, which include <code class="docutils literal"><span class="pre">-g</span></code> to
build debug symbols and <code class="docutils literal"><span class="pre">-O2</span></code> to enable optimizations, you must include them
yourself. For example, to build with the default CFLAGS plus <code class="docutils literal"><span class="pre">-mssse3</span></code>, you
might run configure as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./configure CFLAGS=&quot;-g -O2 -mssse3&quot;
</pre></div>
</div>
<p>For efficient hash computation special flags can be passed to leverage built-in
intrinsics. For example on X86_64 with SSE4.2 instruction set support, CRC32
intrinsics can be used by passing <code class="docutils literal"><span class="pre">-msse4.2</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./configure CFLAGS=&quot;-g -O2 -msse4.2&quot;`
</pre></div>
</div>
<p>If you are on a different processor and don&#8217;t know what flags to choose, it is
recommended to use <code class="docutils literal"><span class="pre">-march=native</span></code> settings:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./configure CFLAGS=&quot;-g -O2 -march=native&quot;
</pre></div>
</div>
<p>With this, GCC will detect the processor and automatically set appropriate
flags for it. This should not be used if you are compiling OVS outside the
target machine.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>CFLAGS are not applied when building the Linux kernel module. Custom CFLAGS
for the kernel module are supplied using the <code class="docutils literal"><span class="pre">EXTRA_CFLAGS</span></code> variable when
running make. For example:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span>$ make EXTRA_CFLAGS=&quot;-Wno-error=date-time&quot;
</pre></div>
</div>
</div>
<p>To build the Linux kernel module, so that you can run the kernel-based switch,
pass the location of the kernel build directory on <code class="docutils literal"><span class="pre">--with-linux</span></code>. For
example, to build for a running instance of Linux:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./configure --with-linux=/lib/modules/$(uname -r)/build
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If <code class="docutils literal"><span class="pre">--with-linux</span></code> requests building for an unsupported version of Linux,
then <code class="docutils literal"><span class="pre">configure</span></code> will fail with an error message. Refer to the
<a class="reference internal" href="contents.html#document-faq/index"><em>Open vSwitch FAQ</em></a> for advice in that case.</p>
</div>
<p>If you wish to build the kernel module for an architecture other than the
architecture of the machine used for the build, you may specify the kernel
architecture string using the KARCH variable when invoking the configure
script. For example, to build for MIPS with Linux:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./configure --with-linux=/path/to/linux KARCH=mips
</pre></div>
</div>
<p>If you plan to do much Open vSwitch development, you might want to add
<code class="docutils literal"><span class="pre">--enable-Werror</span></code>, which adds the <code class="docutils literal"><span class="pre">-Werror</span></code> option to the compiler command
line, turning warnings into errors. That makes it impossible to miss warnings
generated by the build. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./configure --enable-Werror
</pre></div>
</div>
<p>To build with gcov code coverage support, add <code class="docutils literal"><span class="pre">--enable-coverage</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./configure --enable-coverage
</pre></div>
</div>
<p>The configure script accepts a number of other options and honors additional
environment variables. For a full list, invoke configure with the <code class="docutils literal"><span class="pre">--help</span></code>
option:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./configure --help
</pre></div>
</div>
<p>You can also run configure from a separate build directory. This is helpful if
you want to build Open vSwitch in more than one way from a single source
directory, e.g. to try out both GCC and Clang builds, or to build kernel
modules for more than one Linux version. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ mkdir _gcc &amp;&amp; (cd _gcc &amp;&amp; ./configure CC=gcc)
$ mkdir _clang &amp;&amp; (cd _clang &amp;&amp; ./configure CC=clang)
</pre></div>
</div>
<p>Under certains loads the ovsdb-server and other components perform better when
using the jemalloc memory allocator, instead of the glibc memory allocator. If
you wish to link with jemalloc add it to LIBS:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./configure LIBS=-ljemalloc
</pre></div>
</div>
</div>
<div class="section" id="building">
<span id="general-building"></span><h6>Building<a class="headerlink" href="#building" title="Permalink to this headline">¶</a></h6>
<ol class="arabic">
<li><p class="first">Run GNU make in the build directory, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make
</pre></div>
</div>
<p>or if GNU make is installed as &#8220;gmake&#8221;:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ gmake
</pre></div>
</div>
<p>If you used a separate build directory, run make or gmake from that
directory, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make -C _gcc
$ make -C _clang
</pre></div>
</div>
<p>For improved warnings if you installed <code class="docutils literal"><span class="pre">sparse</span></code> (see &#8220;Prerequisites&#8221;), add
<code class="docutils literal"><span class="pre">C=1</span></code> to the command line.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Some versions of Clang and ccache are not completely compatible. If you
see unusual warnings when you use both together, consider disabling
ccache.</p>
</div>
</li>
<li><p class="first">Consider running the testsuite. Refer to <strong>Testing</strong> for instructions.</p>
</li>
<li><p class="first">Run <code class="docutils literal"><span class="pre">make</span> <span class="pre">install</span></code> to install the executables and manpages into the
running system, by default under <code class="docutils literal"><span class="pre">/usr/local</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make install
</pre></div>
</div>
</li>
</ol>
<ol class="arabic" start="5">
<li><p class="first">If you built kernel modules, you may install them, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make modules_install
</pre></div>
</div>
<p>It is possible that you already had a Open vSwitch kernel module installed
on your machine that came from upstream Linux (in a different directory). To
make sure that you load the Open vSwitch kernel module you built from this
repository, you should create a <code class="docutils literal"><span class="pre">depmod.d</span></code> file that prefers your newly
installed kernel modules over the kernel modules from upstream Linux. The
following snippet of code achieves the same:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ config_file=&quot;/etc/depmod.d/openvswitch.conf&quot;
$ for module in datapath/linux/*.ko; do
  modname=&quot;$(basename ${module})&quot;
  echo &quot;override ${modname%.ko} * extra&quot; &gt;&gt; &quot;$config_file&quot;
  echo &quot;override ${modname%.ko} * weak-updates&quot; &gt;&gt; &quot;$config_file&quot;
  done
$ depmod -a
</pre></div>
</div>
<p>Finally, load the kernel modules that you need. e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ /sbin/modprobe openvswitch
</pre></div>
</div>
<p>To verify that the modules have been loaded, run <code class="docutils literal"><span class="pre">/sbin/lsmod</span></code> and check
that openvswitch is listed:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ /sbin/lsmod | grep openvswitch
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If the <code class="docutils literal"><span class="pre">modprobe</span></code> operation fails, look at the last few kernel log
messages (e.g. with <code class="docutils literal"><span class="pre">dmesg</span> <span class="pre">|</span> <span class="pre">tail</span></code>). Generally, issues like this occur
when Open vSwitch is built for a kernel different from the one into which
you are trying to load it.  Run <code class="docutils literal"><span class="pre">modinfo</span></code> on <code class="docutils literal"><span class="pre">openvswitch.ko</span></code> and on a
module built for the running kernel, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ /sbin/modinfo openvswitch.ko
$ /sbin/modinfo /lib/modules/$(uname -r)/kernel/net/bridge/bridge.ko
</pre></div>
</div>
<p>Compare the &#8220;vermagic&#8221; lines output by the two commands.  If they differ,
then Open vSwitch was built for the wrong kernel.</p>
<p class="last">If you decide to report a bug or ask a question related to module loading,
include the output from the <code class="docutils literal"><span class="pre">dmesg</span></code> and <code class="docutils literal"><span class="pre">modinfo</span></code> commands mentioned
above.</p>
</div>
</li>
</ol>
</div>
<div class="section" id="starting">
<span id="general-starting"></span><h6>Starting<a class="headerlink" href="#starting" title="Permalink to this headline">¶</a></h6>
<p>Before starting ovs-vswitchd itself, you need to start its configuration
database, ovsdb-server. Each machine on which Open vSwitch is installed should
run its own copy of ovsdb-server. Before ovsdb-server itself can be started,
configure a database that it can use:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ mkdir -p /usr/local/etc/openvswitch
$ ovsdb-tool create /usr/local/etc/openvswitch/conf.db \
    vswitchd/vswitch.ovsschema
</pre></div>
</div>
<p>Configure ovsdb-server to use database created above, to listen on a Unix
domain socket, to connect to any managers specified in the database itself, and
to use the SSL configuration in the database:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ mkdir -p /usr/local/var/run/openvswitch
$ ovsdb-server --remote=punix:/usr/local/var/run/openvswitch/db.sock \
    --remote=db:Open_vSwitch,Open_vSwitch,manager_options \
    --private-key=db:Open_vSwitch,SSL,private_key \
    --certificate=db:Open_vSwitch,SSL,certificate \
    --bootstrap-ca-cert=db:Open_vSwitch,SSL,ca_cert \
    --pidfile --detach --log-file
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you built Open vSwitch without SSL support, then omit <code class="docutils literal"><span class="pre">--private-key</span></code>,
<code class="docutils literal"><span class="pre">--certificate</span></code>, and <code class="docutils literal"><span class="pre">--bootstrap-ca-cert</span></code>.)</p>
</div>
<p>Initialize the database using ovs-vsctl. This is only necessary the first time
after you create the database with ovsdb-tool, though running it at any time is
harmless:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl --no-wait init
</pre></div>
</div>
<p>Start the main Open vSwitch daemon, telling it to connect to the same Unix
domain socket:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vswitchd --pidfile --detach --log-file
</pre></div>
</div>
</div>
<div class="section" id="validating">
<h6>Validating<a class="headerlink" href="#validating" title="Permalink to this headline">¶</a></h6>
<p>At this point you can use ovs-vsctl to set up bridges and other Open vSwitch
features.  For example, to create a bridge named <code class="docutils literal"><span class="pre">br0</span></code> and add ports <code class="docutils literal"><span class="pre">eth0</span></code>
and <code class="docutils literal"><span class="pre">vif1.0</span></code> to it:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 eth0
$ ovs-vsctl add-port br0 vif1.0
</pre></div>
</div>
<p>Refer to ovs-vsctl(8) for more details. You may also wish to refer to
<a class="reference internal" href="contents.html#document-topics/testing"><em>Testing</em></a> for information on more generic testing of OVS.</p>
</div>
<div class="section" id="upgrading">
<h6>Upgrading<a class="headerlink" href="#upgrading" title="Permalink to this headline">¶</a></h6>
<p>When you upgrade Open vSwitch from one version to another you should also
upgrade the database schema:</p>
<ol class="arabic">
<li><p class="first">Stop the Open vSwitch daemons, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ kill `cd /usr/local/var/run/openvswitch &amp;&amp; cat ovsdb-server.pid ovs-vswitchd.pid`
</pre></div>
</div>
</li>
<li><p class="first">Install the new Open vSwitch release by using the same configure options as
was used for installing the previous version. If you do not use the same
configure options, you can end up with two different versions of Open
vSwitch executables installed in different locations.</p>
</li>
<li><p class="first">Upgrade the database, in one of the following two ways:</p>
<ul>
<li><p class="first">If there is no important data in your database, then you may delete the
database file and recreate it with ovsdb-tool, following the instructions
under &#8220;Building and Installing Open vSwitch for Linux, FreeBSD or NetBSD&#8221;.</p>
</li>
<li><p class="first">If you want to preserve the contents of your database, back it up first,
then use <code class="docutils literal"><span class="pre">ovsdb-tool</span> <span class="pre">convert</span></code> to upgrade it, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovsdb-tool convert /usr/local/etc/openvswitch/conf.db \
    vswitchd/vswitch.ovsschema
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Start the Open vSwitch daemons as described under <strong>Starting</strong> above.</p>
</li>
</ol>
</div>
<div class="section" id="hot-upgrading">
<h6>Hot Upgrading<a class="headerlink" href="#hot-upgrading" title="Permalink to this headline">¶</a></h6>
<p>Upgrading Open vSwitch from one version to the next version with minimum
disruption of traffic going through the system that is using that Open vSwitch
needs some considerations:</p>
<ol class="arabic simple">
<li>If the upgrade only involves upgrading the userspace utilities and daemons
of Open vSwitch, make sure that the new userspace version is compatible with
the previously loaded kernel module.</li>
<li>An upgrade of userspace daemons means that they have to be restarted.
Restarting the daemons means that the OpenFlow flows in the ovs-vswitchd
daemon will be lost. One way to restore the flows is to let the controller
re-populate it. Another way is to save the previous flows using a utility
like ovs-ofctl and then re-add them after the restart. Restoring the old
flows is accurate only if the new Open vSwitch interfaces retain the old
&#8216;ofport&#8217; values.</li>
<li>When the new userspace daemons get restarted, they automatically flush the
old flows setup in the kernel. This can be expensive if there are hundreds
of new flows that are entering the kernel but userspace daemons are busy
setting up new userspace flows from either the controller or an utility like
ovs-ofctl. Open vSwitch database provides an option to solve this problem
through the <code class="docutils literal"><span class="pre">other_config:flow-restore-wait</span></code> column of the
<code class="docutils literal"><span class="pre">Open_vSwitch</span></code> table. Refer to the ovs-vswitchd.conf.db(5) manpage for
details.</li>
<li>If the upgrade also involves upgrading the kernel module, the old kernel
module needs to be unloaded and the new kernel module should be loaded. This
means that the kernel network devices belonging to Open vSwitch is recreated
and the kernel flows are lost. The downtime of the traffic can be reduced if
the userspace daemons are restarted immediately and the userspace flows are
restored as soon as possible.</li>
</ol>
<p>The ovs-ctl utility&#8217;s <code class="docutils literal"><span class="pre">restart</span></code> function only restarts the userspace daemons,
makes sure that the &#8216;ofport&#8217; values remain consistent across restarts, restores
userspace flows using the ovs-ofctl utility and also uses the
<code class="docutils literal"><span class="pre">other_config:flow-restore-wait</span></code> column to keep the traffic downtime to the
minimum. The ovs-ctl utility&#8217;s <code class="docutils literal"><span class="pre">force-reload-kmod</span></code> function does all of the
above, but also replaces the old kernel module with the new one. Open vSwitch
startup scripts for Debian, XenServer and RHEL use ovs-ctl&#8217;s functions and it
is recommended that these functions be used for other software platforms too.</p>
</div>
<div class="section" id="reporting-bugs">
<h6>Reporting Bugs<a class="headerlink" href="#reporting-bugs" title="Permalink to this headline">¶</a></h6>
<p>Report problems to <a class="reference external" href="mailto:bugs&#37;&#52;&#48;openvswitch&#46;org">bugs<span>&#64;</span>openvswitch<span>&#46;</span>org</a>.</p>
</div>
</div>
<span id="document-intro/install/netbsd"></span><div class="section" id="open-vswitch-on-netbsd">
<h5>Open vSwitch on NetBSD<a class="headerlink" href="#open-vswitch-on-netbsd" title="Permalink to this headline">¶</a></h5>
<p>On NetBSD, you might want to install requirements from pkgsrc.  In that case,
you need at least the following packages.</p>
<ul class="simple">
<li>automake</li>
<li>libtool-base</li>
<li>gmake</li>
<li>python27</li>
<li>py27-six</li>
<li>py27-xml</li>
<li>pkg_alternatives</li>
</ul>
<p>Some components have additional requirements. Refer to <a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a> for more
information.</p>
<p>Assuming you are running NetBSD/amd64 6.1.2, you can download and install
pre-built binary packages as the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ PKG_PATH=http://ftp.netbsd.org/pub/pkgsrc/packages/NetBSD/amd64/7.0.2/All/
$ export PKG_PATH
$ pkg_add automake libtool-base gmake python27 py27-six py27-xml \
    pkg_alternatives
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You might get some warnings about minor version mismatch. These can be safely
ignored.</p>
</div>
<p>NetBSD&#8217;s <code class="docutils literal"><span class="pre">/usr/bin/make</span></code> is not GNU make.  GNU make is installed as
<code class="docutils literal"><span class="pre">/usr/pkg/bin/gmake</span></code> by the above mentioned <code class="docutils literal"><span class="pre">gmake</span></code> package.</p>
<p>As all executables installed with pkgsrc are placed in <code class="docutils literal"><span class="pre">/usr/pkg/bin/</span></code>
directory, it might be a good idea to add it to your PATH. Or install ovs by
<code class="docutils literal"><span class="pre">gmake</span></code> and <code class="docutils literal"><span class="pre">gmake</span> <span class="pre">install</span></code>.</p>
<p>Open vSwitch on NetBSD is currently &#8220;userspace switch&#8221; implementation in the
sense described in <a class="reference internal" href="contents.html#document-intro/install/userspace"><em>Open vSwitch without Kernel Support</em></a> and <a class="reference internal" href="contents.html#document-topics/porting"><em>Porting Open vSwitch to New Software or Hardware</em></a>.</p>
</div>
<span id="document-intro/install/windows"></span><div class="section" id="open-vswitch-on-windows">
<h5>Open vSwitch on Windows<a class="headerlink" href="#open-vswitch-on-windows" title="Permalink to this headline">¶</a></h5>
<div class="section" id="build-requirements">
<span id="windows-build-reqs"></span><h6>Build Requirements<a class="headerlink" href="#build-requirements" title="Permalink to this headline">¶</a></h6>
<p>Open vSwitch on Linux uses autoconf and automake for generating Makefiles.  It
will be useful to maintain the same build system while compiling on Windows
too.  One approach is to compile Open vSwitch in a MinGW environment that
contains autoconf and automake utilities and then use Visual C++ as a compiler
and linker.</p>
<p>The following explains the steps in some detail.</p>
<ul>
<li><p class="first">Mingw</p>
<p>Install Mingw on a Windows machine by following the instructions on
<a class="reference external" href="http://www.mingw.org/wiki/Getting_Started">mingw.org</a>.</p>
<p>This should install mingw at <code class="docutils literal"><span class="pre">C:\Mingw</span></code> and msys at <code class="docutils literal"><span class="pre">C:\Mingw\msys</span></code>.  Add
<code class="docutils literal"><span class="pre">C:\MinGW\bin</span></code> and <code class="docutils literal"><span class="pre">C:\Mingw\msys\1.0\bin</span></code> to PATH environment variable
of Windows.</p>
<p>You can either use the MinGW installer or the command line utility
<code class="docutils literal"><span class="pre">mingw-get</span></code> to install both the base packages and additional packages like
automake and autoconf(version 2.68).</p>
<p>Also make sure that <code class="docutils literal"><span class="pre">/mingw</span></code> mount point exists. If its not, please
add/create the following entry in <code class="docutils literal"><span class="pre">/etc/fstab</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>&#39;C:/MinGW /mingw&#39;.
</pre></div>
</div>
</li>
<li><p class="first">Python</p>
<p>Install the latest Python 2.x from python.org and verify that its path is
part of Windows&#8217; PATH environment variable.
We require that you have Python six and pypiwin32 libraries installed.
The libraries can be installed via pip command:</p>
<blockquote>
<div><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> pip install six
<span class="gp">$</span> pip install pypiwin32
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Visual Studio</p>
<p>You will need at least Visual Studio 2013 (update 4) to compile userspace
binaries.  In addition to that, if you want to compile the kernel module you
will also need to install Windows Driver Kit (WDK) 8.1 Update.</p>
<p>It is important to get the Visual Studio related environment variables and to
have the $PATH inside the bash to point to the proper compiler and linker.
One easy way to achieve this for VS2013 is to get into the &#8220;VS2013 x86 Native
Tools Command Prompt&#8221; (in a default installation of Visual Studio 2013 this
can be found under the following location: <code class="docutils literal"><span class="pre">C:\Program</span> <span class="pre">Files</span> <span class="pre">(x86)\Microsoft</span>
<span class="pre">Visual</span> <span class="pre">Studio</span> <span class="pre">12.0\Common7\Tools\Shortcuts</span></code>) and through it enter into the
bash shell available from msys by typing <code class="docutils literal"><span class="pre">bash</span> <span class="pre">--login</span></code>.</p>
<p>There is support for generating 64 bit binaries too.  To compile under x64,
open the &#8220;VS2013 x64 Native Tools Command Prompt&#8221; (if your current running OS
is 64 bit) or &#8220;VS2013 x64 Cross Tools Command Prompt&#8221; (if your current
running OS is not 64 bit) instead of opening its x86 variant.  This will
point the compiler and the linker to their 64 bit equivalent.</p>
<p>If after the above step, a <code class="docutils literal"><span class="pre">which</span> <span class="pre">link</span></code> inside MSYS&#8217;s bash says,
<code class="docutils literal"><span class="pre">/bin/link.exe</span></code>, rename <code class="docutils literal"><span class="pre">/bin/link.exe</span></code> to something else so that the
Visual studio&#8217;s linker is used. You should also see a &#8216;which sort&#8217; report
<code class="docutils literal"><span class="pre">/bin/sort.exe</span></code>.</p>
</li>
<li><p class="first">pthreads-win32</p>
<p>For pthread support, install the library, dll and includes of pthreads-win32
project from <a class="reference external" href="ftp://sourceware.org/pub/pthreads-win32/prebuilt-dll-2-9-1-release">sourceware</a> to a
directory (e.g.: <code class="docutils literal"><span class="pre">C:/pthread</span></code>). You should add the pthread-win32&#8217;s dll path
(e.g.: <code class="docutils literal"><span class="pre">C:\pthread\dll\x86</span></code>) to the Windows&#8217; PATH environment variable.</p>
</li>
<li><p class="first">OpenSSL</p>
<p>To get SSL support for Open vSwitch on Windows, you will need to install
<a class="reference external" href="https://wiki.openssl.org/index.php/Binaries">OpenSSL for Windows</a></p>
<p>Note down the directory where OpenSSL is installed (e.g.:
<code class="docutils literal"><span class="pre">C:/OpenSSL-Win32</span></code>) for later use.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Commands prefixed by <code class="docutils literal"><span class="pre">$</span></code> must be run in the Bash shell provided by MinGW.
Open vSwitch commands, such as <code class="docutils literal"><span class="pre">ovs-dpctl</span></code> are shown running under the DOS
shell (<code class="docutils literal"><span class="pre">cmd.exe</span></code>), as indicated by the <code class="docutils literal"><span class="pre">&gt;</span></code> prefix, but will also run
under Bash. The remainder, prefixed by <code class="docutils literal"><span class="pre">&gt;</span></code>, are PowerShell commands and
must be run in PowerShell.</p>
</div>
</div>
<div class="section" id="install-requirements">
<h6>Install Requirements<a class="headerlink" href="#install-requirements" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p class="first">Share network adaptors</p>
<p>We require that you don&#8217;t disable the &#8220;Allow management operating system to
share this network adapter&#8221; under &#8216;Virtual Switch Properties&#8217; &gt; &#8216;Connection
type: External network&#8217;, in the HyperV virtual network switch configuration.</p>
</li>
<li><p class="first">Checksum Offloads</p>
<p>While there is some support for checksum/segmentation offloads in software,
this is still a work in progress. Till the support is complete we recommend
disabling TX/RX offloads for both the VM&#8217;s as well as the HyperV.</p>
</li>
</ul>
</div>
<div class="section" id="bootstrapping">
<h6>Bootstrapping<a class="headerlink" href="#bootstrapping" title="Permalink to this headline">¶</a></h6>
<p>This step is not needed if you have downloaded a released tarball. If
you pulled the sources directly from an Open vSwitch Git tree or got a
Git tree snapshot, then run boot.sh in the top source directory to build
the &#8220;configure&#8221; script:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ./boot.sh
</pre></div>
</div>
</div>
<div class="section" id="configuring">
<span id="windows-configuring"></span><h6>Configuring<a class="headerlink" href="#configuring" title="Permalink to this headline">¶</a></h6>
<p>Configure the package by running the configure script.  You should provide some
configure options to choose the right compiler, linker, libraries, Open vSwitch
component installation directories, etc. For example:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ./configure <span class="nv">CC</span><span class="o">=</span>./build-aux/cccl <span class="nv">LD</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>which link<span class="k">)</span><span class="s2">&quot;</span> <span class="se">\</span>
<span class="go">    LIBS=&quot;-lws2_32 -liphlpapi -lwbemuuid -lole32 -loleaut32&quot; \</span>
<span class="go">    --prefix=&quot;C:/openvswitch/usr&quot; \</span>
<span class="go">    --localstatedir=&quot;C:/openvswitch/var&quot; \</span>
<span class="go">    --sysconfdir=&quot;C:/openvswitch/etc&quot; \</span>
<span class="go">    --with-pthread=&quot;C:/pthread&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, the above enables compiler optimization for fast code.  For
default compiler optimization, pass the <code class="docutils literal"><span class="pre">--with-debug</span></code> configure option.</p>
</div>
<p>To configure with SSL support, add the requisite additional options:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ./configure <span class="nv">CC</span><span class="o">=</span>./build-aux/cccl <span class="nv">LD</span><span class="o">=</span><span class="s2">&quot;`which link`&quot;</span>  <span class="se">\</span>
<span class="go">    LIBS=&quot;-lws2_32 -liphlpapi -lwbemuuid -lole32 -loleaut32&quot; \</span>
<span class="go">    --prefix=&quot;C:/openvswitch/usr&quot; \</span>
<span class="go">    --localstatedir=&quot;C:/openvswitch/var&quot;</span>
<span class="go">    --sysconfdir=&quot;C:/openvswitch/etc&quot; \</span>
<span class="go">    --with-pthread=&quot;C:/pthread&quot; \</span>
<span class="go">    --enable-ssl --with-openssl=&quot;C:/OpenSSL-Win32&quot;</span>
</pre></div>
</div>
<p>Finally, to the kernel module also:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ./configure <span class="nv">CC</span><span class="o">=</span>./build-aux/cccl <span class="nv">LD</span><span class="o">=</span><span class="s2">&quot;`which link`&quot;</span> <span class="se">\</span>
<span class="go">    LIBS=&quot;-lws2_32 -liphlpapi -lwbemuuid -lole32 -loleaut32&quot; \</span>
<span class="go">    --prefix=&quot;C:/openvswitch/usr&quot; \</span>
<span class="go">    --localstatedir=&quot;C:/openvswitch/var&quot; \</span>
<span class="go">    --sysconfdir=&quot;C:/openvswitch/etc&quot; \</span>
<span class="go">    --with-pthread=&quot;C:/pthread&quot; \</span>
<span class="go">    --enable-ssl --with-openssl=&quot;C:/OpenSSL-Win32&quot; \</span>
<span class="go">    --with-vstudiotarget=&quot;&lt;target type&gt;&quot;</span>
</pre></div>
</div>
<p>Possible values for <code class="docutils literal"><span class="pre">&lt;target</span> <span class="pre">type&gt;</span></code> are: <code class="docutils literal"><span class="pre">Debug</span></code> and <code class="docutils literal"><span class="pre">Release</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can directly use the Visual Studio 2013 IDE to compile the kernel
datapath. Open the ovsext.sln file in the IDE and build the solution.</p>
</div>
<p>Refer to <a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a> for information on additional configuration options.</p>
</div>
<div class="section" id="building">
<span id="windows-building"></span><h6>Building<a class="headerlink" href="#building" title="Permalink to this headline">¶</a></h6>
<p>Once correctly configured, building Open vSwitch on Windows is similar to
building on Linux, FreeBSD, or NetBSD.</p>
<ol class="arabic">
<li><p class="first">Run make for the ported executables in the top source directory, e.g.:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> make
</pre></div>
</div>
<p>For faster compilation, you can pass the <code class="docutils literal"><span class="pre">-j</span></code> argument to make.  For
example, to run 4 jobs simultaneously, run <code class="docutils literal"><span class="pre">make</span> <span class="pre">-j4</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>MSYS 1.0.18 has a bug that causes parallel make to hang. You can overcome
this by downgrading to MSYS 1.0.17.  A simple way to downgrade is to exit
all MinGW sessions and then run the below command from MSVC developers
command prompt.:</p>
<div class="last highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; mingw-get upgrade msys-core-bin=1.0.17-1</span>
</pre></div>
</div>
</div>
</li>
<li><p class="first">To run all the unit tests in Open vSwitch, one at a time:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> make check
</pre></div>
</div>
<p>To run all the unit tests in Open vSwitch, up to 8 in parallel:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> make check <span class="nv">TESTSUITEFLAGS</span><span class="o">=</span><span class="s2">&quot;-j8&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">To install all the compiled executables on the local machine, run:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> make install
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This will install the Open vSwitch executables in <code class="docutils literal"><span class="pre">C:/openvswitch</span></code>.  You
can add <code class="docutils literal"><span class="pre">C:\openvswitch\usr\bin</span></code> and <code class="docutils literal"><span class="pre">C:\openvswitch\usr\sbin</span></code> to
Windows&#8217; PATH environment variable for easy access.</p>
</div>
</div></blockquote>
<div class="section" id="the-kernel-module">
<h7>The Kernel Module<a class="headerlink" href="#the-kernel-module" title="Permalink to this headline">¶</a></h7>
<p>If you are building the kernel module, you will need to copy the below files to
the target Hyper-V machine.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">./datapath-windows/x64/Win8.1Debug/package/ovsext.inf</span></code></li>
<li><code class="docutils literal"><span class="pre">./datapath-windows/x64/Win8.1Debug/package/OVSExt.sys</span></code></li>
<li><code class="docutils literal"><span class="pre">./datapath-windows/x64/Win8.1Debug/package/ovsext.cat</span></code></li>
<li><code class="docutils literal"><span class="pre">./datapath-windows/misc/install.cmd</span></code></li>
<li><code class="docutils literal"><span class="pre">./datapath-windows/misc/uninstall.cmd</span></code></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The above path assumes that the kernel module has been built using Windows
DDK 8.1 in Debug mode. Change the path appropriately, if a different WDK has
been used.</p>
</div>
<p>Now run <code class="docutils literal"><span class="pre">./uninstall.cmd</span></code> to remove the old extension. Once complete, run
<code class="docutils literal"><span class="pre">./install.cmd</span></code> to insert the new one.  For this to work you will have to
turn on <code class="docutils literal"><span class="pre">TESTSIGNING</span></code> boot option or &#8216;Disable Driver Signature
Enforcement&#8217; during boot.  The following commands can be used:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; bcdedit /set LOADOPTIONS DISABLE_INTEGRITY_CHECKS</span>
<span class="go">&gt; bcdedit /set TESTSIGNING ON</span>
<span class="go">&gt; bcdedit /set nointegritychecks ON</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may have to restart the machine for the settings to take effect.</p>
</div>
<p>In the Virtual Switch Manager configuration you can enable the Open vSwitch
Extension on an existing switch or create a new switch.  If you are using an
existing switch, make sure to enable the &#8220;Allow Management OS&#8221; option for VXLAN
to work (covered later).</p>
<p>The command to create a new switch named &#8216;OVS-Extended-Switch&#8217; using a physical
NIC named &#8216;Ethernet 1&#8217; is:</p>
<div class="highlight-ps1con"><div class="highlight"><pre><span></span><span class="go">PS &gt; New-VMSwitch &quot;OVS-Extended-Switch&quot; -NetAdapterName &quot;Ethernet 1&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can obtain the list of physical NICs on the host using &#8216;Get-NetAdapter&#8217;
command.</p>
</div>
<p>In the properties of any switch, you should should now see &#8220;Open vSwitch
Extension&#8221; under &#8216;Extensions&#8217;.  Click the check box to enable the extension.
An alternative way to do the same is to run the following command:</p>
<div class="highlight-ps1con"><div class="highlight"><pre><span></span><span class="go">PS &gt; Enable-VMSwitchExtension &quot;Open vSwitch Extension&quot; OVS-Extended-Switch</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you enabled the extension using the command line, a delay of a few
seconds has been observed for the change to be reflected in the UI.  This is
not a bug in Open vSwitch.</p>
</div>
</div>
</div>
<div class="section" id="starting">
<h6>Starting<a class="headerlink" href="#starting" title="Permalink to this headline">¶</a></h6>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The following steps assume that you have installed the Open vSwitch
utilities in the local machine via &#8216;make install&#8217;.</p>
</div>
<p>Before starting ovs-vswitchd itself, you need to start its configuration
database, ovsdb-server. Each machine on which Open vSwitch is installed should
run its own copy of ovsdb-server. Before ovsdb-server itself can be started,
configure a database that it can use:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovsdb-tool create C:\openvswitch\etc\openvswitch\conf.db \</span>
<span class="go">    C:\openvswitch\usr\share\openvswitch\vswitch.ovsschema</span>
</pre></div>
</div>
<p>Configure ovsdb-server to use database created above and to listen on a Unix
domain socket:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovsdb-server -vfile:info --remote=punix:db.sock --log-file \</span>
<span class="go">    --pidfile --detach</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The logfile is created at <code class="docutils literal"><span class="pre">C:/openvswitch/var/log/openvswitch/</span></code></p>
</div>
<p>Initialize the database using ovs-vsctl. This is only necessary the first time
after you create the database with ovsdb-tool, though running it at any time is
harmless:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovs-vsctl --no-wait init</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>If you would later like to terminate the started ovsdb-server, run:</p>
<div class="last highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovs-appctl -t ovsdb-server exit</span>
</pre></div>
</div>
</div>
<p>Start the main Open vSwitch daemon, telling it to connect to the same Unix
domain socket:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovs-vswitchd -vfile:info --log-file --pidfile --detach</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>If you would like to terminate the started ovs-vswitchd, run:</p>
<div class="last highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovs-appctl exit</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The logfile is created at <code class="docutils literal"><span class="pre">C:/openvswitch/var/log/openvswitch/</span></code></p>
</div>
</div>
<div class="section" id="validating">
<h6>Validating<a class="headerlink" href="#validating" title="Permalink to this headline">¶</a></h6>
<p>At this point you can use ovs-vsctl to set up bridges and other Open vSwitch
features.</p>
<div class="section" id="add-bridges">
<h7>Add bridges<a class="headerlink" href="#add-bridges" title="Permalink to this headline">¶</a></h7>
<p>Let&#8217;s start by creating an integration bridge, <code class="docutils literal"><span class="pre">br-int</span></code> and a PIF bridge,
<code class="docutils literal"><span class="pre">br-pif</span></code>:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovs-vsctl add-br br-int</span>
<span class="go">&gt; ovs-vsctl add-br br-pif</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There&#8217;s a known bug that running the ovs-vsctl command does not terminate.
This is generally solved by having ovs-vswitchd running.  If you face the
issue despite that, hit Ctrl-C to terminate ovs-vsctl and check the output
to see if your command succeeded.</p>
</div>
<p>Validate that ports are added by dumping from both ovs-dpctl and ovs-vsctl:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovs-dpctl show</span>
<span class="go">system@ovs-system:</span>
<span class="go">        lookups: hit:0 missed:0 lost:0</span>
<span class="go">        flows: 0</span>
<span class="go">        port 2: br-pif (internal)     &lt;&lt;&lt; internal port on &#39;br-pif&#39; bridge</span>
<span class="go">        port 1: br-int (internal)     &lt;&lt;&lt; internal port on &#39;br-int&#39; bridge</span>

<span class="go">&gt; ovs-vsctl show</span>
<span class="go">a56ec7b5-5b1f-49ec-a795-79f6eb63228b</span>
<span class="go">    Bridge br-pif</span>
<span class="go">        Port br-pif</span>
<span class="go">            Interface br-pif</span>
<span class="go">                type: internal</span>
<span class="go">    Bridge br-int</span>
<span class="go">        Port br-int</span>
<span class="go">            Interface br-int</span>
<span class="go">                type: internal</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There&#8217;s a known bug that the ports added to OVSDB via ovs-vsctl don&#8217;t get to
the kernel datapath immediately, ie. they don&#8217;t show up in the output of
<code class="docutils literal"><span class="pre">ovs-dpctl</span> <span class="pre">show</span></code> even though they show up in output of <code class="docutils literal"><span class="pre">ovs-vsctl</span> <span class="pre">show</span></code>.
In order to workaround this issue, restart ovs-vswitchd. (You can terminate
ovs-vswitchd by running <code class="docutils literal"><span class="pre">ovs-appctl</span> <span class="pre">exit</span></code>.)</p>
</div>
</div>
<div class="section" id="add-physicals-nics-pif">
<h7>Add physicals NICs (PIF)<a class="headerlink" href="#add-physicals-nics-pif" title="Permalink to this headline">¶</a></h7>
<p>Now, let&#8217;s add the physical NIC and the internal port to <code class="docutils literal"><span class="pre">br-pif</span></code>. In OVS for
Hyper-V, we use the name of the adapter on top of which the Hyper-V virtual
switch was created, as a special name to refer to the physical NICs connected
to the Hyper-V switch, e.g. if we created the Hyper-V virtual switch on top of
the adapter named <code class="docutils literal"><span class="pre">Ethernet0</span></code>, then in OVS we use that name (<code class="docutils literal"><span class="pre">Ethernet0</span></code>)
as a special name to refer to that adapter.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We assume that the OVS extension is enabled Hyper-V switch.</p>
</div>
<p>Internal ports are the virtual adapters created on the Hyper-V switch using the
<code class="docutils literal"><span class="pre">ovs-vsctl</span> <span class="pre">add-br</span> <span class="pre">&lt;bridge&gt;</span></code> command. By default they are created under the
following rule &#8220;&lt;name of bridge&gt;&#8221; and the adapters are disabled. One needs to
enable them and set the corresponding values to it to make them IP-able.</p>
<p>As a whole example, if we issue the following in a powershell console:</p>
<div class="highlight-ps1con"><div class="highlight"><pre><span></span><span class="go">PS &gt; Get-NetAdapter | select Name,InterfaceDescription</span>
<span class="go">Name                   InterfaceDescription</span>
<span class="go">----                   --------------------</span>
<span class="go">Ethernet1              Intel(R) PRO/1000 MT Network Connection</span>
<span class="go">br-pif                 Hyper-V Virtual Ethernet Adapter #2</span>
<span class="go">Ethernet0              Intel(R) PRO/1000 MT Network Connection #2</span>
<span class="go">br-int                 Hyper-V Virtual Ethernet Adapter #3</span>

<span class="go">PS &gt; Get-VMSwitch</span>
<span class="go">Name     SwitchType NetAdapterInterfaceDescription</span>
<span class="go">----     ---------- ------------------------------</span>
<span class="go">external External   Intel(R) PRO/1000 MT Network Connection #2</span>
</pre></div>
</div>
<p>We can see that we have a switch(external) created upon adapter name
&#8216;Ethernet0&#8217; with the internal ports under name &#8216;br-pif&#8217; and &#8216;br-int&#8217;. Thus
resulting into the following ovs-vsctl commands:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovs-vsctl add-port br-pif Ethernet0</span>
</pre></div>
</div>
<p>Dumping the ports should show the additional ports that were just added:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovs-dpctl show</span>
<span class="go">system@ovs-system:</span>
<span class="go">        lookups: hit:0 missed:0 lost:0</span>
<span class="go">        flows: 0</span>
<span class="go">        port 2: br-pif (internal)               &lt;&lt;&lt; internal port</span>
<span class="go">                                                    adapter on</span>
<span class="go">                                                    Hyper-V switch</span>
<span class="go">        port 1: br-int (internal)               &lt;&lt;&lt; internal port</span>
<span class="go">                                                    adapter on</span>
<span class="go">                                                    Hyper-V switch</span>
<span class="go">        port 3: Ethernet0                       &lt;&lt;&lt; Physical NIC</span>

<span class="go">&gt; ovs-vsctl show</span>
<span class="go">a56ec7b5-5b1f-49ec-a795-79f6eb63228b</span>
<span class="go">    Bridge br-pif</span>
<span class="go">        Port br-pif</span>
<span class="go">            Interface br-pif</span>
<span class="go">                type: internal</span>
<span class="go">        Port &quot;Ethernet0&quot;</span>
<span class="go">            Interface &quot;Ethernet0&quot;</span>
<span class="go">    Bridge br-int</span>
<span class="go">        Port br-int</span>
<span class="go">            Interface br-int</span>
<span class="go">                type: internal</span>
</pre></div>
</div>
</div>
<div class="section" id="add-virtual-interfaces-vifs">
<h7>Add virtual interfaces (VIFs)<a class="headerlink" href="#add-virtual-interfaces-vifs" title="Permalink to this headline">¶</a></h7>
<p>Adding VIFs to openvswitch is a two step procedure.  The first step is to
assign a &#8216;OVS port name&#8217; which is a unique name across all VIFs on this
Hyper-V.  The next step is to add the VIF to the ovsdb using its &#8216;OVS port
name&#8217; as key.</p>
<p>First, assign a unique &#8216;OVS port name&#8217; to the VIF. The VIF needs to have been
disconnected from the Hyper-V switch before assigning a &#8216;OVS port name&#8217; to it.
In the example below, we assign a &#8216;OVS port name&#8217; called <code class="docutils literal"><span class="pre">ovs-port-a</span></code> to a
VIF on a VM <code class="docutils literal"><span class="pre">VM1</span></code>.  By using index 0 for <code class="docutils literal"><span class="pre">$vnic</span></code>, the first VIF of the VM
is being addressed.  After assigning the name <code class="docutils literal"><span class="pre">ovs-port-a</span></code>, the VIF is
connected back to the Hyper-V switch with name <code class="docutils literal"><span class="pre">OVS-HV-Switch</span></code>, which is
assumed to be the Hyper-V switch with OVS extension enabled.:</p>
<div class="highlight-ps1con"><div class="highlight"><pre><span></span><span class="go">PS &gt; import-module .\datapath-windows\misc\OVS.psm1</span>
<span class="go">PS &gt; $vnic = Get-VMNetworkAdapter &lt;Name of the VM&gt;</span>
<span class="go">PS &gt; Disconnect-VMNetworkAdapter -VMNetworkAdapter $vnic[0]</span>
<span class="go">PS &gt; $vnic[0] | Set-VMNetworkAdapterOVSPort -OVSPortName ovs-port-a</span>
<span class="go">PS &gt; Connect-VMNetworkAdapter -VMNetworkAdapter $vnic[0] \</span>
<span class="go">      -SwitchName OVS-Extended-Switch</span>
</pre></div>
</div>
<p>Next, add the VIFs to <code class="docutils literal"><span class="pre">br-int</span></code>:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovs-vsctl add-port br-int ovs-port-a</span>
</pre></div>
</div>
<p>Dumping the ports should show the additional ports that were just added:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovs-dpctl show</span>
<span class="go">system@ovs-system:</span>
<span class="go">        lookups: hit:0 missed:0 lost:0</span>
<span class="go">        flows: 0</span>
<span class="go">        port 4: ovs-port-a</span>
<span class="go">        port 2: br-pif (internal)</span>
<span class="go">        port 1: br-int (internal</span>
<span class="go">        port 3: Ethernet0</span>

<span class="go">&gt; ovs-vsctl show</span>
<span class="go">4cd86499-74df-48bd-a64d-8d115b12a9f2</span>
<span class="go">    Bridge br-pif</span>
<span class="go">        Port &quot;vEthernet (external)&quot;</span>
<span class="go">            Interface &quot;vEthernet (external)&quot;</span>
<span class="go">        Port &quot;Ethernet0&quot;</span>
<span class="go">            Interface &quot;Ethernet0&quot;</span>
<span class="go">        Port br-pif</span>
<span class="go">            Interface br-pif</span>
<span class="go">                type: internal</span>
<span class="go">    Bridge br-int</span>
<span class="go">        Port br-int</span>
<span class="go">            Interface br-int</span>
<span class="go">                type: internal</span>
<span class="go">        Port &quot;ovs-port-a&quot;</span>
<span class="go">            Interface &quot;ovs-port-a&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="add-multiple-nics-to-be-managed-by-ovs">
<h7>Add multiple NICs to be managed by OVS<a class="headerlink" href="#add-multiple-nics-to-be-managed-by-ovs" title="Permalink to this headline">¶</a></h7>
<p>To leverage support of multiple NICs into OVS, we will be using the MSFT
cmdlets for forwarding team extension. More documentation about them can be
found at <a class="reference external" href="https://technet.microsoft.com/en-us/library/jj553812%28v=wps.630%29.aspx">technet</a>.</p>
<p>For example, to set up a switch team combined from <code class="docutils literal"><span class="pre">Ethernet0</span> <span class="pre">2</span></code> and
<code class="docutils literal"><span class="pre">Ethernet1</span> <span class="pre">2</span></code> named <code class="docutils literal"><span class="pre">external</span></code>:</p>
<div class="highlight-ps1con"><div class="highlight"><pre><span></span><span class="go">PS &gt; Get-NetAdapter</span>
<span class="go">Name                      InterfaceDescription</span>
<span class="go">----                      --------------------</span>
<span class="go">br-int                    Hyper-V Virtual Ethernet Adapter #3</span>
<span class="go">br-pif                    Hyper-V Virtual Ethernet Adapter #2</span>
<span class="go">Ethernet3 2               Intel(R) 82574L Gigabit Network Co...#3</span>
<span class="go">Ethernet2 2               Intel(R) 82574L Gigabit Network Co...#4</span>
<span class="go">Ethernet1 2               Intel(R) 82574L Gigabit Network Co...#2</span>
<span class="go">Ethernet0 2               Intel(R) 82574L Gigabit Network Conn...</span>

<span class="go">PS &gt; New-NetSwitchTeam -Name external -TeamMembers &quot;Ethernet0 2&quot;,&quot;Ethernet1 2&quot;</span>

<span class="go">PS &gt; Get-NetSwitchTeam</span>
<span class="go">Name    : external</span>
<span class="go">Members : {Ethernet1 2, Ethernet0 2}</span>
</pre></div>
</div>
<p>This will result in a new adapter bound to the host called <code class="docutils literal"><span class="pre">external</span></code>:</p>
<div class="highlight-ps1con"><div class="highlight"><pre><span></span><span class="go">PS &gt; Get-NetAdapter</span>
<span class="go">Name                      InterfaceDescription</span>
<span class="go">----                      --------------------</span>
<span class="go">br-test                   Hyper-V Virtual Ethernet Adapter #4</span>
<span class="go">br-pif                    Hyper-V Virtual Ethernet Adapter #2</span>
<span class="go">external                  Microsoft Network Adapter Multiplexo...</span>
<span class="go">Ethernet3 2               Intel(R) 82574L Gigabit Network Co...#3</span>
<span class="go">Ethernet2 2               Intel(R) 82574L Gigabit Network Co...#4</span>
<span class="go">Ethernet1 2               Intel(R) 82574L Gigabit Network Co...#2</span>
<span class="go">Ethernet0 2               Intel(R) 82574L Gigabit Network Conn...</span>
</pre></div>
</div>
<p>Next we will set up the Hyper-V VMSwitch on the new adapter <code class="docutils literal"><span class="pre">external</span></code>:</p>
<div class="highlight-ps1con"><div class="highlight"><pre><span></span><span class="go">PS &gt; New-VMSwitch -Name external -NetAdapterName external \</span>
<span class="go">     -AllowManagementOS $false</span>
</pre></div>
</div>
<p>Under OVS the adapters under the team <code class="docutils literal"><span class="pre">external</span></code>, <code class="docutils literal"><span class="pre">Ethernet0</span> <span class="pre">2</span></code> and
<code class="docutils literal"><span class="pre">Ethernet1</span> <span class="pre">2</span></code>, can be added either under a bond device or separately.</p>
<p>The following example shows how the bridges look with the NICs being
separated:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovs-vsctl show</span>
<span class="go">6cd9481b-c249-4ee3-8692-97b399dd29d8</span>
<span class="go">    Bridge br-test</span>
<span class="go">        Port br-test</span>
<span class="go">            Interface br-test</span>
<span class="go">                type: internal</span>
<span class="go">        Port &quot;Ethernet1 2&quot;</span>
<span class="go">            Interface &quot;Ethernet1 2&quot;</span>
<span class="go">    Bridge br-pif</span>
<span class="go">        Port &quot;Ethernet0 2&quot;</span>
<span class="go">            Interface &quot;Ethernet0 2&quot;</span>
<span class="go">        Port br-pif</span>
<span class="go">            Interface br-pif</span>
<span class="go">                type: internal</span>
</pre></div>
</div>
</div>
<div class="section" id="add-patch-ports-and-configure-vlan-tagging">
<h7>Add patch ports and configure VLAN tagging<a class="headerlink" href="#add-patch-ports-and-configure-vlan-tagging" title="Permalink to this headline">¶</a></h7>
<p>The Windows Open vSwitch implementation support VLAN tagging in the switch.
Switch VLAN tagging along with patch ports between <code class="docutils literal"><span class="pre">br-int</span></code> and <code class="docutils literal"><span class="pre">br-pif</span></code> is
used to configure VLAN tagging functionality between two VMs on different
Hyper-Vs.  To start, add a patch port from <code class="docutils literal"><span class="pre">br-int</span></code> to <code class="docutils literal"><span class="pre">br-pif</span></code>:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovs-vsctl add-port br-int patch-to-pif</span>
<span class="go">&gt; ovs-vsctl set interface patch-to-pif type=patch \</span>
<span class="go">    options:peer=patch-to-int</span>
</pre></div>
</div>
<p>Add a patch port from <code class="docutils literal"><span class="pre">br-pif</span></code> to <code class="docutils literal"><span class="pre">br-int</span></code>:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovs-vsctl add-port br-pif patch-to-int</span>
<span class="go">&gt; ovs-vsctl set interface patch-to-int type=patch \</span>
<span class="go">    options:peer=patch-to-pif</span>
</pre></div>
</div>
<p>Re-Add the VIF ports with the VLAN tag:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovs-vsctl add-port br-int ovs-port-a tag=900</span>
<span class="go">&gt; ovs-vsctl add-port br-int ovs-port-b tag=900</span>
</pre></div>
</div>
</div>
<div class="section" id="add-tunnels">
<h7>Add tunnels<a class="headerlink" href="#add-tunnels" title="Permalink to this headline">¶</a></h7>
<p>The Windows Open vSwitch implementation support VXLAN and STT tunnels. To add
tunnels. For example, first add the tunnel port between 172.168.201.101 &lt;-&gt;
172.168.201.102:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovs-vsctl add-port br-int tun-1</span>
<span class="go">&gt; ovs-vsctl set Interface tun-1 type=&lt;port-type&gt;</span>
<span class="go">&gt; ovs-vsctl set Interface tun-1 options:local_ip=172.168.201.101</span>
<span class="go">&gt; ovs-vsctl set Interface tun-1 options:remote_ip=172.168.201.102</span>
<span class="go">&gt; ovs-vsctl set Interface tun-1 options:in_key=flow</span>
<span class="go">&gt; ovs-vsctl set Interface tun-1 options:out_key=flow</span>
</pre></div>
</div>
<p>...and the tunnel port between 172.168.201.101 &lt;-&gt; 172.168.201.105:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovs-vsctl add-port br-int tun-2</span>
<span class="go">&gt; ovs-vsctl set Interface tun-2 type=&lt;port-type&gt;</span>
<span class="go">&gt; ovs-vsctl set Interface tun-2 options:local_ip=172.168.201.102</span>
<span class="go">&gt; ovs-vsctl set Interface tun-2 options:remote_ip=172.168.201.105</span>
<span class="go">&gt; ovs-vsctl set Interface tun-2 options:in_key=flow</span>
<span class="go">&gt; ovs-vsctl set Interface tun-2 options:out_key=flow</span>
</pre></div>
</div>
<p>Where <code class="docutils literal"><span class="pre">&lt;port-type&gt;</span></code> is one of: <code class="docutils literal"><span class="pre">stt</span></code> or <code class="docutils literal"><span class="pre">vxlan</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Any patch ports created between br-int and br-pif MUST be be deleted prior
to adding tunnels.</p>
</div>
</div>
</div>
<div class="section" id="windows-services">
<h6>Windows Services<a class="headerlink" href="#windows-services" title="Permalink to this headline">¶</a></h6>
<p>Open vSwitch daemons come with support to run as a Windows service. The
instructions here assume that you have installed the Open vSwitch utilities and
daemons via <code class="docutils literal"><span class="pre">make</span> <span class="pre">install</span></code>.</p>
<p>To start, create the database:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovsdb-tool create C:/openvswitch/etc/openvswitch/conf.db \</span>
<span class="go">    &quot;C:/openvswitch/usr/share/openvswitch/vswitch.ovsschema&quot;</span>
</pre></div>
</div>
<p>Create the ovsdb-server service and start it:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; sc create ovsdb-server \</span>
<span class="go">    binpath=&quot;C:/openvswitch/usr/sbin/ovsdb-server.exe \</span>
<span class="go">    C:/openvswitch/etc/openvswitch/conf.db \</span>
<span class="go">    -vfile:info --log-file --pidfile \</span>
<span class="go">    --remote=punix:db.sock --service --service-monitor&quot;</span>
<span class="go">&gt; sc start ovsdb-server</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>One of the common issues with creating a Windows service is with mungled
paths.  You can make sure that the correct path has been registered with the
Windows services manager by running:</p>
<div class="last highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; sc qc ovsdb-server</span>
</pre></div>
</div>
</div>
<p>Check that the service is healthy by running:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; sc query ovsdb-server</span>
</pre></div>
</div>
<p>Initialize the database:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; ovs-vsctl --no-wait init</span>
</pre></div>
</div>
<p>Create the ovs-vswitchd service and start it:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; sc create ovs-vswitchd \</span>
<span class="go">    binpath=&quot;C:/openvswitch/usr/sbin/ovs-vswitchd.exe \</span>
<span class="go">    --pidfile -vfile:info --log-file  --service --service-monitor&quot;</span>
<span class="go">&gt; sc start ovs-vswitchd</span>
</pre></div>
</div>
<p>Check that the service is healthy by running:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; sc query ovs-vswitchd</span>
</pre></div>
</div>
<p>To stop and delete the services, run:</p>
<div class="highlight-doscon"><div class="highlight"><pre><span></span><span class="go">&gt; sc stop ovs-vswitchd</span>
<span class="go">&gt; sc stop ovsdb-server</span>
<span class="go">&gt; sc delete ovs-vswitchd</span>
<span class="go">&gt; sc delete ovsdb-server</span>
</pre></div>
</div>
</div>
<div class="section" id="windows-ci-service">
<h6>Windows CI Service<a class="headerlink" href="#windows-ci-service" title="Permalink to this headline">¶</a></h6>
<p><a class="reference external" href="www.appveyor.com">AppVeyor</a> provides a free Windows autobuild service for
opensource projects.  Open vSwitch has integration with AppVeyor for continuous
build.  A developer can build test his changes for Windows by logging into
appveyor.com using a github account, creating a new project by linking it to
his development repository in github and triggering a new build.</p>
</div>
<div class="section" id="todo">
<h6>TODO<a class="headerlink" href="#todo" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Investigate the working of sFlow on Windows and re-enable the unit tests.</li>
<li>Investigate and add the feature to provide QoS.</li>
<li>Sign the driver &amp; create an MSI for installing the different OpenvSwitch
components on Windows.</li>
</ul>
</div>
</div>
<span id="document-intro/install/xenserver"></span><div class="section" id="open-vswitch-on-citrix-xenserver">
<h5>Open vSwitch on Citrix XenServer<a class="headerlink" href="#open-vswitch-on-citrix-xenserver" title="Permalink to this headline">¶</a></h5>
<p>This document describes how to build and install Open vSwitch on a Citrix
XenServer host.  If you want to install Open vSwitch on a generic Linux or BSD
host, refer to <a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a> instead.</p>
<p>Open vSwitch should work with XenServer 5.6.100 and later.  However, Open
vSwitch requires Python 2.7 or later, so using Open vSwitch with XenServer 6.5
or earlier requires installing Python 2.7.</p>
<div class="section" id="building">
<h6>Building<a class="headerlink" href="#building" title="Permalink to this headline">¶</a></h6>
<p>You may build from an Open vSwitch distribution tarball or from an Open vSwitch
Git tree.  The recommended build environment to build RPMs for Citrix XenServer
is the DDK VM available from Citrix.</p>
<ol class="arabic">
<li><p class="first">If you are building from an Open vSwitch Git tree, then you will need to
first create a distribution tarball by running:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./boot.sh
$ ./configure
$ make dist
</pre></div>
</div>
<p>You cannot run this in the DDK VM, because it lacks tools that are necessary
to bootstrap the Open vSwitch distribution.  Instead, you must run this on a
machine that has the tools listed in <a class="reference internal" href="contents.html#general-install-reqs"><span>Installation Requirements</span></a> as
prerequisites for building from a Git tree.</p>
</li>
<li><p class="first">Copy the distribution tarball into <code class="docutils literal"><span class="pre">/usr/src/redhat/SOURCES</span></code> inside
the DDK VM.</p>
</li>
<li><p class="first">In the DDK VM, unpack the distribution tarball into a temporary directory
and &#8220;cd&#8221; into the root of the distribution tarball.</p>
</li>
<li><p class="first">To build Open vSwitch userspace, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ rpmbuild -bb xenserver/openvswitch-xen.spec
</pre></div>
</div>
<p>This produces three RPMs in <code class="docutils literal"><span class="pre">/usr/src/redhat/RPMS/i386</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">openvswitch</span></code></li>
<li><code class="docutils literal"><span class="pre">openvswitch-modules-xen</span></code></li>
<li><code class="docutils literal"><span class="pre">openvswitch-debuginfo</span></code></li>
</ul>
<p>The above command automatically runs the Open vSwitch unit tests.  To
disable the unit tests, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ rpmbuild -bb --without check xenserver/openvswitch-xen.spec
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="build-parameters">
<h6>Build Parameters<a class="headerlink" href="#build-parameters" title="Permalink to this headline">¶</a></h6>
<p><code class="docutils literal"><span class="pre">openvswitch-xen.spec</span></code> needs to know a number of pieces of information about
the XenServer kernel.  Usually, it can figure these out for itself, but if it
does not do it correctly then you can specify them yourself as parameters to
the build.  Thus, the final <code class="docutils literal"><span class="pre">rpmbuild</span></code> step above can be elaborated as:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ VERSION=&lt;Open vSwitch version&gt;
$ KERNEL_NAME=&lt;Xen Kernel name&gt;
$ KERNEL_VERSION=&lt;Xen Kernel version&gt;
$ KERNEL_FLAVOR=&lt;Xen Kernel flavor(suffix)&gt;
$ rpmbuild \
     -D &quot;openvswitch_version $VERSION&quot; \
     -D &quot;kernel_name $KERNEL_NAME&quot; \
     -D &quot;kernel_version $KERNEL_VERSION&quot; \
     -D &quot;kernel_flavor $KERNEL_FLAVOR&quot; \
     -bb xenserver/openvswitch-xen.spec
</pre></div>
</div>
<p>where:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">&lt;openvswitch</span> <span class="pre">version&gt;</span></code></dt>
<dd>is the version number that appears in the name of the Open vSwitch tarball,
e.g. 0.90.0.</dd>
<dt><code class="docutils literal"><span class="pre">&lt;Xen</span> <span class="pre">Kernel</span> <span class="pre">name&gt;</span></code></dt>
<dd>is the name of the XenServer kernel package, e.g. <code class="docutils literal"><span class="pre">kernel-xen</span></code> or
<code class="docutils literal"><span class="pre">kernel-NAME-xen</span></code>, without the <code class="docutils literal"><span class="pre">kernel-</span></code> prefix.</dd>
<dt><code class="docutils literal"><span class="pre">&lt;Xen</span> <span class="pre">Kernel</span> <span class="pre">version&gt;</span></code></dt>
<dd><p class="first">is the output of:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ rpm -q --queryformat &quot;%{Version}-%{Release}&quot; &lt;kernel-devel-package&gt;,
</pre></div>
</div>
<p class="last">e.g. <code class="docutils literal"><span class="pre">2.6.32.12-0.7.1.xs5.6.100.323.170596</span></code>, where
<code class="docutils literal"><span class="pre">&lt;kernel-devel-package&gt;</span></code> is the name of the <code class="docutils literal"><span class="pre">-devel</span></code> package
corresponding to <code class="docutils literal"><span class="pre">&lt;Xen</span> <span class="pre">Kernel</span> <span class="pre">name&gt;</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">&lt;Xen</span> <span class="pre">Kernel</span> <span class="pre">flavor</span> <span class="pre">(suffix)&gt;</span></code></dt>
<dd>is either <code class="docutils literal"><span class="pre">xen</span></code> or <code class="docutils literal"><span class="pre">kdump</span></code>, where <code class="docutils literal"><span class="pre">xen</span></code> flavor is the main running
kernel flavor and the <code class="docutils literal"><span class="pre">kdump</span></code> flavor is the crashdump kernel flavor.
Commonly, one would specify <code class="docutils literal"><span class="pre">xen</span></code> here.</dd>
</dl>
<p>For XenServer 6.5 or above, the kernel version naming no longer contains
KERNEL_FLAVOR.  In fact, only providing the <code class="docutils literal"><span class="pre">uname</span> <span class="pre">-r</span></code> output is enough.  So,
the final <code class="docutils literal"><span class="pre">rpmbuild</span></code> step changes to:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ KERNEL_UNAME=&lt;`uname -r` output&gt;
$ rpmbuild \
    -D &quot;kenel_uname $KERNEL_UNAME&quot; \
    -bb xenserver/openvswitch-xen.spec
</pre></div>
</div>
</div>
<div class="section" id="installing-open-vswitch-for-xenserver">
<h6>Installing Open vSwitch for XenServer<a class="headerlink" href="#installing-open-vswitch-for-xenserver" title="Permalink to this headline">¶</a></h6>
<p>To install Open vSwitch on a XenServer host, or to upgrade to a newer version,
copy the <code class="docutils literal"><span class="pre">openvswitch</span></code> and <code class="docutils literal"><span class="pre">openvswitch-modules-xen</span></code> RPMs to that host with
<code class="docutils literal"><span class="pre">scp</span></code>, then install them with <code class="docutils literal"><span class="pre">rpm</span> <span class="pre">-U</span></code>, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ scp openvswitch-$VERSION-1.i386.rpm \
    openvswitch-modules-xen-$XEN_KERNEL_VERSION-$VERSION-1.i386.rpm \
    root@&lt;host&gt;:
# Enter &lt;host&gt;&#39;s root password.
$ ssh root@&lt;host&gt;
# Enter &lt;host&gt;&#39;s root password again.
$ rpm -U openvswitch-$VERSION-1.i386.rpm \
    openvswitch-modules-xen-$XEN_KERNEL_VERSION-$VERSION-1.i386.rpm
</pre></div>
</div>
<p>To uninstall Open vSwitch from a XenServer host, remove the packages:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ssh root@&lt;host&gt;
# Enter &lt;host&gt;&#39;s root password again.
$ rpm -e openvswitch openvswitch-modules-xen-$XEN_KERNEL_VERSION
</pre></div>
</div>
<p>After installing or uninstalling Open vSwitch, the XenServer should be rebooted
as soon as possible.</p>
</div>
<div class="section" id="open-vswitch-boot-sequence-on-xenserver">
<h6>Open vSwitch Boot Sequence on XenServer<a class="headerlink" href="#open-vswitch-boot-sequence-on-xenserver" title="Permalink to this headline">¶</a></h6>
<p>When Open vSwitch is installed on XenServer, its startup script
<code class="docutils literal"><span class="pre">/etc/init.d/openvswitch</span></code> runs early in boot.  It does roughly the following:</p>
<ul class="simple">
<li>Loads the OVS kernel module, openvswitch.</li>
<li>Starts ovsdb-server, the OVS configuration database.</li>
<li>XenServer expects there to be no bridges configured at startup, but the OVS
configuration database likely still has bridges configured from before
reboot.  To match XenServer expectations, the startup script deletes all
configured bridges from the database.</li>
<li>Starts ovs-vswitchd, the OVS switching daemon.</li>
</ul>
<p>At this point in the boot process, then, there are no Open vSwitch bridges,
even though all of the Open vSwitch daemons are running.  Later on in boot,
<code class="docutils literal"><span class="pre">/etc/init.d/management-interface</span></code> (part of XenServer, not Open vSwitch)
creates the bridge for the XAPI management interface by invoking
<code class="docutils literal"><span class="pre">/opt/xensource/libexec/interface-reconfigure</span></code>.  Normally this program
consults XAPI&#8217;s database to obtain information about how to configure the
bridge, but XAPI is not running yet(*) so it instead consults
<code class="docutils literal"><span class="pre">/var/xapi/network.dbcache</span></code>, which is a cached copy of the most recent
network configuration.</p>
<dl class="docutils">
<dt>(*) Even if XAPI were running, if this XenServer node is a pool slave then the</dt>
<dd>query would have to consult the master, which requires network access,
which begs the question of how to configure the management interface.</dd>
</dl>
<p>XAPI starts later on in the boot process.  XAPI can then create other bridges
on demand using <code class="docutils literal"><span class="pre">/opt/xensource/libexec/interface-reconfigure</span></code>.  Now that
XAPI is running, that program consults XAPI directly instead of reading the
cache.</p>
<p>As part of its own startup, XAPI invokes the Open vSwitch XAPI plugin script
<code class="docutils literal"><span class="pre">/etc/xapi.d/openvswitch-cfg-update</span></code> passing the <code class="docutils literal"><span class="pre">update</span></code> command.  The
plugin script does roughly the following:</p>
<ul class="simple">
<li>Calls <code class="docutils literal"><span class="pre">/opt/xensource/libexec/interface-reconfigure</span></code> with the <code class="docutils literal"><span class="pre">rewrite</span></code>
command, to ensure that the network cache is up-to-date.</li>
<li>Queries the Open vSwitch manager setting (named <code class="docutils literal"><span class="pre">vswitch_controller</span></code>) from
the XAPI database for the XenServer pool.</li>
<li>If XAPI and OVS are configured for different managers, or if OVS is
configured for a manager but XAPI is not, runs <code class="docutils literal"><span class="pre">ovs-vsctl</span> <span class="pre">emer-reset</span></code> to
bring the Open vSwitch configuration to a known state.  One effect of
emer-reset is to deconfigure any manager from the OVS database.</li>
<li>If XAPI is configured for a manager, configures the OVS manager to match with
<code class="docutils literal"><span class="pre">ovs-vsctl</span> <span class="pre">set-manager</span></code>.</li>
</ul>
</div>
<div class="section" id="notes">
<h6>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>The Open vSwitch boot sequence only configures an OVS configuration database
manager.  There is no way to directly configure an OpenFlow controller on
XenServer and, as a consequence of the step above that deletes all of the
bridges at boot time, controller configuration only persists until XenServer
reboot.  The configuration database manager can, however, configure
controllers for bridges.  See the BUGS section of ovs-testcontroller(8) for
more information on this topic.</li>
<li>The Open vSwitch startup script automatically adds a firewall rule to allow
GRE traffic. This rule is needed for the XenServer feature called &#8220;Cross-Host
Internal Networks&#8221; (CHIN) that uses GRE. If a user configures tunnels other
than GRE (ex: Geneve, VXLAN, LISP), they will have to either manually add a
iptables firewall rule to allow the tunnel traffic or add it through a
startup script (Please refer to the &#8220;enable-protocol&#8221; command in the
ovs-ctl(8) manpage).</li>
</ul>
</div>
<div class="section" id="reporting-bugs">
<h6>Reporting Bugs<a class="headerlink" href="#reporting-bugs" title="Permalink to this headline">¶</a></h6>
<p>Please report problems to <a class="reference external" href="mailto:bugs&#37;&#52;&#48;openvswitch&#46;org">bugs<span>&#64;</span>openvswitch<span>&#46;</span>org</a>.</p>
</div>
</div>
<span id="document-intro/install/userspace"></span><div class="section" id="open-vswitch-without-kernel-support">
<h5>Open vSwitch without Kernel Support<a class="headerlink" href="#open-vswitch-without-kernel-support" title="Permalink to this headline">¶</a></h5>
<p>Open vSwitch can operate, at a cost in performance, entirely in userspace,
without assistance from a kernel module.  This file explains how to install
Open vSwitch in such a mode.</p>
<p>This version of Open vSwitch should be built manually with <code class="docutils literal"><span class="pre">configure</span></code> and
<code class="docutils literal"><span class="pre">make</span></code>.  Debian packaging for Open vSwitch is also included, but it has not
been recently tested, and so Debian packages are not a recommended way to use
this version of Open vSwitch.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The userspace-only mode of Open vSwitch without DPDK is considered
experimental. It has not been thoroughly tested.</p>
</div>
<div class="section" id="building-and-installing">
<h6>Building and Installing<a class="headerlink" href="#building-and-installing" title="Permalink to this headline">¶</a></h6>
<p>The requirements and procedure for building, installing, and configuring Open
vSwitch are the same as those given in <a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a>. You may omit
configuring, building, and installing the kernel module, and the related
requirements.</p>
<p>On Linux, the userspace switch additionally requires the kernel TUN/TAP driver
to be available, either built into the kernel or loaded as a module.  If you
are not sure, check for a directory named <code class="docutils literal"><span class="pre">/sys/class/misc/tun</span></code>.  If it does
not exist, then attempt to load the module with <code class="docutils literal"><span class="pre">modprobe</span> <span class="pre">tun</span></code>.</p>
<p>The tun device must also exist as <code class="docutils literal"><span class="pre">/dev/net/tun</span></code>.  If it does not exist, then
create <code class="docutils literal"><span class="pre">/dev/net</span></code> (if necessary) with <code class="docutils literal"><span class="pre">mkdir</span> <span class="pre">/dev/net</span></code>, then create
<code class="docutils literal"><span class="pre">/dev/net/tun</span></code> with <code class="docutils literal"><span class="pre">mknod</span> <span class="pre">/dev/net/tun</span> <span class="pre">c</span> <span class="pre">10</span> <span class="pre">200</span></code>.</p>
<p>On FreeBSD and NetBSD, the userspace switch additionally requires the kernel
tap(4) driver to be available, either built into the kernel or loaded as a
module.</p>
</div>
<div class="section" id="using-the-userspace-datapath-with-ovs-vswitchd">
<h6>Using the Userspace Datapath with ovs-vswitchd<a class="headerlink" href="#using-the-userspace-datapath-with-ovs-vswitchd" title="Permalink to this headline">¶</a></h6>
<p>To use ovs-vswitchd in userspace mode, create a bridge with
<code class="docutils literal"><span class="pre">datapath_type=netdev</span></code> in the configuration database.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl set bridge br0 datapath_type=netdev
$ ovs-vsctl add-port br0 eth0
$ ovs-vsctl add-port br0 eth1
$ ovs-vsctl add-port br0 eth2
</pre></div>
</div>
<p>ovs-vswitchd will create a TAP device as the bridge&#8217;s local interface, named
the same as the bridge, as well as for each configured internal interface.</p>
<p>Currently, on FreeBSD, the functionality required for in-band control support
is not implemented.  To avoid related errors, you can disable the in-band
support with the following command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set bridge br0 other_config:disable-in-band=true
</pre></div>
</div>
</div>
<div class="section" id="firewall-rules">
<h6>Firewall Rules<a class="headerlink" href="#firewall-rules" title="Permalink to this headline">¶</a></h6>
<p>On Linux, when a physical interface is in use by the userspace datapath,
packets received on the interface still also pass into the kernel TCP/IP stack.
This can cause surprising and incorrect behavior.  You can use &#8220;iptables&#8221; to
avoid this behavior, by using it to drop received packets.  For example, to
drop packets received on eth0:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ iptables -A INPUT -i eth0 -j DROP
$ iptables -A FORWARD -i eth0 -j DROP
</pre></div>
</div>
</div>
<div class="section" id="other-settings">
<h6>Other Settings<a class="headerlink" href="#other-settings" title="Permalink to this headline">¶</a></h6>
<p>On NetBSD, depending on your network topology and applications, the following
configuration might help.  See sysctl(7).:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ sysctl -w net.inet.ip.checkinterface=1
</pre></div>
</div>
</div>
<div class="section" id="reporting-bugs">
<h6>Reporting Bugs<a class="headerlink" href="#reporting-bugs" title="Permalink to this headline">¶</a></h6>
<p>Report problems to <a class="reference external" href="mailto:bugs&#37;&#52;&#48;openvswitch&#46;org">bugs<span>&#64;</span>openvswitch<span>&#46;</span>org</a>.</p>
</div>
</div>
<span id="document-intro/install/dpdk"></span><div class="section" id="open-vswitch-with-dpdk">
<h5>Open vSwitch with DPDK<a class="headerlink" href="#open-vswitch-with-dpdk" title="Permalink to this headline">¶</a></h5>
<p>This document describes how to build and install Open vSwitch using a DPDK
datapath. Open vSwitch can use the DPDK library to operate entirely in
userspace.</p>
<div class="section" id="build-requirements">
<h6>Build requirements<a class="headerlink" href="#build-requirements" title="Permalink to this headline">¶</a></h6>
<p>In addition to the requirements described in <a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a>, building Open
vSwitch with DPDK will require the following:</p>
<ul>
<li><p class="first">DPDK 16.11</p>
</li>
<li><p class="first">A <a class="reference external" href="http://dpdk.org/doc/nics">DPDK supported NIC</a></p>
<p>Only required when physical ports are in use</p>
</li>
<li><p class="first">A suitable kernel</p>
<p>On Linux Distros running kernel version &gt;= 3.0, only <cite>IOMMU</cite> needs to enabled
via the grub cmdline, assuming you are using <strong>VFIO</strong>. For older kernels,
ensure the kernel is built with <code class="docutils literal"><span class="pre">UIO</span></code>, <code class="docutils literal"><span class="pre">HUGETLBFS</span></code>,
<code class="docutils literal"><span class="pre">PROC_PAGE_MONITOR</span></code>, <code class="docutils literal"><span class="pre">HPET</span></code>, <code class="docutils literal"><span class="pre">HPET_MMAP</span></code> support. If these are not
present, it will be necessary to upgrade your kernel or build a custom kernel
with these flags enabled.</p>
</li>
</ul>
<p>Detailed system requirements can be found at <a class="reference external" href="http://dpdk.org/doc/guides/linux_gsg/sys_reqs.html">DPDK requirements</a>.</p>
</div>
<div class="section" id="installing">
<h6>Installing<a class="headerlink" href="#installing" title="Permalink to this headline">¶</a></h6>
<div class="section" id="install-dpdk">
<h7>Install DPDK<a class="headerlink" href="#install-dpdk" title="Permalink to this headline">¶</a></h7>
<ol class="arabic">
<li><p class="first">Download the <a class="reference external" href="http://dpdk.org/rel">DPDK sources</a>, extract the file and set <code class="docutils literal"><span class="pre">DPDK_DIR</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cd /usr/src/
$ wget http://fast.dpdk.org/rel/dpdk-16.11.tar.xz
$ tar xf dpdk-16.11.tar.xz
$ export DPDK_DIR=/usr/src/dpdk-16.11
$ cd $DPDK_DIR
</pre></div>
</div>
</li>
<li><p class="first">(Optional) Configure DPDK as a shared library</p>
<p>DPDK can be built as either a static library or a shared library.  By
default, it is configured for the former. If you wish to use the latter, set
<code class="docutils literal"><span class="pre">CONFIG_RTE_BUILD_SHARED_LIB=y</span></code> in <code class="docutils literal"><span class="pre">$DPDK_DIR/config/common_base</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Minor performance loss is expected when using OVS with a shared DPDK
library compared to a static DPDK library.</p>
</div>
</li>
<li><p class="first">Configure and install DPDK</p>
<p>Build and install the DPDK library:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ export DPDK_TARGET=x86_64-native-linuxapp-gcc
$ export DPDK_BUILD=$DPDK_DIR/$DPDK_TARGET
$ make install T=$DPDK_TARGET DESTDIR=install
</pre></div>
</div>
</li>
<li><p class="first">(Optional) Export the DPDK shared library location</p>
<p>If DPDK was built as a shared library, export the path to this library for
use when building OVS:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ export LD_LIBRARY_PATH=$DPDK_DIR/x86_64-native-linuxapp-gcc/lib
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="install-ovs">
<h7>Install OVS<a class="headerlink" href="#install-ovs" title="Permalink to this headline">¶</a></h7>
<p>OVS can be installed using different methods. For OVS to use DPDK datapath, it
has to be configured with DPDK support (<code class="docutils literal"><span class="pre">--with-dpdk</span></code>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section focuses on generic recipe that suits most cases. For
distribution specific instructions, refer to one of the more relevant guides.</p>
</div>
<ol class="arabic">
<li><p class="first">Ensure the standard OVS requirements, described in
<a class="reference internal" href="contents.html#general-build-reqs"><span>Build Requirements</span></a>, are installed</p>
</li>
<li><p class="first">Bootstrap, if required, as described in <a class="reference internal" href="contents.html#general-bootstrapping"><span>Bootstrapping</span></a></p>
</li>
<li><p class="first">Configure the package using the <code class="docutils literal"><span class="pre">--with-dpdk</span></code> flag:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./configure --with-dpdk=$DPDK_BUILD
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">DPDK_BUILD</span></code> is the path to the built DPDK library. This can be
skipped if DPDK library is installed in its default location</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">While <code class="docutils literal"><span class="pre">--with-dpdk</span></code> is required, you can pass any other configuration
option described in <a class="reference internal" href="contents.html#general-configuring"><span>Configuring</span></a>.</p>
</div>
</li>
<li><p class="first">Build and install OVS, as described in <a class="reference internal" href="contents.html#general-building"><span>Building</span></a></p>
</li>
</ol>
<p>Additional information can be found in <a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a>.</p>
</div>
</div>
<div class="section" id="setup">
<h6>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h6>
<div class="section" id="setup-hugepages">
<h7>Setup Hugepages<a class="headerlink" href="#setup-hugepages" title="Permalink to this headline">¶</a></h7>
<p>Allocate a number of 2M Huge pages:</p>
<ul>
<li><p class="first">For persistent allocation of huge pages, write to hugepages.conf file
in <cite>/etc/sysctl.d</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ echo &#39;vm.nr_hugepages=2048&#39; &gt; /etc/sysctl.d/hugepages.conf
</pre></div>
</div>
</li>
<li><p class="first">For run-time allocation of huge pages, use the <code class="docutils literal"><span class="pre">sysctl</span></code> utility:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ sysctl -w vm.nr_hugepages=N  # where N = No. of 2M huge pages
</pre></div>
</div>
</li>
</ul>
<p>To verify hugepage configuration:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ grep HugePages_ /proc/meminfo
</pre></div>
</div>
<p>Mount the hugepages, if not already mounted by default:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ mount -t hugetlbfs none /dev/hugepages``
</pre></div>
</div>
</div>
<div class="section" id="setup-dpdk-devices-using-vfio">
<span id="dpdk-vfio"></span><h7>Setup DPDK devices using VFIO<a class="headerlink" href="#setup-dpdk-devices-using-vfio" title="Permalink to this headline">¶</a></h7>
<p>VFIO is prefered to the UIO driver when using recent versions of DPDK. VFIO
support required support from both the kernel and BIOS. For the former, kernel
version &gt; 3.6 must be used. For the latter, you must enable VT-d in the BIOS
and ensure this is configured via grub. To ensure VT-d is enabled via the BIOS,
run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ dmesg | grep -e DMAR -e IOMMU
</pre></div>
</div>
<p>If VT-d is not enabled in the BIOS, enable it now.</p>
<p>To ensure VT-d is enabled in the kernel, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cat /proc/cmdline | grep iommu=pt
$ cat /proc/cmdline | grep intel_iommu=on
</pre></div>
</div>
<p>If VT-d is not enabled in the kernel, enable it now.</p>
<p>Once VT-d is correctly configured, load the required modules and bind the NIC
to the VFIO driver:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ modprobe vfio-pci
$ /usr/bin/chmod a+x /dev/vfio
$ /usr/bin/chmod 0666 /dev/vfio/*
$ $DPDK_DIR/tools/dpdk-devbind.py --bind=vfio-pci eth1
$ $DPDK_DIR/tools/dpdk-devbind.py --status
</pre></div>
</div>
</div>
<div class="section" id="setup-ovs">
<h7>Setup OVS<a class="headerlink" href="#setup-ovs" title="Permalink to this headline">¶</a></h7>
<p>Open vSwitch should be started as described in <a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a> with the
exception of ovs-vswitchd, which requires some special configuration to enable
DPDK functionality. DPDK configuration arguments can be passed to ovs-vswitchd
via the <code class="docutils literal"><span class="pre">other_config</span></code> column of the <code class="docutils literal"><span class="pre">Open_vSwitch</span></code> table. At a minimum,
the <code class="docutils literal"><span class="pre">dpdk-init</span></code> option must be set to <code class="docutils literal"><span class="pre">true</span></code>. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ export DB_SOCK=/usr/local/var/run/openvswitch/db.sock
$ ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
$ ovs-vswitchd unix:$DB_SOCK --pidfile --detach
</pre></div>
</div>
<p>There are many other configuration options, the most important of which are
listed below. Defaults will be provided for all values not explicitly set.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">dpdk-init</span></code></dt>
<dd>Specifies whether OVS should initialize and support DPDK ports. This is a
boolean, and defaults to false.</dd>
<dt><code class="docutils literal"><span class="pre">dpdk-lcore-mask</span></code></dt>
<dd>Specifies the CPU cores on which dpdk lcore threads should be spawned and
expects hex string (eg &#8216;0x123&#8217;).</dd>
<dt><code class="docutils literal"><span class="pre">dpdk-socket-mem</span></code></dt>
<dd>Comma separated list of memory to pre-allocate from hugepages on specific
sockets.</dd>
<dt><code class="docutils literal"><span class="pre">dpdk-hugepage-dir</span></code></dt>
<dd>Directory where hugetlbfs is mounted</dd>
<dt><code class="docutils literal"><span class="pre">vhost-sock-dir</span></code></dt>
<dd>Option to set the path to the vhost-user unix socket files.</dd>
</dl>
<p>If allocating more than one GB hugepage, you can configure the
amount of memory used from any given NUMA nodes. For example, to use 1GB from
NUMA node 0, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl --no-wait set Open_vSwitch . \
    other_config:dpdk-socket-mem=&quot;1024,0&quot;
</pre></div>
</div>
<p>Similarly, if you wish to better scale the workloads across cores, then
multiple pmd threads can be created and pinned to CPU cores by explicity
specifying <code class="docutils literal"><span class="pre">pmd-cpu-mask</span></code>. Cores are numbered from 0, so to spawn two pmd
threads and pin them to cores 1,2, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set Open_vSwitch . other_config:pmd-cpu-mask=0x6
</pre></div>
</div>
<p>Refer to ovs-vswitchd.conf.db(5) for additional information on configuration
options.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Changing any of these options requires restarting the ovs-vswitchd
application</p>
</div>
</div>
</div>
<div class="section" id="validating">
<h6>Validating<a class="headerlink" href="#validating" title="Permalink to this headline">¶</a></h6>
<p>At this point you can use ovs-vsctl to set up bridges and other Open vSwitch
features. Seeing as we&#8217;ve configured the DPDK datapath, we will use DPDK-type
ports. For example, to create a userspace bridge named <code class="docutils literal"><span class="pre">br0</span></code> and add two
<code class="docutils literal"><span class="pre">dpdk</span></code> ports to it, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
$ ovs-vsctl add-port br0 myportnameone -- set Interface myportnameone \
    type=dpdk options:dpdk-devargs=0000:06:00.0
$ ovs-vsctl add-port br0 myportnametwo -- set Interface myportnametwo \
    type=dpdk options:dpdk-devargs=0000:06:00.1
</pre></div>
</div>
<p>DPDK devices will not be available for use until a valid dpdk-devargs is
specified.</p>
<p>Refer to ovs-vsctl(8) and <a class="reference internal" href="contents.html#document-howto/dpdk"><em>Using Open vSwitch with DPDK</em></a> for more details.</p>
</div>
<div class="section" id="performance-tuning">
<h6>Performance Tuning<a class="headerlink" href="#performance-tuning" title="Permalink to this headline">¶</a></h6>
<p>To achieve optimal OVS performance, the system can be configured and that
includes BIOS tweaks, Grub cmdline additions, better understanding of NUMA
nodes and apt selection of PCIe slots for NIC placement.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section is optional. Once installed as described above, OVS with DPDK
will work out of the box.</p>
</div>
<div class="section" id="recommended-bios-settings">
<h7>Recommended BIOS Settings<a class="headerlink" href="#recommended-bios-settings" title="Permalink to this headline">¶</a></h7>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-text">Recommended BIOS Settings</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>C3 Power State</td>
<td>Disabled</td>
</tr>
<tr class="row-odd"><td>C6 Power State</td>
<td>Disabled</td>
</tr>
<tr class="row-even"><td>MLC Streamer</td>
<td>Enabled</td>
</tr>
<tr class="row-odd"><td>MLC Spacial Prefetcher</td>
<td>Enabled</td>
</tr>
<tr class="row-even"><td>DCU Data Prefetcher</td>
<td>Enabled</td>
</tr>
<tr class="row-odd"><td>DCA</td>
<td>Enabled</td>
</tr>
<tr class="row-even"><td>CPU Power and Performance</td>
<td>Performance</td>
</tr>
<tr class="row-odd"><td>Memeory RAS and Performance Config -&gt; NUMA optimized</td>
<td>Enabled</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="pcie-slot-selection">
<h7>PCIe Slot Selection<a class="headerlink" href="#pcie-slot-selection" title="Permalink to this headline">¶</a></h7>
<p>The fastpath performance can be affected by factors related to the placement of
the NIC, such as channel speeds between PCIe slot and CPU or the proximity of
PCIe slot to the CPU cores running the DPDK application. Listed below are the
steps to identify right PCIe slot.</p>
<ol class="arabic">
<li><p class="first">Retrieve host details using <code class="docutils literal"><span class="pre">dmidecode</span></code>. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ dmidecode -t baseboard | grep &quot;Product Name&quot;
</pre></div>
</div>
</li>
<li><p class="first">Download the technical specification for product listed, e.g: S2600WT2</p>
</li>
<li><p class="first">Check the Product Architecture Overview on the Riser slot placement, CPU
sharing info and also PCIe channel speeds</p>
<p>For example: On S2600WT, CPU1 and CPU2 share Riser Slot 1 with Channel speed
between CPU1 and Riser Slot1 at 32GB/s, CPU2 and Riser Slot1 at 16GB/s.
Running DPDK app on CPU1 cores and NIC inserted in to Riser card Slots will
optimize OVS performance in this case.</p>
</li>
<li><p class="first">Check the Riser Card #1 - Root Port mapping information, on the available
slots and individual bus speeds. In S2600WT slot 1, slot 2 has high bus
speeds and are potential slots for NIC placement.</p>
</li>
</ol>
</div>
<div class="section" id="advanced-hugepage-setup">
<h7>Advanced Hugepage Setup<a class="headerlink" href="#advanced-hugepage-setup" title="Permalink to this headline">¶</a></h7>
<p>Allocate and mount 1 GB hugepages.</p>
<ul>
<li><p class="first">For persistent allocation of huge pages, add the following options to the
kernel bootline:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>default_hugepagesz=1GB hugepagesz=1G hugepages=N
</pre></div>
</div>
<p>For platforms supporting multiple huge page sizes, add multiple options:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>default_hugepagesz=&lt;size&gt; hugepagesz=&lt;size&gt; hugepages=N
</pre></div>
</div>
<p>where:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">N</span></code></dt>
<dd><p class="first last">number of huge pages requested</p>
</dd>
<dt><code class="docutils literal"><span class="pre">size</span></code></dt>
<dd><p class="first last">huge page size with an optional suffix <code class="docutils literal"><span class="pre">[kKmMgG]</span></code></p>
</dd>
</dl>
</li>
<li><p class="first">For run-time allocation of huge pages:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ echo N &gt; /sys/devices/system/node/nodeX/hugepages/hugepages-1048576kB/nr_hugepages
</pre></div>
</div>
<p>where:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">N</span></code></dt>
<dd><p class="first last">number of huge pages requested</p>
</dd>
<dt><code class="docutils literal"><span class="pre">X</span></code></dt>
<dd><p class="first last">NUMA Node</p>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For run-time allocation of 1G huge pages, Contiguous Memory Allocator
(<code class="docutils literal"><span class="pre">CONFIG_CMA</span></code>) has to be supported by kernel, check your Linux distro.</p>
</div>
</li>
</ul>
<p>Now mount the huge pages, if not already done so:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ mount -t hugetlbfs -o pagesize=1G none /dev/hugepages
</pre></div>
</div>
</div>
<div class="section" id="enable-hyperthreading">
<h7>Enable HyperThreading<a class="headerlink" href="#enable-hyperthreading" title="Permalink to this headline">¶</a></h7>
<p>With HyperThreading, or SMT, enabled, a physical core appears as two logical
cores. SMT can be utilized to spawn worker threads on logical cores of the same
physical core there by saving additional cores.</p>
<p>With DPDK, when pinning pmd threads to logical cores, care must be taken to set
the correct bits of the <code class="docutils literal"><span class="pre">pmd-cpu-mask</span></code> to ensure that the pmd threads are
pinned to SMT siblings.</p>
<p>Take a sample system configuration, with 2 sockets, 2 * 10 core processors, HT
enabled. This gives us a total of 40 logical cores. To identify the physical
core shared by two logical cores, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cat /sys/devices/system/cpu/cpuN/topology/thread_siblings_list
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">N</span></code> is the logical core number.</p>
<p>In this example, it would show that cores <code class="docutils literal"><span class="pre">1</span></code> and <code class="docutils literal"><span class="pre">21</span></code> share the same
physical core. As cores are counted from 0, the <code class="docutils literal"><span class="pre">pmd-cpu-mask</span></code> can be used
to enable these two pmd threads running on these two logical cores (one
physical core) is:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set Open_vSwitch . other_config:pmd-cpu-mask=0x200002
</pre></div>
</div>
</div>
<div class="section" id="isolate-cores">
<h7>Isolate Cores<a class="headerlink" href="#isolate-cores" title="Permalink to this headline">¶</a></h7>
<p>The <code class="docutils literal"><span class="pre">isolcpus</span></code> option can be used to isolate cores from the Linux scheduler.
The isolated cores can then be used to dedicatedly run HPC applications or
threads.  This helps in better application performance due to zero context
switching and minimal cache thrashing. To run platform logic on core 0 and
isolate cores between 1 and 19 from scheduler, add  <code class="docutils literal"><span class="pre">isolcpus=1-19</span></code> to GRUB
cmdline.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It has been verified that core isolation has minimal advantage due to mature
Linux scheduler in some circumstances.</p>
</div>
</div>
<div class="section" id="numa-cluster-on-die">
<h7>NUMA/Cluster-on-Die<a class="headerlink" href="#numa-cluster-on-die" title="Permalink to this headline">¶</a></h7>
<p>Ideally inter-NUMA datapaths should be avoided where possible as packets will
go across QPI and there may be a slight performance penalty when compared with
intra NUMA datapaths. On Intel Xeon Processor E5 v3, Cluster On Die is
introduced on models that have 10 cores or more.  This makes it possible to
logically split a socket into two NUMA regions and again it is preferred where
possible to keep critical datapaths within the one cluster.</p>
<p>It is good practice to ensure that threads that are in the datapath are pinned
to cores in the same NUMA area. e.g. pmd threads and QEMU vCPUs responsible for
forwarding. If DPDK is built with <code class="docutils literal"><span class="pre">CONFIG_RTE_LIBRTE_VHOST_NUMA=y</span></code>, vHost
User ports automatically detect the NUMA socket of the QEMU vCPUs and will be
serviced by a PMD from the same node provided a core on this node is enabled in
the <code class="docutils literal"><span class="pre">pmd-cpu-mask</span></code>. <code class="docutils literal"><span class="pre">libnuma</span></code> packages are required for this feature.</p>
</div>
<div class="section" id="compiler-optimizations">
<h7>Compiler Optimizations<a class="headerlink" href="#compiler-optimizations" title="Permalink to this headline">¶</a></h7>
<p>The default compiler optimization level is <code class="docutils literal"><span class="pre">-O2</span></code>. Changing this to more
aggressive compiler optimization such as <code class="docutils literal"><span class="pre">-O3</span> <span class="pre">-march=native</span></code> with
gcc (verified on 5.3.1) can produce performance gains though not siginificant.
<code class="docutils literal"><span class="pre">-march=native</span></code> will produce optimized code on local machine and should be
used when software compilation is done on Testbed.</p>
</div>
<div class="section" id="affinity">
<h7>Affinity<a class="headerlink" href="#affinity" title="Permalink to this headline">¶</a></h7>
<p>For superior performance, DPDK pmd threads and Qemu vCPU threads needs to be
affinitized accordingly.</p>
<ul>
<li><p class="first">PMD thread Affinity</p>
<p>A poll mode driver (pmd) thread handles the I/O of all DPDK interfaces
assigned to it. A pmd thread shall poll the ports for incoming packets,
switch the packets and send to tx port.  pmd thread is CPU bound, and needs
to be affinitized to isolated cores for optimum performance.</p>
<p>By setting a bit in the mask, a pmd thread is created and pinned to the
corresponding CPU core. e.g. to run a pmd thread on core 2:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set Open_vSwitch . other_config:pmd-cpu-mask=0x4
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">pmd thread on a NUMA node is only created if there is at least one DPDK
interface from that NUMA node added to OVS.</p>
</div>
</li>
<li><p class="first">QEMU vCPU thread Affinity</p>
<p>A VM performing simple packet forwarding or running complex packet pipelines
has to ensure that the vCPU threads performing the work has as much CPU
occupancy as possible.</p>
<p>For example, on a multicore VM, multiple QEMU vCPU threads shall be spawned.
When the DPDK <code class="docutils literal"><span class="pre">testpmd</span></code> application that does packet forwarding is invoked,
the <code class="docutils literal"><span class="pre">taskset</span></code> command should be used to affinitize the vCPU threads to the
dedicated isolated cores on the host system.</p>
</li>
</ul>
</div>
<div class="section" id="multiple-poll-mode-driver-threads">
<h7>Multiple Poll-Mode Driver Threads<a class="headerlink" href="#multiple-poll-mode-driver-threads" title="Permalink to this headline">¶</a></h7>
<p>With pmd multi-threading support, OVS creates one pmd thread for each NUMA node
by default. However, in cases where there are multiple ports/rxq&#8217;s producing
traffic, performance can be improved by creating multiple pmd threads running
on separate cores. These pmd threads can share the workload by each being
responsible for different ports/rxq&#8217;s. Assignment of ports/rxq&#8217;s to pmd threads
is done automatically.</p>
<p>A set bit in the mask means a pmd thread is created and pinned to the
corresponding CPU core. For example, to run pmd threads on core 1 and 2:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set Open_vSwitch . other_config:pmd-cpu-mask=0x6
</pre></div>
</div>
<p>When using dpdk and dpdkvhostuser ports in a bi-directional VM loopback as
shown below, spreading the workload over 2 or 4 pmd threads shows significant
improvements as there will be more total CPU occupancy available:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>NIC port0 &lt;-&gt; OVS &lt;-&gt; VM &lt;-&gt; OVS &lt;-&gt; NIC port 1
</pre></div>
</div>
</div>
<div class="section" id="dpdk-physical-port-rx-queues">
<h7>DPDK Physical Port Rx Queues<a class="headerlink" href="#dpdk-physical-port-rx-queues" title="Permalink to this headline">¶</a></h7>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set Interface &lt;DPDK interface&gt; options:n_rxq=&lt;integer&gt;
</pre></div>
</div>
<p>The above command sets the number of rx queues for DPDK physical interface.
The rx queues are assigned to pmd threads on the same NUMA node in a
round-robin fashion.</p>
</div>
<div class="section" id="dpdk-physical-port-queue-sizes">
<h7>DPDK Physical Port Queue Sizes<a class="headerlink" href="#dpdk-physical-port-queue-sizes" title="Permalink to this headline">¶</a></h7>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set Interface dpdk0 options:n_rxq_desc=&lt;integer&gt;
$ ovs-vsctl set Interface dpdk0 options:n_txq_desc=&lt;integer&gt;
</pre></div>
</div>
<p>The above command sets the number of rx/tx descriptors that the NIC associated
with dpdk0 will be initialised with.</p>
<p>Different <code class="docutils literal"><span class="pre">n_rxq_desc</span></code> and <code class="docutils literal"><span class="pre">n_txq_desc</span></code> configurations yield different
benefits in terms of throughput and latency for different scenarios.
Generally, smaller queue sizes can have a positive impact for latency at the
expense of throughput. The opposite is often true for larger queue sizes.
Note: increasing the number of rx descriptors eg. to 4096  may have a negative
impact on performance due to the fact that non-vectorised DPDK rx functions may
be used. This is dependent on the driver in use, but is true for the commonly
used i40e and ixgbe DPDK drivers.</p>
</div>
<div class="section" id="exact-match-cache">
<h7>Exact Match Cache<a class="headerlink" href="#exact-match-cache" title="Permalink to this headline">¶</a></h7>
<p>Each pmd thread contains one Exact Match Cache (EMC). After initial flow setup
in the datapath, the EMC contains a single table and provides the lowest level
(fastest) switching for DPDK ports. If there is a miss in the EMC then the next
level where switching will occur is the datapath classifier.  Missing in the
EMC and looking up in the datapath classifier incurs a significant performance
penalty.  If lookup misses occur in the EMC because it is too small to handle
the number of flows, its size can be increased. The EMC size can be modified by
editing the define <code class="docutils literal"><span class="pre">EM_FLOW_HASH_SHIFT</span></code> in <code class="docutils literal"><span class="pre">lib/dpif-netdev.c</span></code>.</p>
<p>As mentioned above, an EMC is per pmd thread. An alternative way of increasing
the aggregate amount of possible flow entries in EMC and avoiding datapath
classifier lookups is to have multiple pmd threads running.</p>
</div>
<div class="section" id="rx-mergeable-buffers">
<h7>Rx Mergeable Buffers<a class="headerlink" href="#rx-mergeable-buffers" title="Permalink to this headline">¶</a></h7>
<p>Rx mergeable buffers is a virtio feature that allows chaining of multiple
virtio descriptors to handle large packet sizes. Large packets are handled by
reserving and chaining multiple free descriptors together. Mergeable buffer
support is negotiated between the virtio driver and virtio device and is
supported by the DPDK vhost library.  This behavior is supported and enabled by
default, however in the case where the user knows that rx mergeable buffers are
not needed i.e. jumbo frames are not needed, it can be forced off by adding
<code class="docutils literal"><span class="pre">mrg_rxbuf=off</span></code> to the QEMU command line options. By not reserving multiple
chains of descriptors it will make more individual virtio descriptors available
for rx to the guest using dpdkvhost ports and this can improve performance.</p>
</div>
</div>
<div class="section" id="limitations">
<h6>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p class="first">Currently DPDK ports does not use HW offload functionality.</p>
</li>
<li><p class="first">Network Interface Firmware requirements: Each release of DPDK is
validated against a specific firmware version for a supported Network
Interface. New firmware versions introduce bug fixes, performance
improvements and new functionality that DPDK leverages. The validated
firmware versions are available as part of the release notes for
DPDK. It is recommended that users update Network Interface firmware
to match what has been validated for the DPDK release.</p>
<p>The latest list of validated firmware versions can be found in the <a class="reference external" href="http://dpdk.org/doc/guides/rel_notes/release_16_11.html">DPDK
release notes</a>.</p>
</li>
</ul>
</div>
<div class="section" id="reporting-bugs">
<h6>Reporting Bugs<a class="headerlink" href="#reporting-bugs" title="Permalink to this headline">¶</a></h6>
<p>Report problems to <a class="reference external" href="mailto:bugs&#37;&#52;&#48;openvswitch&#46;org">bugs<span>&#64;</span>openvswitch<span>&#46;</span>org</a>.</p>
</div>
</div>
</div>
</div>
<div class="section" id="installation-from-packages">
<h4>Installation from Packages<a class="headerlink" href="#installation-from-packages" title="Permalink to this headline">¶</a></h4>
<p>Open vSwitch is packaged on a variety of distributions. The tooling required to
build these packages is included in the Open vSwitch tree. The instructions are
provided below.</p>
<div class="toctree-wrapper compound">
<span id="document-intro/install/debian"></span><div class="section" id="debian-packaging-for-open-vswitch">
<h5>Debian Packaging for Open vSwitch<a class="headerlink" href="#debian-packaging-for-open-vswitch" title="Permalink to this headline">¶</a></h5>
<p>This document describes how to build Debian packages for Open vSwitch. To
install Open vSwitch on Debian without building Debian packages, refer to
<a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a> instead.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These instructions should also work on Ubuntu and other Debian derivative
distributions.</p>
</div>
<div class="section" id="before-you-begin">
<h6>Before You Begin<a class="headerlink" href="#before-you-begin" title="Permalink to this headline">¶</a></h6>
<p>Before you begin, consider whether you really need to build packages yourself.
Debian &#8220;wheezy&#8221; and &#8220;sid&#8221;, as well as recent versions of Ubuntu, contain
pre-built Debian packages for Open vSwitch. It is easier to install these than
to build your own. To use packages from your distribution, skip ahead to
&#8220;Installing .deb Packages&#8221;, below.</p>
</div>
<div class="section" id="building-open-vswitch-debian-packages">
<h6>Building Open vSwitch Debian packages<a class="headerlink" href="#building-open-vswitch-debian-packages" title="Permalink to this headline">¶</a></h6>
<p>You may build from an Open vSwitch distribution tarball or from an Open vSwitch
Git tree with these instructions.</p>
<p>You do not need to be the superuser to build the Debian packages.</p>
<ol class="arabic">
<li><p class="first">Install the &#8220;build-essential&#8221; and &#8220;fakeroot&#8221; packages. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ apt-get install build-essential fakeroot
</pre></div>
</div>
</li>
<li><p class="first">Obtain and unpack an Open vSwitch source distribution and <code class="docutils literal"><span class="pre">cd</span></code> into its
top level directory.</p>
</li>
<li><p class="first">Install the build dependencies listed under &#8220;Build-Depends:&#8221; near the top of
<code class="docutils literal"><span class="pre">debian/control</span></code>. You can install these any way you like, e.g.  with
<code class="docutils literal"><span class="pre">apt-get</span> <span class="pre">install</span></code>.</p>
</li>
</ol>
<p>Check your work by running <code class="docutils literal"><span class="pre">dpkg-checkbuilddeps</span></code> in the top level of your ovs
directory. If you&#8217;ve installed all the dependencies properly,
<code class="docutils literal"><span class="pre">dpkg-checkbuilddeps</span></code> will exit without printing anything. If you forgot to
install some dependencies, it will tell you which ones.</p>
<ol class="arabic" start="4">
<li><p class="first">Build the package:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ fakeroot debian/rules binary
</pre></div>
</div>
<p>This will do a serial build that runs the unit tests. This will take
approximately 8 to 10 minutes. If you prefer, you can run a faster parallel
build:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ DEB_BUILD_OPTIONS=&#39;parallel=8&#39; fakeroot debian/rules binary
</pre></div>
</div>
<p>If you are in a big hurry, you can even skip the unit tests:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ DEB_BUILD_OPTIONS=&#39;parallel=8 nocheck&#39; fakeroot debian/rules binary
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>There are a few pitfalls in the Debian packaging building system so that,
occasionally, you may find that in a tree that you have using for a while,
the build command above exits immediately without actually building anything.
To fix the problem, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ fakeroot debian/rules clean
</pre></div>
</div>
<p class="last">or start over from a fresh copy of the source tree.</p>
</div>
<ol class="arabic simple" start="5">
<li>The generated .deb files will be in the parent directory of the Open vSwitch
source distribution.</li>
</ol>
</div>
<div class="section" id="installing-deb-packages">
<h6>Installing .deb Packages<a class="headerlink" href="#installing-deb-packages" title="Permalink to this headline">¶</a></h6>
<p>These instructions apply to installing from Debian packages that you built
yourself, as described in the previous section, or from packages provided by
Debian or a Debian derivative distribution such as Ubuntu.  In the former case,
use a command such as <code class="docutils literal"><span class="pre">dpkg</span> <span class="pre">-i</span></code> to install the .deb files that you build, and
in the latter case use a program such as <code class="docutils literal"><span class="pre">apt-get</span></code> or <code class="docutils literal"><span class="pre">aptitude</span></code> to
download and install the provided packages.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">You must be superuser to install Debian packages.</p>
</div>
<ol class="arabic simple">
<li>Start by installing an Open vSwitch kernel module. See
<code class="docutils literal"><span class="pre">debian/openvswitch-switch.README.Debian</span></code> for the available options.</li>
<li>Install the <code class="docutils literal"><span class="pre">openvswitch-switch</span></code> and <code class="docutils literal"><span class="pre">openvswitch-common</span></code> packages.
These packages include the core userspace components of the switch.</li>
</ol>
<p>Open vSwitch <code class="docutils literal"><span class="pre">.deb</span></code> packages not mentioned above are rarely useful. Refer to
their individual package descriptions to find out whether any of them are
useful to you.</p>
</div>
<div class="section" id="reporting-bugs">
<h6>Reporting Bugs<a class="headerlink" href="#reporting-bugs" title="Permalink to this headline">¶</a></h6>
<p>Report problems to <a class="reference external" href="mailto:bugs&#37;&#52;&#48;openvswitch&#46;org">bugs<span>&#64;</span>openvswitch<span>&#46;</span>org</a>.</p>
</div>
</div>
<span id="document-intro/install/fedora"></span><div class="section" id="fedora-rhel-7-x-packaging-for-open-vswitch">
<h5>Fedora, RHEL 7.x Packaging for Open vSwitch<a class="headerlink" href="#fedora-rhel-7-x-packaging-for-open-vswitch" title="Permalink to this headline">¶</a></h5>
<p>This document provides instructions for building and installing Open vSwitch
RPM packages on a Fedora Linux host. Instructions for the installation of Open
vSwitch on a Fedora Linux host without using RPM packages can be found in the
<a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a>.</p>
<p>These instructions have been tested with Fedora 23, and are also applicable for
RHEL 7.x and its derivatives, including CentOS 7.x and Scientific Linux 7.x.</p>
<div class="section" id="build-requirements">
<h6>Build Requirements<a class="headerlink" href="#build-requirements" title="Permalink to this headline">¶</a></h6>
<p>To build packages for a Fedora Linux host, you will need the packages described
in the <a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a>. Specific packages (by package name) include:</p>
<ul class="simple">
<li>rpm-build</li>
<li>autoconf automake libtool</li>
<li>systemd-units openssl openssl-devel</li>
<li>python python-twisted-core python-zope-interface python-six</li>
<li>desktop-file-utils</li>
<li>groff graphviz</li>
<li>procps-ng</li>
<li>checkpolicy selinux-policy-devel</li>
</ul>
<p>And (optionally):</p>
<ul class="simple">
<li>libcap-ng libcap-ng-devel</li>
<li>dpdk-devel</li>
</ul>
</div>
<div class="section" id="bootstraping">
<h6>Bootstraping<a class="headerlink" href="#bootstraping" title="Permalink to this headline">¶</a></h6>
<p>Refer to <a class="reference internal" href="contents.html#general-bootstrapping"><span>Bootstrapping</span></a>.</p>
</div>
<div class="section" id="configuring">
<h6>Configuring<a class="headerlink" href="#configuring" title="Permalink to this headline">¶</a></h6>
<p>Refer to <a class="reference internal" href="contents.html#general-configuring"><span>Configuring</span></a>.</p>
</div>
<div class="section" id="building">
<h6>Building<a class="headerlink" href="#building" title="Permalink to this headline">¶</a></h6>
<div class="section" id="user-space-rpms">
<h7>User Space RPMs<a class="headerlink" href="#user-space-rpms" title="Permalink to this headline">¶</a></h7>
<p>To build Open vSwitch user-space RPMs, execute the following from the directory
in which <cite>./configure</cite> was executed:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make rpm-fedora
</pre></div>
</div>
<p>This will create the RPMs <cite>openvswitch</cite>, <cite>python-openvswitch</cite>,
<cite>openvswitch-test</cite>, <cite>openvswitch-devel</cite>, <cite>openvswitch-ovn-common</cite>,
<cite>openvswitch-ovn-central</cite>, <cite>openvswitch-ovn-host</cite>, <cite>openvswitch-ovn-vtep</cite>,
<cite>openvswitch-ovn-docker</cite>, and <cite>openvswitch-debuginfo</cite>.</p>
<p>To enable DPDK support in the openvswitch package, the <code class="docutils literal"><span class="pre">--with</span> <span class="pre">dpdk</span></code> option
can be added:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make rpm-fedora RPMBUILD_OPT=&quot;--with dpdk&quot;
</pre></div>
</div>
<p>The above commands automatically run the Open vSwitch unit tests, which can
take several minutes.  To reduce the build time by disabling the execution of
these tests, the <code class="docutils literal"><span class="pre">--without</span> <span class="pre">check</span></code> option can be added:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make rpm-fedora RPMBUILD_OPT=&quot;--without check&quot;
</pre></div>
</div>
</div>
<div class="section" id="kernel-ovs-tree-datapath-rpm">
<h7>Kernel OVS Tree Datapath RPM<a class="headerlink" href="#kernel-ovs-tree-datapath-rpm" title="Permalink to this headline">¶</a></h7>
<p>To build the Open vSwitch kernel module for the currently running kernel
version, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make rpm-fedora-kmod
</pre></div>
</div>
<p>To build the Open vSwitch kernel module for another kernel version, the desired
kernel version can be specified via the <cite>kversion</cite> macro.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make rpm-fedora-kmod \
     RPMBUILD_OPT=&#39;-D &quot;kversion 4.3.4-300.fc23.x86_64&quot;&#39;
</pre></div>
</div>
</div>
</div>
<div class="section" id="installing">
<h6>Installing<a class="headerlink" href="#installing" title="Permalink to this headline">¶</a></h6>
<p>RPM packages can be installed by using the command <code class="docutils literal"><span class="pre">rpm</span> <span class="pre">-i</span></code>. Package
installation requires superuser privileges.</p>
<p>The <cite>openvswitch-kmod</cite> RPM should be installed first if the Linux OVS tree
datapath module is to be used. The <cite>openvswitch-kmod</cite> RPM should not be
installed if only the in-tree Linux datapath or user-space datapath is needed.
Refer to the <a class="reference internal" href="contents.html#document-faq/index"><em>Open vSwitch FAQ</em></a> for more information about the various Open
vSwitch datapath options.</p>
<p>In most cases only the <cite>openvswitch</cite> RPM will need to be installed. The
<cite>python-openvswitch</cite>, <cite>openvswitch-test</cite>, <cite>openvswitch-devel</cite>, and
<cite>openvswitch-debuginfo</cite> RPMs are optional unless required for a specific
purpose.</p>
<p>The <cite>openvswitch-ovn-*</cite> packages are only needed when using OVN.</p>
<p>Refer to the <a class="reference external" href="https://github.com/openvswitch/ovs/blob/master/rhel/README.RHEL.rst">RHEL README</a> for additional usage and configuration
information.</p>
</div>
<div class="section" id="reporting-bugs">
<h6>Reporting Bugs<a class="headerlink" href="#reporting-bugs" title="Permalink to this headline">¶</a></h6>
<p>Report problems to <a class="reference external" href="mailto:bugs&#37;&#52;&#48;openvswitch&#46;org">bugs<span>&#64;</span>openvswitch<span>&#46;</span>org</a>.</p>
</div>
</div>
<span id="document-intro/install/rhel"></span><div class="section" id="rhel-5-6-6-x-packaging-for-open-vswitch">
<h5>RHEL 5.6, 6.x Packaging for Open vSwitch<a class="headerlink" href="#rhel-5-6-6-x-packaging-for-open-vswitch" title="Permalink to this headline">¶</a></h5>
<p>This document describes how to build and install Open vSwitch on a Red Hat
Enterprise Linux (RHEL) host.  If you want to install Open vSwitch on a generic
Linux host, refer to <a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a> instead.</p>
<p>We have tested these instructions with RHEL 5.6 and RHEL 6.0.</p>
<p>For RHEL 7.x (or derivatives, such as CentOS 7.x), you should follow the
instructions in the <a class="reference internal" href="contents.html#document-intro/install/fedora"><em>Fedora, RHEL 7.x Packaging for Open vSwitch</em></a>.  The Fedora spec files are used for RHEL
7.x.</p>
<div class="section" id="prerequisites">
<span id="rhel-prerequisites"></span><h6>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h6>
<p>You may build from an Open vSwitch distribution tarball or from an Open vSwitch
Git tree.</p>
<p>The default RPM build directory, <code class="docutils literal"><span class="pre">_topdir</span></code>, has five directories in the
top-level.</p>
<dl class="docutils">
<dt>BUILD/</dt>
<dd>where the software is unpacked and built</dd>
<dt>RPMS/</dt>
<dd>where the newly created binary package files are written</dd>
<dt>SOURCES/</dt>
<dd>contains the original sources, patches, and icon files</dd>
<dt>SPECS/</dt>
<dd>contains the spec files for each package to be built</dd>
<dt>SRPMS/</dt>
<dd>where the newly created source package files are written</dd>
</dl>
<p>Before you begin, note the RPM sources directory on your version of RHEL.  The
command <code class="docutils literal"><span class="pre">rpmbuild</span> <span class="pre">--showrc</span></code> will show the configuration for each of those
directories. Alternatively, the command <code class="docutils literal"><span class="pre">rpm</span> <span class="pre">--eval</span> <span class="pre">'%{_topdir}'</span></code> shows the
current configuration for the top level directory and the command <code class="docutils literal"><span class="pre">rpm</span> <span class="pre">--eval</span>
<span class="pre">'%{_sourcedir}'</span></code> does the same for the sources directory. On RHEL 5, the
default RPM <code class="docutils literal"><span class="pre">_topdir</span></code> is <code class="docutils literal"><span class="pre">/usr/src/redhat</span></code> and the default RPM sources
directory is <code class="docutils literal"><span class="pre">/usr/src/redhat/SOURCES</span></code>. On RHEL 6, the default <code class="docutils literal"><span class="pre">_topdir</span></code> is
<code class="docutils literal"><span class="pre">$HOME/rpmbuild</span></code> and the default RPM sources directory is
<code class="docutils literal"><span class="pre">$HOME/rpmbuild/SOURCES</span></code>.</p>
</div>
<div class="section" id="build-requirements">
<h6>Build Requirements<a class="headerlink" href="#build-requirements" title="Permalink to this headline">¶</a></h6>
<p>To compile the RPMs, you will need to install the packages described in the
<a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a> along with some additional packages. These can be installed with
the below command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ yum install gcc make python-devel openssl-devel kernel-devel graphviz \
    kernel-debug-devel autoconf automake rpm-build redhat-rpm-config \
    libtool checkpolicy selinux-policy-devel
</pre></div>
</div>
</div>
<div class="section" id="bootstrapping-and-configuring">
<span id="rhel-bootstrapping"></span><h6>Bootstrapping and Configuring<a class="headerlink" href="#bootstrapping-and-configuring" title="Permalink to this headline">¶</a></h6>
<p>If you are building from a distribution tarball, skip to <a class="reference internal" href="#rhel-building"><span>Building</span></a>.
If not, you must be building from an Open vSwitch Git tree.  Determine what
version of Autoconf is installed (e.g. run <code class="docutils literal"><span class="pre">autoconf</span> <span class="pre">--version</span></code>).  If it is
not at least version 2.63, then you must upgrade or use another machine to
build the packages.</p>
<p>Assuming all requirements have been met, build the tarball by running:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./boot.sh
$ ./configure
$ make dist
</pre></div>
</div>
<p>You must run this on a machine that has the tools listed in
<a class="reference internal" href="contents.html#general-build-reqs"><span>Build Requirements</span></a> as prerequisites for building from a Git tree.
Afterward, proceed with the rest of the instructions using the distribution
tarball.</p>
<p>Now you have a distribution tarball, named something like
<code class="docutils literal"><span class="pre">openvswitch-x.y.z.tar.gz</span></code>.  Copy this file into the RPM sources directory,
e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cp openvswitch-x.y.z.tar.gz $HOME/rpmbuild/SOURCES
</pre></div>
</div>
<div class="section" id="broken-build-symlink">
<h7>Broken <code class="docutils literal"><span class="pre">build</span></code> symlink<a class="headerlink" href="#broken-build-symlink" title="Permalink to this headline">¶</a></h7>
<p>Some versions of the RHEL 6 kernel-devel package contain a broken <code class="docutils literal"><span class="pre">build</span></code>
symlink.  If you are using such a version, you must fix the problem before
continuing.</p>
<p>To find out whether you are affected, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cd /lib/modules/&lt;version&gt;
$ ls -l build/
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">&lt;version&gt;</span></code> is the version number of the RHEL 6 kernel.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The trailing slash in the final command is important.  Be sure to include
it.</p>
</div>
<p>If the <code class="docutils literal"><span class="pre">ls</span></code> command produces a directory listing, your kernel-devel package
is OK.  If it produces a <code class="docutils literal"><span class="pre">No</span> <span class="pre">such</span> <span class="pre">file</span> <span class="pre">or</span> <span class="pre">directory</span></code> error, your kernel-devel
package is buggy.</p>
<p>If your kernel-devel package is buggy, then you can fix it with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cd /lib/modules/&lt;version&gt;
$ rm build
$ ln -s /usr/src/kernels/&lt;target&gt; build
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">&lt;target&gt;</span></code> is the name of an existing directory under
<code class="docutils literal"><span class="pre">/usr/src/kernels</span></code>, whose name should be similar to <code class="docutils literal"><span class="pre">&lt;version&gt;</span></code> but may
contain some extra parts.  Once you have done this, verify the fix with the
same procedure you used above to check for the problem.</p>
</div>
</div>
<div class="section" id="building">
<span id="rhel-building"></span><h6>Building<a class="headerlink" href="#building" title="Permalink to this headline">¶</a></h6>
<p>You should have a distribution tarball named something like
openvswitch-x.y.z.tar.gz.  Copy this file into the RPM sources directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cp openvswitch-x.y.z.tar.gz $HOME/rpmbuild/SOURCES
</pre></div>
</div>
<p>Make another copy of the distribution tarball in a temporary directory.  Then
unpack the tarball and <code class="docutils literal"><span class="pre">cd</span></code> into its root:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ tar xzf openvswitch-x.y.z.tar.gz
$ cd openvswitch-x.y.z
</pre></div>
</div>
<div class="section" id="userspace">
<h7>Userspace<a class="headerlink" href="#userspace" title="Permalink to this headline">¶</a></h7>
<p>To build Open vSwitch userspace, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ rpmbuild -bb rhel/openvswitch.spec
</pre></div>
</div>
<p>This produces two RPMs: &#8220;openvswitch&#8221; and &#8220;openvswitch-debuginfo&#8221;.</p>
<p>The above command automatically runs the Open vSwitch unit tests.  To disable
the unit tests, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ rpmbuild -bb --without check rhel/openvswitch.spec
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the build fails with <code class="docutils literal"><span class="pre">configure:</span> <span class="pre">error:</span> <span class="pre">source</span> <span class="pre">dir</span>
<span class="pre">/lib/modules/2.6.32-279.el6.x86_64/build</span> <span class="pre">doesn't</span> <span class="pre">exist</span></code> or similar, then
the kernel-devel package is missing or buggy.</p>
</div>
</div>
<div class="section" id="kernel-module">
<h7>Kernel Module<a class="headerlink" href="#kernel-module" title="Permalink to this headline">¶</a></h7>
<p>On RHEL 6, to build the Open vSwitch kernel module, copy
rhel/openvswitch-kmod.files into the RPM sources directory and run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ rpmbuild -bb rhel/openvswitch-kmod-rhel6.spec
</pre></div>
</div>
<p>You might have to specify a kernel version and/or variants, e.g.:</p>
<blockquote>
<div><dl class="docutils">
<dt>$ rpmbuild -bb </dt>
<dd>-D &#8220;kversion 2.6.32-131.6.1.el6.x86_64&#8221; -D &#8220;kflavors default debug kdump&#8221; rhel/openvswitch-kmod-rhel6.spec</dd>
</dl>
</div></blockquote>
<p>This produces an &#8220;kmod-openvswitch&#8221; RPM for each kernel variant, in this
example: &#8220;kmod-openvswitch&#8221;, &#8220;kmod-openvswitch-debug&#8221;, and
&#8220;kmod-openvswitch-kdump&#8221;.</p>
</div>
</div>
<div class="section" id="red-hat-network-scripts-integration">
<span id="rhel-script-integrations"></span><h6>Red Hat Network Scripts Integration<a class="headerlink" href="#red-hat-network-scripts-integration" title="Permalink to this headline">¶</a></h6>
<p>A RHEL host has default firewall rules that prevent any Open vSwitch tunnel
traffic from passing through. If a user configures Open vSwitch tunnels like
Geneve, GRE, VXLAN, LISP etc., they will either have to manually add iptables
firewall rules to allow the tunnel traffic or add it through a startup script
Refer to the &#8220;enable-protocol&#8221; command in the ovs-ctl(8) manpage for more
information.</p>
<p>In addition, simple integration with Red Hat network scripts has been
implemented.  Refer to <a class="reference external" href="https://github.com/openvswitch/ovs/blob/master/rhel/README.RHEL.rst">README.RHEL.rst</a> in the source tree or
/usr/share/doc/openvswitch/README.RHEL.rst in the installed openvswitch package
for details.</p>
</div>
<div class="section" id="reporting-bugs">
<h6>Reporting Bugs<a class="headerlink" href="#reporting-bugs" title="Permalink to this headline">¶</a></h6>
<p>Report problems to <a class="reference external" href="mailto:bugs&#37;&#52;&#48;openvswitch&#46;org">bugs<span>&#64;</span>openvswitch<span>&#46;</span>org</a>.</p>
</div>
</div>
</div>
</div>
<div class="section" id="upgrades">
<h4>Upgrades<a class="headerlink" href="#upgrades" title="Permalink to this headline">¶</a></h4>
<div class="toctree-wrapper compound">
<span id="document-intro/install/ovn-upgrades"></span><div class="section" id="ovn-upgrades">
<h5>OVN Upgrades<a class="headerlink" href="#ovn-upgrades" title="Permalink to this headline">¶</a></h5>
<p>Since OVN is a distributed system, special consideration must be given to
the process used to upgrade OVN across a deployment.  This document discusses
the recommended upgrade process.</p>
<div class="section" id="release-notes">
<h6>Release Notes<a class="headerlink" href="#release-notes" title="Permalink to this headline">¶</a></h6>
<p>You should always check the OVS and OVN release notes (NEWS file) for any
release specific notes on upgrades.</p>
</div>
<div class="section" id="ovs">
<h6>OVS<a class="headerlink" href="#ovs" title="Permalink to this headline">¶</a></h6>
<p>OVN depends on and is included with OVS.  It&#8217;s expected that OVS and OVN are
upgraded together, partly for convenience.  OVN is included in OVS releases
so it&#8217;s easiest to upgrade them together.  OVN may also make use of new
features of OVS only available in that release.</p>
</div>
<div class="section" id="upgrade-ovn-controller">
<h6>Upgrade ovn-controller<a class="headerlink" href="#upgrade-ovn-controller" title="Permalink to this headline">¶</a></h6>
<p>You should start by upgrading ovn-controller on each host it&#8217;s running on.
First, you upgrade the OVS and OVN packages.  Then, restart the
ovn-controller service.  You can restart with ovn-ctl:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ sudo /usr/share/openvswitch/scripts/ovn-ctl restart_controller
</pre></div>
</div>
<p>or with systemd:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ sudo systemd restart ovn-controller
</pre></div>
</div>
</div>
<div class="section" id="upgrade-ovn-databases-and-ovn-northd">
<h6>Upgrade OVN Databases and ovn-northd<a class="headerlink" href="#upgrade-ovn-databases-and-ovn-northd" title="Permalink to this headline">¶</a></h6>
<p>The OVN databases and ovn-northd should be upgraded next.  Since ovn-controller
has already been upgraded, it will be ready to operate on any new functionality
specified by the database or logical flows created by ovn-northd.</p>
<p>Upgrading the OVN packages installs everything needed for an upgrade.  The only
step required after upgrading the packages is to restart ovn-northd, which
automatically restarts the databases and upgrades the database schema, as well.</p>
<p>You may perform this restart using the ovn-ctl script:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ sudo /usr/share/openvswitch/scripts/ovn-ctl restart_northd
</pre></div>
</div>
<p>or if you&#8217;re using a Linux distribution with systemd:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ sudo systemctl restart ovn-northd
</pre></div>
</div>
</div>
<div class="section" id="upgrading-ovn-integration">
<h6>Upgrading OVN Integration<a class="headerlink" href="#upgrading-ovn-integration" title="Permalink to this headline">¶</a></h6>
<p>Lastly, you may also want to upgrade integration with OVN that you may be
using.  For example, this could be the OpenStack Neutron driver or
ovn-kubernetes.</p>
<p>OVN&#8217;s northbound database schema is a backwards compatible interface, so
you should be able to safely complete an OVN upgrade before upgrading
any integration in use.</p>
</div>
</div>
</div>
</div>
<div class="section" id="others">
<h4>Others<a class="headerlink" href="#others" title="Permalink to this headline">¶</a></h4>
<div class="toctree-wrapper compound">
<span id="document-intro/install/bash-completion"></span><div class="section" id="bash-command-line-completion-scripts">
<h5>Bash command-line completion scripts<a class="headerlink" href="#bash-command-line-completion-scripts" title="Permalink to this headline">¶</a></h5>
<p>There are two completion scripts available: <code class="docutils literal"><span class="pre">ovs-appctl-bashcomp.bash</span></code> and
<code class="docutils literal"><span class="pre">ovs-vsctl-bashcomp.bash</span></code>.</p>
<div class="section" id="ovs-appctl-bashcomp">
<h6>ovs-appctl-bashcomp<a class="headerlink" href="#ovs-appctl-bashcomp" title="Permalink to this headline">¶</a></h6>
<p><code class="docutils literal"><span class="pre">ovs-appctl-bashcomp.bash</span></code> adds bash command-line completion support for
<code class="docutils literal"><span class="pre">ovs-appctl</span></code>, <code class="docutils literal"><span class="pre">ovs-dpctl</span></code>, <code class="docutils literal"><span class="pre">ovs-ofctl</span></code> and <code class="docutils literal"><span class="pre">ovsdb-tool</span></code> commands.</p>
<div class="section" id="features">
<h7>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>Display available completion or complete on unfinished user input (long
option, subcommand, and argument).</li>
<li>Subcommand hints</li>
<li>Convert between keywords like <code class="docutils literal"><span class="pre">bridge</span></code>, <code class="docutils literal"><span class="pre">port</span></code>, <code class="docutils literal"><span class="pre">interface</span></code>, or <code class="docutils literal"><span class="pre">dp</span></code>
and the available record in ovsdb.</li>
</ul>
</div>
<div class="section" id="limitations">
<h7>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h7>
<ul>
<li><p class="first">Only supports a small set of important keywords (<code class="docutils literal"><span class="pre">dp</span></code>, <code class="docutils literal"><span class="pre">datapath</span></code>,
<code class="docutils literal"><span class="pre">bridge</span></code>, <code class="docutils literal"><span class="pre">switch</span></code>, <code class="docutils literal"><span class="pre">port</span></code>, <code class="docutils literal"><span class="pre">interface</span></code>, <code class="docutils literal"><span class="pre">iface</span></code>).</p>
</li>
<li><p class="first">Does not support parsing of nested options. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovsdb-tool create [db [schema]]
</pre></div>
</div>
</li>
<li><p class="first">Does not support expansion on repeated argument. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-dpctl show [dp...]).
</pre></div>
</div>
</li>
<li><p class="first">Only supports matching on long options, and only in the format <code class="docutils literal"><span class="pre">--option</span>
<span class="pre">[arg]</span></code>. Do not use <code class="docutils literal"><span class="pre">--option=[arg]</span></code>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="ovs-vsctl-bashcomp">
<h6>ovs-vsctl-bashcomp<a class="headerlink" href="#ovs-vsctl-bashcomp" title="Permalink to this headline">¶</a></h6>
<p><code class="docutils literal"><span class="pre">ovs-vsctl-bashcomp.bash</span></code> adds Bash command-line completion support for
<code class="docutils literal"><span class="pre">ovs-vsctl</span></code> command.</p>
<div class="section" id="id1">
<h7>Features<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h7>
<ul class="simple">
<li>Display available completion and complete on user input for global/local
options, command, and argument.</li>
<li>Query database and expand keywords like <code class="docutils literal"><span class="pre">table</span></code>, <code class="docutils literal"><span class="pre">record</span></code>, <code class="docutils literal"><span class="pre">column</span></code>, or
<code class="docutils literal"><span class="pre">key</span></code>, to available completions.</li>
<li>Deal with argument relations like &#8216;one and more&#8217;, &#8216;zero or one&#8217;.</li>
<li>Complete multiple <code class="docutils literal"><span class="pre">ovs-vsctl</span></code> commands cascaded via <code class="docutils literal"><span class="pre">--</span></code>.</li>
</ul>
</div>
<div class="section" id="id2">
<h7>Limitations<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h7>
<p>Completion of very long <code class="docutils literal"><span class="pre">ovs-vsctl</span></code> commands can take up to several seconds.</p>
</div>
</div>
<div class="section" id="usage">
<h6>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h6>
<p>The bashcomp scripts should be placed at <code class="docutils literal"><span class="pre">/etc/bash_completion.d/</span></code> to be
available for all bash sessions.  Running <code class="docutils literal"><span class="pre">make</span> <span class="pre">install</span></code> will place the
scripts to <code class="docutils literal"><span class="pre">$(sysconfdir)/bash_completion.d/</span></code>, thus, the user should specify
<code class="docutils literal"><span class="pre">--sysconfdir=/etc</span></code> at configuration.  If OVS is installed from packages, the
scripts will automatically be placed inside <code class="docutils literal"><span class="pre">/etc/bash_completion.d/</span></code>.</p>
<p>If you just want to run the scripts in one bash, you can remove them from
<code class="docutils literal"><span class="pre">/etc/bash_completion.d/</span></code> and run the scripts via <code class="docutils literal"><span class="pre">.</span>
<span class="pre">ovs-appctl-bashcomp.bash</span></code> or <code class="docutils literal"><span class="pre">.</span> <span class="pre">ovs-vsctl-bashcomp.bash</span></code>.</p>
</div>
<div class="section" id="tests">
<h6>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h6>
<p>Unit tests are added in <code class="docutils literal"><span class="pre">tests/completion.at</span></code> and integrated into autotest
framework.  To run the tests, just run <code class="docutils literal"><span class="pre">make</span> <span class="pre">check</span></code>.</p>
</div>
</div>
<span id="document-intro/install/documentation"></span><div class="section" id="open-vswitch-documentation">
<h5>Open vSwitch Documentation<a class="headerlink" href="#open-vswitch-documentation" title="Permalink to this headline">¶</a></h5>
<p>This document describes how to build the OVS documentation for use offline. A
continuously updated, online version can be found at <a class="reference external" href="http://docs.openvswitch.org">docs.openvswitch.org</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These instructions provide information on building the documentation locally.
For information on writing documentation, refer to
<a class="reference internal" href="contents.html#document-internals/contributing/documentation-style"><em>Open vSwitch Documentation Style</em></a></p>
</div>
<div class="section" id="build-requirements">
<h6>Build Requirements<a class="headerlink" href="#build-requirements" title="Permalink to this headline">¶</a></h6>
<p>As described in the <a class="reference internal" href="contents.html#document-internals/contributing/documentation-style"><em>Open vSwitch Documentation Style</em></a>, the
Open vSwitch documentation is written in reStructuredText and built with
Sphinx. A detailed guide on installing Sphinx in many environments is available
on the <a class="reference external" href="http://www.sphinx-doc.org/install.html">Sphinx website</a> but, for most Linux distributions, you can install
with your package manager. For example, on Debian/Ubuntu run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ sudo apt-get install python-sphinx
</pre></div>
</div>
<p>Similarly, on RHEL/Fedora run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ sudo dnf install python-sphinx
</pre></div>
</div>
<p>A <code class="docutils literal"><span class="pre">requirements.txt</span></code> is also provided in the <code class="docutils literal"><span class="pre">/Documentation</span></code>, should you
wish to install using <code class="docutils literal"><span class="pre">pip</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ virtualenv .venv
$ source .venv/bin/activate
$ pip install -r Documentation/requirements.txt
</pre></div>
</div>
</div>
<div class="section" id="configuring">
<h6>Configuring<a class="headerlink" href="#configuring" title="Permalink to this headline">¶</a></h6>
<p>It&#8217;s unlikely that you&#8217;ll need to customize any aspect of the configuration.
However, the <code class="docutils literal"><span class="pre">Documentation/conf.py</span></code> is the go-to place for all
configuration. This file is well documented and further information is
available on the <a class="reference external" href="http://www.sphinx-doc.org/config.html">Sphinx website</a>.</p>
</div>
<div class="section" id="building">
<h6>Building<a class="headerlink" href="#building" title="Permalink to this headline">¶</a></h6>
<p>Once Sphinx installed, the documentation can be built using the provided
Makefile targets:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make htmldocs
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The <code class="docutils literal"><span class="pre">htmldocs</span></code> target will fail if there are any syntax errors. However,
it won&#8217;t catch more succint issues such as style or grammar issues. As a
result, you should always inspect changes visually to ensure the result is
as intended.</p>
</div>
<p>Once built, documentation is available in the <code class="docutils literal"><span class="pre">/Documentation/_build</span></code> folder.
Open the root <code class="docutils literal"><span class="pre">index.html</span></code> to browse the documentation.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-tutorials/index"></span><div class="section" id="tutorials">
<h2>Tutorials<a class="headerlink" href="#tutorials" title="Permalink to this headline">¶</a></h2>
<p>Getting started with Open vSwitch (OVS) and Open Virtual Network (OVN) for Open
vSwitch.</p>
<div class="toctree-wrapper compound">
<span id="document-tutorials/ovs-advanced"></span><div class="section" id="open-vswitch-advanced-features">
<h3>Open vSwitch Advanced Features<a class="headerlink" href="#open-vswitch-advanced-features" title="Permalink to this headline">¶</a></h3>
<p>Many tutorials cover the basics of OpenFlow.  This is not such a tutorial.
Rather, a knowledge of the basics of OpenFlow is a prerequisite.  If you do not
already understand how an OpenFlow flow table works, please go read a basic
tutorial and then continue reading here afterward.</p>
<p>It is also important to understand the basics of Open vSwitch before you begin.
If you have never used ovs-vsctl or ovs-ofctl before, you should learn a little
about them before proceeding.</p>
<p>Most of the features covered in this tutorial are Open vSwitch extensions to
OpenFlow.  Also, most of the features in this tutorial are specific to the
software Open vSwitch implementation.  If you are using an Open vSwitch port to
an ASIC-based hardware switch, this tutorial will not help you.</p>
<p>This tutorial does not cover every aspect of the features that it mentions.
You can find the details elsewhere in the Open vSwitch documentation,
especially <code class="docutils literal"><span class="pre">ovs-ofctl(8)</span></code> and the comments in the
<code class="docutils literal"><span class="pre">include/openflow/nicira-ext.h</span></code> and <code class="docutils literal"><span class="pre">include/openvswitch/meta-flow.h</span></code>
header files.</p>
<div class="section" id="getting-started">
<h4>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h4>
<p>This is a hands-on tutorial.  To get the most out of it, you will need Open
vSwitch binaries.  You do not, on the other hand, need any physical networking
hardware or even supervisor privilege on your system.  Instead, we will use a
script called <code class="docutils literal"><span class="pre">ovs-sandbox</span></code>, which accompanies the tutorial, that constructs
a software simulated network environment based on Open vSwitch.</p>
<p>You can use <code class="docutils literal"><span class="pre">ovs-sandbox</span></code> three ways:</p>
<ul class="simple">
<li>If you have already installed Open vSwitch on your system, then you should be
able to just run <code class="docutils literal"><span class="pre">ovs-sandbox</span></code> from this directory without any options.</li>
<li>If you have not installed Open vSwitch (and you do not want to install it),
then you can build Open vSwitch according to the instructions in
<a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a>, without installing it.  Then run
<code class="docutils literal"><span class="pre">./ovs-sandbox</span> <span class="pre">-b</span> <span class="pre">DIRECTORY</span></code> from this directory, substituting the Open
vSwitch build directory for <code class="docutils literal"><span class="pre">DIRECTORY</span></code>.</li>
<li>As a slight variant on the latter, you can run <code class="docutils literal"><span class="pre">make</span> <span class="pre">sandbox</span></code> from an Open
vSwitch build directory.</li>
</ul>
<p>When you run <code class="docutils literal"><span class="pre">ovs-sandbox</span></code>, it does the following:</p>
<ol class="arabic simple">
<li><strong>CAUTION:</strong> Deletes any subdirectory of the current directory named
&#8220;sandbox&#8221; and any files in that directory.</li>
<li>Creates a new directory &#8220;sandbox&#8221; in the current directory.</li>
<li>Sets up special environment variables that ensure that Open vSwitch programs
will look inside the &#8220;sandbox&#8221; directory instead of in the Open vSwitch
installation directory.</li>
<li>If you are using a built but not installed Open vSwitch, installs the Open
vSwitch manpages in a subdirectory of &#8220;sandbox&#8221; and adjusts the <code class="docutils literal"><span class="pre">MANPATH</span></code>
environment variable to point to this directory.  This means that you can
use, for example, <code class="docutils literal"><span class="pre">man</span> <span class="pre">ovs-vsctl</span></code> to see a manpage for the <code class="docutils literal"><span class="pre">ovs-vsctl</span></code>
program that you built.</li>
<li>Creates an empty Open vSwitch configuration database under &#8220;sandbox&#8221;.</li>
<li>Starts <code class="docutils literal"><span class="pre">ovsdb-server</span></code> running under &#8220;sandbox&#8221;.</li>
<li>Starts <code class="docutils literal"><span class="pre">ovs-vswitchd</span></code> running under &#8220;sandbox&#8221;, passing special options
that enable a special &#8220;dummy&#8221; mode for testing.</li>
<li>Starts a nested interactive shell inside &#8220;sandbox&#8221;.</li>
</ol>
<p>At this point, you can run all the usual Open vSwitch utilities from the nested
shell environment.  You can, for example, use <code class="docutils literal"><span class="pre">ovs-vsctl</span></code> to create a bridge:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
</pre></div>
</div>
<p>From Open vSwitch&#8217;s perspective, the bridge that you create this way is as real
as any other.  You can, for example, connect it to an OpenFlow controller or
use <code class="docutils literal"><span class="pre">ovs-ofctl</span></code> to examine and modify it and its OpenFlow flow table.  On the
other hand, the bridge is not visible to the operating system&#8217;s network stack,
so <code class="docutils literal"><span class="pre">ifconfig</span></code> or <code class="docutils literal"><span class="pre">ip</span></code> cannot see it or affect it, which means that
utilities like <code class="docutils literal"><span class="pre">ping</span></code> and <code class="docutils literal"><span class="pre">tcpdump</span></code> will not work either.  (That has its
good side, too: you can&#8217;t screw up your computer&#8217;s network stack by
manipulating a sandboxed OVS.)</p>
<p>When you&#8217;re done using OVS from the sandbox, exit the nested shell (by entering
the &#8220;exit&#8221; shell command or pressing Control+D).  This will kill the daemons
that <code class="docutils literal"><span class="pre">ovs-sandbox</span></code> started, but it leaves the &#8220;sandbox&#8221; directory and its
contents in place.</p>
<p>The sandbox directory contains log files for the Open vSwitch dameons.  You can
examine them while you&#8217;re running in the sandboxed environment or after you
exit.</p>
</div>
<div class="section" id="using-gdb">
<h4>Using GDB<a class="headerlink" href="#using-gdb" title="Permalink to this headline">¶</a></h4>
<p>GDB support is not required to go through the tutorial. It is added in case
user wants to explore the internals of OVS programs.</p>
<p>GDB can already be used to debug any running process, with the usual
<code class="docutils literal"><span class="pre">gdb</span> <span class="pre">&lt;program&gt;</span> <span class="pre">&lt;process-id&gt;</span></code> command.</p>
<p><code class="docutils literal"><span class="pre">ovs-sandbox</span></code> also has a <code class="docutils literal"><span class="pre">-g</span></code> option for launching ovs-vswitchd under GDB.
This option can be handy for setting break points before ovs-vswitchd runs, or
for catching early segfaults. Similarly, a <code class="docutils literal"><span class="pre">-d</span></code> option can be used to run
ovsdb-server under GDB. Both options can be specified at the same time.</p>
<p>In addition, a <code class="docutils literal"><span class="pre">-e</span></code> option also launches ovs-vswitchd under GDB. However,
instead of displaying a <code class="docutils literal"><span class="pre">gdb&gt;</span></code> prompt and waiting for user input,
ovs-vswitchd will start to execute immediately. <code class="docutils literal"><span class="pre">-r</span></code> option is the
corresponding option for running ovsdb-server under gdb with immediate
execution.</p>
<p>To avoid GDB mangling with the sandbox sub shell terminal, <code class="docutils literal"><span class="pre">ovs-sandbox</span></code>
starts a new xterm to run each GDB session.  For systems that do not support X
windows, GDB support is effectively disabled.</p>
<p>When launching sandbox through the build tree&#8217;s make file, the <code class="docutils literal"><span class="pre">-g</span></code> option
can be passed via the <code class="docutils literal"><span class="pre">SANDBOXFLAGS</span></code> environment variable.  <code class="docutils literal"><span class="pre">make</span> <span class="pre">sandbox</span>
<span class="pre">SANDBOXFLAGS=-g</span></code> will start the sandbox with ovs-vswitchd running under GDB in
its own xterm if X is available.</p>
</div>
<div class="section" id="motivation">
<h4>Motivation<a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h4>
<p>The goal of this tutorial is to demonstrate the power of Open vSwitch flow
tables.  The tutorial works through the implementation of a MAC-learning switch
with VLAN trunk and access ports.  Outside of the Open vSwitch features that we
will discuss, OpenFlow provides at least two ways to implement such a switch:</p>
<ol class="arabic simple">
<li>An OpenFlow controller to implement MAC learning in a &#8220;reactive&#8221; fashion.
Whenever a new MAC appears on the switch, or a MAC moves from one switch
port to another, the controller adjusts the OpenFlow flow table to match.</li>
<li>The &#8220;normal&#8221; action.  OpenFlow defines this action to submit a packet to
&#8220;the traditional non-OpenFlow pipeline of the switch&#8221;.  That is, if a flow
uses this action, then the packets in the flow go through the switch in the
same way that they would if OpenFlow was not configured on the switch.</li>
</ol>
<p>Each of these approaches has unfortunate pitfalls.  In the first approach,
using an OpenFlow controller to implement MAC learning, has a significant cost
in terms of network bandwidth and latency.  It also makes the controller more
difficult to scale to large numbers of switches, which is especially important
in environments with thousands of hypervisors (each of which contains a virtual
OpenFlow switch).  MAC learning at an OpenFlow controller also behaves poorly
if the OpenFlow controller fails, slows down, or becomes unavailable due to
network problems.</p>
<p>The second approach, using the &#8220;normal&#8221; action, has different problems.  First,
little about the &#8220;normal&#8221; action is standardized, so it behaves differently on
switches from different vendors, and the available features and how those
features are configured (usually not through OpenFlow) varies widely.  Second,
&#8220;normal&#8221; does not work well with other OpenFlow actions.  It is
&#8220;all-or-nothing&#8221;, with little potential to adjust its behavior slightly or to
compose it with other features.</p>
</div>
<div class="section" id="scenario">
<h4>Scenario<a class="headerlink" href="#scenario" title="Permalink to this headline">¶</a></h4>
<p>We will construct Open vSwitch flow tables for a VLAN-capable,
MAC-learning switch that has four ports:</p>
<dl class="docutils">
<dt>p1</dt>
<dd>a trunk port that carries all VLANs, on OpenFlow port 1.</dd>
<dt>p2</dt>
<dd>an access port for VLAN 20, on OpenFlow port 2.</dd>
<dt>p3, p4</dt>
<dd>both access ports for VLAN 30, on OpenFlow ports 3 and 4, respectively.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The ports&#8217; names are not significant.  You could call them eth1 through eth4,
or any other names you like.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An OpenFlow switch always has a &#8220;local&#8221; port as well.  This scenario won&#8217;t
use the local port.</p>
</div>
<p>Our switch design will consist of five main flow tables, each of which
implements one stage in the switch pipeline:</p>
<dl class="docutils">
<dt>Table 0</dt>
<dd>Admission control.</dd>
<dt>Table 1</dt>
<dd>VLAN input processing.</dd>
<dt>Table 2</dt>
<dd>Learn source MAC and VLAN for ingress port.</dd>
<dt>Table 3</dt>
<dd>Look up learned port for destination MAC and VLAN.</dd>
<dt>Table 4</dt>
<dd>Output processing.</dd>
</dl>
<p>The section below describes how to set up the scenario, followed by a section
for each OpenFlow table.</p>
<p>You can cut and paste the <code class="docutils literal"><span class="pre">ovs-vsctl</span></code> and <code class="docutils literal"><span class="pre">ovs-ofctl</span></code> commands in each of
the sections below into your <code class="docutils literal"><span class="pre">ovs-sandbox</span></code> shell.  They are also available as
shell scripts in this directory, named <code class="docutils literal"><span class="pre">t-setup</span></code>, <code class="docutils literal"><span class="pre">t-stage0</span></code>, <code class="docutils literal"><span class="pre">t-stage1</span></code>,
..., <code class="docutils literal"><span class="pre">t-stage4</span></code>.  The <code class="docutils literal"><span class="pre">ovs-appctl</span></code> test commands are intended for cutting
and pasting and are not supplied separately.</p>
</div>
<div class="section" id="setup">
<h4>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h4>
<p>To get started, start <code class="docutils literal"><span class="pre">ovs-sandbox</span></code>.  Inside the interactive shell that it
starts, run this command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0 -- set Bridge br0 fail-mode=secure
</pre></div>
</div>
<p>This command creates a new bridge &#8220;br0&#8221; and puts &#8220;br0&#8221; into so-called
&#8220;fail-secure&#8221; mode.  For our purpose, this just means that the OpenFlow flow
table starts out empty.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If we did not do this, then the flow table would start out with a single flow
that executes the &#8220;normal&#8221; action.  We could use that feature to yield a
switch that behaves the same as the switch we are currently building, but
with the caveats described under &#8220;Motivation&#8221; above.)</p>
</div>
<p>The new bridge has only one port on it so far, the &#8220;local port&#8221; br0.  We need
to add <code class="docutils literal"><span class="pre">p1</span></code>, <code class="docutils literal"><span class="pre">p2</span></code>, <code class="docutils literal"><span class="pre">p3</span></code>, and <code class="docutils literal"><span class="pre">p4</span></code>.  A shell <code class="docutils literal"><span class="pre">for</span></code> loop is one way to
do it:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>for i in 1 2 3 4; do
    ovs-vsctl add-port br0 p$i -- set Interface p$i ofport_request=$i
    ovs-ofctl mod-port br0 p$i up
done
</pre></div>
</div>
<p>In addition to adding a port, the <code class="docutils literal"><span class="pre">ovs-vsctl</span></code> command above sets its
<code class="docutils literal"><span class="pre">ofport_request</span></code> column to ensure that port <code class="docutils literal"><span class="pre">p1</span></code> is assigned OpenFlow port
1, <code class="docutils literal"><span class="pre">p2</span></code> is assigned OpenFlow port 2, and so on.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We could omit setting the ofport_request and let Open vSwitch choose port
numbers for us, but it&#8217;s convenient for the purposes of this tutorial because
we can talk about OpenFlow port 1 and know that it corresponds to <code class="docutils literal"><span class="pre">p1</span></code>.</p>
</div>
<p>The <code class="docutils literal"><span class="pre">ovs-ofctl</span></code> command above brings up the simulated interfaces, which are
down initially, using an OpenFlow request.  The effect is similar to <code class="docutils literal"><span class="pre">ifconfig</span>
<span class="pre">up</span></code>, but the sandbox&#8217;s interfaces are not visible to the operating system and
therefore <code class="docutils literal"><span class="pre">ifconfig</span></code> would not affect them.</p>
<p>We have not configured anything related to VLANs or MAC learning.  That&#8217;s
because we&#8217;re going to implement those features in the flow table.</p>
<p>To see what we&#8217;ve done so far to set up the scenario, you can run a command
like <code class="docutils literal"><span class="pre">ovs-vsctl</span> <span class="pre">show</span></code> or <code class="docutils literal"><span class="pre">ovs-ofctl</span> <span class="pre">show</span> <span class="pre">br0</span></code>.</p>
</div>
<div class="section" id="implementing-table-0-admission-control">
<h4>Implementing Table 0: Admission control<a class="headerlink" href="#implementing-table-0-admission-control" title="Permalink to this headline">¶</a></h4>
<p>Table 0 is where packets enter the switch.  We use this stage to discard
packets that for one reason or another are invalid.  For example, packets with
a multicast source address are not valid, so we can add a flow to drop them at
ingress to the switch with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 \
    &quot;table=0, dl_src=01:00:00:00:00:00/01:00:00:00:00:00, actions=drop&quot;
</pre></div>
</div>
<p>A switch should also not forward IEEE 802.1D Spanning Tree Protocol (STP)
packets, so we can also add a flow to drop those and other packets with
reserved multicast protocols:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 \
    &quot;table=0, dl_dst=01:80:c2:00:00:00/ff:ff:ff:ff:ff:f0, actions=drop&quot;
</pre></div>
</div>
<p>We could add flows to drop other protocols, but these demonstrate the pattern.</p>
<p>We need one more flow, with a priority lower than the default, so that flows
that don&#8217;t match either of the &#8220;drop&#8221; flows we added above go on to pipeline
stage 1 in OpenFlow table 1:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 &quot;table=0, priority=0, actions=resubmit(,1)&quot;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The &#8220;resubmit&#8221; action is an Open vSwitch extension to OpenFlow.</p>
</div>
</div>
<div class="section" id="testing-table-0">
<h4>Testing Table 0<a class="headerlink" href="#testing-table-0" title="Permalink to this headline">¶</a></h4>
<p>If we were using Open vSwitch to set up a physical or a virtual switch, then we
would naturally test it by sending packets through it one way or another,
perhaps with common network testing tools like <code class="docutils literal"><span class="pre">ping</span></code> and <code class="docutils literal"><span class="pre">tcpdump</span></code> or more
specialized tools like Scapy.  That&#8217;s difficult with our simulated switch,
since it&#8217;s not visible to the operating system.</p>
<p>But our simulated switch has a few specialized testing tools.  The most
powerful of these tools is <code class="docutils literal"><span class="pre">ofproto/trace</span></code>.  Given a switch and the
specification of a flow, <code class="docutils literal"><span class="pre">ofproto/trace</span></code> shows, step-by-step, how such a flow
would be treated as it goes through the switch.</p>
<div class="section" id="example-1">
<h5>Example 1<a class="headerlink" href="#example-1" title="Permalink to this headline">¶</a></h5>
<p>Try this command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ofproto/trace br0 in_port=1,dl_dst=01:80:c2:00:00:05
</pre></div>
</div>
<p>The output should look something like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Flow: in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=01:80:c2:00:00:05,dl_type=0x0000

bridge(&quot;br0&quot;)
-------------
 0. dl_dst=01:80:c2:00:00:00/ff:ff:ff:ff:ff:f0, priority 32768
    drop

Final flow: unchanged
Megaflow: recirc_id=0,in_port=1,dl_src=00:00:00:00:00:00/01:00:00:00:00:00,dl_dst=01:80:c2:00:00:00/ff:ff:ff:ff:ff:f0,dl_type=0x0000
Datapath actions: drop
</pre></div>
</div>
<p>The first line shows the flow being traced, in slightly greater detail
than specified on the command line.  It is mostly zeros because
unspecified fields default to zeros.</p>
<p>The second group of lines shows the packet&#8217;s trip through bridge br0.
We see, in table 0, the OpenFlow flow that the fields matched, along
with its priority, followed by its actions, one per line.  In this
case, we see that this packet that has a reserved multicast
destination address matches the flow that drops those packets.</p>
<p>The final block of lines summarizes the results, which are not very
interesting here.</p>
</div>
<div class="section" id="example-2">
<h5>Example 2<a class="headerlink" href="#example-2" title="Permalink to this headline">¶</a></h5>
<p>Try another command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ofproto/trace br0 in_port=1,dl_dst=01:80:c2:00:00:10
</pre></div>
</div>
<p>The output should be:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Flow: in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=01:80:c2:00:00:10,dl_type=0x0000

bridge(&quot;br0&quot;)
-------------
 0. priority 0
    resubmit(,1)
 1. No match.
    drop

Final flow: unchanged
Megaflow: recirc_id=0,in_port=1,dl_src=00:00:00:00:00:00/01:00:00:00:00:00,dl_dst=01:80:c2:00:00:10/ff:ff:ff:ff:ff:f0,dl_type=0x0000
Datapath actions: drop
</pre></div>
</div>
<p>This time the flow we handed to <code class="docutils literal"><span class="pre">ofproto/trace</span></code> doesn&#8217;t match any of
our &#8220;drop&#8221; flows in table 0, so it falls through to the low-priority
&#8220;resubmit&#8221; flow.  The &#8220;resubmit&#8221; causes a second lookup in OpenFlow
table 1, described by the block of text that starts with &#8220;1.&#8221;  We
haven&#8217;t yet added any flows to OpenFlow table 1, so no flow actually
matches in the second lookup.  Therefore, the packet is still actually
dropped, which means that the externally observable results would be
identical to our first example.</p>
</div>
</div>
<div class="section" id="implementing-table-1-vlan-input-processing">
<h4>Implementing Table 1: VLAN Input Processing<a class="headerlink" href="#implementing-table-1-vlan-input-processing" title="Permalink to this headline">¶</a></h4>
<p>A packet that enters table 1 has already passed basic validation in table 0.
The purpose of table 1 is validate the packet&#8217;s VLAN, based on the VLAN
configuration of the switch port through which the packet entered the switch.
We will also use it to attach a VLAN header to packets that arrive on an access
port, which allows later processing stages to rely on the packet&#8217;s VLAN always
being part of the VLAN header, reducing special cases.</p>
<p>Let&#8217;s start by adding a low-priority flow that drops all packets, before we add
flows that pass through acceptable packets.  You can think of this as a
&#8220;default drop&#8221; flow:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 &quot;table=1, priority=0, actions=drop&quot;
</pre></div>
</div>
<p>Our trunk port <code class="docutils literal"><span class="pre">p1</span></code>, on OpenFlow port 1, is an easy case.  <code class="docutils literal"><span class="pre">p1</span></code> accepts any
packet regardless of whether it has a VLAN header or what the VLAN was, so we
can add a flow that resubmits everything on input port 1 to the next table:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 \
    &quot;table=1, priority=99, in_port=1, actions=resubmit(,2)&quot;
</pre></div>
</div>
<p>On the access ports, we want to accept any packet that has no VLAN header, tag
it with the access port&#8217;s VLAN number, and then pass it along to the next
stage:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flows br0 - &lt;&lt;&#39;EOF&#39;
table=1, priority=99, in_port=2, vlan_tci=0, actions=mod_vlan_vid:20, resubmit(,2)
table=1, priority=99, in_port=3, vlan_tci=0, actions=mod_vlan_vid:30, resubmit(,2)
table=1, priority=99, in_port=4, vlan_tci=0, actions=mod_vlan_vid:30, resubmit(,2)
EOF
</pre></div>
</div>
<p>We don&#8217;t write any flows that match packets with 802.1Q that enter this stage
on any of the access ports, so the &#8220;default drop&#8221; flow we added earlier causes
them to be dropped, which is ordinarily what we want for access ports.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Another variation of access ports allows ingress of packets tagged with VLAN
0 (aka 802.1p priority tagged packets).  To allow such packets, replace
<code class="docutils literal"><span class="pre">vlan_tci=0</span></code> by <code class="docutils literal"><span class="pre">vlan_tci=0/0xfff</span></code> above.</p>
</div>
</div>
<div class="section" id="testing-table-1">
<h4>Testing Table 1<a class="headerlink" href="#testing-table-1" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">ofproto/trace</span></code> allows us to test the ingress VLAN flows that we added above.</p>
<div class="section" id="example-1-packet-on-trunk-port">
<h5>Example 1: Packet on Trunk Port<a class="headerlink" href="#example-1-packet-on-trunk-port" title="Permalink to this headline">¶</a></h5>
<p>Here&#8217;s a test of a packet coming in on the trunk port:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ofproto/trace br0 in_port=1,vlan_tci=5
</pre></div>
</div>
<p>The output shows the lookup in table 0, the resubmit to table 1, and the
resubmit to table 2 (which does nothing because we haven&#8217;t put anything there
yet):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Flow: in_port=1,vlan_tci=0x0005,dl_src=00:00:00:00:00:00,dl_dst=00:00:00:00:00:00,dl_type=0x0000

bridge(&quot;br0&quot;)
-------------
 0. priority 0
    resubmit(,1)
 1. in_port=1, priority 99
    resubmit(,2)
 2. No match.
    drop

Final flow: unchanged
Megaflow: recirc_id=0,in_port=1,dl_src=00:00:00:00:00:00/01:00:00:00:00:00,dl_dst=00:00:00:00:00:00/ff:ff:ff:ff:ff:f0,dl_type=0x0000
Datapath actions: drop
</pre></div>
</div>
</div>
<div class="section" id="example-2-valid-packet-on-access-port">
<h5>Example 2: Valid Packet on Access Port<a class="headerlink" href="#example-2-valid-packet-on-access-port" title="Permalink to this headline">¶</a></h5>
<p>Here&#8217;s a test of a valid packet (a packet without an 802.1Q header) coming in
on access port <code class="docutils literal"><span class="pre">p2</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ofproto/trace br0 in_port=2
</pre></div>
</div>
<p>The output is similar to that for the previous case, except that it
additionally tags the packet with <code class="docutils literal"><span class="pre">p2</span></code>&#8216;s VLAN 20 before it passes it along to
table 2:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Flow: in_port=2,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:00:00:00:00:00,dl_type=0x0000

bridge(&quot;br0&quot;)
-------------
 0. priority 0
    resubmit(,1)
 1. in_port=2,vlan_tci=0x0000, priority 99
    mod_vlan_vid:20
    resubmit(,2)
 2. No match.
    drop

Final flow: in_port=2,dl_vlan=20,dl_vlan_pcp=0,dl_src=00:00:00:00:00:00,dl_dst=00:00:00:00:00:00,dl_type=0x0000
Megaflow: recirc_id=0,in_port=2,vlan_tci=0x0000,dl_src=00:00:00:00:00:00/01:00:00:00:00:00,dl_dst=00:00:00:00:00:00/ff:ff:ff:ff:ff:f0,dl_type=0x0000
Datapath actions: drop
</pre></div>
</div>
</div>
<div class="section" id="example-3-invalid-packet-on-access-port">
<h5>Example 3: Invalid Packet on Access Port<a class="headerlink" href="#example-3-invalid-packet-on-access-port" title="Permalink to this headline">¶</a></h5>
<p>This tests an invalid packet (one that includes an 802.1Q header) coming in on
access port <code class="docutils literal"><span class="pre">p2</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ofproto/trace br0 in_port=2,vlan_tci=5
</pre></div>
</div>
<p>The output shows the packet matching the default drop flow:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Flow: in_port=2,vlan_tci=0x0005,dl_src=00:00:00:00:00:00,dl_dst=00:00:00:00:00:00,dl_type=0x0000

bridge(&quot;br0&quot;)
-------------
 0. priority 0
    resubmit(,1)
 1. priority 0
    drop

Final flow: unchanged
Megaflow: recirc_id=0,in_port=2,vlan_tci=0x0005,dl_src=00:00:00:00:00:00/01:00:00:00:00:00,dl_dst=00:00:00:00:00:00/ff:ff:ff:ff:ff:f0,dl_type=0x0000
Datapath actions: drop
</pre></div>
</div>
</div>
</div>
<div class="section" id="implementing-table-2-mac-vlan-learning-for-ingress-port">
<h4>Implementing Table 2: MAC+VLAN Learning for Ingress Port<a class="headerlink" href="#implementing-table-2-mac-vlan-learning-for-ingress-port" title="Permalink to this headline">¶</a></h4>
<p>This table allows the switch we&#8217;re implementing to learn that the packet&#8217;s
source MAC is located on the packet&#8217;s ingress port in the packet&#8217;s VLAN.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This table is a good example why table 1 added a VLAN tag to packets that
entered the switch through an access port.  We want to associate a MAC+VLAN
with a port regardless of whether the VLAN in question was originally part of
the packet or whether it was an assumed VLAN associated with an access port.</p>
</div>
<p>It only takes a single flow to do this.  The following command adds it:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 \
    &quot;table=2 actions=learn(table=10, NXM_OF_VLAN_TCI[0..11], \
                           NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[], \
                           load:NXM_OF_IN_PORT[]-&gt;NXM_NX_REG0[0..15]), \
                     resubmit(,3)&quot;
</pre></div>
</div>
<p>The &#8220;learn&#8221; action (an Open vSwitch extension to OpenFlow) modifies a flow
table based on the content of the flow currently being processed.  Here&#8217;s how
you can interpret each part of the &#8220;learn&#8221; action above:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">table=10</span></code></dt>
<dd>Modify flow table 10.  This will be the MAC learning table.</dd>
<dt><code class="docutils literal"><span class="pre">NXM_OF_VLAN_TCI[0..11]</span></code></dt>
<dd>Make the flow that we add to flow table 10 match the same VLAN ID that the
packet we&#8217;re currently processing contains.  This effectively scopes the
MAC learning entry to a single VLAN, which is the ordinary behavior for a
VLAN-aware switch.</dd>
<dt><code class="docutils literal"><span class="pre">NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[]</span></code></dt>
<dd>Make the flow that we add to flow table 10 match, as Ethernet destination,
the Ethernet source address of the packet we&#8217;re currently processing.</dd>
<dt><code class="docutils literal"><span class="pre">load:NXM_OF_IN_PORT[]-&gt;NXM_NX_REG0[0..15]</span></code></dt>
<dd>Whereas the preceding parts specify fields for the new flow to match, this
specifies an action for the flow to take when it matches.  The action is
for the flow to load the ingress port number of the current packet into
register 0 (a special field that is an Open vSwitch extension to OpenFlow).</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A real use of &#8220;learn&#8221; for MAC learning would probably involve two additional
elements.  First, the &#8220;learn&#8221; action would specify a hard_timeout for the new
flow, to enable a learned MAC to eventually expire if no new packets were
seen from a given source within a reasonable interval.  Second, one would
usually want to limit resource consumption by using the Flow_Table table in
the Open vSwitch configuration database to specify a maximum number of flows
in table 10.</p>
</div>
<p>This definitely calls for examples.</p>
</div>
<div class="section" id="testing-table-2">
<h4>Testing Table 2<a class="headerlink" href="#testing-table-2" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id1">
<h5>Example 1<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<p>Try the following test command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ofproto/trace br0 \
    in_port=1,vlan_tci=20,dl_src=50:00:00:00:00:01 -generate
</pre></div>
</div>
<p>The output shows that &#8220;learn&#8221; was executed in table 2 and the
particular flow that was added:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Flow: in_port=1,vlan_tci=0x0014,dl_src=50:00:00:00:00:01,dl_dst=00:00:00:00:00:00,dl_type=0x0000

bridge(&quot;br0&quot;)
-------------
 0. priority 0
    resubmit(,1)
 1. in_port=1, priority 99
    resubmit(,2)
 2. priority 32768
    learn(table=10,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_OF_IN_PORT[]-&gt;NXM_NX_REG0[0..15])
     -&gt; table=10 vlan_tci=0x0014/0x0fff,dl_dst=50:00:00:00:00:01 priority=32768 actions=load:0x1-&gt;NXM_NX_REG0[0..15]
    resubmit(,3)
 3. No match.
    drop

Final flow: unchanged
Megaflow: recirc_id=0,in_port=1,vlan_tci=0x0014/0x1fff,dl_src=50:00:00:00:00:01,dl_dst=00:00:00:00:00:00/ff:ff:ff:ff:ff:f0,dl_type=0x0000
Datapath actions: drop
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">-generate</span></code> keyword is new.  Ordinarily, <code class="docutils literal"><span class="pre">ofproto/trace</span></code> has no side
effects: &#8220;output&#8221; actions do not actually output packets, &#8220;learn&#8221; actions do
not actually modify the flow table, and so on.  With <code class="docutils literal"><span class="pre">-generate</span></code>, though,
<code class="docutils literal"><span class="pre">ofproto/trace</span></code> does execute &#8220;learn&#8221; actions.  That&#8217;s important now, because
we want to see the effect of the &#8220;learn&#8221; action on table 10.  You can see that
by running:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl dump-flows br0 table=10
</pre></div>
</div>
<p>which (omitting the <code class="docutils literal"><span class="pre">duration</span></code> and <code class="docutils literal"><span class="pre">idle_age</span></code> fields, which will vary based
on how soon you ran this command after the previous one, as well as some other
uninteresting fields) prints something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>NXST_FLOW reply (xid=0x4):
 table=10, vlan_tci=0x0014/0x0fff,dl_dst=50:00:00:00:00:01 actions=load:0x1-&gt;NXM_NX_REG0[0..15]
</pre></div>
</div>
<p>You can see that the packet coming in on VLAN <code class="docutils literal"><span class="pre">20</span></code> with source MAC
<code class="docutils literal"><span class="pre">50:00:00:00:00:01</span></code> became a flow that matches VLAN <code class="docutils literal"><span class="pre">20</span></code> (written in
hexadecimal) and destination MAC <code class="docutils literal"><span class="pre">50:00:00:00:00:01</span></code>.  The flow loads port
number <code class="docutils literal"><span class="pre">1</span></code>, the input port for the flow we tested, into register 0.</p>
</div>
<div class="section" id="id2">
<h5>Example 2<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
<p>Here&#8217;s a second test command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ofproto/trace br0 \
    in_port=2,dl_src=50:00:00:00:00:01 -generate
</pre></div>
</div>
<p>The flow that this command tests has the same source MAC and VLAN as example 1,
although the VLAN comes from an access port VLAN rather than an 802.1Q header.
If we again dump the flows for table 10 with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl dump-flows br0 table=10
</pre></div>
</div>
<p>then we see that the flow we saw previously has changed to indicate that the
learned port is port 2, as we would expect:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>NXST_FLOW reply (xid=0x4):
 table=10, vlan_tci=0x0014/0x0fff,dl_dst=50:00:00:00:00:01 actions=load:0x2-&gt;NXM_NX_REG0[0..15]
</pre></div>
</div>
</div>
</div>
<div class="section" id="implementing-table-3-look-up-destination-port">
<h4>Implementing Table 3: Look Up Destination Port<a class="headerlink" href="#implementing-table-3-look-up-destination-port" title="Permalink to this headline">¶</a></h4>
<p>This table figures out what port we should send the packet to based on the
destination MAC and VLAN.  That is, if we&#8217;ve learned the location of the
destination (from table 2 processing some previous packet with that destination
as its source), then we want to send the packet there.</p>
<p>We need only one flow to do the lookup:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 \
    &quot;table=3 priority=50 actions=resubmit(,10), resubmit(,4)&quot;
</pre></div>
</div>
<p>The flow&#8217;s first action resubmits to table 10, the table that the &#8220;learn&#8221;
action modifies.  As you saw previously, the learned flows in this table write
the learned port into register 0.  If the destination for our packet hasn&#8217;t
been learned, then there will be no matching flow, and so the &#8220;resubmit&#8221; turns
into a no-op.  Because registers are initialized to 0, we can use a register 0
value of 0 in our next pipeline stage as a signal to flood the packet.</p>
<p>The second action resubmits to table 4, continuing to the next pipeline stage.</p>
<p>We can add another flow to skip the learning table lookup for multicast and
broadcast packets, since those should always be flooded:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 \
    &quot;table=3 priority=99 dl_dst=01:00:00:00:00:00/01:00:00:00:00:00 \
      actions=resubmit(,4)&quot;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We don&#8217;t strictly need to add this flow, because multicast addresses will
never show up in our learning table.  (In turn, that&#8217;s because we put a flow
into table 0 to drop packets that have a multicast source address.)</p>
</div>
</div>
<div class="section" id="testing-table-3">
<h4>Testing Table 3<a class="headerlink" href="#testing-table-3" title="Permalink to this headline">¶</a></h4>
<div class="section" id="example">
<h5>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h5>
<p>Here&#8217;s a command that should cause OVS to learn that <code class="docutils literal"><span class="pre">f0:00:00:00:00:01</span></code> is
on <code class="docutils literal"><span class="pre">p1</span></code> in VLAN <code class="docutils literal"><span class="pre">20</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ofproto/trace br0 \
    in_port=1,dl_vlan=20,dl_src=f0:00:00:00:00:01,dl_dst=90:00:00:00:00:01 \
    -generate
</pre></div>
</div>
<p>The output shows (from the &#8220;no match&#8221; looking up the resubmit to
table 10) that the flow&#8217;s destination was unknown:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Flow: in_port=1,dl_vlan=20,dl_vlan_pcp=0,dl_src=f0:00:00:00:00:01,dl_dst=90:00:00:00:00:01,dl_type=0x0000

bridge(&quot;br0&quot;)
-------------
 0. priority 0
    resubmit(,1)
 1. in_port=1, priority 99
    resubmit(,2)
 2. priority 32768
    learn(table=10,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_OF_IN_PORT[]-&gt;NXM_NX_REG0[0..15])
     -&gt; table=10 vlan_tci=0x0014/0x0fff,dl_dst=f0:00:00:00:00:01 priority=32768 actions=load:0x1-&gt;NXM_NX_REG0[0..15]
    resubmit(,3)
 3. priority 50
    resubmit(,10)
    10. No match.
            drop
    resubmit(,4)
 4. No match.
    drop

Final flow: unchanged
Megaflow: recirc_id=0,in_port=1,dl_vlan=20,dl_src=f0:00:00:00:00:01,dl_dst=90:00:00:00:00:01,dl_type=0x0000
Datapath actions: drop
</pre></div>
</div>
<p>There are two ways that you can verify that the packet&#8217;s source was
learned.  The most direct way is to dump the learning table with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl dump-flows br0 table=10
</pre></div>
</div>
<p>which ought to show roughly the following, with extraneous details removed:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>table=10, vlan_tci=0x0014/0x0fff,dl_dst=f0:00:00:00:00:01 actions=load:0x1-&gt;NXM_NX_REG0[0..15]
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you tried the examples for the previous step, or if you did some of your
own experiments, then you might see additional flows there.  These
additional flows are harmless.  If they bother you, then you can remove
them with <cite>ovs-ofctl del-flows br0 table=10</cite>.</p>
</div>
<p>The other way is to inject a packet to take advantage of the learning entry.
For example, we can inject a packet on p2 whose destination is the MAC address
that we just learned on p1:</p>
<blockquote>
<div><dl class="docutils">
<dt>$ ovs-appctl ofproto/trace br0 </dt>
<dd>in_port=2,dl_src=90:00:00:00:00:01,dl_dst=f0:00:00:00:00:01 -generate</dd>
</dl>
</div></blockquote>
<p>Here is this command&#8217;s output.  Take a look at the lines that trace
the <code class="docutils literal"><span class="pre">resubmit(,10)</span></code>, showing that the packet matched the learned
flow for the first MAC we used, loading the OpenFlow port number for
the learned port <code class="docutils literal"><span class="pre">p1</span></code> into register <code class="docutils literal"><span class="pre">0</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Flow: in_port=2,vlan_tci=0x0000,dl_src=90:00:00:00:00:01,dl_dst=f0:00:00:00:00:01,dl_type=0x0000

bridge(&quot;br0&quot;)
-------------
 0. priority 0
    resubmit(,1)
 1. in_port=2,vlan_tci=0x0000, priority 99
    mod_vlan_vid:20
    resubmit(,2)
 2. priority 32768
    learn(table=10,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_OF_IN_PORT[]-&gt;NXM_NX_REG0[0..15])
     -&gt; table=10 vlan_tci=0x0014/0x0fff,dl_dst=90:00:00:00:00:01 priority=32768 actions=load:0x2-&gt;NXM_NX_REG0[0..15]
    resubmit(,3)
 3. priority 50
    resubmit(,10)
    10. vlan_tci=0x0014/0x0fff,dl_dst=f0:00:00:00:00:01, priority 32768
            load:0x1-&gt;NXM_NX_REG0[0..15]
    resubmit(,4)
 4. No match.
    drop

Final flow: reg0=0x1,in_port=2,dl_vlan=20,dl_vlan_pcp=0,dl_src=90:00:00:00:00:01,dl_dst=f0:00:00:00:00:01,dl_type=0x0000
Megaflow: recirc_id=0,in_port=2,vlan_tci=0x0000,dl_src=90:00:00:00:00:01,dl_dst=f0:00:00:00:00:01,dl_type=0x0000
Datapath actions: drop
</pre></div>
</div>
<p>If you read the commands above carefully, then you might have noticed that they
simply have the Ethernet source and destination addresses exchanged.  That
means that if we now rerun the first <code class="docutils literal"><span class="pre">ovs-appctl</span></code> command above, e.g.:</p>
<blockquote>
<div><dl class="docutils">
<dt>$ ovs-appctl ofproto/trace br0 </dt>
<dd>in_port=1,dl_vlan=20,dl_src=f0:00:00:00:00:01,dl_dst=90:00:00:00:00:01 -generate</dd>
</dl>
</div></blockquote>
<p>then we see in the output, looking at the indented &#8220;load&#8221; action
executed in table 10, that the destination has now been learned:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Flow: in_port=1,dl_vlan=20,dl_vlan_pcp=0,dl_src=f0:00:00:00:00:01,dl_dst=90:00:00:00:00:01,dl_type=0x0000

bridge(&quot;br0&quot;)
-------------
 0. priority 0
    resubmit(,1)
 1. in_port=1, priority 99
    resubmit(,2)
 2. priority 32768
    learn(table=10,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_OF_IN_PORT[]-&gt;NXM_NX_REG0[0..15])
     -&gt; table=10 vlan_tci=0x0014/0x0fff,dl_dst=f0:00:00:00:00:01 priority=32768 actions=load:0x1-&gt;NXM_NX_REG0[0..15]
    resubmit(,3)
 3. priority 50
    resubmit(,10)
    10. vlan_tci=0x0014/0x0fff,dl_dst=90:00:00:00:00:01, priority 32768
            load:0x2-&gt;NXM_NX_REG0[0..15]
    resubmit(,4)
 4. No match.
    drop
</pre></div>
</div>
</div>
</div>
<div class="section" id="implementing-table-4-output-processing">
<h4>Implementing Table 4: Output Processing<a class="headerlink" href="#implementing-table-4-output-processing" title="Permalink to this headline">¶</a></h4>
<p>At entry to stage 4, we know that register 0 contains either the desired output
port or is zero if the packet should be flooded.  We also know that the
packet&#8217;s VLAN is in its 802.1Q header, even if the VLAN was implicit because
the packet came in on an access port.</p>
<p>The job of the final pipeline stage is to actually output packets.  The job is
trivial for output to our trunk port <code class="docutils literal"><span class="pre">p1</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 &quot;table=4 reg0=1 actions=1&quot;
</pre></div>
</div>
<p>For output to the access ports, we just have to strip the VLAN header before
outputting the packet:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flows br0 - &lt;&lt;&#39;EOF&#39;
table=4 reg0=2 actions=strip_vlan,2
table=4 reg0=3 actions=strip_vlan,3
table=4 reg0=4 actions=strip_vlan,4
EOF
</pre></div>
</div>
<p>The only slightly tricky part is flooding multicast and broadcast packets and
unicast packets with unlearned destinations.  For those, we need to make sure
that we only output the packets to the ports that carry our packet&#8217;s VLAN, and
that we include the 802.1Q header in the copy output to the trunk port but not
in copies output to access ports:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flows br0 - &lt;&lt;&#39;EOF&#39;
table=4 reg0=0 priority=99 dl_vlan=20 actions=1,strip_vlan,2
table=4 reg0=0 priority=99 dl_vlan=30 actions=1,strip_vlan,3,4
table=4 reg0=0 priority=50            actions=1
EOF
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Our flows rely on the standard OpenFlow behavior that an output action will
not forward a packet back out the port it came in on.  That is, if a packet
comes in on p1, and we&#8217;ve learned that the packet&#8217;s destination MAC is also
on p1, so that we end up with <code class="docutils literal"><span class="pre">actions=1</span></code> as our actions, the switch will
not forward the packet back out its input port.  The
multicast/broadcast/unknown destination cases above also rely on this
behavior.</p>
</div>
</div>
<div class="section" id="testing-table-4">
<h4>Testing Table 4<a class="headerlink" href="#testing-table-4" title="Permalink to this headline">¶</a></h4>
<div class="section" id="example-1-broadcast-multicast-and-unknown-destination">
<h5>Example 1: Broadcast, Multicast, and Unknown Destination<a class="headerlink" href="#example-1-broadcast-multicast-and-unknown-destination" title="Permalink to this headline">¶</a></h5>
<p>Try tracing a broadcast packet arriving on <code class="docutils literal"><span class="pre">p1</span></code> in VLAN <code class="docutils literal"><span class="pre">30</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ofproto/trace br0 \
    in_port=1,dl_dst=ff:ff:ff:ff:ff:ff,dl_vlan=30
</pre></div>
</div>
<p>The interesting part of the output is the final line, which shows that the
switch would remove the 802.1Q header and then output the packet to <code class="docutils literal"><span class="pre">p3</span></code>
and <code class="docutils literal"><span class="pre">p4</span></code>, which are access ports for VLAN <code class="docutils literal"><span class="pre">30</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Datapath actions: pop_vlan,3,4
</pre></div>
</div>
<p>Similarly, if we trace a broadcast packet arriving on <code class="docutils literal"><span class="pre">p3</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ofproto/trace br0 in_port=3,dl_dst=ff:ff:ff:ff:ff:ff
</pre></div>
</div>
<p>then we see that it is output to <code class="docutils literal"><span class="pre">p1</span></code> with an 802.1Q tag and then to <code class="docutils literal"><span class="pre">p4</span></code>
without one:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Datapath actions: push_vlan(vid=30,pcp=0),1,pop_vlan,4
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Open vSwitch could simplify the datapath actions here to just
<code class="docutils literal"><span class="pre">4,push_vlan(vid=30,pcp=0),1</span></code> but it is not smart enough to do so.</p>
</div>
<p>The following are also broadcasts, but the result is to drop the packets
because the VLAN only belongs to the input port:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ofproto/trace br0 \
    in_port=1,dl_dst=ff:ff:ff:ff:ff:ff
$ ovs-appctl ofproto/trace br0 \
    in_port=1,dl_dst=ff:ff:ff:ff:ff:ff,dl_vlan=55
</pre></div>
</div>
<p>Try some other broadcast cases on your own:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ofproto/trace br0 \
    in_port=1,dl_dst=ff:ff:ff:ff:ff:ff,dl_vlan=20
$ ovs-appctl ofproto/trace br0 \
    in_port=2,dl_dst=ff:ff:ff:ff:ff:ff
$ ovs-appctl ofproto/trace br0 \
    in_port=4,dl_dst=ff:ff:ff:ff:ff:ff
</pre></div>
</div>
<p>You can see the same behavior with multicast packets and with unicast
packets whose destination has not been learned, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ofproto/trace br0 \
    in_port=4,dl_dst=01:00:00:00:00:00
$ ovs-appctl ofproto/trace br0 \
    in_port=1,dl_dst=90:12:34:56:78:90,dl_vlan=20
$ ovs-appctl ofproto/trace br0 \
    in_port=1,dl_dst=90:12:34:56:78:90,dl_vlan=30
</pre></div>
</div>
</div>
<div class="section" id="example-2-mac-learning">
<h5>Example 2: MAC Learning<a class="headerlink" href="#example-2-mac-learning" title="Permalink to this headline">¶</a></h5>
<p>Let&#8217;s follow the same pattern as we did for table 3.  First learn a MAC on port
<code class="docutils literal"><span class="pre">p1</span></code> in VLAN <code class="docutils literal"><span class="pre">30</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ofproto/trace br0 \
    in_port=1,dl_vlan=30,dl_src=10:00:00:00:00:01,dl_dst=20:00:00:00:00:01 \
    -generate
</pre></div>
</div>
<p>You can see from the last line of output that the packet&#8217;s destination is
unknown, so it gets flooded to both <code class="docutils literal"><span class="pre">p3</span></code> and <code class="docutils literal"><span class="pre">p4</span></code>, the other ports in VLAN
<code class="docutils literal"><span class="pre">30</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Datapath actions: pop_vlan,3,4
</pre></div>
</div>
<p>Then reverse the MACs and learn the first flow&#8217;s destination on port <code class="docutils literal"><span class="pre">p4</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ofproto/trace br0 \
    in_port=4,dl_src=20:00:00:00:00:01,dl_dst=10:00:00:00:00:01 -generate
</pre></div>
</div>
<p>The last line of output shows that the this packet&#8217;s destination is known to be
<code class="docutils literal"><span class="pre">p1</span></code>, as learned from our previous command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Datapath actions: push_vlan(vid=30,pcp=0),1
</pre></div>
</div>
<p>Now, if we rerun our first command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ofproto/trace br0 \
    in_port=1,dl_vlan=30,dl_src=10:00:00:00:00:01,dl_dst=20:00:00:00:00:01 \
    -generate
</pre></div>
</div>
<p>...we can see that the result is no longer a flood but to the specified learned
destination port <code class="docutils literal"><span class="pre">p4</span></code>:</p>
<blockquote>
<div>Datapath actions: pop_vlan,4</div></blockquote>
<div class="section" id="contact">
<h6>Contact<a class="headerlink" href="#contact" title="Permalink to this headline">¶</a></h6>
<p><a class="reference external" href="mailto:bugs&#37;&#52;&#48;openvswitch&#46;org">bugs<span>&#64;</span>openvswitch<span>&#46;</span>org</a>
<a class="reference external" href="http://openvswitch.org/">http://openvswitch.org/</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-topics/index"></span><div class="section" id="deep-dive">
<h2>Deep Dive<a class="headerlink" href="#deep-dive" title="Permalink to this headline">¶</a></h2>
<p>How Open vSwitch and OVN are implemented and, where necessary, why it was
implemented that way.</p>
<div class="section" id="ovs">
<h3>OVS<a class="headerlink" href="#ovs" title="Permalink to this headline">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-topics/design"></span><div class="section" id="design-decisions-in-open-vswitch">
<h4>Design Decisions In Open vSwitch<a class="headerlink" href="#design-decisions-in-open-vswitch" title="Permalink to this headline">¶</a></h4>
<p>This document describes design decisions that went into implementing Open
vSwitch.  While we believe these to be reasonable decisions, it is impossible
to predict how Open vSwitch will be used in all environments.  Understanding
assumptions made by Open vSwitch is critical to a successful deployment.  The
end of this document contains contact information that can be used to let us
know how we can make Open vSwitch more generally useful.</p>
<div class="section" id="asynchronous-messages">
<h5>Asynchronous Messages<a class="headerlink" href="#asynchronous-messages" title="Permalink to this headline">¶</a></h5>
<p>Over time, Open vSwitch has added many knobs that control whether a given
controller receives OpenFlow asynchronous messages.  This section describes how
all of these features interact.</p>
<p>First, a service controller never receives any asynchronous messages unless it
changes its miss_send_len from the service controller default of zero in one of
the following ways:</p>
<ul class="simple">
<li>Sending an <code class="docutils literal"><span class="pre">OFPT_SET_CONFIG</span></code> message with nonzero <code class="docutils literal"><span class="pre">miss_send_len</span></code>.</li>
<li>Sending any <code class="docutils literal"><span class="pre">NXT_SET_ASYNC_CONFIG</span></code> message: as a side effect, this message
changes the <code class="docutils literal"><span class="pre">miss_send_len</span></code> to <code class="docutils literal"><span class="pre">OFP_DEFAULT_MISS_SEND_LEN</span></code> (128) for
service controllers.</li>
</ul>
<p>Second, <code class="docutils literal"><span class="pre">OFPT_FLOW_REMOVED</span></code> and <code class="docutils literal"><span class="pre">NXT_FLOW_REMOVED</span></code> messages are generated
only if the flow that was removed had the <code class="docutils literal"><span class="pre">OFPFF_SEND_FLOW_REM</span></code> flag set.</p>
<p>Third, <code class="docutils literal"><span class="pre">OFPT_PACKET_IN</span></code> and <code class="docutils literal"><span class="pre">NXT_PACKET_IN</span></code> messages are sent only to
OpenFlow controller connections that have the correct connection ID (see
<code class="docutils literal"><span class="pre">struct</span> <span class="pre">nx_controller_id</span></code> and <code class="docutils literal"><span class="pre">struct</span> <span class="pre">nx_action_controller</span></code>):</p>
<ul class="simple">
<li>For packet-in messages generated by a <code class="docutils literal"><span class="pre">NXAST_CONTROLLER</span></code> action, the
controller ID specified in the action.</li>
<li>For other packet-in messages, controller ID zero.  (This is the default ID
when an OpenFlow controller does not configure one.)</li>
</ul>
<p>Finally, Open vSwitch consults a per-connection table indexed by the message
type, reason code, and current role.  The following table shows how this table
is initialized by default when an OpenFlow connection is made.  An entry
labeled <code class="docutils literal"><span class="pre">yes</span></code> means that the message is sent, an entry labeled <code class="docutils literal"><span class="pre">---</span></code> means
that the message is suppressed.</p>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-text"><code class="docutils literal"><span class="pre">OFPT_PACKET_IN</span></code> / <code class="docutils literal"><span class="pre">NXT_PACKET_IN</span></code></span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="78%" />
<col width="13%" />
<col width="9%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">message and reason code</th>
<th class="head">other</th>
<th class="head">slave</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">OFPR_NO_MATCH</span></code></td>
<td>yes</td>
<td>&#8212;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">OFPR_ACTION</span></code></td>
<td>yes</td>
<td>&#8212;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">OFPR_INVALID_TTL</span></code></td>
<td>&#8212;</td>
<td>&#8212;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">OFPR_ACTION_SET</span></code> (OF1.4+)</td>
<td>yes</td>
<td>&#8212;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">OFPR_GROUP</span></code> (OF1.4+)</td>
<td>yes</td>
<td>&#8212;</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id2">
<caption><span class="caption-text"><code class="docutils literal"><span class="pre">OFPT_FLOW_REMOVED</span></code> / <code class="docutils literal"><span class="pre">NXT_FLOW_REMOVED</span></code></span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="78%" />
<col width="13%" />
<col width="9%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">message and reason code</th>
<th class="head">other</th>
<th class="head">slave</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">OFPRR_IDLE_TIMEOUT</span></code></td>
<td>yes</td>
<td>&#8212;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">OFPRR_HARD_TIMEOUT</span></code></td>
<td>yes</td>
<td>&#8212;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">OFPRR_DELETE</span></code></td>
<td>yes</td>
<td>&#8212;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">OFPRR_GROUP_DELETE</span></code> (OF1.4+)</td>
<td>yes</td>
<td>&#8212;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">OFPRR_METER_DELETE</span></code> (OF1.4+)</td>
<td>yes</td>
<td>&#8212;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">OFPRR_EVICTION</span></code> (OF1.4+)</td>
<td>yes</td>
<td>&#8212;</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id3">
<caption><span class="caption-text"><code class="docutils literal"><span class="pre">OFPT_PORT_STATUS</span></code></span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="78%" />
<col width="13%" />
<col width="9%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">message and reason code</th>
<th class="head">other</th>
<th class="head">slave</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">OFPPR_ADD</span></code></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">OFPPR_DELETE</span></code></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">OFPPR_MODIFY</span></code></td>
<td>yes</td>
<td>yes</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id4">
<caption><span class="caption-text"><code class="docutils literal"><span class="pre">OFPT_ROLE_REQUEST</span></code> / <code class="docutils literal"><span class="pre">OFPT_ROLE_REPLY</span></code> (OF1.4+)</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="78%" />
<col width="13%" />
<col width="9%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">message and reason code</th>
<th class="head">other</th>
<th class="head">slave</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">OFPCRR_MASTER_REQUEST</span></code></td>
<td>&#8212;</td>
<td>&#8212;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">OFPCRR_CONFIG</span></code></td>
<td>&#8212;</td>
<td>&#8212;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">OFPCRR_EXPERIMENTER</span></code></td>
<td>&#8212;</td>
<td>&#8212;</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id5">
<caption><span class="caption-text"><code class="docutils literal"><span class="pre">OFPT_TABLE_STATUS</span></code> (OF1.4+)</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="78%" />
<col width="13%" />
<col width="9%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">message and reason code</th>
<th class="head">other</th>
<th class="head">slave</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">OFPTR_VACANCY_DOWN</span></code></td>
<td>&#8212;</td>
<td>&#8212;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">OFPTR_VACANCY_UP</span></code></td>
<td>&#8212;</td>
<td>&#8212;</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id6">
<caption><span class="caption-text"><code class="docutils literal"><span class="pre">OFPT_REQUESTFORWARD</span></code> (OF1.4+)</span><a class="headerlink" href="#id6" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="78%" />
<col width="13%" />
<col width="9%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">message and reason code</th>
<th class="head">other</th>
<th class="head">slave</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">OFPRFR_GROUP_MOD</span></code></td>
<td>&#8212;</td>
<td>&#8212;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">OFPRFR_METER_MOD</span></code></td>
<td>&#8212;</td>
<td>&#8212;</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal"><span class="pre">NXT_SET_ASYNC_CONFIG</span></code> message directly sets all of the values in this
table for the current connection.  The <code class="docutils literal"><span class="pre">OFPC_INVALID_TTL_TO_CONTROLLER</span></code> bit
in the <code class="docutils literal"><span class="pre">OFPT_SET_CONFIG</span></code> message controls the setting for
<code class="docutils literal"><span class="pre">OFPR_INVALID_TTL</span></code> for the &#8220;master&#8221; role.</p>
</div>
<div class="section" id="ofpat-enqueue">
<h5><code class="docutils literal"><span class="pre">OFPAT_ENQUEUE</span></code><a class="headerlink" href="#ofpat-enqueue" title="Permalink to this headline">¶</a></h5>
<p>The OpenFlow 1.0 specification requires the output port of the
<code class="docutils literal"><span class="pre">OFPAT_ENQUEUE</span></code> action to &#8220;refer to a valid physical port (i.e. &lt;
<code class="docutils literal"><span class="pre">OFPP_MAX</span></code>) or <code class="docutils literal"><span class="pre">OFPP_IN_PORT</span></code>&#8221;.  Although <code class="docutils literal"><span class="pre">OFPP_LOCAL</span></code> is not less than
<code class="docutils literal"><span class="pre">OFPP_MAX</span></code>, it is an &#8216;internal&#8217; port which can have QoS applied to it in
Linux.  Since we allow the <code class="docutils literal"><span class="pre">OFPAT_ENQUEUE</span></code> to apply to &#8216;internal&#8217; ports whose
port numbers are less than <code class="docutils literal"><span class="pre">OFPP_MAX</span></code>, we interpret <code class="docutils literal"><span class="pre">OFPP_LOCAL</span></code> as a
physical port and support <code class="docutils literal"><span class="pre">OFPAT_ENQUEUE</span></code> on it as well.</p>
</div>
<div class="section" id="ofpt-flow-mod">
<h5><code class="docutils literal"><span class="pre">OFPT_FLOW_MOD</span></code><a class="headerlink" href="#ofpt-flow-mod" title="Permalink to this headline">¶</a></h5>
<p>The OpenFlow specification for the behavior of <code class="docutils literal"><span class="pre">OFPT_FLOW_MOD</span></code> is confusing.
The following tables summarize the Open vSwitch implementation of its behavior
in the following categories:</p>
<dl class="docutils">
<dt>&#8220;match on priority&#8221;</dt>
<dd>Whether the <code class="docutils literal"><span class="pre">flow_mod</span></code> acts only on flows whose priority matches that
included in the <code class="docutils literal"><span class="pre">flow_mod</span></code> message.</dd>
<dt>&#8220;match on out_port&#8221;</dt>
<dd>Whether the <code class="docutils literal"><span class="pre">flow_mod</span></code> acts only on flows that output to the out_port
included in the flow_mod message (if out_port is not <code class="docutils literal"><span class="pre">OFPP_NONE</span></code>).
OpenFlow 1.1 and later have a similar feature (not listed separately here)
for <code class="docutils literal"><span class="pre">out_group</span></code>.</dd>
<dt>&#8220;match on flow_cookie&#8221;:</dt>
<dd>Whether the <code class="docutils literal"><span class="pre">flow_mod</span></code> acts only on flows whose <code class="docutils literal"><span class="pre">flow_cookie</span></code> matches an
optional controller-specified value and mask.</dd>
<dt>&#8220;updates flow_cookie&#8221;:</dt>
<dd>Whether the <code class="docutils literal"><span class="pre">flow_mod</span></code> changes the <code class="docutils literal"><span class="pre">flow_cookie</span></code> of the flow or flows
that it matches to the <code class="docutils literal"><span class="pre">flow_cookie</span></code> included in the flow_mod message.</dd>
<dt>&#8220;updates <code class="docutils literal"><span class="pre">OFPFF_</span></code> flags&#8221;:</dt>
<dd>Whether the flow_mod changes the <code class="docutils literal"><span class="pre">OFPFF_SEND_FLOW_REM</span></code> flag of the flow or
flows that it matches to the setting included in the flags of the flow_mod
message.</dd>
<dt>&#8220;honors <code class="docutils literal"><span class="pre">OFPFF_CHECK_OVERLAP</span></code>&#8221;:</dt>
<dd>Whether the <code class="docutils literal"><span class="pre">OFPFF_CHECK_OVERLAP</span></code> flag in the flow_mod is significant.</dd>
<dt>&#8220;updates <code class="docutils literal"><span class="pre">idle_timeout</span></code>&#8221; and &#8220;updates <code class="docutils literal"><span class="pre">hard_timeout</span></code>&#8221;:</dt>
<dd>Whether the <code class="docutils literal"><span class="pre">idle_timeout</span></code> and hard_timeout in the <code class="docutils literal"><span class="pre">flow_mod</span></code>,
respectively, have an effect on the flow or flows matched by the
<code class="docutils literal"><span class="pre">flow_mod</span></code>.</dd>
<dt>&#8220;updates idle timer&#8221;:</dt>
<dd>Whether the <code class="docutils literal"><span class="pre">flow_mod</span></code> resets the per-flow timer that measures how long a
flow has been idle.</dd>
<dt>&#8220;updates hard timer&#8221;:</dt>
<dd>Whether the <code class="docutils literal"><span class="pre">flow_mod</span></code> resets the per-flow timer that measures how long it
has been since a flow was modified.</dd>
<dt>&#8220;zeros counters&#8221;:</dt>
<dd>Whether the <code class="docutils literal"><span class="pre">flow_mod</span></code> resets per-flow packet and byte counters to zero.</dd>
<dt>&#8220;may add a new flow&#8221;:</dt>
<dd>Whether the <code class="docutils literal"><span class="pre">flow_mod</span></code> may add a new flow to the flow table.  (Obviously
this is always true for &#8220;add&#8221; commands but in some OpenFlow versions &#8220;modify&#8221;
and &#8220;modify-strict&#8221; can also add new flows.)</dd>
<dt>&#8220;sends <code class="docutils literal"><span class="pre">flow_removed</span></code> message&#8221;:</dt>
<dd>Whether the flow_mod generates a flow_removed message for the flow or flows
that it affects.</dd>
</dl>
<p>An entry labeled <code class="docutils literal"><span class="pre">yes</span></code> means that the flow mod type does have the indicated
behavior, <code class="docutils literal"><span class="pre">---</span></code> means that it does not, an empty cell means that the property
is not applicable, and other values are explained below the table.</p>
<div class="section" id="openflow-1-0">
<h6>OpenFlow 1.0<a class="headerlink" href="#openflow-1-0" title="Permalink to this headline">¶</a></h6>
<table border="1" class="docutils">
<colgroup>
<col width="54%" />
<col width="5%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">RULE</th>
<th class="head">ADD</th>
<th class="head">MODIFY</th>
<th class="head">STRICT</th>
<th class="head">DELETE</th>
<th class="head">STRICT</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>match on <code class="docutils literal"><span class="pre">priority</span></code></td>
<td>yes</td>
<td>&#8212;</td>
<td>yes</td>
<td>&#8212;</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td>match on <code class="docutils literal"><span class="pre">out_port</span></code></td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="row-even"><td>match on <code class="docutils literal"><span class="pre">flow_cookie</span></code></td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
</tr>
<tr class="row-odd"><td>match on <code class="docutils literal"><span class="pre">table_id</span></code></td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
</tr>
<tr class="row-even"><td>controller chooses <code class="docutils literal"><span class="pre">table_id</span></code></td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>updates <code class="docutils literal"><span class="pre">flow_cookie</span></code></td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>updates <code class="docutils literal"><span class="pre">OFPFF_SEND_FLOW_REM</span></code></td>
<td>yes</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>honors <code class="docutils literal"><span class="pre">OFPFF_CHECK_OVERLAP</span></code></td>
<td>yes</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>updates <code class="docutils literal"><span class="pre">idle_timeout</span></code></td>
<td>yes</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>updates <code class="docutils literal"><span class="pre">hard_timeout</span></code></td>
<td>yes</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>resets idle timer</td>
<td>yes</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>resets hard timer</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>zeros counters</td>
<td>yes</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>may add a new flow</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>sends <code class="docutils literal"><span class="pre">flow_removed</span></code> message</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>%</td>
<td>%</td>
</tr>
</tbody>
</table>
<p>where:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">+</span></code></dt>
<dd>&#8220;modify&#8221; and &#8220;modify-strict&#8221; only take these actions when they create a new
flow, not when they update an existing flow.</dd>
<dt><code class="docutils literal"><span class="pre">%</span></code></dt>
<dd>&#8220;delete&#8221; and &#8220;delete_strict&#8221; generates a flow_removed message if the deleted
flow or flows have the <code class="docutils literal"><span class="pre">OFPFF_SEND_FLOW_REM</span></code> flag set.  (Each controller
can separately control whether it wants to receive the generated messages.)</dd>
</dl>
</div>
<div class="section" id="openflow-1-1">
<h6>OpenFlow 1.1<a class="headerlink" href="#openflow-1-1" title="Permalink to this headline">¶</a></h6>
<p>OpenFlow 1.1 makes these changes:</p>
<ul class="simple">
<li>The controller now must specify the <code class="docutils literal"><span class="pre">table_id</span></code> of the flow match searched
and into which a flow may be inserted.  Behavior for a <code class="docutils literal"><span class="pre">table_id</span></code> of 255 is
undefined.</li>
<li>A <code class="docutils literal"><span class="pre">flow_mod</span></code>, except an &#8220;add&#8221;, can now match on the <code class="docutils literal"><span class="pre">flow_cookie</span></code>.</li>
<li>When a <code class="docutils literal"><span class="pre">flow_mod</span></code> matches on the <code class="docutils literal"><span class="pre">flow_cookie</span></code>, &#8220;modify&#8221; and
&#8220;modify-strict&#8221; never insert a new flow.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="54%" />
<col width="5%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">RULE</th>
<th class="head">ADD</th>
<th class="head">MODIFY</th>
<th class="head">STRICT</th>
<th class="head">DELETE</th>
<th class="head">STRICT</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>match on <code class="docutils literal"><span class="pre">priority</span></code></td>
<td>yes</td>
<td>&#8212;</td>
<td>yes</td>
<td>&#8212;</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td>match on <code class="docutils literal"><span class="pre">out_port</span></code></td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="row-even"><td>match on <code class="docutils literal"><span class="pre">flow_cookie</span></code></td>
<td>&#8212;</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td>match on <code class="docutils literal"><span class="pre">table_id</span></code></td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="row-even"><td>controller chooses <code class="docutils literal"><span class="pre">table_id</span></code></td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>updates <code class="docutils literal"><span class="pre">flow_cookie</span></code></td>
<td>yes</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>updates <code class="docutils literal"><span class="pre">OFPFF_SEND_FLOW_REM</span></code></td>
<td>yes</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>honors <code class="docutils literal"><span class="pre">OFPFF_CHECK_OVERLAP</span></code></td>
<td>yes</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>updates <code class="docutils literal"><span class="pre">idle_timeout</span></code></td>
<td>yes</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>updates <code class="docutils literal"><span class="pre">hard_timeout</span></code></td>
<td>yes</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>resets idle timer</td>
<td>yes</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>resets hard timer</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>zeros counters</td>
<td>yes</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>may add a new flow</td>
<td>yes</td>
<td>#</td>
<td>#</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>sends <code class="docutils literal"><span class="pre">flow_removed</span></code> message</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>%</td>
<td>%</td>
</tr>
</tbody>
</table>
<p>where:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">+</span></code></dt>
<dd>&#8220;modify&#8221; and &#8220;modify-strict&#8221; only take these actions when they create a new
flow, not when they update an existing flow.</dd>
<dt><code class="docutils literal"><span class="pre">%</span></code></dt>
<dd>&#8220;delete&#8221; and &#8220;delete_strict&#8221; generates a flow_removed message if the deleted
flow or flows have the <code class="docutils literal"><span class="pre">OFPFF_SEND_FLOW_REM</span></code> flag set.  (Each controller
can separately control whether it wants to receive the generated messages.)</dd>
<dt><code class="docutils literal"><span class="pre">#</span></code></dt>
<dd>&#8220;modify&#8221; and &#8220;modify-strict&#8221; only add a new flow if the flow_mod does not
match on any bits of the flow cookie</dd>
</dl>
</div>
<div class="section" id="openflow-1-2">
<h6>OpenFlow 1.2<a class="headerlink" href="#openflow-1-2" title="Permalink to this headline">¶</a></h6>
<p>OpenFlow 1.2 makes these changes:</p>
<ul class="simple">
<li>Only &#8220;add&#8221; commands ever add flows, &#8220;modify&#8221; and &#8220;modify-strict&#8221; never do.</li>
<li>A new flag <code class="docutils literal"><span class="pre">OFPFF_RESET_COUNTS</span></code> now controls whether &#8220;modify&#8221; and
&#8220;modify-strict&#8221; reset counters, whereas previously they never reset counters
(except when they inserted a new flow).</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="54%" />
<col width="5%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">RULE</th>
<th class="head">ADD</th>
<th class="head">MODIFY</th>
<th class="head">STRICT</th>
<th class="head">DELETE</th>
<th class="head">STRICT</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>match on <code class="docutils literal"><span class="pre">priority</span></code></td>
<td>yes</td>
<td>&#8212;</td>
<td>yes</td>
<td>&#8212;</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td>match on <code class="docutils literal"><span class="pre">out_port</span></code></td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="row-even"><td>match on <code class="docutils literal"><span class="pre">flow_cookie</span></code></td>
<td>&#8212;</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td>match on <code class="docutils literal"><span class="pre">table_id</span></code></td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="row-even"><td>controller chooses <code class="docutils literal"><span class="pre">table_id</span></code></td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>updates <code class="docutils literal"><span class="pre">flow_cookie</span></code></td>
<td>yes</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>updates <code class="docutils literal"><span class="pre">OFPFF_SEND_FLOW_REM</span></code></td>
<td>yes</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>honors <code class="docutils literal"><span class="pre">OFPFF_CHECK_OVERLAP</span></code></td>
<td>yes</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>updates <code class="docutils literal"><span class="pre">idle_timeout</span></code></td>
<td>yes</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>updates <code class="docutils literal"><span class="pre">hard_timeout</span></code></td>
<td>yes</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>resets idle timer</td>
<td>yes</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>resets hard timer</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>zeros counters</td>
<td>yes</td>
<td>&amp;</td>
<td>&amp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>may add a new flow</td>
<td>yes</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>sends <code class="docutils literal"><span class="pre">flow_removed</span></code> message</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>%</td>
<td>%</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">%</span></code></dt>
<dd>&#8220;delete&#8221; and &#8220;delete_strict&#8221; generates a flow_removed message if the deleted
flow or flows have the <code class="docutils literal"><span class="pre">OFPFF_SEND_FLOW_REM</span></code> flag set.  (Each controller
can separately control whether it wants to receive the generated messages.)</dd>
<dt><code class="docutils literal"><span class="pre">&amp;</span></code></dt>
<dd>&#8220;modify&#8221; and &#8220;modify-strict&#8221; reset counters if the <code class="docutils literal"><span class="pre">OFPFF_RESET_COUNTS</span></code>
flag is specified.</dd>
</dl>
</div>
<div class="section" id="openflow-1-3">
<h6>OpenFlow 1.3<a class="headerlink" href="#openflow-1-3" title="Permalink to this headline">¶</a></h6>
<p>OpenFlow 1.3 makes these changes:</p>
<ul class="simple">
<li>Behavior for a table_id of 255 is now defined, for &#8220;delete&#8221; and
&#8220;delete-strict&#8221; commands, as meaning to delete from all tables.  A table_id
of 255 is now explicitly invalid for other commands.</li>
<li>New flags <code class="docutils literal"><span class="pre">OFPFF_NO_PKT_COUNTS</span></code> and <code class="docutils literal"><span class="pre">OFPFF_NO_BYT_COUNTS</span></code> for &#8220;add&#8221;
operations.</li>
</ul>
<p>The table for 1.3 is the same as the one shown above for 1.2.</p>
</div>
<div class="section" id="openflow-1-4">
<h6>OpenFlow 1.4<a class="headerlink" href="#openflow-1-4" title="Permalink to this headline">¶</a></h6>
<p>OpenFlow 1.4 makes these changes:</p>
<ul class="simple">
<li>Adds the &#8220;importance&#8221; field to <code class="docutils literal"><span class="pre">flow_mods</span></code>, but it does not explicitly
specify which kinds of <code class="docutils literal"><span class="pre">flow_mods</span></code> set the importance.  For consistency,
Open vSwitch uses the same rule for importance as for <code class="docutils literal"><span class="pre">idle_timeout</span></code> and
<code class="docutils literal"><span class="pre">hard_timeout</span></code>, that is, only an &#8220;ADD&#8221; flow_mod sets the importance.  (This
issue has been filed with the ONF as EXT-496.)</li>
</ul>
<ul class="simple">
<li>Eviction Mechanism to automatically delete entries of lower importance to
make space for newer entries.</li>
</ul>
</div>
</div>
<div class="section" id="openflow-1-4-bundles">
<h5>OpenFlow 1.4 Bundles<a class="headerlink" href="#openflow-1-4-bundles" title="Permalink to this headline">¶</a></h5>
<p>Open vSwitch makes all flow table modifications atomically, i.e., any datapath
packet only sees flow table configurations either before or after any change
made by any <code class="docutils literal"><span class="pre">flow_mod</span></code>.  For example, if a controller removes all flows with
a single OpenFlow <code class="docutils literal"><span class="pre">flow_mod</span></code>, no packet sees an intermediate version of the
OpenFlow pipeline where only some of the flows have been deleted.</p>
<p>It should be noted that Open vSwitch caches datapath flows, and that the cached
flows are <em>NOT</em> flushed immediately when a flow table changes.  Instead, the
datapath flows are revalidated against the new flow table as soon as possible,
and usually within one second of the modification.  This design amortizes the
cost of datapath cache flushing across multiple flow table changes, and has a
significant performance effect during simultaneous heavy flow table churn and
high traffic load.  This means that different cached datapath flows may have
been computed based on a different flow table configurations, but each of the
datapath flows is guaranteed to have been computed over a coherent view of the
flow tables, as described above.</p>
<p>With OpenFlow 1.4 bundles this atomicity can be extended across an arbitrary
set of <code class="docutils literal"><span class="pre">flow_mod</span></code>.  Bundles are supported for <code class="docutils literal"><span class="pre">flow_mod</span></code> and port_mod
messages only.  For <code class="docutils literal"><span class="pre">flow_mod</span></code>, both <code class="docutils literal"><span class="pre">atomic</span></code> and <code class="docutils literal"><span class="pre">ordered</span></code> bundle flags
are trivially supported, as all bundled messages are executed in the order they
were added and all flow table modifications are now atomic to the datapath.
Port mods may not appear in atomic bundles, as port status modifications are
not atomic.</p>
<p>To support bundles, ovs-ofctl has a <code class="docutils literal"><span class="pre">--bundle</span></code> option that makes the
flow mod commands (<code class="docutils literal"><span class="pre">add-flow</span></code>, <code class="docutils literal"><span class="pre">add-flows</span></code>, <code class="docutils literal"><span class="pre">mod-flows</span></code>, <code class="docutils literal"><span class="pre">del-flows</span></code>,
and <code class="docutils literal"><span class="pre">replace-flows</span></code>) use an OpenFlow 1.4 bundle to operate the
modifications as a single atomic transaction.  If any of the flow mods
in a transaction fail, none of them are executed.  All flow mods in a
bundle appear to datapath lookups simultaneously.</p>
<p>Furthermore, ovs-ofctl <code class="docutils literal"><span class="pre">add-flow</span></code> and <code class="docutils literal"><span class="pre">add-flows</span></code> commands now accept
arbitrary flow mods as an input by allowing the flow specification to
start with an explicit <code class="docutils literal"><span class="pre">add</span></code>, <code class="docutils literal"><span class="pre">modify</span></code>, <code class="docutils literal"><span class="pre">modify_strict</span></code>, <code class="docutils literal"><span class="pre">delete</span></code>, or
<code class="docutils literal"><span class="pre">delete_strict</span></code> keyword.  A missing keyword is treated as <code class="docutils literal"><span class="pre">add</span></code>, so
this is fully backwards compatible.  With the new <code class="docutils literal"><span class="pre">--bundle</span></code> option
all the flow mods are executed as a single atomic transaction using an
OpenFlow 1.4 bundle.  Without the <code class="docutils literal"><span class="pre">--bundle</span></code> option the flow mods are
executed in order up to the first failing <code class="docutils literal"><span class="pre">flow_mod</span></code>, and in case of an
error the earlier successful <code class="docutils literal"><span class="pre">flow_mod</span></code> calls are not rolled back.</p>
</div>
<div class="section" id="ofpt-packet-in">
<h5><code class="docutils literal"><span class="pre">OFPT_PACKET_IN</span></code><a class="headerlink" href="#ofpt-packet-in" title="Permalink to this headline">¶</a></h5>
<p>The OpenFlow 1.1 specification for <code class="docutils literal"><span class="pre">OFPT_PACKET_IN</span></code> is confusing.  The
definition in OF1.1 <code class="docutils literal"><span class="pre">openflow.h</span></code> is[*]:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>/* Packet received on port (datapath -&gt; controller). */
struct ofp_packet_in {
    struct ofp_header header;
    uint32_t buffer_id;     /* ID assigned by datapath. */
    uint32_t in_port;       /* Port on which frame was received. */
    uint32_t in_phy_port;   /* Physical Port on which frame was received. */
    uint16_t total_len;     /* Full length of frame. */
    uint8_t reason;         /* Reason packet is being sent (one of OFPR_*) */
    uint8_t table_id;       /* ID of the table that was looked up */
    uint8_t data[0];        /* Ethernet frame, halfway through 32-bit word,
                               so the IP header is 32-bit aligned.  The
                               amount of data is inferred from the length
                               field in the header.  Because of padding,
                               offsetof(struct ofp_packet_in, data) ==
                               sizeof(struct ofp_packet_in) - 2. */
};
OFP_ASSERT(sizeof(struct ofp_packet_in) == 24);
</pre></div>
</div>
<p>The confusing part is the comment on the <code class="docutils literal"><span class="pre">data[]</span></code> member.  This comment is a
leftover from OF1.0 <code class="docutils literal"><span class="pre">openflow.h</span></code>, in which the comment was correct:
<code class="docutils literal"><span class="pre">sizeof(struct</span> <span class="pre">ofp_packet_in)</span></code> is 20 in OF1.0 and <code class="docutils literal"><span class="pre">ffsetof(struct</span>
<span class="pre">ofp_packet_in,</span> <span class="pre">data)</span></code> is 18.  When OF1.1 was written, the structure members
were changed but the comment was carelessly not updated, and the comment became
wrong: <code class="docutils literal"><span class="pre">sizeof(struct</span> <span class="pre">ofp_packet_in)</span></code> and offsetof(struct ofp_packet_in,
data) are both 24 in OF1.1.</p>
<p>That leaves the question of how to implement <code class="docutils literal"><span class="pre">ofp_packet_in</span></code> in OF1.1.  The
OpenFlow reference implementation for OF1.1 does not include any padding, that
is, the first byte of the encapsulated frame immediately follows the
<code class="docutils literal"><span class="pre">table_id</span></code> member without a gap.  Open vSwitch therefore implements it the
same way for compatibility.</p>
<p>For an earlier discussion, please see the thread archived at:
<a class="reference external" href="https://mailman.stanford.edu/pipermail/openflow-discuss/2011-August/002604.html">https://mailman.stanford.edu/pipermail/openflow-discuss/2011-August/002604.html</a></p>
<p>[*] The quoted definition is directly from OF1.1.  Definitions used inside OVS
omit the 8-byte <code class="docutils literal"><span class="pre">ofp_header</span></code> members, so the sizes in this discussion are
8 bytes larger than those declared in OVS header files.</p>
</div>
<div class="section" id="vlan-matching">
<h5>VLAN Matching<a class="headerlink" href="#vlan-matching" title="Permalink to this headline">¶</a></h5>
<p>The 802.1Q VLAN header causes more trouble than any other 4 bytes in
networking.  More specifically, three versions of OpenFlow and Open vSwitch
have among them four different ways to match the contents and presence of the
VLAN header.  The following table describes how each version works.</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="19%" />
<col width="22%" />
<col width="22%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Match</th>
<th class="head">NXM</th>
<th class="head">OF1.0</th>
<th class="head">OF1.1</th>
<th class="head">OF1.2</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">[1]</span></code></td>
<td><code class="docutils literal"><span class="pre">0000/0000</span></code></td>
<td><code class="docutils literal"><span class="pre">????/1,??/?</span></code></td>
<td><code class="docutils literal"><span class="pre">????/1,??/?</span></code></td>
<td><code class="docutils literal"><span class="pre">0000/0000,--</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">[2]</span></code></td>
<td><code class="docutils literal"><span class="pre">0000/ffff</span></code></td>
<td><code class="docutils literal"><span class="pre">ffff/0,??/?</span></code></td>
<td><code class="docutils literal"><span class="pre">ffff/0,??/?</span></code></td>
<td><code class="docutils literal"><span class="pre">0000/ffff,--</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">[3]</span></code></td>
<td><code class="docutils literal"><span class="pre">1xxx/1fff</span></code></td>
<td><code class="docutils literal"><span class="pre">0xxx/0,??/1</span></code></td>
<td><code class="docutils literal"><span class="pre">0xxx/0,??/1</span></code></td>
<td><code class="docutils literal"><span class="pre">1xxx/ffff,--</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">[4]</span></code></td>
<td><code class="docutils literal"><span class="pre">z000/f000</span></code></td>
<td><code class="docutils literal"><span class="pre">????/1,0y/0</span></code></td>
<td><code class="docutils literal"><span class="pre">fffe/0,0y/0</span></code></td>
<td><code class="docutils literal"><span class="pre">1000/1000,0y</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">[5]</span></code></td>
<td><code class="docutils literal"><span class="pre">zxxx/ffff</span></code></td>
<td><code class="docutils literal"><span class="pre">0xxx/0,0y/0</span></code></td>
<td><code class="docutils literal"><span class="pre">0xxx/0,0y/0</span></code></td>
<td><code class="docutils literal"><span class="pre">1xxx/ffff,0y</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">[6]</span></code></td>
<td><code class="docutils literal"><span class="pre">0000/0fff</span></code></td>
<td><code class="docutils literal"><span class="pre">&lt;none&gt;</span></code></td>
<td><code class="docutils literal"><span class="pre">&lt;none&gt;</span></code></td>
<td><code class="docutils literal"><span class="pre">&lt;none&gt;</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">[7]</span></code></td>
<td><code class="docutils literal"><span class="pre">0000/f000</span></code></td>
<td><code class="docutils literal"><span class="pre">&lt;none&gt;</span></code></td>
<td><code class="docutils literal"><span class="pre">&lt;none&gt;</span></code></td>
<td><code class="docutils literal"><span class="pre">&lt;none&gt;</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">[8]</span></code></td>
<td><code class="docutils literal"><span class="pre">0000/efff</span></code></td>
<td><code class="docutils literal"><span class="pre">&lt;none&gt;</span></code></td>
<td><code class="docutils literal"><span class="pre">&lt;none&gt;</span></code></td>
<td><code class="docutils literal"><span class="pre">&lt;none&gt;</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">[9]</span></code></td>
<td><code class="docutils literal"><span class="pre">1001/1001</span></code></td>
<td><code class="docutils literal"><span class="pre">&lt;none&gt;</span></code></td>
<td><code class="docutils literal"><span class="pre">&lt;none&gt;</span></code></td>
<td><code class="docutils literal"><span class="pre">1001/1001,--</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">[10]</span></code></td>
<td><code class="docutils literal"><span class="pre">3000/3000</span></code></td>
<td><code class="docutils literal"><span class="pre">&lt;none&gt;</span></code></td>
<td><code class="docutils literal"><span class="pre">&lt;none&gt;</span></code></td>
<td><code class="docutils literal"><span class="pre">&lt;none&gt;</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">[11]</span></code></td>
<td><code class="docutils literal"><span class="pre">1000/1000</span></code></td>
<td><code class="docutils literal"><span class="pre">&lt;none&gt;</span></code></td>
<td><code class="docutils literal"><span class="pre">fffe/0,??/1</span></code></td>
<td><code class="docutils literal"><span class="pre">1000/1000,--</span></code></td>
</tr>
</tbody>
</table>
<p>where:</p>
<dl class="docutils">
<dt>Match:</dt>
<dd>See the list below.</dd>
<dt>NXM:</dt>
<dd><code class="docutils literal"><span class="pre">xxxx/yyyy</span></code> means <code class="docutils literal"><span class="pre">NXM_OF_VLAN_TCI_W</span></code> with value <code class="docutils literal"><span class="pre">xxxx</span></code> and mask
<code class="docutils literal"><span class="pre">yyyy</span></code>.  A mask of <code class="docutils literal"><span class="pre">0000</span></code> is equivalent to omitting
<code class="docutils literal"><span class="pre">NXM_OF_VLAN_TCI(_W)</span></code>, a mask of <code class="docutils literal"><span class="pre">ffff</span></code> is equivalent to
<code class="docutils literal"><span class="pre">NXM_OF_VLAN_TCI</span></code>.</dd>
<dt>OF1.0, OF1.1:</dt>
<dd><code class="docutils literal"><span class="pre">wwww/x,yy/z</span></code> means <code class="docutils literal"><span class="pre">dl_vlan</span></code> <code class="docutils literal"><span class="pre">wwww</span></code>, <code class="docutils literal"><span class="pre">OFPFW_DL_VLAN</span></code> <code class="docutils literal"><span class="pre">x</span></code>,
<code class="docutils literal"><span class="pre">dl_vlan_pcp</span></code> <code class="docutils literal"><span class="pre">yy</span></code>, and <code class="docutils literal"><span class="pre">OFPFW_DL_VLAN_PCP</span></code> <code class="docutils literal"><span class="pre">z</span></code>.  If
<code class="docutils literal"><span class="pre">OFPFW_DL_VLAN</span></code> or <code class="docutils literal"><span class="pre">OFPFW_DL_VLAN_PCP</span></code> is 1, the corresponding field
value is wildcarded, otherwise it is matched.  <code class="docutils literal"><span class="pre">?</span></code> means that the given
bits are ignored (their conventional values are <code class="docutils literal"><span class="pre">0000/x,00/0</span></code> in OF1.0,
<code class="docutils literal"><span class="pre">0000/x,00/1</span></code> in OF1.1; <code class="docutils literal"><span class="pre">x</span></code> is never ignored).  <code class="docutils literal"><span class="pre">&lt;none&gt;</span></code> means that the
given match is not supported.</dd>
<dt>OF1.2:</dt>
<dd><code class="docutils literal"><span class="pre">xxxx/yyyy,zz</span></code> means <code class="docutils literal"><span class="pre">OXM_OF_VLAN_VID_W</span></code> with value <code class="docutils literal"><span class="pre">xxxx</span></code> and mask
<code class="docutils literal"><span class="pre">yyyy</span></code>, and <code class="docutils literal"><span class="pre">OXM_OF_VLAN_PCP</span></code> (which is not maskable) with value <code class="docutils literal"><span class="pre">zz</span></code>.
A mask of <code class="docutils literal"><span class="pre">0000</span></code> is equivalent to omitting <code class="docutils literal"><span class="pre">OXM_OF_VLAN_VID(_W)</span></code>, a mask
of <code class="docutils literal"><span class="pre">ffff</span></code> is equivalent to <code class="docutils literal"><span class="pre">OXM_OF_VLAN_VID</span></code>.  <code class="docutils literal"><span class="pre">--</span></code> means that
<code class="docutils literal"><span class="pre">OXM_OF_VLAN_PCP</span></code> is omitted.  <code class="docutils literal"><span class="pre">&lt;none&gt;</span></code> means that the given match is not
supported.</dd>
</dl>
<p>The matches are:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">[1]</span></code>:</dt>
<dd>Matches any packet, that is, one without an 802.1Q header or with an 802.1Q
header with any TCI value.</dd>
<dt><code class="docutils literal"><span class="pre">[2]</span></code></dt>
<dd><p class="first">Matches only packets without an 802.1Q header.</p>
<dl class="last docutils">
<dt>NXM:</dt>
<dd>Any match with <code class="docutils literal"><span class="pre">vlan_tci</span> <span class="pre">==</span> <span class="pre">0</span></code> and <code class="docutils literal"><span class="pre">(vlan_tci_mask</span> <span class="pre">&amp;</span> <span class="pre">0x1000)</span> <span class="pre">!=</span> <span class="pre">0</span></code> is
equivalent to the one listed in the table.</dd>
<dt>OF1.0:</dt>
<dd>The spec doesn&#8217;t define behavior if <code class="docutils literal"><span class="pre">dl_vlan</span></code> is set to <code class="docutils literal"><span class="pre">0xffff</span></code> and
<code class="docutils literal"><span class="pre">OFPFW_DL_VLAN_PCP</span></code> is not set.</dd>
<dt>OF1.1:</dt>
<dd>The spec says explicitly to ignore <code class="docutils literal"><span class="pre">dl_vlan_pcp</span></code> when <code class="docutils literal"><span class="pre">dl_vlan</span></code> is set
to <code class="docutils literal"><span class="pre">0xffff</span></code>.</dd>
<dt>OF1.2:</dt>
<dd>The spec doesn&#8217;t say what should happen if <code class="docutils literal"><span class="pre">vlan_vid</span> <span class="pre">==</span> <span class="pre">0</span></code> and
<code class="docutils literal"><span class="pre">(vlan_vid_mask</span> <span class="pre">&amp;</span> <span class="pre">0x1000)</span> <span class="pre">!=</span> <span class="pre">0</span></code> but <code class="docutils literal"><span class="pre">vlan_vid_mask</span> <span class="pre">!=</span> <span class="pre">0x1000</span></code>, but it
would be straightforward to also interpret as <code class="docutils literal"><span class="pre">[2]</span></code>.</dd>
</dl>
</dd>
<dt><code class="docutils literal"><span class="pre">[3]</span></code></dt>
<dd>Matches only packets that have an 802.1Q header with VID <code class="docutils literal"><span class="pre">xxx</span></code> (and any
PCP).</dd>
<dt><code class="docutils literal"><span class="pre">[4]</span></code></dt>
<dd><p class="first">Matches only packets that have an 802.1Q header with PCP <code class="docutils literal"><span class="pre">y</span></code> (and any VID).</p>
<dl class="last docutils">
<dt>NXM:</dt>
<dd><code class="docutils literal"><span class="pre">z</span></code> is <code class="docutils literal"><span class="pre">(y</span> <span class="pre">&lt;&lt;</span> <span class="pre">1)</span> <span class="pre">|</span> <span class="pre">1</span></code>.</dd>
<dt>OF1.0:</dt>
<dd>The spec isn&#8217;t very clear, but OVS implements it this way.</dd>
<dt>OF1.2:</dt>
<dd>Presumably other masks such that <code class="docutils literal"><span class="pre">(vlan_vid_mask</span> <span class="pre">&amp;</span> <span class="pre">0x1fff)</span> <span class="pre">==</span> <span class="pre">0x1000</span></code>
would also work, but the spec doesn&#8217;t define their behavior.</dd>
</dl>
</dd>
<dt><code class="docutils literal"><span class="pre">[5]</span></code></dt>
<dd><p class="first">Matches only packets that have an 802.1Q header with VID <code class="docutils literal"><span class="pre">xxx</span></code> and PCP
<code class="docutils literal"><span class="pre">y</span></code>.</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>NXM:</dt>
<dd><code class="docutils literal"><span class="pre">z</span></code> is <code class="docutils literal"><span class="pre">((y</span> <span class="pre">&lt;&lt;</span> <span class="pre">1)</span> <span class="pre">|</span> <span class="pre">1)</span></code>.</dd>
<dt>OF1.2:</dt>
<dd>Presumably other masks such that <code class="docutils literal"><span class="pre">(vlan_vid_mask</span> <span class="pre">&amp;</span> <span class="pre">0x1fff)</span> <span class="pre">==</span> <span class="pre">0x1fff</span></code>
would also work.</dd>
</dl>
</div></blockquote>
</dd>
<dt><code class="docutils literal"><span class="pre">[6]</span></code></dt>
<dd>Matches packets with no 802.1Q header or with an 802.1Q header with a VID of
0.  Only possible with NXM.</dd>
<dt><code class="docutils literal"><span class="pre">[7]</span></code></dt>
<dd>Matches packets with no 802.1Q header or with an 802.1Q header with a PCP of
0.  Only possible with NXM.</dd>
<dt><code class="docutils literal"><span class="pre">[8]</span></code></dt>
<dd>Matches packets with no 802.1Q header or with an 802.1Q header with both VID
and PCP of 0.  Only possible with NXM.</dd>
<dt><code class="docutils literal"><span class="pre">[9]</span></code></dt>
<dd>Matches only packets that have an 802.1Q header with an odd-numbered VID (and
any PCP).  Only possible with NXM and OF1.2.  (This is just an example; one
can match on any desired VID bit pattern.)</dd>
<dt><code class="docutils literal"><span class="pre">[10]</span></code></dt>
<dd>Matches only packets that have an 802.1Q header with an odd-numbered PCP (and
any VID).  Only possible with NXM.  (This is just an example; one can match
on any desired VID bit pattern.)</dd>
<dt><code class="docutils literal"><span class="pre">[11]</span></code></dt>
<dd>Matches any packet with an 802.1Q header, regardless of VID or PCP.</dd>
</dl>
<p>Additional notes:</p>
<dl class="docutils">
<dt>OF1.2:</dt>
<dd>The top three bits of <code class="docutils literal"><span class="pre">OXM_OF_VLAN_VID</span></code> are fixed to zero, so bits 13, 14,
and 15 in the masks listed in the table may be set to arbitrary values, as
long as the corresponding value bits are also zero.  The suggested <code class="docutils literal"><span class="pre">ffff</span></code>
mask for [2], [3], and [5] allows a shorter OXM representation (the mask is
omitted) than the minimal <code class="docutils literal"><span class="pre">1fff</span></code> mask.</dd>
</dl>
</div>
<div class="section" id="flow-cookies">
<h5>Flow Cookies<a class="headerlink" href="#flow-cookies" title="Permalink to this headline">¶</a></h5>
<p>OpenFlow 1.0 and later versions have the concept of a &#8220;flow cookie&#8221;, which is a
64-bit integer value attached to each flow.  The treatment of the flow cookie
has varied greatly across OpenFlow versions, however.</p>
<p>In OpenFlow 1.0:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">OFPFC_ADD</span></code> set the cookie in the flow that it added.</li>
<li><code class="docutils literal"><span class="pre">OFPFC_MODIFY</span></code> and <code class="docutils literal"><span class="pre">OFPFC_MODIFY_STRICT</span></code> updated the cookie for the flow
or flows that it modified.</li>
<li><code class="docutils literal"><span class="pre">OFPST_FLOW</span></code> messages included the flow cookie.</li>
<li><code class="docutils literal"><span class="pre">OFPT_FLOW_REMOVED</span></code> messages reported the cookie of the flow that was
removed.</li>
</ul>
<p>OpenFlow 1.1 made the following changes:</p>
<ul class="simple">
<li>Flow mod operations <code class="docutils literal"><span class="pre">OFPFC_MODIFY</span></code>, <code class="docutils literal"><span class="pre">OFPFC_MODIFY_STRICT</span></code>,
<code class="docutils literal"><span class="pre">OFPFC_DELETE</span></code>, and <code class="docutils literal"><span class="pre">OFPFC_DELETE_STRICT</span></code>, plus flow stats requests and
aggregate stats requests, gained the ability to match on flow cookies with an
arbitrary mask.</li>
<li><code class="docutils literal"><span class="pre">OFPFC_MODIFY</span></code> and <code class="docutils literal"><span class="pre">OFPFC_MODIFY_STRICT</span></code> were changed to add a new flow,
in the case of no match, only if the flow table modification operation did
not match on the cookie field.  (In OpenFlow 1.0, modify operations always
added a new flow when there was no match.)</li>
<li><code class="docutils literal"><span class="pre">OFPFC_MODIFY</span></code> and <code class="docutils literal"><span class="pre">OFPFC_MODIFY_STRICT</span></code> no longer updated flow cookies.</li>
</ul>
<p>OpenFlow 1.2 made the following changes:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">OFPC_MODIFY</span></code> and <code class="docutils literal"><span class="pre">OFPFC_MODIFY_STRICT</span></code> were changed to never add a new
flow, regardless of whether the flow cookie was used for matching.</li>
</ul>
<p>Open vSwitch support for OpenFlow 1.0 implements the OpenFlow 1.0 behavior with
the following extensions:</p>
<ul class="simple">
<li>An NXM extension field <code class="docutils literal"><span class="pre">NXM_NX_COOKIE(_W)</span></code> allows the NXM versions of
<code class="docutils literal"><span class="pre">OFPFC_MODIFY</span></code>, <code class="docutils literal"><span class="pre">OFPFC_MODIFY_STRICT</span></code>, <code class="docutils literal"><span class="pre">OFPFC_DELETE</span></code>, and
<code class="docutils literal"><span class="pre">OFPFC_DELETE_STRICT</span></code> <code class="docutils literal"><span class="pre">flow_mod</span></code> calls, plus flow stats requests and
aggregate stats requests, to match on flow cookies with arbitrary masks.
This is much like the equivalent OpenFlow 1.1 feature.</li>
<li>Like OpenFlow 1.1, <code class="docutils literal"><span class="pre">OFPC_MODIFY</span></code> and <code class="docutils literal"><span class="pre">OFPFC_MODIFY_STRICT</span></code> add a new flow
if there is no match and the mask is zero (or not given).</li>
<li>The <code class="docutils literal"><span class="pre">cookie</span></code> field in <code class="docutils literal"><span class="pre">OFPT_FLOW_MOD</span></code> and <code class="docutils literal"><span class="pre">NXT_FLOW_MOD</span></code> messages is
used as the cookie value for <code class="docutils literal"><span class="pre">OFPFC_ADD</span></code> commands, as described in OpenFlow
1.0.  For <code class="docutils literal"><span class="pre">OFPFC_MODIFY</span></code> and <code class="docutils literal"><span class="pre">OFPFC_MODIFY_STRICT</span></code> commands, the
<code class="docutils literal"><span class="pre">cookie</span></code> field is used as a new cookie for flows that match unless it is
<code class="docutils literal"><span class="pre">UINT64_MAX</span></code>, in which case the flow&#8217;s cookie is not updated.</li>
<li><code class="docutils literal"><span class="pre">NXT_PACKET_IN</span></code> (the Nicira extended version of <code class="docutils literal"><span class="pre">OFPT_PACKET_IN</span></code>) reports
the cookie of the rule that generated the packet, or all-1-bits if no rule
generated the packet.  (Older versions of OVS used all-0-bits instead of
all-1-bits.)</li>
</ul>
<p>The following table shows the handling of different protocols when receiving
<code class="docutils literal"><span class="pre">OFPFC_MODIFY</span></code> and <code class="docutils literal"><span class="pre">OFPFC_MODIFY_STRICT</span></code> messages.  A mask of 0 indicates
either an explicit mask of zero or an implicit one by not specifying the
<code class="docutils literal"><span class="pre">NXM_NX_COOKIE(_W)</span></code> field.</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="12%" />
<col width="12%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&nbsp;</th>
<th class="head">&nbsp;</th>
<th class="head">&nbsp;</th>
<th class="head">&nbsp;</th>
<th class="head">&nbsp;</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>OpenFlow 1.0</td>
<td>no</td>
<td>yes</td>
<td>(add on miss)</td>
<td>(add on miss)</td>
</tr>
<tr class="row-odd"><td>OpenFlow 1.1</td>
<td>yes</td>
<td>no</td>
<td>no</td>
<td>yes</td>
</tr>
<tr class="row-even"><td>OpenFlow 1.2</td>
<td>yes</td>
<td>no</td>
<td>no</td>
<td>no</td>
</tr>
<tr class="row-odd"><td>NXM</td>
<td>yes</td>
<td>yes*</td>
<td>no</td>
<td>yes</td>
</tr>
</tbody>
</table>
<p>* Updates the flow&#8217;s cookie unless the <code class="docutils literal"><span class="pre">cookie</span></code> field is <code class="docutils literal"><span class="pre">UINT64_MAX</span></code>.</p>
</div>
<div class="section" id="multiple-table-support">
<h5>Multiple Table Support<a class="headerlink" href="#multiple-table-support" title="Permalink to this headline">¶</a></h5>
<p>OpenFlow 1.0 has only rudimentary support for multiple flow tables.  Notably,
OpenFlow 1.0 does not allow the controller to specify the flow table to which a
flow is to be added.  Open vSwitch adds an extension for this purpose, which is
enabled on a per-OpenFlow connection basis using the <code class="docutils literal"><span class="pre">NXT_FLOW_MOD_TABLE_ID</span></code>
message.  When the extension is enabled, the upper 8 bits of the <code class="docutils literal"><span class="pre">command</span></code>
member in an <code class="docutils literal"><span class="pre">OFPT_FLOW_MOD</span></code> or <code class="docutils literal"><span class="pre">NXT_FLOW_MOD</span></code> message designates the table
to which a flow is to be added.</p>
<p>The Open vSwitch software switch implementation offers 255 flow tables.  On
packet ingress, only the first flow table (table 0) is searched, and the
contents of the remaining tables are not considered in any way.  Tables other
than table 0 only come into play when an <code class="docutils literal"><span class="pre">NXAST_RESUBMIT_TABLE</span></code> action
specifies another table to search.</p>
<p>Tables 128 and above are reserved for use by the switch itself.  Controllers
should use only tables 0 through 127.</p>
</div>
<div class="section" id="ofptc-table-configuration">
<h5><code class="docutils literal"><span class="pre">OFPTC_*</span></code> Table Configuration<a class="headerlink" href="#ofptc-table-configuration" title="Permalink to this headline">¶</a></h5>
<p>This section covers the history of the <code class="docutils literal"><span class="pre">OFPTC_*</span></code> table configuration bits
across OpenFlow versions.</p>
<p>OpenFlow 1.0 flow tables had fixed configurations.</p>
<p>OpenFlow 1.1 enabled controllers to configure behavior upon flow table miss and
added the <code class="docutils literal"><span class="pre">OFPTC_MISS_*</span></code> constants for that purpose.  <code class="docutils literal"><span class="pre">OFPTC_*</span></code> did not
control anything else but it was nevertheless conceptualized as a set of
bit-fields instead of an enum.  OF1.1 added the <code class="docutils literal"><span class="pre">OFPT_TABLE_MOD</span></code> message to
set <code class="docutils literal"><span class="pre">OFPTC_MISS_*</span></code> for a flow table and added the <code class="docutils literal"><span class="pre">config</span></code> field to the
<code class="docutils literal"><span class="pre">OFPST_TABLE</span></code> reply to report the current setting.</p>
<p>OpenFlow 1.2 did not change anything in this regard.</p>
<p>OpenFlow 1.3 switched to another means to changing flow table miss behavior and
deprecated <code class="docutils literal"><span class="pre">OFPTC_MISS_*</span></code> without adding any more <code class="docutils literal"><span class="pre">OFPTC_*</span></code> constants.
This meant that <code class="docutils literal"><span class="pre">OFPT_TABLE_MOD</span></code> now had no purpose at all, but OF1.3 kept it
around &#8220;for backward compatibility with older and newer versions of the
specification.&#8221;  At the same time, OF1.3 introduced a new message
OFPMP_TABLE_FEATURES that included a field <code class="docutils literal"><span class="pre">config</span></code> documented as reporting
the <code class="docutils literal"><span class="pre">OFPTC_*</span></code> values set with <code class="docutils literal"><span class="pre">OFPT_TABLE_MOD</span></code>; of course this served no
real purpose because no <code class="docutils literal"><span class="pre">OFPTC_*</span></code> values are defined.  OF1.3 did remove the
<code class="docutils literal"><span class="pre">OFPTC_*</span></code> field from <code class="docutils literal"><span class="pre">OFPMP_TABLE</span></code> (previously named <code class="docutils literal"><span class="pre">OFPST_TABLE</span></code>).</p>
<p>OpenFlow 1.4 defined two new <code class="docutils literal"><span class="pre">OFPTC_*</span></code> constants, <code class="docutils literal"><span class="pre">OFPTC_EVICTION</span></code> and
<code class="docutils literal"><span class="pre">OFPTC_VACANCY_EVENTS</span></code>, using bits that did not overlap with <code class="docutils literal"><span class="pre">OFPTC_MISS_*</span></code>
even though those bits had not been defined since OF1.2.  <code class="docutils literal"><span class="pre">OFPT_TABLE_MOD</span></code>
still controlled these settings.  The field for <code class="docutils literal"><span class="pre">OFPTC_*</span></code> values in
<code class="docutils literal"><span class="pre">OFPMP_TABLE_FEATURES</span></code> was renamed from <code class="docutils literal"><span class="pre">config</span></code> to <code class="docutils literal"><span class="pre">capabilities</span></code> and
documented as reporting the flags that are supported in a <code class="docutils literal"><span class="pre">OFPT_TABLE_MOD</span></code>
message.  The <code class="docutils literal"><span class="pre">OFPMP_TABLE_DESC</span></code> message newly added in OF1.4 reported the
<code class="docutils literal"><span class="pre">OFPTC_*</span></code> setting.</p>
<p>OpenFlow 1.5 did not change anything in this regard.</p>
<table border="1" class="docutils" id="id7">
<caption><span class="caption-text">Revisions</span><a class="headerlink" href="#id7" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="17%" />
<col width="17%" />
<col width="17%" />
<col width="17%" />
<col width="17%" />
<col width="17%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">OpenFlow</th>
<th class="head"><code class="docutils literal"><span class="pre">OFPTC_*</span></code> flags</th>
<th class="head"><code class="docutils literal"><span class="pre">TABLE_MOD</span></code></th>
<th class="head">Statistics</th>
<th class="head"><code class="docutils literal"><span class="pre">TABLE_FEATURES</span></code></th>
<th class="head"><code class="docutils literal"><span class="pre">TABLE_DESC</span></code></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>OF1.0</td>
<td>none</td>
<td>no (*)(+)</td>
<td>no (*)</td>
<td>nothing (*)(+)</td>
<td>no (*)(+)</td>
</tr>
<tr class="row-odd"><td>OF1.1/1.2</td>
<td><code class="docutils literal"><span class="pre">MISS_*</span></code></td>
<td>yes</td>
<td>yes</td>
<td>nothing (+)</td>
<td>no (+)</td>
</tr>
<tr class="row-even"><td>OF1.3</td>
<td>none</td>
<td>yes (*)</td>
<td>no (*)</td>
<td>config (*)</td>
<td>no (*)(+)</td>
</tr>
<tr class="row-odd"><td>OF1.4/1.5</td>
<td><code class="docutils literal"><span class="pre">EVICTION</span></code>/<code class="docutils literal"><span class="pre">VACANCY_EVENTS</span></code></td>
<td>yes</td>
<td>no</td>
<td>capabilities</td>
<td>yes</td>
</tr>
</tbody>
</table>
<p>where:</p>
<dl class="docutils">
<dt>OpenFlow:</dt>
<dd>The OpenFlow version(s).</dd>
<dt><code class="docutils literal"><span class="pre">OFPTC_*</span></code> flags:</dt>
<dd>The <code class="docutils literal"><span class="pre">OFPTC_*</span></code> flags defined in those versions.</dd>
<dt><code class="docutils literal"><span class="pre">TABLE_MOD</span></code>:</dt>
<dd>Whether <code class="docutils literal"><span class="pre">OFPT_TABLE_MOD</span></code> can modify <code class="docutils literal"><span class="pre">OFPTC_*</span></code> flags.</dd>
<dt>Statistics:</dt>
<dd>Whether <code class="docutils literal"><span class="pre">OFPST_TABLE/OFPMP_TABLE</span></code> reports the <code class="docutils literal"><span class="pre">OFPTC_*</span></code> flags.</dd>
<dt><code class="docutils literal"><span class="pre">TABLE_FEATURES</span></code>:</dt>
<dd>What <code class="docutils literal"><span class="pre">OFPMP_TABLE_FEATURES</span></code> reports (if it exists): either the current
configuration or the switch&#8217;s capabilities.</dd>
<dt><code class="docutils literal"><span class="pre">TABLE_DESC</span></code>:</dt>
<dd>Whether <code class="docutils literal"><span class="pre">OFPMP_TABLE_DESC</span></code> reports the current configuration.</dd>
</dl>
<p>(*): Nothing to report/change anyway.</p>
<p>(+): No such message.</p>
</div>
<div class="section" id="ipv6">
<h5>IPv6<a class="headerlink" href="#ipv6" title="Permalink to this headline">¶</a></h5>
<p>Open vSwitch supports stateless handling of IPv6 packets.  Flows can be written
to support matching TCP, UDP, and ICMPv6 headers within an IPv6 packet.  Deeper
matching of some Neighbor Discovery messages is also supported.</p>
<p>IPv6 was not designed to interact well with middle-boxes.  This, combined with
Open vSwitch&#8217;s stateless nature, have affected the processing of IPv6 traffic,
which is detailed below.</p>
<div class="section" id="extension-headers">
<h6>Extension Headers<a class="headerlink" href="#extension-headers" title="Permalink to this headline">¶</a></h6>
<p>The base IPv6 header is incredibly simple with the intention of only containing
information relevant for routing packets between two endpoints.  IPv6 relies
heavily on the use of extension headers to provide any other functionality.
Unfortunately, the extension headers were designed in such a way that it is
impossible to move to the next header (including the layer-4 payload) unless
the current header is understood.</p>
<p>Open vSwitch will process the following extension headers and continue to the
next header:</p>
<ul class="simple">
<li>Fragment (see the next section)</li>
<li>AH (Authentication Header)</li>
<li>Hop-by-Hop Options</li>
<li>Routing</li>
<li>Destination Options</li>
</ul>
<p>When a header is encountered that is not in that list, it is considered
&#8220;terminal&#8221;.  A terminal header&#8217;s IPv6 protocol value is stored in <code class="docutils literal"><span class="pre">nw_proto</span></code>
for matching purposes.  If a terminal header is TCP, UDP, or ICMPv6, the packet
will be further processed in an attempt to extract layer-4 information.</p>
</div>
<div class="section" id="fragments">
<h6>Fragments<a class="headerlink" href="#fragments" title="Permalink to this headline">¶</a></h6>
<p>IPv6 requires that every link in the internet have an MTU of 1280 octets or
greater (RFC 2460).  As such, a terminal header (as described above in
&#8220;Extension Headers&#8221;) in the first fragment should generally be reachable.  In
this case, the terminal header&#8217;s IPv6 protocol type is stored in the
<code class="docutils literal"><span class="pre">nw_proto</span></code> field for matching purposes.  If a terminal header cannot be found
in the first fragment (one with a fragment offset of zero), the <code class="docutils literal"><span class="pre">nw_proto</span></code>
field is set to 0.  Subsequent fragments (those with a non-zero fragment
offset) have the <code class="docutils literal"><span class="pre">nw_proto</span></code> field set to the IPv6 protocol type for fragments
(44).</p>
</div>
<div class="section" id="jumbograms">
<h6>Jumbograms<a class="headerlink" href="#jumbograms" title="Permalink to this headline">¶</a></h6>
<p>An IPv6 jumbogram (RFC 2675) is a packet containing a payload longer than
65,535 octets.  A jumbogram is only relevant in subnets with a link MTU greater
than 65,575 octets, and are not required to be supported on nodes that do not
connect to link with such large MTUs.  Currently, Open vSwitch doesn&#8217;t process
jumbograms.</p>
</div>
</div>
<div class="section" id="in-band-control">
<h5>In-Band Control<a class="headerlink" href="#in-band-control" title="Permalink to this headline">¶</a></h5>
<div class="section" id="motivation">
<h6>Motivation<a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h6>
<p>An OpenFlow switch must establish and maintain a TCP network connection to its
controller.  There are two basic ways to categorize the network that this
connection traverses: either it is completely separate from the one that the
switch is otherwise controlling, or its path may overlap the network that the
switch controls.  We call the former case &#8220;out-of-band control&#8221;, the latter
case &#8220;in-band control&#8221;.</p>
<p>Out-of-band control has the following benefits:</p>
<ul class="simple">
<li>Simplicity: Out-of-band control slightly simplifies the switch
implementation.</li>
<li>Reliability: Excessive switch traffic volume cannot interfere with control
traffic.</li>
<li>Integrity: Machines not on the control network cannot impersonate a switch or
a controller.</li>
<li>Confidentiality: Machines not on the control network cannot snoop on control
traffic.</li>
</ul>
<p>In-band control, on the other hand, has the following advantages:</p>
<ul class="simple">
<li>No dedicated port: There is no need to dedicate a physical switch port to
control, which is important on switches that have few ports (e.g. wireless
routers, low-end embedded platforms).</li>
<li>No dedicated network: There is no need to build and maintain a separate
control network.  This is important in many environments because it reduces
proliferation of switches and wiring.</li>
</ul>
<p>Open vSwitch supports both out-of-band and in-band control.  This section
describes the principles behind in-band control.  See the description of the
Controller table in ovs-vswitchd.conf.db(5) to configure OVS for in-band
control.</p>
</div>
<div class="section" id="principles">
<h6>Principles<a class="headerlink" href="#principles" title="Permalink to this headline">¶</a></h6>
<p>The fundamental principle of in-band control is that an OpenFlow switch must
recognize and switch control traffic without involving the OpenFlow controller.
All the details of implementing in-band control are special cases of this
principle.</p>
<p>The rationale for this principle is simple.  If the switch does not handle
in-band control traffic itself, then it will be caught in a contradiction: it
must contact the controller, but it cannot, because only the controller can set
up the flows that are needed to contact the controller.</p>
<p>The following points describe important special cases of this principle.</p>
<ul>
<li><p class="first">In-band control must be implemented regardless of whether the switch is
connected.</p>
<p>It is tempting to implement the in-band control rules only when the switch is
not connected to the controller, using the reasoning that the controller
should have complete control once it has established a connection with the
switch.</p>
<p>This does not work in practice.  Consider the case where the switch is
connected to the controller.  Occasionally it can happen that the controller
forgets or otherwise needs to obtain the MAC address of the switch.  To do
so, the controller sends a broadcast ARP request.  A switch that implements
the in-band control rules only when it is disconnected will then send an
<code class="docutils literal"><span class="pre">OFPT_PACKET_IN</span></code> message up to the controller.  The controller will be
unable to respond, because it does not know the MAC address of the switch.
This is a deadlock situation that can only be resolved by the switch noticing
that its connection to the controller has hung and reconnecting.</p>
</li>
<li><p class="first">In-band control must override flows set up by the controller.</p>
<p>It is reasonable to assume that flows set up by the OpenFlow controller
should take precedence over in-band control, on the basis that the controller
should be in charge of the switch.</p>
<p>Again, this does not work in practice.  Reasonable controller implementations
may set up a &#8220;last resort&#8221; fallback rule that wildcards every field and,
e.g., sends it up to the controller or discards it.  If a controller does
that, then it will isolate itself from the switch.</p>
</li>
<li><p class="first">The switch must recognize all control traffic.</p>
<p>The fundamental principle of in-band control states, in part, that a switch
must recognize control traffic without involving the OpenFlow controller.
More specifically, the switch must recognize <em>all</em> control traffic.  &#8220;False
negatives&#8221;, that is, packets that constitute control traffic but that the
switch does not recognize as control traffic, lead to control traffic storms.</p>
<p>Consider an OpenFlow switch that only recognizes control packets sent to or
from that switch.  Now suppose that two switches of this type, named A and B,
are connected to ports on an Ethernet hub (not a switch) and that an OpenFlow
controller is connected to a third hub port.  In this setup, control traffic
sent by switch A will be seen by switch B, which will send it to the
controller as part of an OFPT_PACKET_IN message.  Switch A will then see the
OFPT_PACKET_IN message&#8217;s packet, re-encapsulate it in another OFPT_PACKET_IN,
and send it to the controller.  Switch B will then see that OFPT_PACKET_IN,
and so on in an infinite loop.</p>
<p>Incidentally, the consequences of &#8220;false positives&#8221;, where packets that are
not control traffic are nevertheless recognized as control traffic, are much
less severe.  The controller will not be able to control their behavior, but
the network will remain in working order.  False positives do constitute a
security problem.</p>
</li>
<li><p class="first">The switch should use echo-requests to detect disconnection.</p>
<p>TCP will notice that a connection has hung, but this can take a considerable
amount of time.  For example, with default settings the Linux kernel TCP
implementation will retransmit for between 13 and 30 minutes, depending on
the connection&#8217;s retransmission timeout, according to kernel documentation.
This is far too long for a switch to be disconnected, so an OpenFlow switch
should implement its own connection timeout.  OpenFlow <code class="docutils literal"><span class="pre">OFPT_ECHO_REQUEST</span></code>
messages are the best way to do this, since they test the OpenFlow connection
itself.</p>
</li>
</ul>
</div>
<div class="section" id="implementation">
<h6>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h6>
<p>This section describes how Open vSwitch implements in-band control.  Correctly
implementing in-band control has proven difficult due to its many subtleties,
and has thus gone through many iterations.  Please read through and understand
the reasoning behind the chosen rules before making modifications.</p>
<p>Open vSwitch implements in-band control as &#8220;hidden&#8221; flows, that is, flows that
are not visible through OpenFlow, and at a higher priority than wildcarded
flows can be set up through OpenFlow.  This is done so that the OpenFlow
controller cannot interfere with them and possibly break connectivity with its
switches.  It is possible to see all flows, including in-band ones, with the
ovs-appctl &#8220;bridge/dump-flows&#8221; command.</p>
<p>The Open vSwitch implementation of in-band control can hide traffic to
arbitrary &#8220;remotes&#8221;, where each remote is one TCP port on one IP address.
Currently the remotes are automatically configured as the in-band OpenFlow
controllers plus the OVSDB managers, if any.  (The latter is a requirement
because OVSDB managers are responsible for configuring OpenFlow controllers, so
if the manager cannot be reached then OpenFlow cannot be reconfigured.)</p>
<p>The following rules (with the OFPP_NORMAL action) are set up on any bridge that
has any remotes:</p>
<ol class="loweralpha simple">
<li>DHCP requests sent from the local port.</li>
<li>ARP replies to the local port&#8217;s MAC address.</li>
<li>ARP requests from the local port&#8217;s MAC address.</li>
</ol>
<p>In-band also sets up the following rules for each unique next-hop MAC address
for the remotes&#8217; IPs (the &#8220;next hop&#8221; is either the remote itself, if it is on a
local subnet, or the gateway to reach the remote):</p>
<ol class="loweralpha simple" start="4">
<li>ARP replies to the next hop&#8217;s MAC address.</li>
<li>ARP requests from the next hop&#8217;s MAC address.</li>
</ol>
<p>In-band also sets up the following rules for each unique remote IP address:</p>
<ol class="loweralpha simple" start="6">
<li>ARP replies containing the remote&#8217;s IP address as a target.</li>
<li>ARP requests containing the remote&#8217;s IP address as a source.</li>
</ol>
<p>In-band also sets up the following rules for each unique remote (IP,port) pair:</p>
<ol class="loweralpha simple" start="8">
<li>TCP traffic to the remote&#8217;s IP and port.</li>
<li>TCP traffic from the remote&#8217;s IP and port.</li>
</ol>
<p>The goal of these rules is to be as narrow as possible to allow a switch to
join a network and be able to communicate with the remotes.  As mentioned
earlier, these rules have higher priority than the controller&#8217;s rules, so if
they are too broad, they may prevent the controller from implementing its
policy.  As such, in-band actively monitors some aspects of flow and packet
processing so that the rules can be made more precise.</p>
<p>In-band control monitors attempts to add flows into the datapath that could
interfere with its duties.  The datapath only allows exact match entries, so
in-band control is able to be very precise about the flows it prevents.  Flows
that miss in the datapath are sent to userspace to be processed, so preventing
these flows from being cached in the &#8220;fast path&#8221; does not affect correctness.
The only type of flow that is currently prevented is one that would prevent
DHCP replies from being seen by the local port.  For example, a rule that
forwarded all DHCP traffic to the controller would not be allowed, but one that
forwarded to all ports (including the local port) would.</p>
<p>As mentioned earlier, packets that miss in the datapath are sent to the
userspace for processing.  The userspace has its own flow table, the
&#8220;classifier&#8221;, so in-band checks whether any special processing is needed before
the classifier is consulted.  If a packet is a DHCP response to a request from
the local port, the packet is forwarded to the local port, regardless of the
flow table.  Note that this requires L7 processing of DHCP replies to determine
whether the &#8216;chaddr&#8217; field matches the MAC address of the local port.</p>
<p>It is interesting to note that for an L3-based in-band control mechanism, the
majority of rules are devoted to ARP traffic.  At first glance, some of these
rules appear redundant.  However, each serves an important role.  First, in
order to determine the MAC address of the remote side (controller or gateway)
for other ARP rules, we must allow ARP traffic for our local port with rules
(b) and (c).  If we are between a switch and its connection to the remote, we
have to allow the other switch&#8217;s ARP traffic to through.  This is done with
rules (d) and (e), since we do not know the addresses of the other switches a
priori, but do know the remote&#8217;s or gateway&#8217;s.  Finally, if the remote is
running in a local guest VM that is not reached through the local port, the
switch that is connected to the VM must allow ARP traffic based on the remote&#8217;s
IP address, since it will not know the MAC address of the local port that is
sending the traffic or the MAC address of the remote in the guest VM.</p>
<p>With a few notable exceptions below, in-band should work in most network
setups.  The following are considered &#8220;supported&#8221; in the current
implementation:</p>
<ul class="simple">
<li>Locally Connected.  The switch and remote are on the same subnet.  This uses
rules (a), (b), (c), (h), and (i).</li>
<li>Reached through Gateway.  The switch and remote are on different subnets and
must go through a gateway.  This uses rules (a), (b), (c), (h), and (i).</li>
<li>Between Switch and Remote.  This switch is between another switch and the
remote, and we want to allow the other switch&#8217;s traffic through.  This uses
rules (d), (e), (h), and (i).  It uses (b) and (c) indirectly in order to
know the MAC address for rules (d) and (e).  Note that DHCP for the other
switch will not work unless an OpenFlow controller explicitly lets this
switch pass the traffic.</li>
<li>Between Switch and Gateway.  This switch is between another switch and the
gateway, and we want to allow the other switch&#8217;s traffic through.  This uses
the same rules and logic as the &#8220;Between Switch and Remote&#8221; configuration
described earlier.</li>
<li>Remote on Local VM.  The remote is a guest VM on the system running in-band
control.  This uses rules (a), (b), (c), (h), and (i).</li>
<li>Remote on Local VM with Different Networks.  The remote is a guest VM on the
system running in-band control, but the local port is not used to connect to
the remote.  For example, an IP address is configured on eth0 of the switch.
The remote&#8217;s VM is connected through eth1 of the switch, but an IP address
has not been configured for that port on the switch.  As such, the switch
will use eth0 to connect to the remote, and eth1&#8217;s rules about the local port
will not work.  In the example, the switch attached to eth0 would use rules
(a), (b), (c), (h), and (i) on eth0.  The switch attached to eth1 would use
rules (f), (g), (h), and (i).</li>
</ul>
<p>The following are explicitly <em>not</em> supported by in-band control:</p>
<ul class="simple">
<li>Specify Remote by Name.  Currently, the remote must be identified by IP
address.  A naive approach would be to permit all DNS traffic.
Unfortunately, this would prevent the controller from defining any policy
over DNS.  Since switches that are located behind us need to connect to the
remote, in-band cannot simply add a rule that allows DNS traffic from the
local port.  The &#8220;correct&#8221; way to support this is to parse DNS requests to
allow all traffic related to a request for the remote&#8217;s name through.  Due to
the potential security problems and amount of processing, we decided to hold
off for the time-being.</li>
<li>Differing Remotes for Switches.  All switches must know the L3 addresses for
all the remotes that other switches may use, since rules need to be set up to
allow traffic related to those remotes through.  See rules (f), (g), (h), and
(i).</li>
<li>Differing Routes for Switches.  In order for the switch to allow other
switches to connect to a remote through a gateway, it allows the gateway&#8217;s
traffic through with rules (d) and (e).  If the routes to the remote differ
for the two switches, we will not know the MAC address of the alternate
gateway.</li>
</ul>
</div>
</div>
<div class="section" id="action-reproduction">
<h5>Action Reproduction<a class="headerlink" href="#action-reproduction" title="Permalink to this headline">¶</a></h5>
<p>It seems likely that many controllers, at least at startup, use the OpenFlow
&#8220;flow statistics&#8221; request to obtain existing flows, then compare the flows&#8217;
actions against the actions that they expect to find.  Before version 1.8.0,
Open vSwitch always returned exact, byte-for-byte copies of the actions that
had been added to the flow table.  The current version of Open vSwitch does not
always do this in some exceptional cases.  This section lists the exceptions
that controller authors must keep in mind if they compare actual actions
against desired actions in a bytewise fashion:</p>
<ul class="simple">
<li>Open vSwitch zeros padding bytes in action structures, regardless of their
values when the flows were added.</li>
<li>Open vSwitch &#8220;normalizes&#8221; the instructions in OpenFlow 1.1 (and later) in the
following way:<ul>
<li>OVS sorts the instructions into the following order: Apply-Actions,
Clear-Actions, Write-Actions, Write-Metadata, Goto-Table.</li>
<li>OVS drops Apply-Actions instructions that have empty action lists.</li>
<li>OVS drops Write-Actions instructions that have empty action sets.</li>
</ul>
</li>
</ul>
<p>Please report other discrepancies, if you notice any, so that we can fix or
document them.</p>
</div>
<div class="section" id="suggestions">
<h5>Suggestions<a class="headerlink" href="#suggestions" title="Permalink to this headline">¶</a></h5>
<p>Suggestions to improve Open vSwitch are welcome at <a class="reference external" href="mailto:discuss&#37;&#52;&#48;openvswitch&#46;org">discuss<span>&#64;</span>openvswitch<span>&#46;</span>org</a>.</p>
</div>
</div>
<span id="document-topics/datapath"></span><div class="section" id="open-vswitch-datapath-development-guide">
<h4>Open vSwitch Datapath Development Guide<a class="headerlink" href="#open-vswitch-datapath-development-guide" title="Permalink to this headline">¶</a></h4>
<p>The Open vSwitch kernel module allows flexible userspace control over
flow-level packet processing on selected network devices.  It can be used to
implement a plain Ethernet switch, network device bonding, VLAN processing,
network access control, flow-based network control, and so on.</p>
<p>The kernel module implements multiple &#8220;datapaths&#8221; (analogous to bridges), each
of which can have multiple &#8220;vports&#8221; (analogous to ports within a bridge).  Each
datapath also has associated with it a &#8220;flow table&#8221; that userspace populates
with &#8220;flows&#8221; that map from keys based on packet headers and metadata to sets of
actions.  The most common action forwards the packet to another vport; other
actions are also implemented.</p>
<p>When a packet arrives on a vport, the kernel module processes it by extracting
its flow key and looking it up in the flow table.  If there is a matching flow,
it executes the associated actions.  If there is no match, it queues the packet
to userspace for processing (as part of its processing, userspace will likely
set up a flow to handle further packets of the same type entirely in-kernel).</p>
<div class="section" id="flow-key-compatibility">
<h5>Flow Key Compatibility<a class="headerlink" href="#flow-key-compatibility" title="Permalink to this headline">¶</a></h5>
<p>Network protocols evolve over time.  New protocols become important and
existing protocols lose their prominence.  For the Open vSwitch kernel module
to remain relevant, it must be possible for newer versions to parse additional
protocols as part of the flow key.  It might even be desirable, someday, to
drop support for parsing protocols that have become obsolete.  Therefore, the
Netlink interface to Open vSwitch is designed to allow carefully written
userspace applications to work with any version of the flow key, past or
future.</p>
<p>To support this forward and backward compatibility, whenever the kernel module
passes a packet to userspace, it also passes along the flow key that it parsed
from the packet.  Userspace then extracts its own notion of a flow key from the
packet and compares it against the kernel-provided version:</p>
<ul class="simple">
<li>If userspace&#8217;s notion of the flow key for the packet matches the kernel&#8217;s,
then nothing special is necessary.</li>
<li>If the kernel&#8217;s flow key includes more fields than the userspace version of
the flow key, for example if the kernel decoded IPv6 headers but userspace
stopped at the Ethernet type (because it does not understand IPv6), then
again nothing special is necessary.  Userspace can still set up a flow in the
usual way, as long as it uses the kernel-provided flow key to do it.</li>
<li>If the userspace flow key includes more fields than the kernel&#8217;s, for example
if userspace decoded an IPv6 header but the kernel stopped at the Ethernet
type, then userspace can forward the packet manually, without setting up a
flow in the kernel.  This case is bad for performance because every packet
that the kernel considers part of the flow must go to userspace, but the
forwarding behavior is correct.  (If userspace can determine that the values
of the extra fields would not affect forwarding behavior, then it could set
up a flow anyway.)</li>
</ul>
<p>How flow keys evolve over time is important to making this work, so
the following sections go into detail.</p>
</div>
<div class="section" id="flow-key-format">
<h5>Flow Key Format<a class="headerlink" href="#flow-key-format" title="Permalink to this headline">¶</a></h5>
<p>A flow key is passed over a Netlink socket as a sequence of Netlink attributes.
Some attributes represent packet metadata, defined as any information about a
packet that cannot be extracted from the packet itself, e.g. the vport on which
the packet was received.  Most attributes, however, are extracted from headers
within the packet, e.g. source and destination addresses from Ethernet, IP, or
TCP headers.</p>
<p>The <code class="docutils literal"><span class="pre">&lt;linux/openvswitch.h&gt;</span></code> header file defines the exact format of the flow
key attributes.  For informal explanatory purposes here, we write them as
comma-separated strings, with parentheses indicating arguments and nesting.
For example, the following could represent a flow key corresponding to a TCP
packet that arrived on vport 1:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>in_port(1), eth(src=e0:91:f5:21:d0:b2, dst=00:02:e3:0f:80:a4),
eth_type(0x0800), ipv4(src=172.16.0.20, dst=172.18.0.52, proto=17, tos=0,
frag=no), tcp(src=49163, dst=80)
</pre></div>
</div>
<p>Often we ellipsize arguments not important to the discussion, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">in_port</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">eth</span><span class="p">(</span><span class="o">...</span><span class="p">),</span> <span class="n">eth_type</span><span class="p">(</span><span class="mh">0x0800</span><span class="p">),</span> <span class="n">ipv4</span><span class="p">(</span><span class="o">...</span><span class="p">),</span> <span class="n">tcp</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="wildcarded-flow-key-format">
<h5>Wildcarded Flow Key Format<a class="headerlink" href="#wildcarded-flow-key-format" title="Permalink to this headline">¶</a></h5>
<p>A wildcarded flow is described with two sequences of Netlink attributes passed
over the Netlink socket. A flow key, exactly as described above, and an
optional corresponding flow mask.</p>
<p>A wildcarded flow can represent a group of exact match flows. Each <code class="docutils literal"><span class="pre">1</span></code> bit
in the mask specifies an exact match with the corresponding bit in the flow key.
A <code class="docutils literal"><span class="pre">0</span></code> bit specifies a don&#8217;t care bit, which will match either a <code class="docutils literal"><span class="pre">1</span></code> or
<code class="docutils literal"><span class="pre">0</span></code> bit of an incoming packet. Using a wildcarded flow can improve the flow
set up rate by reducing the number of new flows that need to be processed by
the user space program.</p>
<p>Support for the mask Netlink attribute is optional for both the kernel and user
space program. The kernel can ignore the mask attribute, installing an exact
match flow, or reduce the number of don&#8217;t care bits in the kernel to less than
what was specified by the user space program. In this case, variations in bits
that the kernel does not implement will simply result in additional flow
setups.  The kernel module will also work with user space programs that neither
support nor supply flow mask attributes.</p>
<p>Since the kernel may ignore or modify wildcard bits, it can be difficult for
the userspace program to know exactly what matches are installed. There are two
possible approaches: reactively install flows as they miss the kernel flow
table (and therefore not attempt to determine wildcard changes at all) or use
the kernel&#8217;s response messages to determine the installed wildcards.</p>
<p>When interacting with userspace, the kernel should maintain the match portion
of the key exactly as originally installed. This will provides a handle to
identify the flow for all future operations. However, when reporting the mask
of an installed flow, the mask should include any restrictions imposed by the
kernel.</p>
<p>The behavior when using overlapping wildcarded flows is undefined. It is the
responsibility of the user space program to ensure that any incoming packet can
match at most one flow, wildcarded or not. The current implementation performs
best-effort detection of overlapping wildcarded flows and may reject some but
not all of them. However, this behavior may change in future versions.</p>
</div>
<div class="section" id="unique-flow-identifiers">
<h5>Unique Flow Identifiers<a class="headerlink" href="#unique-flow-identifiers" title="Permalink to this headline">¶</a></h5>
<p>An alternative to using the original match portion of a key as the handle for
flow identification is a unique flow identifier, or &#8220;UFID&#8221;. UFIDs are optional
for both the kernel and user space program.</p>
<p>User space programs that support UFID are expected to provide it during flow
setup in addition to the flow, then refer to the flow using the UFID for all
future operations. The kernel is not required to index flows by the original
flow key if a UFID is specified.</p>
</div>
<div class="section" id="basic-rule-for-evolving-flow-keys">
<h5>Basic Rule for Evolving Flow Keys<a class="headerlink" href="#basic-rule-for-evolving-flow-keys" title="Permalink to this headline">¶</a></h5>
<p>Some care is needed to really maintain forward and backward compatibility for
applications that follow the rules listed under &#8220;Flow key compatibility&#8221; above.</p>
<p>The basic rule is obvious:</p>
<blockquote>
<div>New network protocol support must only supplement existing flow key
attributes.  It must not change the meaning of already defined flow key
attributes.</div></blockquote>
<p>This rule does have less-obvious consequences so it is worth working through a
few examples.  Suppose, for example, that the kernel module did not already
implement VLAN parsing.  Instead, it just interpreted the 802.1Q TPID
(<code class="docutils literal"><span class="pre">0x8100</span></code>) as the Ethertype then stopped parsing the packet.  The flow key
for any packet with an 802.1Q header would look essentially like this, ignoring
metadata:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">eth</span><span class="p">(</span><span class="o">...</span><span class="p">),</span> <span class="n">eth_type</span><span class="p">(</span><span class="mh">0x8100</span><span class="p">)</span>
</pre></div>
</div>
<p>Naively, to add VLAN support, it makes sense to add a new &#8220;vlan&#8221; flow key
attribute to contain the VLAN tag, then continue to decode the encapsulated
headers beyond the VLAN tag using the existing field definitions.  With this
change, a TCP packet in VLAN 10 would have a flow key much like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">eth</span><span class="p">(</span><span class="o">...</span><span class="p">),</span> <span class="n">vlan</span><span class="p">(</span><span class="n">vid</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pcp</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">eth_type</span><span class="p">(</span><span class="mh">0x0800</span><span class="p">),</span> <span class="n">ip</span><span class="p">(</span><span class="n">proto</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="o">...</span><span class="p">),</span> <span class="n">tcp</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>But this change would negatively affect a userspace application that has not
been updated to understand the new &#8220;vlan&#8221; flow key attribute.  The application
could, following the flow compatibility rules above, ignore the &#8220;vlan&#8221;
attribute that it does not understand and therefore assume that the flow
contained IP packets.  This is a bad assumption (the flow only contains IP
packets if one parses and skips over the 802.1Q header) and it could cause the
application&#8217;s behavior to change across kernel versions even though it follows
the compatibility rules.</p>
<p>The solution is to use a set of nested attributes.  This is, for example, why
802.1Q support uses nested attributes.  A TCP packet in VLAN 10 is actually
expressed as:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>eth(...), eth_type(0x8100), vlan(vid=10, pcp=0), encap(eth_type(0x0800),
ip(proto=6, ...), tcp(...)))
</pre></div>
</div>
<p>Notice how the <code class="docutils literal"><span class="pre">eth_type</span></code>, <code class="docutils literal"><span class="pre">ip</span></code>, and <code class="docutils literal"><span class="pre">tcp</span></code> flow key attributes are nested
inside the <code class="docutils literal"><span class="pre">encap</span></code> attribute.  Thus, an application that does not understand
the <code class="docutils literal"><span class="pre">vlan</span></code> key will not see either of those attributes and therefore will not
misinterpret them.  (Also, the outer <code class="docutils literal"><span class="pre">eth_type</span></code> is still <code class="docutils literal"><span class="pre">0x8100</span></code>, not
changed to <code class="docutils literal"><span class="pre">0x0800</span></code>)</p>
</div>
<div class="section" id="handling-malformed-packets">
<h5>Handling Malformed Packets<a class="headerlink" href="#handling-malformed-packets" title="Permalink to this headline">¶</a></h5>
<p>Don&#8217;t drop packets in the kernel for malformed protocol headers, bad checksums,
etc.  This would prevent userspace from implementing a simple Ethernet switch
that forwards every packet.</p>
<p>Instead, in such a case, include an attribute with &#8220;empty&#8221; content.  It doesn&#8217;t
matter if the empty content could be valid protocol values, as long as those
values are rarely seen in practice, because userspace can always forward all
packets with those values to userspace and handle them individually.</p>
<p>For example, consider a packet that contains an IP header that indicates
protocol 6 for TCP, but which is truncated just after the IP header, so that
the TCP header is missing.  The flow key for this packet would include a tcp
attribute with all-zero <code class="docutils literal"><span class="pre">src</span></code> and <code class="docutils literal"><span class="pre">dst</span></code>, like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">eth</span><span class="p">(</span><span class="o">...</span><span class="p">),</span> <span class="n">eth_type</span><span class="p">(</span><span class="mh">0x0800</span><span class="p">),</span> <span class="n">ip</span><span class="p">(</span><span class="n">proto</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="o">...</span><span class="p">),</span> <span class="n">tcp</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>As another example, consider a packet with an Ethernet type of 0x8100,
indicating that a VLAN TCI should follow, but which is truncated just after the
Ethernet type.  The flow key for this packet would include an all-zero-bits
vlan and an empty encap attribute, like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">eth</span><span class="p">(</span><span class="o">...</span><span class="p">),</span> <span class="n">eth_type</span><span class="p">(</span><span class="mh">0x8100</span><span class="p">),</span> <span class="n">vlan</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">encap</span><span class="p">()</span>
</pre></div>
</div>
<p>Unlike a TCP packet with source and destination ports 0, an all-zero-bits VLAN
TCI is not that rare, so the CFI bit (aka VLAN_TAG_PRESENT inside the kernel)
is ordinarily set in a vlan attribute expressly to allow this situation to be
distinguished.  Thus, the flow key in this second example unambiguously
indicates a missing or malformed VLAN TCI.</p>
</div>
<div class="section" id="other-rules">
<h5>Other Rules<a class="headerlink" href="#other-rules" title="Permalink to this headline">¶</a></h5>
<p>The other rules for flow keys are much less subtle:</p>
<ul class="simple">
<li>Duplicate attributes are not allowed at a given nesting level.</li>
<li>Ordering of attributes is not significant.</li>
<li>When the kernel sends a given flow key to userspace, it always composes it
the same way.  This allows userspace to hash and compare entire flow keys
that it may not be able to fully interpret.</li>
</ul>
</div>
<div class="section" id="coding-rules">
<h5>Coding Rules<a class="headerlink" href="#coding-rules" title="Permalink to this headline">¶</a></h5>
<p>Implement the headers and codes for compatibility with older kernel in
<code class="docutils literal"><span class="pre">linux/compat/</span></code> directory.  All public functions should be exported using
<code class="docutils literal"><span class="pre">EXPORT_SYMBOL</span></code> macro.  Public function replacing the same-named kernel
function should be prefixed with <code class="docutils literal"><span class="pre">rpl_</span></code>.  Otherwise, the function should be
prefixed with <code class="docutils literal"><span class="pre">ovs_</span></code>.  For special case when it is not possible to follow
this rule (e.g., the <code class="docutils literal"><span class="pre">pskb_expand_head()</span></code> function), the function name must
be added to <code class="docutils literal"><span class="pre">linux/compat/build-aux/export-check-whitelist</span></code>, otherwise, the
compilation check <code class="docutils literal"><span class="pre">check-export-symbol</span></code> will fail.</p>
</div>
</div>
<span id="document-topics/integration"></span><div class="section" id="integration-guide-for-centralized-control">
<h4>Integration Guide for Centralized Control<a class="headerlink" href="#integration-guide-for-centralized-control" title="Permalink to this headline">¶</a></h4>
<p>This document describes how to integrate Open vSwitch onto a new platform to
expose the state of the switch and attached devices for centralized control.
(If you are looking to port the switching components of Open vSwitch to a new
platform, refer to <a class="reference internal" href="contents.html#document-topics/porting"><em>Porting Open vSwitch to New Software or Hardware</em></a>)  The focus of this guide is on hypervisors,
but many of the interfaces are useful for hardware switches, as well.  The
XenServer integration is the most mature implementation, so most of the
examples are drawn from it.</p>
<p>The externally visible interface to this integration is platform-agnostic.  We
encourage anyone who integrates Open vSwitch to use the same interface, because
keeping a uniform interface means that controllers require less customization
for individual platforms (and perhaps no customization at all).</p>
<p>Integration centers around the Open vSwitch database and mostly involves the
<code class="docutils literal"><span class="pre">external_ids</span></code> columns in several of the tables.  These columns are not
interpreted by Open vSwitch itself.  Instead, they provide information to a
controller that permits it to associate a database record with a more
meaningful entity.  In contrast, the <code class="docutils literal"><span class="pre">other_config</span></code> column is used to
configure behavior of the switch.  The main job of the integrator, then, is to
ensure that these values are correctly populated and maintained.</p>
<p>An integrator sets the columns in the database by talking to the ovsdb-server
daemon.  A few of the columns can be set during startup by calling the ovs-ctl
tool from inside the startup scripts.  The <code class="docutils literal"><span class="pre">xenserver/etc_init.d_openvswitch</span></code>
script provides examples of its use, and the ovs-ctl(8) manpage contains
complete documentation.  At runtime, ovs-vsctl can be be used to set columns in
the database.  The script <code class="docutils literal"><span class="pre">xenserver/etc_xensource_scripts_vif</span></code> contains
examples of its use, and ovs-vsctl(8) manpage contains complete documentation.</p>
<p>Python and C bindings to the database are provided if deeper integration with a
program are needed.  The XenServer ovs-xapi-sync daemon
(<code class="docutils literal"><span class="pre">xenserver/usr_share_openvswitch_scripts_ovs-xapi-sync</span></code>) provides an example
of using the Python bindings.  More information on the python bindings is
available at <code class="docutils literal"><span class="pre">python/ovs/db/idl.py</span></code>.  Information on the C bindings is
available at <code class="docutils literal"><span class="pre">lib/ovsdb-idl.h</span></code>.</p>
<p>The following diagram shows how integration scripts fit into the Open vSwitch
architecture:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Diagram

         +----------------------------------------+
         |           Controller Cluster           +
         +----------------------------------------+
                             |
                             |
+----------------------------------------------------------+
|                            |                             |
|             +--------------+---------------+             |
|             |                              |             |
|   +-------------------+           +------------------+   |
|   |   ovsdb-server    |-----------|   ovs-vswitchd   |   |
|   +-------------------+           +------------------+   |
|             |                              |             |
|  +---------------------+                   |             |
|  | Integration scripts |                   |             |
|  | (ex: ovs-xapi-sync) |                   |             |
|  +---------------------+                   |             |
|                                            |   Userspace |
|----------------------------------------------------------|
|                                            |      Kernel |
|                                            |             |
|                                 +---------------------+  |
|                                 |  OVS Kernel Module  |  |
|                                 +---------------------+  |
+----------------------------------------------------------+
</pre></div>
</div>
<p>A description of the most relevant fields for integration follows.  By setting
these values, controllers are able to understand the network and manage it more
dynamically and precisely.  For more details about the database and each
individual column, please refer to the ovs-vswitchd.conf.db(5) manpage.</p>
<div class="section" id="open-vswitch-table">
<h5><code class="docutils literal"><span class="pre">Open_vSwitch</span></code> table<a class="headerlink" href="#open-vswitch-table" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal"><span class="pre">Open_vSwitch</span></code> table describes the switch as a whole.  The
<code class="docutils literal"><span class="pre">system_type</span></code> and <code class="docutils literal"><span class="pre">system_version</span></code> columns identify the platform to the
controller.  The <code class="docutils literal"><span class="pre">external_ids:system-id</span></code> key uniquely identifies the
physical host.  In XenServer, the system-id will likely be the same as the UUID
returned by <code class="docutils literal"><span class="pre">xe</span> <span class="pre">host-list</span></code>. This key allows controllers to distinguish
between multiple hypervisors.</p>
<p>Most of this configuration can be done with the ovs-ctl command at startup.
For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ctl --system-type=&quot;XenServer&quot; --system-version=&quot;6.0.0-50762p&quot; \
    --system-id=&quot;${UUID}&quot; &quot;${other_options}&quot; start
</pre></div>
</div>
<p>Alternatively, the ovs-vsctl command may be used to set a particular value at
runtime.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set open_vswitch . external-ids:system-id=&#39;&quot;${UUID}&quot;&#39;
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">other_config:enable-statistics</span></code> key may be set to <code class="docutils literal"><span class="pre">true</span></code> to have OVS
populate the database with statistics (e.g., number of CPUs, memory, system
load) for the controller&#8217;s use.</p>
</div>
<div class="section" id="bridge-table">
<h5>Bridge table<a class="headerlink" href="#bridge-table" title="Permalink to this headline">¶</a></h5>
<p>The Bridge table describes individual bridges within an Open vSwitch instance.
The <code class="docutils literal"><span class="pre">external-ids:bridge-id</span></code> key uniquely identifies a particular bridge.  In
XenServer, this will likely be the same as the UUID returned by <code class="docutils literal"><span class="pre">xe</span>
<span class="pre">network-list</span></code> for that particular bridge.</p>
<p>For example, to set the identifier for bridge &#8220;br0&#8221;, the following command can
be used:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set Bridge br0 external-ids:bridge-id=&#39;&quot;${UUID}&quot;&#39;
</pre></div>
</div>
<p>The MAC address of the bridge may be manually configured by setting it with the
<code class="docutils literal"><span class="pre">other_config:hwaddr</span></code> key.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set Bridge br0 other_config:hwaddr=&quot;12:34:56:78:90:ab&quot;
</pre></div>
</div>
</div>
<div class="section" id="interface-table">
<h5>Interface table<a class="headerlink" href="#interface-table" title="Permalink to this headline">¶</a></h5>
<p>The Interface table describes an interface under the control of Open vSwitch.
The <code class="docutils literal"><span class="pre">external_ids</span></code> column contains keys that are used to provide additional
information about the interface:</p>
<p>attached-mac</p>
<blockquote>
<div>This field contains the MAC address of the device attached to the interface.
On a hypervisor, this is the MAC address of the interface as seen inside a
VM.  It does not necessarily correlate to the host-side MAC address.  For
example, on XenServer, the MAC address on a VIF in the hypervisor is always
FE:FF:FF:FF:FF:FF, but inside the VM a normal MAC address is seen.</div></blockquote>
<p>iface-id</p>
<blockquote>
<div>This field uniquely identifies the interface.  In hypervisors, this allows
the controller to follow VM network interfaces as VMs migrate.  A well-chosen
identifier should also allow an administrator or a controller to associate
the interface with the corresponding object in the VM management system.  For
example, the Open vSwitch integration with XenServer by default uses the
XenServer assigned UUID for a VIF record as the iface-id.</div></blockquote>
<p>iface-status</p>
<blockquote>
<div>In a hypervisor, there are situations where there are multiple interface
choices for a single virtual ethernet interface inside a VM.  Valid values
are &#8220;active&#8221; and &#8220;inactive&#8221;.  A complete description is available in the
ovs-vswitchd.conf.db(5) manpage.</div></blockquote>
<p>vm-id</p>
<blockquote>
<div>This field uniquely identifies the VM to which this interface belongs.  A
single VM may have multiple interfaces attached to it.</div></blockquote>
<p>As in the previous tables, the ovs-vsctl command may be used to configure the
values.  For example, to set the <code class="docutils literal"><span class="pre">iface-id</span></code> on eth0, the following command
can be used:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set Interface eth0 external-ids:iface-id=&#39;&quot;${UUID}&quot;&#39;
</pre></div>
</div>
</div>
<div class="section" id="ha-for-ovn-db-servers-using-pacemaker">
<h5>HA for OVN DB servers using pacemaker<a class="headerlink" href="#ha-for-ovn-db-servers-using-pacemaker" title="Permalink to this headline">¶</a></h5>
<p>The ovsdb servers can work in either active or backup mode. In backup mode, db
server will be connected to an active server and replicate the active servers
contents. At all times, the data can be transacted only from the active server.
When the active server dies for some reason, entire OVN operations will be
stalled.</p>
<p><a class="reference external" href="http://clusterlabs.org/pacemaker.html">Pacemaker</a> is a cluster resource
manager which can manage a defined set of resource across a set of clustered
nodes. Pacemaker manages the resource with the help of the resource agents.
One among the resource agent is <a class="reference external" href="http://www.linux-ha.org/wiki/OCF_Resource_Agents">OCF</a></p>
<p>OCF is nothing but a shell script which accepts a set of actions and returns an
appropriate status code.</p>
<p>With the help of the OCF resource agent ovn/utilities/ovndb-servers.ocf, one
can defined a resource for the pacemaker such that pacemaker will always
maintain one running active server at any time.</p>
<p>After creating a pacemaker cluster, use the following commands to create one
active and multiple backup servers for OVN databases:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ pcs resource create ovndb_servers ocf:ovn:ovndb-servers \
     master_ip=x.x.x.x \
     ovn_ctl=&lt;path of the ovn-ctl script&gt; \
     op monitor interval=&quot;10s&quot; \
     op monitor role=Master interval=&quot;15s&quot;
$ pcs resource master ovndb_servers-master ovndb_servers \
    meta notify=&quot;true&quot;
</pre></div>
</div>
<p>The <cite>master_ip</cite> and <cite>ovn_ctl</cite> are the parameters that will be used by the OCF
script. <cite>ovn_ctl</cite> is optional, if not given, it assumes a default value of
/usr/share/openvswitch/scripts/ovn-ctl. <cite>master_ip</cite> is the IP address on which
the active database server is expected to be listening, the slave node uses it
to connect to the master node. You can add the optional parameters
&#8216;nb_master_port&#8217;, &#8216;nb_master_protocol&#8217;, &#8216;sb_master_port&#8217;, &#8216;sb_master_protocol&#8217;
to set the protocol and port.</p>
<p>Whenever the active server dies, pacemaker is responsible to promote one of the
backup servers to be active. Both ovn-controller and ovn-northd needs the
ip-address at which the active server is listening. With pacemaker changing the
node at which the active server is run, it is not efficient to instruct all the
ovn-controllers and the ovn-northd to listen to the latest active server&#8217;s
ip-address.</p>
<p>This problem can be solved by using a native ocf resource agent
<code class="docutils literal"><span class="pre">ocf:heartbeat:IPaddr2</span></code>. The IPAddr2 resource agent is just a resource with
an ip-address. When we colocate this resource with the active server, pacemaker
will enable the active server to be connected with a single ip-address all the
time. This is the ip-address that needs to be given as the parameter while
creating the <cite>ovndb_servers</cite> resource.</p>
<p>Use the following command to create the IPAddr2 resource and colocate it
with the active server:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ pcs resource create VirtualIP ocf:heartbeat:IPaddr2 ip=x.x.x.x \
    op monitor interval=30s
$ pcs constraint order promote ovndb_servers-master then VirtualIP
$ pcs constraint colocation add VirtualIP with master ovndb_servers-master \
    score=INFINITY
</pre></div>
</div>
</div>
</div>
<span id="document-topics/porting"></span><div class="section" id="porting-open-vswitch-to-new-software-or-hardware">
<h4>Porting Open vSwitch to New Software or Hardware<a class="headerlink" href="#porting-open-vswitch-to-new-software-or-hardware" title="Permalink to this headline">¶</a></h4>
<p>Open vSwitch (OVS) is intended to be easily ported to new software and hardware
platforms.  This document describes the types of changes that are most likely
to be necessary in porting OVS to Unix-like platforms.  (Porting OVS to other
kinds of platforms is likely to be more difficult.)</p>
<div class="section" id="vocabulary">
<h5>Vocabulary<a class="headerlink" href="#vocabulary" title="Permalink to this headline">¶</a></h5>
<p>For historical reasons, different words are used for essentially the same
concept in different areas of the Open vSwitch source tree.  Here is a
concordance, indexed by the area of the source tree:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>datapath/       vport           ---
vswitchd/       iface           port
ofproto/        port            bundle
ofproto/bond.c  slave           bond
lib/lacp.c      slave           lacp
lib/netdev.c    netdev          ---
database        Interface       Port
</pre></div>
</div>
</div>
<div class="section" id="open-vswitch-architectural-overview">
<h5>Open vSwitch Architectural Overview<a class="headerlink" href="#open-vswitch-architectural-overview" title="Permalink to this headline">¶</a></h5>
<p>The following diagram shows the very high-level architecture of Open vSwitch
from a porter&#8217;s perspective.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>+-------------------+
|    ovs-vswitchd   |&lt;--&gt;ovsdb-server
+-------------------+
|      ofproto      |&lt;--&gt;OpenFlow controllers
+--------+-+--------+
| netdev | | ofproto|
+--------+ |provider|
| netdev | +--------+
|provider|
+--------+
</pre></div>
</div>
<p>Some of the components are generic.  Modulo bugs or inadequacies, these
components should not need to be modified as part of a port:</p>
<dl class="docutils">
<dt>ovs-vswitchd</dt>
<dd>The main Open vSwitch userspace program, in vswitchd/.  It reads the desired
Open vSwitch configuration from the ovsdb-server program over an IPC channel
and passes this configuration down to the &#8220;ofproto&#8221; library.  It also passes
certain status and statistical information from ofproto back into the
database.</dd>
<dt>ofproto</dt>
<dd>The Open vSwitch library, in ofproto/, that implements an OpenFlow switch.
It talks to OpenFlow controllers over the network and to switch hardware or
software through an &#8220;ofproto provider&#8221;, explained further below.</dd>
<dt>netdev</dt>
<dd>The Open vSwitch library, in lib/netdev.c, that abstracts interacting with
network devices, that is, Ethernet interfaces.  The netdev library is a thin
layer over &#8220;netdev provider&#8221; code, explained further below.</dd>
</dl>
<p>The other components may need attention during a port.  You will almost
certainly have to implement a &#8220;netdev provider&#8221;.  Depending on the type of port
you are doing and the desired performance, you may also have to implement an
&#8220;ofproto provider&#8221; or a lower-level component called a &#8220;dpif&#8221; provider.</p>
<p>The following sections talk about these components in more detail.</p>
</div>
<div class="section" id="writing-a-netdev-provider">
<h5>Writing a netdev Provider<a class="headerlink" href="#writing-a-netdev-provider" title="Permalink to this headline">¶</a></h5>
<p>A &#8220;netdev provider&#8221; implements an operating system and hardware specific
interface to &#8220;network devices&#8221;, e.g. eth0 on Linux.  Open vSwitch must be able
to open each port on a switch as a netdev, so you will need to implement a
&#8220;netdev provider&#8221; that works with your switch hardware and software.</p>
<p><code class="docutils literal"><span class="pre">struct</span> <span class="pre">netdev_class</span></code>, in <code class="docutils literal"><span class="pre">lib/netdev-provider.h</span></code>, defines the interfaces
required to implement a netdev.  That structure contains many function
pointers, each of which has a comment that is meant to describe its behavior in
detail.  If the requirements are unclear, report this as a bug.</p>
<p>The netdev interface can be divided into a few rough categories:</p>
<ul class="simple">
<li>Functions required to properly implement OpenFlow features.  For example,
OpenFlow requires the ability to report the Ethernet hardware address of a
port.  These functions must be implemented for minimally correct operation.</li>
<li>Functions required to implement optional Open vSwitch features.  For example,
the Open vSwitch support for in-band control requires netdev support for
inspecting the TCP/IP stack&#8217;s ARP table.  These functions must be implemented
if the corresponding OVS features are to work, but may be omitted initially.</li>
<li>Functions needed in some implementations but not in others.  For example,
most kinds of ports (see below) do not need functionality to receive packets
from a network device.</li>
</ul>
<p>The existing netdev implementations may serve as useful examples during a port:</p>
<ul class="simple">
<li>lib/netdev-linux.c implements netdev functionality for Linux network devices,
using Linux kernel calls.  It may be a good place to start for full-featured
netdev implementations.</li>
<li>lib/netdev-vport.c provides support for &#8220;virtual ports&#8221; implemented by the
Open vSwitch datapath module for the Linux kernel.  This may serve as a model
for minimal netdev implementations.</li>
<li>lib/netdev-dummy.c is a fake netdev implementation useful only for testing.</li>
</ul>
</div>
<div class="section" id="porting-strategies">
<span id="id1"></span><h5>Porting Strategies<a class="headerlink" href="#porting-strategies" title="Permalink to this headline">¶</a></h5>
<p>After a netdev provider has been implemented for a system&#8217;s network devices,
you may choose among three basic porting strategies.</p>
<p>The lowest-effort strategy is to use the &#8220;userspace switch&#8221; implementation
built into Open vSwitch.  This ought to work, without writing any more code, as
long as the netdev provider that you implemented supports receiving packets.
It yields poor performance, however, because every packet passes through the
ovs-vswitchd process. Refer to <a class="reference internal" href="contents.html#document-intro/install/userspace"><em>Open vSwitch without Kernel Support</em></a> for instructions
on how to configure a userspace switch.</p>
<p>If the userspace switch is not the right choice for your port, then you will
have to write more code.  You may implement either an &#8220;ofproto provider&#8221; or a
&#8220;dpif provider&#8221;.  Which you should choose depends on a few different factors:</p>
<ul class="simple">
<li>Only an ofproto provider can take full advantage of hardware with built-in
support for wildcards (e.g. an ACL table or a TCAM).</li>
<li>A dpif provider can take advantage of the Open vSwitch built-in
implementations of bonding, LACP, 802.1ag, 802.1Q VLANs, and other features.
An ofproto provider has to provide its own implementations, if the hardware
can support them at all.</li>
<li>A dpif provider is usually easier to implement, but most appropriate for
software switching.  It &#8220;explodes&#8221; wildcard rules into exact-match entries
(with an optional wildcard mask).  This allows fast hash lookups in software,
but makes inefficient use of TCAMs in hardware that support wildcarding.</li>
</ul>
<p>The following sections describe how to implement each kind of port.</p>
</div>
<div class="section" id="ofproto-providers">
<h5>ofproto Providers<a class="headerlink" href="#ofproto-providers" title="Permalink to this headline">¶</a></h5>
<p>An &#8220;ofproto provider&#8221; is what ofproto uses to directly monitor and control an
OpenFlow-capable switch.  <code class="docutils literal"><span class="pre">struct</span> <span class="pre">ofproto_class</span></code>, in
<code class="docutils literal"><span class="pre">ofproto/ofproto-provider.h</span></code>, defines the interfaces to implement an ofproto
provider for new hardware or software.  That structure contains many function
pointers, each of which has a comment that is meant to describe its behavior in
detail.  If the requirements are unclear, report this as a bug.</p>
<p>The ofproto provider interface is preliminary.  Let us know if it seems
unsuitable for your purpose.  We will try to improve it.</p>
</div>
<div class="section" id="writing-a-dpif-provider">
<h5>Writing a dpif Provider<a class="headerlink" href="#writing-a-dpif-provider" title="Permalink to this headline">¶</a></h5>
<p>Open vSwitch has a built-in ofproto provider named &#8220;ofproto-dpif&#8221;, which is
built on top of a library for manipulating datapaths, called &#8220;dpif&#8221;.  A
&#8220;datapath&#8221; is a simple flow table, one that is only required to support
exact-match flows, that is, flows without wildcards.  When a packet arrives on
a network device, the datapath looks for it in this table.  If there is a
match, then it performs the associated actions.  If there is no match, the
datapath passes the packet up to ofproto-dpif, which maintains the full
OpenFlow flow table.  If the packet matches in this flow table, then
ofproto-dpif executes its actions and inserts a new entry into the dpif flow
table.  (Otherwise, ofproto-dpif passes the packet up to ofproto to send the
packet to the OpenFlow controller, if one is configured.)</p>
<p>When calculating the dpif flow, ofproto-dpif generates an exact-match flow that
describes the missed packet.  It makes an effort to figure out what fields can
be wildcarded based on the switch&#8217;s configuration and OpenFlow flow table.  The
dpif is free to ignore the suggested wildcards and only support the exact-match
entry.  However, if the dpif supports wildcarding, then it can use the masks to
match multiple flows with fewer entries and potentially significantly reduce
the number of flow misses handled by ofproto-dpif.</p>
<p>The &#8220;dpif&#8221; library in turn delegates much of its functionality to a &#8220;dpif
provider&#8221;.  The following diagram shows how dpif providers fit into the Open
vSwitch architecture:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Architecure

           _
          |   +-------------------+
          |   |    ovs-vswitchd   |&lt;--&gt;ovsdb-server
          |   +-------------------+
          |   |      ofproto      |&lt;--&gt;OpenFlow controllers
          |   +--------+-+--------+  _
          |   | netdev | |ofproto-|   |
userspace |   +--------+ |  dpif  |   |
          |   | netdev | +--------+   |
          |   |provider| |  dpif  |   |
          |   +---||---+ +--------+   |
          |       ||     |  dpif  |   | implementation of
          |       ||     |provider|   | ofproto provider
          |_      ||     +---||---+   |
                  ||         ||       |
           _  +---||-----+---||---+   |
          |   |          |datapath|   |
   kernel |   |          +--------+  _|
          |   |                   |
          |_  +--------||---------+
                       ||
                    physical
                       NIC
</pre></div>
</div>
<p>struct <code class="docutils literal"><span class="pre">dpif_class</span></code>, in <code class="docutils literal"><span class="pre">lib/dpif-provider.h</span></code>, defines the interfaces
required to implement a dpif provider for new hardware or software.  That
structure contains many function pointers, each of which has a comment that is
meant to describe its behavior in detail.  If the requirements are unclear,
report this as a bug.</p>
<p>There are two existing dpif implementations that may serve as useful examples
during a port:</p>
<ul class="simple">
<li>lib/dpif-netlink.c is a Linux-specific dpif implementation that talks to an
Open vSwitch-specific kernel module (whose sources are in the &#8220;datapath&#8221;
directory).  The kernel module performs all of the switching work, passing
packets that do not match any flow table entry up to userspace.  This dpif
implementation is essentially a wrapper around calls into the kernel module.</li>
<li>lib/dpif-netdev.c is a generic dpif implementation that performs all
switching internally.  This is how the Open vSwitch userspace switch is
implemented.</li>
</ul>
</div>
<div class="section" id="miscellaneous-notes">
<h5>Miscellaneous Notes<a class="headerlink" href="#miscellaneous-notes" title="Permalink to this headline">¶</a></h5>
<p>Open vSwitch source code uses <code class="docutils literal"><span class="pre">uint16_t</span></code>, <code class="docutils literal"><span class="pre">uint32_t</span></code>, and <code class="docutils literal"><span class="pre">uint64_t</span></code> as
fixed-width types in host byte order, and <code class="docutils literal"><span class="pre">ovs_be16</span></code>, <code class="docutils literal"><span class="pre">ovs_be32</span></code>, and
<code class="docutils literal"><span class="pre">ovs_be64</span></code> as fixed-width types in network byte order.  Each of the latter is
equivalent to the one of the former, but the difference in name makes the
intended use obvious.</p>
<p>The default &#8220;fail-mode&#8221; for Open vSwitch bridges is &#8220;standalone&#8221;, meaning that,
when the OpenFlow controllers cannot be contacted, Open vSwitch acts as a
regular MAC-learning switch.  This works well in virtualization environments
where there is normally just one uplink (either a single physical interface or
a bond).  In a more general environment, it can create loops.  So, if you are
porting to a general-purpose switch platform, you should consider changing the
default &#8220;fail-mode&#8221; to &#8220;secure&#8221;, which does not behave this way.  See
documentation for the &#8220;fail-mode&#8221; column in the Bridge table in
ovs-vswitchd.conf.db(5) for more information.</p>
<p><code class="docutils literal"><span class="pre">lib/entropy.c</span></code> assumes that it can obtain high-quality random number seeds
at startup by reading from /dev/urandom.  You will need to modify it if this is
not true on your platform.</p>
<p><code class="docutils literal"><span class="pre">vswitchd/system-stats.c</span></code> only knows how to obtain some statistics on Linux.
Optionally you may implement them for your platform as well.</p>
</div>
<div class="section" id="why-ovs-does-not-support-hybrid-providers">
<h5>Why OVS Does Not Support Hybrid Providers<a class="headerlink" href="#why-ovs-does-not-support-hybrid-providers" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference internal" href="#porting-strategies">porting strategies</a> section above describes the &#8220;ofproto provider&#8221; and
&#8220;dpif provider&#8221; porting strategies.  Only an ofproto provider can take
advantage of hardware TCAM support, and only a dpif provider can take advantage
of the OVS built-in implementations of various features.  It is therefore
tempting to suggest a hybrid approach that shares the advantages of both
strategies.</p>
<p>However, Open vSwitch does not support a hybrid approach.  Doing so may be
possible, with a significant amount of extra development work, but it does not
yet seem worthwhile, for the reasons explained below.</p>
<p>First, user surprise is likely when a switch supports a feature only with a
high performance penalty.  For example, one user questioned why adding a
particular OpenFlow action to a flow caused a 1,058x slowdown on a hardware
OpenFlow implementation <a class="footnote-reference" href="#id3" id="id2">[1]</a>.  The action required the flow to be implemented in
software.</p>
<p>Given that implementing a flow in software on the slow management CPU of a
hardware switch causes a major slowdown, software-implemented flows would only
make sense for very low-volume traffic.  But many of the features built into
the OVS software switch implementation would need to apply to every flow to be
useful.  There is no value, for example, in applying bonding or 802.1Q VLAN
support only to low-volume traffic.</p>
<p>Besides supporting features of OpenFlow actions, a hybrid approach could also
support forms of matching not supported by particular switching hardware, by
sending all packets that might match a rule to software.  But again this can
cause an unacceptable slowdown by forcing bulk traffic through software in the
hardware switch&#8217;s slow management CPU.  Consider, for example, a hardware
switch that can match on the IPv6 Ethernet type but not on fields in IPv6
headers.  An OpenFlow table that matched on the IPv6 Ethernet type would
perform well, but adding a rule that matched only UDPv6 would force every IPv6
packet to software, slowing down not just UDPv6 but all IPv6 processing.</p>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>Aaron Rosen, &#8220;Modify packet fields extremely slow&#8221;,
openflow-discuss mailing list, June 26, 2011, archived at
<a class="reference external" href="https://mailman.stanford.edu/pipermail/openflow-discuss/2011-June/002386.html">https://mailman.stanford.edu/pipermail/openflow-discuss/2011-June/002386.html</a>.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="questions">
<h5>Questions<a class="headerlink" href="#questions" title="Permalink to this headline">¶</a></h5>
<p>Direct porting questions to <a class="reference external" href="mailto:dev&#37;&#52;&#48;openvswitch&#46;org">dev<span>&#64;</span>openvswitch<span>&#46;</span>org</a>.  We will try to use questions
to improve this porting guide.</p>
</div>
</div>
<span id="document-topics/openflow"></span><div class="section" id="openflow-support-in-open-vswitch">
<h4>OpenFlow Support in Open vSwitch<a class="headerlink" href="#openflow-support-in-open-vswitch" title="Permalink to this headline">¶</a></h4>
<p>Open vSwitch support for OpenFlow 1.1 and beyond is a work in progress.  This
file describes the work still to be done.</p>
<div class="section" id="the-plan">
<h5>The Plan<a class="headerlink" href="#the-plan" title="Permalink to this headline">¶</a></h5>
<p>OpenFlow version support is not a build-time option.  A single build of Open
vSwitch must be able to handle all supported versions of OpenFlow.  Ideally,
even at runtime it should be able to support all protocol versions at the same
time on different OpenFlow bridges (and perhaps even on the same bridge).</p>
<p>At the same time, it would be a shame to litter the core of the OVS code with
lots of ugly code concerned with the details of various OpenFlow protocol
versions.</p>
<p>The primary approach to compatibility is to abstract most of the details of the
differences from the core code, by adding a protocol layer that translates
between OF1.x and a slightly higher-level abstract representation.  The core of
this approach is the many <code class="docutils literal"><span class="pre">struct</span> <span class="pre">ofputil_*</span></code> structures in
<code class="docutils literal"><span class="pre">include/openvswitch/ofp-util.h</span></code>.</p>
<p>As a consequence of this approach, OVS cannot use OpenFlow protocol definitions
that closely resemble those in the OpenFlow specification, because
<code class="docutils literal"><span class="pre">openflow.h</span></code> in different versions of the OpenFlow specification defines the
same identifier with different values.  Instead, <code class="docutils literal"><span class="pre">openflow-common.h</span></code> contains
definitions that are common to all the specifications and separate protocol
version-specific headers contain protocol-specific definitions renamed so as
not to conflict, e.g. <code class="docutils literal"><span class="pre">OFPAT10_ENQUEUE</span></code> and <code class="docutils literal"><span class="pre">OFPAT11_ENQUEUE</span></code> for the
OpenFlow 1.0 and 1.1 values for <code class="docutils literal"><span class="pre">OFPAT_ENQUEUE</span></code>.  Generally, in cases of
conflict, the protocol layer will define a more abstract <code class="docutils literal"><span class="pre">OFPUTIL_*</span></code> or
struct <code class="docutils literal"><span class="pre">ofputil_*</span></code>.</p>
<p>Here are the current approaches in a few tricky areas:</p>
<ul>
<li><p class="first">Port numbering.</p>
<p>OpenFlow 1.0 has 16-bit port numbers and later OpenFlow versions have 32-bit
port numbers.  For now, OVS support for later protocol versions requires all
port numbers to fall into the 16-bit range, translating the reserved
<code class="docutils literal"><span class="pre">OFPP_*</span></code> port numbers.</p>
</li>
<li><p class="first">Actions.</p>
<p>OpenFlow 1.0 and later versions have very different ideas of actions.  OVS
reconciles by translating all the versions&#8217; actions (and instructions) to and
from a common internal representation.</p>
</li>
</ul>
</div>
<div class="section" id="openflow-1-1">
<h5>OpenFlow 1.1<a class="headerlink" href="#openflow-1-1" title="Permalink to this headline">¶</a></h5>
<p>The list of remaining work items for OpenFlow 1.1 is below.  It is probably
incomplete.</p>
<ul>
<li><p class="first">Match and set double-tagged VLANs (QinQ).</p>
<p>This requires kernel work for reasonable performance.</p>
<p>(optional for OF1.1+)</p>
</li>
<li><p class="first">VLANs tagged with 88a8 Ethertype.</p>
<p>This requires kernel work for reasonable performance.</p>
<p>(required for OF1.1+)</p>
</li>
</ul>
</div>
<div class="section" id="openflow-1-2">
<h5>OpenFlow 1.2<a class="headerlink" href="#openflow-1-2" title="Permalink to this headline">¶</a></h5>
<p>OpenFlow 1.2 support requires OpenFlow 1.1 as a prerequisite. All the
additional work specific to Openflow 1.2 are complete.  (This is based on the
change log at the end of the OF1.2 spec.  I didn&#8217;t compare the specs carefully
yet.)</p>
</div>
<div class="section" id="openflow-1-3">
<h5>OpenFlow 1.3<a class="headerlink" href="#openflow-1-3" title="Permalink to this headline">¶</a></h5>
<p>OpenFlow 1.3 support requires OpenFlow 1.2 as a prerequisite, plus the
following additional work.  (This is based on the change log at the end of the
OF1.3 spec, reusing most of the section titles directly.  I didn&#8217;t compare the
specs carefully yet.)</p>
<ul>
<li><p class="first">Add support for multipart requests.</p>
<p>Currently we always report <code class="docutils literal"><span class="pre">OFPBRC_MULTIPART_BUFFER_OVERFLOW</span></code>.</p>
<p>(optional for OF1.3+)</p>
</li>
<li><p class="first">IPv6 extension header handling support.</p>
<p>Fully implementing this requires kernel support.  This likely will take some
careful and probably time-consuming design work.  The actual coding, once
that is all done, is probably 2 or 3 days work.</p>
<p>(optional for OF1.3+)</p>
</li>
<li><p class="first">Per-flow meters.</p>
<p>OpenFlow protocol support is now implemented.  Support for the special
<code class="docutils literal"><span class="pre">OFPM_SLOWPATH</span></code> and <code class="docutils literal"><span class="pre">OFPM_CONTROLLER</span></code> meters is missing.  Support for
the software switch is under review.</p>
<p>(optional for OF1.3+)</p>
</li>
<li><p class="first">Auxiliary connections.</p>
<p>An implementation in generic code might be a week&#8217;s worth of work.  The value
of an implementation in generic code is questionable, though, since much of
the benefit of axuiliary connections is supposed to be to take advantage of
hardware support.  (We could make the kernel module somehow send packets
across the auxiliary connections directly, for some kind of &#8220;hardware&#8221;
support, if we judged it useful enough.)</p>
<p>(optional for OF1.3+)</p>
</li>
<li><p class="first">Provider Backbone Bridge tagging.</p>
<p>I don&#8217;t plan to implement this (but we&#8217;d accept an implementation).</p>
<p>(optional for OF1.3+)</p>
</li>
<li><p class="first">On-demand flow counters.</p>
<p>I think this might be a real optimization in some cases for the software
switch.</p>
<p>(optional for OF1.3+)</p>
</li>
</ul>
</div>
<div class="section" id="openflow-1-4-onf-extensions-for-1-3-x-pack1">
<h5>OpenFlow 1.4 &amp; ONF Extensions for 1.3.X Pack1<a class="headerlink" href="#openflow-1-4-onf-extensions-for-1-3-x-pack1" title="Permalink to this headline">¶</a></h5>
<p>The following features are both defined as a set of ONF Extensions for 1.3 and
integrated in 1.4.</p>
<p>When defined as an ONF Extension for 1.3, the feature is using the Experimenter
mechanism with the ONF Experimenter ID.</p>
<p>When defined integrated in 1.4, the feature use the standard OpenFlow
structures (for example defined in openflow-1.4.h).</p>
<p>The two definitions for each feature are independent and can exist in parallel
in OVS.</p>
<ul>
<li><p class="first">Flow entry notifications</p>
<p>This seems to be modelled after OVS&#8217;s NXST_FLOW_MONITOR.  (Simon Horman is
working on this.)</p>
<p>(EXT-187)
(optional for OF1.4+)</p>
</li>
<li><p class="first">Role Status</p>
<p>Already implemented as a 1.4 feature.</p>
<p>(EXT-191)</p>
<p>(required for OF1.4+)</p>
</li>
<li><p class="first">Flow entry eviction</p>
<p>OVS has flow eviction functionality.  <code class="docutils literal"><span class="pre">table_mod</span> <span class="pre">OFPTC_EVICTION</span></code>,
<code class="docutils literal"><span class="pre">flow_mod</span> <span class="pre">'importance'</span></code>, and <code class="docutils literal"><span class="pre">table_desc</span> <span class="pre">ofp_table_mod_prop_eviction</span></code>
need to be implemented.</p>
<p>(EXT-192-e)</p>
<p>(optional for OF1.4+)</p>
</li>
<li><p class="first">Vacancy events</p>
<p>(EXT-192-v)</p>
<p>(optional for OF1.4+)</p>
</li>
<li><p class="first">Bundle</p>
<p>Transactional modification.  OpenFlow 1.4 requires to support
<code class="docutils literal"><span class="pre">flow_mods</span></code> and <code class="docutils literal"><span class="pre">port_mods</span></code> in a bundle if bundle is supported.
(Not related to OVS&#8217;s &#8216;ofbundle&#8217; stuff.)</p>
<p>Implemented as an OpenFlow 1.4 feature.  Only flow_mods and port_mods are
supported in a bundle.  If the bundle includes port mods, it may not specify
the <code class="docutils literal"><span class="pre">OFPBF_ATOMIC</span></code> flag.  Nevertheless, port mods and flow mods in a bundle
are always applied in order and consecutive flow mods between port mods are
made available to lookups atomically.</p>
<p>(EXT-230)</p>
<p>(optional for OF1.4+)</p>
</li>
<li><p class="first">Table synchronisation</p>
<p>Probably not so useful to the software switch.</p>
<p>(EXT-232)</p>
<p>(optional for OF1.4+)</p>
</li>
<li><p class="first">Group and Meter change notifications</p>
<p>(EXT-235)</p>
<p>(optional for OF1.4+)</p>
</li>
<li><p class="first">Bad flow entry priority error</p>
<p>Probably not so useful to the software switch.</p>
<p>(EXT-236)</p>
<p>(optional for OF1.4+)</p>
</li>
<li><p class="first">Set async config error</p>
<p>(EXT-237)</p>
<p>(optional for OF1.4+)</p>
</li>
<li><p class="first">PBB UCA header field</p>
<p>See comment on Provider Backbone Bridge in section about OpenFlow 1.3.</p>
<p>(EXT-256)</p>
<p>(optional for OF1.4+)</p>
</li>
<li><p class="first">Multipart timeout error</p>
<p>(EXT-264)</p>
<p>(required for OF1.4+)</p>
</li>
</ul>
</div>
<div class="section" id="openflow-1-4-only">
<h5>OpenFlow 1.4 only<a class="headerlink" href="#openflow-1-4-only" title="Permalink to this headline">¶</a></h5>
<p>Those features are those only available in OpenFlow 1.4, other OpenFlow 1.4
features are listed in the previous section.</p>
<ul>
<li><p class="first">More extensible wire protocol</p>
<p>Many on-wire structures got TLVs.</p>
<p>All required features are now supported.
Remaining optional: table desc, table-status</p>
<p>(EXT-262)</p>
<p>(required for OF1.4+)</p>
</li>
<li><p class="first">More descriptive reasons for packet-in</p>
<p>Distinguish <code class="docutils literal"><span class="pre">OFPR_APPLY_ACTION</span></code>, <code class="docutils literal"><span class="pre">OFPR_ACTION_SET</span></code>, <code class="docutils literal"><span class="pre">OFPR_GROUP</span></code>,
<code class="docutils literal"><span class="pre">OFPR_PACKET_OUT</span></code>.  <code class="docutils literal"><span class="pre">NO_MATCH</span></code> was renamed to <code class="docutils literal"><span class="pre">OFPR_TABLE_MISS</span></code>.
(OFPR_ACTION_SET and OFPR_GROUP are now supported)</p>
<p>(EXT-136)</p>
<p>(required for OF1.4+)</p>
</li>
<li><p class="first">Optical port properties</p>
<p>(EXT-154)</p>
<p>(optional for OF1.4+)</p>
</li>
</ul>
</div>
<div class="section" id="openflow-1-5-onf-extensions-for-1-3-x-pack2">
<h5>OpenFlow 1.5 &amp; ONF Extensions for 1.3.X Pack2<a class="headerlink" href="#openflow-1-5-onf-extensions-for-1-3-x-pack2" title="Permalink to this headline">¶</a></h5>
<p>The following features are both defined as a set of ONF Extensions for 1.3 and
integrated in 1.5. Note that this list is not definitive as those are not yet
published.</p>
<p>When defined as an ONF Extension for 1.3, the feature is using the Experimenter
mechanism with the ONF Experimenter ID.  When defined integrated in 1.5, the
feature use the standard OpenFlow structures (for example defined in
openflow-1.5.h).</p>
<p>The two definitions for each feature are independent and can exist in parallel
in OVS.</p>
<ul>
<li><p class="first">Time scheduled bundles</p>
<p>(EXT-340)</p>
<p>(optional for OF1.5+)</p>
</li>
</ul>
</div>
<div class="section" id="openflow-1-5-only">
<h5>OpenFlow 1.5 only<a class="headerlink" href="#openflow-1-5-only" title="Permalink to this headline">¶</a></h5>
<p>Those features are those only available in OpenFlow 1.5, other OpenFlow 1.5
features are listed in the previous section.  Note that this list is not
definitive as OpenFlow 1.5 is not yet published.</p>
<ul>
<li><p class="first">Egress Tables</p>
<p>(EXT-306)</p>
<p>(optional for OF1.5+)</p>
</li>
<li><p class="first">Packet Type aware pipeline</p>
<p>Prototype for OVS was done during specification.</p>
<p>(EXT-112)</p>
<p>(optional for OF1.5+)</p>
</li>
<li><p class="first">Extensible Flow Entry Statistics</p>
<p>(EXT-334)</p>
<p>(required for OF1.5+)</p>
</li>
<li><p class="first">Flow Entry Statistics Trigger</p>
<p>(EXT-335)</p>
<p>(optional for OF1.5+)</p>
</li>
<li><p class="first">Controller connection status</p>
<p>Prototype for OVS was done during specification.</p>
<p>(EXT-454)</p>
<p>(optional for OF1.5+)</p>
</li>
<li><p class="first">Meter action</p>
<p>(EXT-379)</p>
<p>(required for OF1.5+ if metering is supported)</p>
</li>
<li><p class="first">Enable setting all pipeline fields in packet-out</p>
<p>Prototype for OVS was done during specification.</p>
<p>(EXT-427)</p>
<p>(required for OF1.5+)</p>
</li>
<li><p class="first">Port properties for pipeline fields</p>
<p>Prototype for OVS was done during specification.</p>
<p>(EXT-388)</p>
<p>(optional for OF1.5+)</p>
</li>
<li><p class="first">Port property for recirculation</p>
<p>Prototype for OVS was done during specification.</p>
<p>(EXT-399)</p>
<p>(optional for OF1.5+)</p>
</li>
</ul>
</div>
<div class="section" id="general">
<h5>General<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>ovs-ofctl(8) often lists as Nicira extensions features that later OpenFlow
versions support in standard ways.</li>
</ul>
</div>
<div class="section" id="how-to-contribute">
<h5>How to contribute<a class="headerlink" href="#how-to-contribute" title="Permalink to this headline">¶</a></h5>
<p>If you plan to contribute code for a feature, please let everyone know on
ovs-dev before you start work.  This will help avoid duplicating work.</p>
<p>Consider the following:</p>
<ul>
<li><p class="first">Testing.</p>
<p>Please test your code.</p>
</li>
<li><p class="first">Unit tests.</p>
<p>Consider writing some.  The tests directory has many examples that you can
use as a starting point.</p>
</li>
<li><p class="first">ovs-ofctl.</p>
<p>If you add a feature that is useful for some ovs-ofctl command then you
should add support for it there.</p>
</li>
<li><p class="first">Documentation.</p>
<p>If you add a user-visible feature, then you should document it in the
appropriate manpage and mention it in NEWS as well.</p>
</li>
</ul>
<p>Refer to <a class="reference internal" href="contents.html#document-internals/contributing/index"><em>Contributing to Open vSwitch</em></a> for more information.</p>
</div>
</div>
<span id="document-topics/bonding"></span><div class="section" id="bonding">
<h4>Bonding<a class="headerlink" href="#bonding" title="Permalink to this headline">¶</a></h4>
<p>Bonding allows two or more interfaces (the &#8220;slaves&#8221;) to share network traffic.
From a high-level point of view, bonded interfaces act like a single port, but
they have the bandwidth of multiple network devices, e.g. two 1 GB physical
interfaces act like a single 2 GB interface.  Bonds also increase robustness:
the bonded port does not go down as long as at least one of its slaves is up.</p>
<p>In vswitchd, a bond always has at least two slaves (and may have more).  If a
configuration error, etc. would cause a bond to have only one slave, the port
becomes an ordinary port, not a bonded port, and none of the special features
of bonded ports described in this section apply.</p>
<p>There are many forms of bonding of which ovs-vswitchd implements only a few.
The most complex bond ovs-vswitchd implements is called &#8220;source load balancing&#8221;
or SLB bonding.  SLB bonding divides traffic among the slaves based on the
Ethernet source address.  This is useful only if the traffic over the bond has
multiple Ethernet source addresses, for example if network traffic from
multiple VMs are multiplexed over the bond.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Most of the ovs-vswitchd implementation is in <code class="docutils literal"><span class="pre">vswitchd/bridge.c</span></code>, so code
references below should be assumed to refer to that file except as otherwise
specified.</p>
</div>
<div class="section" id="enabling-and-disabling-slaves">
<h5>Enabling and Disabling Slaves<a class="headerlink" href="#enabling-and-disabling-slaves" title="Permalink to this headline">¶</a></h5>
<p>When a bond is created, a slave is initially enabled or disabled based on
whether carrier is detected on the NIC (see <code class="docutils literal"><span class="pre">iface_create()</span></code>).  After that, a
slave is disabled if its carrier goes down for a period of time longer than the
downdelay, and it is enabled if carrier comes up for longer than the updelay
(see <code class="docutils literal"><span class="pre">bond_link_status_update()</span></code>).  There is one exception where the updelay
is skipped: if no slaves at all are currently enabled, then the first slave on
which carrier comes up is enabled immediately.</p>
<p>The updelay should be set to a time longer than the STP forwarding delay of the
physical switch to which the bond port is connected (if STP is enabled on that
switch).  Otherwise, the slave will be enabled, and load may be shifted to it,
before the physical switch starts forwarding packets on that port, which can
cause some data to be &#8220;blackholed&#8221; for a time.  The exception for a single
enabled slave does not cause any problem in this regard because when no slaves
are enabled all output packets are blackholed anyway.</p>
<p>When a slave becomes disabled, the vswitch immediately chooses a new output
port for traffic that was destined for that slave (see
<code class="docutils literal"><span class="pre">bond_enable_slave()</span></code>).  It also sends a &#8220;gratuitous learning packet&#8221;,
specifically a RARP, on the bond port (on the newly chosen slave) for each MAC
address that the vswitch has learned on a port other than the bond (see
<code class="docutils literal"><span class="pre">bond_send_learning_packets()</span></code>), to teach the physical switch that the new
slave should be used in place of the one that is now disabled.  (This behavior
probably makes sense only for a vswitch that has only one port (the bond)
connected to a physical switch; vswitchd should probably provide a way to
disable or configure it in other scenarios.)</p>
</div>
<div class="section" id="bond-packet-input">
<h5>Bond Packet Input<a class="headerlink" href="#bond-packet-input" title="Permalink to this headline">¶</a></h5>
<p>Bonding accepts unicast packets on any bond slave.  This can occasionally cause
packet duplication for the first few packets sent to a given MAC, if the
physical switch attached to the bond is flooding packets to that MAC because it
has not yet learned the correct slave for that MAC.</p>
<p>Bonding only accepts multicast (and broadcast) packets on a single bond slave
(the &#8220;active slave&#8221;) at any given time.  Multicast packets received on other
slaves are dropped.  Otherwise, every multicast packet would be duplicated,
once for every bond slave, because the physical switch attached to the bond
will flood those packets.</p>
<p>Bonding also drops received packets when the vswitch has learned that the
packet&#8217;s MAC is on a port other than the bond port itself.  This is because it
is likely that the vswitch itself sent the packet out the bond port on a
different slave and is now receiving the packet back.  This occurs when the
packet is multicast or the physical switch has not yet learned the MAC and is
flooding it.  However, the vswitch makes an exception to this rule for
broadcast ARP replies, which indicate that the MAC has moved to another switch,
probably due to VM migration.  (ARP replies are normally unicast, so this
exception does not match normal ARP replies.  It will match the learning
packets sent on bond fail-over.)</p>
<p>The active slave is simply the first slave to be enabled after the bond is
created (see <code class="docutils literal"><span class="pre">bond_choose_active_iface()</span></code>).  If the active slave is disabled,
then a new active slave is chosen among the slaves that remain active.
Currently due to the way that configuration works, this tends to be the
remaining slave whose interface name is first alphabetically, but this is by no
means guaranteed.</p>
</div>
<div class="section" id="bond-packet-output">
<h5>Bond Packet Output<a class="headerlink" href="#bond-packet-output" title="Permalink to this headline">¶</a></h5>
<p>When a packet is sent out a bond port, the bond slave actually used is selected
based on the packet&#8217;s source MAC and VLAN tag (see <code class="docutils literal"><span class="pre">choose_output_iface()</span></code>).
In particular, the source MAC and VLAN tag are hashed into one of 256 values,
and that value is looked up in a hash table (the &#8220;bond hash&#8221;) kept in the
<code class="docutils literal"><span class="pre">bond_hash</span></code> member of struct port.  The hash table entry identifies a bond
slave.  If no bond slave has yet been chosen for that hash table entry,
vswitchd chooses one arbitrarily.</p>
<p>Every 10 seconds, vswitchd rebalances the bond slaves (see
<code class="docutils literal"><span class="pre">bond_rebalance_port()</span></code>).  To rebalance, vswitchd examines the statistics for
the number of bytes transmitted by each slave over approximately the past
minute, with data sent more recently weighted more heavily than data sent less
recently.  It considers each of the slaves in order from most-loaded to
least-loaded.  If highly loaded slave H is significantly more heavily loaded
than the least-loaded slave L, and slave H carries at least two hashes, then
vswitchd shifts one of H&#8217;s hashes to L.  However, vswitchd will only shift a
hash from H to L if it will decrease the ratio of the load between H and L by
at least 0.1.</p>
<p>Currently, &#8220;significantly more loaded&#8221; means that H must carry at least 1 Mbps
more traffic, and that traffic must be at least 3% greater than L&#8217;s.</p>
</div>
<div class="section" id="bond-balance-modes">
<h5>Bond Balance Modes<a class="headerlink" href="#bond-balance-modes" title="Permalink to this headline">¶</a></h5>
<p>Each bond balancing mode has different considerations, described below.</p>
<div class="section" id="lacp-bonding">
<h6>LACP Bonding<a class="headerlink" href="#lacp-bonding" title="Permalink to this headline">¶</a></h6>
<p>LACP bonding requires the remote switch to implement LACP, but it is otherwise
very simple in that, after LACP negotiation is complete, there is no need for
special handling of received packets.</p>
<p>Several of the physical switches that support LACP block all traffic for ports
that are configured to use LACP, until LACP is negotiated with the host. When
configuring a LACP bond on a OVS host (eg: XenServer), this means that there
will be an interruption of the network connectivity between the time the ports
on the physical switch and the bond on the OVS host are configured. The
interruption may be relatively long, if different people are responsible for
managing the switches and the OVS host.</p>
<p>Such network connectivity failure can be avoided if LACP can be configured on
the OVS host before configuring the physical switch, and having the OVS host
fall back to a bond mode (active-backup) till the physical switch LACP
configuration is complete. An option &#8220;lacp-fallback-ab&#8221; exists to provide such
behavior on openvswitch.</p>
</div>
<div class="section" id="active-backup-bonding">
<h6>Active Backup Bonding<a class="headerlink" href="#active-backup-bonding" title="Permalink to this headline">¶</a></h6>
<p>Active Backup bonds send all traffic out one &#8220;active&#8221; slave until that slave
becomes unavailable.  Since they are significantly less complicated than SLB
bonds, they are preferred when LACP is not an option.  Additionally, they are
the only bond mode which supports attaching each slave to a different upstream
switch.</p>
</div>
<div class="section" id="slb-bonding">
<h6>SLB Bonding<a class="headerlink" href="#slb-bonding" title="Permalink to this headline">¶</a></h6>
<p>SLB bonding allows a limited form of load balancing without the remote switch&#8217;s
knowledge or cooperation.  The basics of SLB are simple.  SLB assigns each
source MAC+VLAN pair to a link and transmits all packets from that MAC+VLAN
through that link.  Learning in the remote switch causes it to send packets to
that MAC+VLAN through the same link.</p>
<p>SLB bonding has the following complications:</p>
<ol class="arabic" start="0">
<li><p class="first">When the remote switch has not learned the MAC for the destination of a
unicast packet and hence floods the packet to all of the links on the SLB
bond, Open vSwitch will forward duplicate packets, one per link, to each
other switch port.</p>
<p>Open vSwitch does not solve this problem.</p>
</li>
<li><p class="first">When the remote switch receives a multicast or broadcast packet from a port
not on the SLB bond, it will forward it to all of the links in the SLB bond.
This would cause packet duplication if not handled specially.</p>
<p>Open vSwitch avoids packet duplication by accepting multicast and broadcast
packets on only the active slave, and dropping multicast and broadcast
packets on all other slaves.</p>
</li>
<li><p class="first">When Open vSwitch forwards a multicast or broadcast packet to a link in the
SLB bond other than the active slave, the remote switch will forward it to
all of the other links in the SLB bond, including the active slave.  Without
special handling, this would mean that Open vSwitch would forward a second
copy of the packet to each switch port (other than the bond), including the
port that originated the packet.</p>
<p>Open vSwitch deals with this case by dropping packets received on any SLB
bonded link that have a source MAC+VLAN that has been learned on any other
port.  (This means that SLB as implemented in Open vSwitch relies critically
on MAC learning.  Notably, SLB is incompatible with the &#8220;flood_vlans&#8221;
feature.)</p>
</li>
<li><p class="first">Suppose that a MAC+VLAN moves to an SLB bond from another port (e.g. when a
VM is migrated from this hypervisor to a different one).  Without additional
special handling, Open vSwitch will not notice until the MAC learning entry
expires, up to 60 seconds later as a consequence of rule #2.</p>
<p>Open vSwitch avoids a 60-second delay by listening for gratuitous ARPs,
which VMs commonly emit upon migration.  As an exception to rule #2, a
gratuitous ARP received on an SLB bond is not dropped and updates the MAC
learning table in the usual way.  (If a move does not trigger a gratuitous
ARP, or if the gratuitous ARP is lost in the network, then a 60-second delay
still occurs.)</p>
</li>
<li><p class="first">Suppose that a MAC+VLAN moves from an SLB bond to another port (e.g. when a
VM is migrated from a different hypervisor to this one), that the MAC+VLAN
emits a gratuitous ARP, and that Open vSwitch forwards that gratuitous ARP
to a link in the SLB bond other than the active slave.  The remote switch
will forward the gratuitous ARP to all of the other links in the SLB bond,
including the active slave.  Without additional special handling, this would
mean that Open vSwitch would learn that the MAC+VLAN was located on the SLB
bond, as a consequence of rule #3.</p>
<p>Open vSwitch avoids this problem by &#8220;locking&#8221; the MAC learning table entry
for a MAC+VLAN from which a gratuitous ARP was received from a non-SLB bond
port.  For 5 seconds, a locked MAC learning table entry will not be updated
based on a gratuitous ARP received on a SLB bond.</p>
</li>
</ol>
</div>
</div>
</div>
<span id="document-topics/ovsdb-replication"></span><div class="section" id="ovsdb-replication-implementation">
<h4>OVSDB Replication Implementation<a class="headerlink" href="#ovsdb-replication-implementation" title="Permalink to this headline">¶</a></h4>
<p>Given two Open vSwitch databases with the same schema, OVSDB replication keeps
these databases in the same state, i.e. each of the databases have the same
contents at any given time even if they are not running in the same host.  This
document elaborates on the implementation details to provide this
functionality.</p>
<div class="section" id="terminology">
<h5>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt>Source of truth database</dt>
<dd>database whose content will be replicated to another database.</dd>
<dt>Active server</dt>
<dd>ovsdb-server providing RPC interface to the source of truth database.</dd>
<dt>Standby server</dt>
<dd>ovsdb-server providing RPC interface to the database that is not the source
of truth.</dd>
</dl>
</div>
<div class="section" id="design">
<h5>Design<a class="headerlink" href="#design" title="Permalink to this headline">¶</a></h5>
<p>The overall design of replication consists of one ovsdb-server (active server)
communicating the state of its databases to another ovsdb-server (standby
server) so that the latter keep its own databases in that same state.  To
achieve this, the standby server acts as a client of the active server, in the
sense that it sends a monitor request to keep up to date with the changes in
the active server databases. When a notification from the active server
arrives, the standby server executes the necessary set of operations so its
databases reach the same state as the the active server databases. Below is the
design represented as a diagram.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>+--------------+    replication     +--------------+
|    Active    |&lt;-------------------|   Standby    |
| OVSDB-server |                    | OVSDB-server |
+--------------+                    +--------------+
        |                                  |
        |                                  |
    +-------+                          +-------+
    |  SoT  |                          |       |
    | OVSDB |                          | OVSDB |
    +-------+                          +-------+
</pre></div>
</div>
</div>
<div class="section" id="setting-up-the-replication">
<h5>Setting Up The Replication<a class="headerlink" href="#setting-up-the-replication" title="Permalink to this headline">¶</a></h5>
<p>To initiate the replication process, the standby server must be executed
indicating the location of the active server via the command line option
<code class="docutils literal"><span class="pre">--sync-from=server</span></code>, where server can take any form described in the
ovsdb-client manpage and it must specify an active connection type (tcp, unix,
ssl). This option will cause the standby server to attempt to send a monitor
request to the active server in every main loop iteration, until the active
server responds.</p>
<p>When sending a monitor request the standby server is doing the following:</p>
<ol class="arabic simple">
<li>Erase the content of the databases for which it is providing a RPC
interface.</li>
<li>Open the jsonrpc channel to communicate with the active server.</li>
<li>Fetch all the databases located in the active server.</li>
<li>For each database with the same schema in both the active and standby
servers: construct and send a monitor request message specifying the tables
that will be monitored (i.e all the tables on the database except the ones
blacklisted [*]).</li>
<li>Set the standby database to the current state of the active database.</li>
</ol>
<p>Once the monitor request message is sent, the standby server will continuously
receive notifications of changes occurring to the tables specified in the
request. The process of handling this notifications is detailed in the next
section.</p>
<p>[*] A set of tables that will be excluded from replication can be configure as
a blacklist of tables via the command line option
<code class="docutils literal"><span class="pre">--sync-exclude-tables=db:table[,db:table]...</span></code>, where db corresponds to the
database where the table resides.</p>
</div>
<div class="section" id="replication-process">
<h5>Replication Process<a class="headerlink" href="#replication-process" title="Permalink to this headline">¶</a></h5>
<p>The replication process consists on handling the update notifications received
in the standby server caused by the monitor request that was previously sent to
the active server. In every loop iteration, the standby server attempts to
receive a message from the active server which can be an error, an echo message
(used to keep the connection alive) or an update notification. In case the
message is a fatal error, the standby server will disconnect from the active
without dropping the replicated data. If it is an echo message, the standby
server will reply with an echo message as well. If the message is an update
notification, the following process occurs:</p>
<ol class="arabic">
<li><p class="first">Create a new transaction.</p>
</li>
<li><p class="first">Get the <code class="docutils literal"><span class="pre">&lt;table-updates&gt;</span></code> object from the <code class="docutils literal"><span class="pre">params</span></code> member of the
notification.</p>
</li>
<li><p class="first">For each <code class="docutils literal"><span class="pre">&lt;table-update&gt;</span></code> in the <code class="docutils literal"><span class="pre">&lt;table-updates&gt;</span></code> object do:</p>
<blockquote>
<div><ol class="arabic simple">
<li>For each <code class="docutils literal"><span class="pre">&lt;row-update&gt;</span></code> in <code class="docutils literal"><span class="pre">&lt;table-update&gt;</span></code> check what kind of
operation should be executed according to the following criteria
about the presence of the object members:<ul>
<li>If <code class="docutils literal"><span class="pre">old</span></code> member is not present, execute an insert operation using
<code class="docutils literal"><span class="pre">&lt;row&gt;</span></code> from the <code class="docutils literal"><span class="pre">new</span></code> member.</li>
<li>If <code class="docutils literal"><span class="pre">old</span></code> member is present and <code class="docutils literal"><span class="pre">new</span></code> member is not present,
execute a delete operation using <code class="docutils literal"><span class="pre">&lt;row&gt;</span></code> from the <code class="docutils literal"><span class="pre">old</span></code> member</li>
<li>If both <code class="docutils literal"><span class="pre">old</span></code> and <code class="docutils literal"><span class="pre">new</span></code> members are present, execute an update
operation using <code class="docutils literal"><span class="pre">&lt;row&gt;</span></code> from the <code class="docutils literal"><span class="pre">new</span></code> member.</li>
</ul>
</li>
</ol>
</div></blockquote>
</li>
<li><p class="first">Commit the transaction.</p>
<p>If an error occurs during the replication process, all replication is
restarted by resending a new monitor request as described in the section
&#8220;Setting up the replication&#8221;.</p>
</li>
</ol>
</div>
<div class="section" id="runtime-management-commands">
<h5>Runtime Management Commands<a class="headerlink" href="#runtime-management-commands" title="Permalink to this headline">¶</a></h5>
<p>Runtime management commands can be sent to a running standby server via
ovs-appctl in order to configure the replication functionality. The available
commands are the following.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">ovsdb-server/set-remote-ovsdb-server</span> <span class="pre">{server}</span></code></dt>
<dd>sets the name of the active server</dd>
<dt><code class="docutils literal"><span class="pre">ovsdb-server/get-remote-ovsdb-server</span></code></dt>
<dd>gets the name of the active server</dd>
<dt><code class="docutils literal"><span class="pre">ovsdb-server/connect-remote-ovsdb-server</span></code></dt>
<dd>causes the server to attempt to send a monitor request every main loop
iteration</dd>
<dt><code class="docutils literal"><span class="pre">ovsdb-server/disconnect-remote-ovsdb-server</span></code></dt>
<dd>closes the jsonrpc channel between the active server and frees the memory
used for the replication configuration.</dd>
<dt><code class="docutils literal"><span class="pre">ovsdb-server/set-sync-exclude-tables</span> <span class="pre">{db:table,...}</span></code></dt>
<dd>sets the tables list that will be excluded from being replicated</dd>
<dt><code class="docutils literal"><span class="pre">ovsdb-server/get-sync-excluded-tables</span></code></dt>
<dd>gets the tables list that is currently excluded from replication</dd>
</dl>
</div>
</div>
<span id="document-topics/dpdk/index"></span><div class="section" id="the-dpdk-datapath">
<h4>The DPDK Datapath<a class="headerlink" href="#the-dpdk-datapath" title="Permalink to this headline">¶</a></h4>
<div class="toctree-wrapper compound">
<span id="document-topics/dpdk/vhost-user"></span><div class="section" id="dpdk-vhost-user-ports">
<h5>DPDK vHost User Ports<a class="headerlink" href="#dpdk-vhost-user-ports" title="Permalink to this headline">¶</a></h5>
<p>The DPDK datapath provides DPDK-backed vHost user ports as a primary way to
interact with guests. For more information on vHost User, refer to the <a class="reference external" href="http://git.qemu-project.org/?p=qemu.git;a=blob;f=docs/specs/vhost-user.txt;h=7890d7169;hb=HEAD">QEMU
documentation</a> on same.</p>
<div class="section" id="quick-example">
<h6>Quick Example<a class="headerlink" href="#quick-example" title="Permalink to this headline">¶</a></h6>
<p>This example demonstrates how to add two <code class="docutils literal"><span class="pre">dpdkvhostuser</span></code> ports to an existing
bridge called <code class="docutils literal"><span class="pre">br0</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 dpdkvhostuser0 \
    -- set Interface dpdkvhostuser0 type=dpdkvhostuser
$ ovs-vsctl add-port br0 dpdkvhostuser1 \
    -- set Interface dpdkvhostuser1 type=dpdkvhostuser
</pre></div>
</div>
</div>
<div class="section" id="vhost-user-vs-vhost-user-client">
<h6>vhost-user vs. vhost-user-client<a class="headerlink" href="#vhost-user-vs-vhost-user-client" title="Permalink to this headline">¶</a></h6>
<p>Open vSwitch provides two types of vHost User ports:</p>
<ul class="simple">
<li>vhost-user (<code class="docutils literal"><span class="pre">dpdkvhostuser</span></code>)</li>
<li>vhost-user-client (<code class="docutils literal"><span class="pre">dpdkvhostuserclient</span></code>)</li>
</ul>
<p>vHost User uses a client-server model. The server creates/manages/destroys the
vHost User sockets, and the client connects to the server. Depending on which
port type you use, <code class="docutils literal"><span class="pre">dpdkvhostuser</span></code> or <code class="docutils literal"><span class="pre">dpdkvhostuserclient</span></code>, a different
configuration of the client-server model is used.</p>
<p>For vhost-user ports, Open vSwitch acts as the server and QEMU the client.  For
vhost-user-client ports, Open vSwitch acts as the client and QEMU the server.</p>
</div>
<div class="section" id="vhost-user">
<span id="dpdk-vhost-user"></span><h6>vhost-user<a class="headerlink" href="#vhost-user" title="Permalink to this headline">¶</a></h6>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Use of vhost-user ports requires QEMU &gt;= 2.2</p>
</div>
<p>To use vhost-user ports, you must first add said ports to the switch. Unlike
DPDK ring ports, DPDK vhost-user ports can have arbitrary names, except that
forward and backward slashes are prohibited in the names. For vhost-user, the
port type is <code class="docutils literal"><span class="pre">dpdkvhostuser</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 vhost-user-1 -- set Interface vhost-user-1 \
    type=dpdkvhostuser
</pre></div>
</div>
<p>This action creates a socket located at
<code class="docutils literal"><span class="pre">/usr/local/var/run/openvswitch/vhost-user-1</span></code>, which you must provide to your
VM on the QEMU command line.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you wish for the vhost-user sockets to be created in a sub-directory of
<code class="docutils literal"><span class="pre">/usr/local/var/run/openvswitch</span></code>, you may specify this directory in the
ovsdb like so:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl --no-wait \
    set Open_vSwitch . other_config:vhost-sock-dir=subdir`
</pre></div>
</div>
</div>
<p>Once the vhost-user ports have been added to the switch, they must be added to
the guest. There are two ways to do this: using QEMU directly, or using
libvirt.</p>
<div class="section" id="adding-vhost-user-ports-to-the-guest-qemu">
<h7>Adding vhost-user ports to the guest (QEMU)<a class="headerlink" href="#adding-vhost-user-ports-to-the-guest-qemu" title="Permalink to this headline">¶</a></h7>
<p>To begin, you must attach the vhost-user device sockets to the guest. To do
this, you must pass the following parameters to QEMU:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>-chardev socket,id=char1,path=/usr/local/var/run/openvswitch/vhost-user-1
-netdev type=vhost-user,id=mynet1,chardev=char1,vhostforce
-device virtio-net-pci,mac=00:00:00:00:00:01,netdev=mynet1
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">vhost-user-1</span></code> is the name of the vhost-user port added to the switch.</p>
<p>Repeat the above parameters for multiple devices, changing the chardev <code class="docutils literal"><span class="pre">path</span></code>
and <code class="docutils literal"><span class="pre">id</span></code> as necessary. Note that a separate and different chardev <code class="docutils literal"><span class="pre">path</span></code>
needs to be specified for each vhost-user device. For example you have a second
vhost-user port named <code class="docutils literal"><span class="pre">vhost-user-2</span></code>, you append your QEMU command line with
an additional set of parameters:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>-chardev socket,id=char2,path=/usr/local/var/run/openvswitch/vhost-user-2
-netdev type=vhost-user,id=mynet2,chardev=char2,vhostforce
-device virtio-net-pci,mac=00:00:00:00:00:02,netdev=mynet2
</pre></div>
</div>
<p>In addition,       QEMU must allocate the VM&#8217;s memory on hugetlbfs. vhost-user
ports access a virtio-net device&#8217;s virtual rings and packet buffers mapping the
VM&#8217;s physical memory on hugetlbfs. To enable vhost-user ports to map the VM&#8217;s
memory into their process address space, pass the following parameters to
QEMU:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>-object memory-backend-file,id=mem,size=4096M,mem-path=/dev/hugepages,share=on
-numa node,memdev=mem -mem-prealloc
</pre></div>
</div>
<p>Finally, you may wish to enable multiqueue support. This is optional but,
should you wish to enable it, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>-chardev socket,id=char2,path=/usr/local/var/run/openvswitch/vhost-user-2
-netdev type=vhost-user,id=mynet2,chardev=char2,vhostforce,queues=$q
-device virtio-net-pci,mac=00:00:00:00:00:02,netdev=mynet2,mq=on,vectors=$v
</pre></div>
</div>
<p>where:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">$q</span></code></dt>
<dd>The number of queues</dd>
<dt><code class="docutils literal"><span class="pre">$v</span></code></dt>
<dd>The number of vectors, which is <code class="docutils literal"><span class="pre">$q</span></code> * 2 + 2</dd>
</dl>
<p>The vhost-user interface will be automatically reconfigured with required
number of rx and tx queues after connection of virtio device.  Manual
configuration of <code class="docutils literal"><span class="pre">n_rxq</span></code> is not supported because OVS will work properly only
if <code class="docutils literal"><span class="pre">n_rxq</span></code> will match number of queues configured in QEMU.</p>
<p>A least 2 PMDs should be configured for the vswitch when using multiqueue.
Using a single PMD will cause traffic to be enqueued to the same vhost queue
rather than being distributed among different vhost queues for a vhost-user
interface.</p>
<p>If traffic destined for a VM configured with multiqueue arrives to the vswitch
via a physical DPDK port, then the number of rxqs should also be set to at
least 2 for that physical DPDK port. This is required to increase the
probability that a different PMD will handle the multiqueue transmission to the
guest using a different vhost queue.</p>
<p>If one wishes to use multiple queues for an interface in the guest, the driver
in the guest operating system must be configured to do so. It is recommended
that the number of queues configured be equal to <code class="docutils literal"><span class="pre">$q</span></code>.</p>
<p>For example, this can be done for the Linux kernel virtio-net driver with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ethtool -L &lt;DEV&gt; combined &lt;$q&gt;
</pre></div>
</div>
<p>where:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">-L</span></code></dt>
<dd>Changes the numbers of channels of the specified network device</dd>
<dt><code class="docutils literal"><span class="pre">combined</span></code></dt>
<dd>Changes the number of multi-purpose channels.</dd>
</dl>
</div>
<div class="section" id="adding-vhost-user-ports-to-the-guest-libvirt">
<h7>Adding vhost-user ports to the guest (libvirt)<a class="headerlink" href="#adding-vhost-user-ports-to-the-guest-libvirt" title="Permalink to this headline">¶</a></h7>
<p>To begin, you must change the user and group that libvirt runs under, configure
access control policy and restart libvirtd.</p>
<ul>
<li><p class="first">In <code class="docutils literal"><span class="pre">/etc/libvirt/qemu.conf</span></code> add/edit the following lines:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="s2">&quot;root&quot;</span>
<span class="n">group</span> <span class="o">=</span> <span class="s2">&quot;root&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Disable SELinux or set to permissive mode:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ setenforce 0
</pre></div>
</div>
</li>
<li><p class="first">Finally, restart the libvirtd process, For example, on Fedora:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ systemctl restart libvirtd.service
</pre></div>
</div>
</li>
</ul>
<p>Once complete, instantiate the VM. A sample XML configuration file is provided
at the <a class="reference internal" href="#dpdk-vhost-user-xml"><span>end of this file</span></a>. Save this file, then
create a VM using this file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ virsh create demovm.xml
</pre></div>
</div>
<p>Once created, you can connect to the guest console:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ virsh console demovm
</pre></div>
</div>
<p>The demovm xml configuration is aimed at achieving out of box performance on
VM. These enhancements include:</p>
<ul class="simple">
<li>The vcpus are pinned to the cores of the CPU socket 0 using <code class="docutils literal"><span class="pre">vcpupin</span></code>.</li>
<li>Configure NUMA cell and memory shared using <code class="docutils literal"><span class="pre">memAccess='shared'</span></code>.</li>
<li>Disable <code class="docutils literal"><span class="pre">mrg_rxbuf='off'</span></code></li>
</ul>
<p>Refer to the <a class="reference external" href="http://libvirt.org/formatdomain.html">libvirt documentation</a>
for more information.</p>
</div>
</div>
<div class="section" id="vhost-user-client">
<span id="dpdk-vhost-user-client"></span><h6>vhost-user-client<a class="headerlink" href="#vhost-user-client" title="Permalink to this headline">¶</a></h6>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Use of vhost-user ports requires QEMU &gt;= 2.7</p>
</div>
<p>To use vhost-user-client ports, you must first add said ports to the switch.
Like DPDK vhost-user ports, DPDK vhost-user-client ports can have mostly
arbitrary. However, the name given to the port does not govern the name of the
socket device. Instead, this must be configured by the user by way of a
<code class="docutils literal"><span class="pre">vhost-server-path</span></code> option. For vhost-user-client, the port type is
<code class="docutils literal"><span class="pre">dpdkvhostuserclient</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ VHOST_USER_SOCKET_PATH=/path/to/socket
$ ovs-vsctl add-port br0 vhost-client-1 \
    -- set Interface vhost-client-1 type=dpdkvhostuserclient \
         options:vhost-server-path=$VHOST_USER_SOCKET_PATH
</pre></div>
</div>
<p>Once the vhost-user-client ports have been added to the switch, they must be
added to the guest. Like vhost-user ports, there are two ways to do this: using
QEMU directly, or using libvirt. Only the QEMU case is covered here.</p>
<div class="section" id="adding-vhost-user-client-ports-to-the-guest-qemu">
<h7>Adding vhost-user-client ports to the guest (QEMU)<a class="headerlink" href="#adding-vhost-user-client-ports-to-the-guest-qemu" title="Permalink to this headline">¶</a></h7>
<p>Attach the vhost-user device sockets to the guest. To do this, you must pass
the following parameters to QEMU:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>-chardev socket,id=char1,path=$VHOST_USER_SOCKET_PATH,server
-netdev type=vhost-user,id=mynet1,chardev=char1,vhostforce
-device virtio-net-pci,mac=00:00:00:00:00:01,netdev=mynet1
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">vhost-user-1</span></code> is the name of the vhost-user port added to the switch.</p>
<p>If the corresponding <code class="docutils literal"><span class="pre">dpdkvhostuserclient</span></code> port has not yet been configured
in OVS with <code class="docutils literal"><span class="pre">vhost-server-path=/path/to/socket</span></code>, QEMU will print a log
similar to the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>QEMU waiting for connection on: disconnected:unix:/path/to/socket,server
</pre></div>
</div>
<p>QEMU will wait until the port is created sucessfully in OVS to boot the VM.
One benefit of using this mode is the ability for vHost ports to &#8216;reconnect&#8217; in
event of the switch crashing or being brought down. Once it is brought back up,
the vHost ports will reconnect automatically and normal service will resume.</p>
</div>
</div>
<div class="section" id="dpdk-in-the-guest">
<span id="dpdk-testpmd"></span><h6>DPDK in the Guest<a class="headerlink" href="#dpdk-in-the-guest" title="Permalink to this headline">¶</a></h6>
<p>The DPDK <code class="docutils literal"><span class="pre">testpmd</span></code> application can be run in guest VMs for high speed packet
forwarding between vhostuser ports. DPDK and testpmd application has to be
compiled on the guest VM. Below are the steps for setting up the testpmd
application in the VM.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Support for DPDK in the guest requires QEMU &gt;= 2.2</p>
</div>
<p>To begin, instantiate a guest as described in <a class="reference internal" href="#dpdk-vhost-user"><span>vhost-user</span></a> or
<a class="reference internal" href="#dpdk-vhost-user-client"><span>vhost-user-client</span></a>. Once started, connect to the VM, download the
DPDK sources to VM and build DPDK:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cd /root/dpdk/
$ wget http://fast.dpdk.org/rel/dpdk-16.11.tar.xz
$ tar xf dpdk-16.11.tar.xz
$ export DPDK_DIR=/root/dpdk/dpdk-16.11
$ export DPDK_TARGET=x86_64-native-linuxapp-gcc
$ export DPDK_BUILD=$DPDK_DIR/$DPDK_TARGET
$ cd $DPDK_DIR
$ make install T=$DPDK_TARGET DESTDIR=install
</pre></div>
</div>
<p>Build the test-pmd application:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cd app/test-pmd
$ export RTE_SDK=$DPDK_DIR
$ export RTE_TARGET=$DPDK_TARGET
$ make
</pre></div>
</div>
<p>Setup huge pages and DPDK devices using UIO:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ sysctl vm.nr_hugepages=1024
$ mkdir -p /dev/hugepages
$ mount -t hugetlbfs hugetlbfs /dev/hugepages  # only if not already mounted
$ modprobe uio
$ insmod $DPDK_BUILD/kmod/igb_uio.ko
$ $DPDK_DIR/tools/dpdk-devbind.py --status
$ $DPDK_DIR/tools/dpdk-devbind.py -b igb_uio 00:03.0 00:04.0
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>vhost ports pci ids can be retrieved using:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span>lspci | grep Ethernet
</pre></div>
</div>
</div>
<p>Finally, start the application:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># TODO</span>
</pre></div>
</div>
</div>
<div class="section" id="sample-xml">
<span id="dpdk-vhost-user-xml"></span><h6>Sample XML<a class="headerlink" href="#sample-xml" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python"><div class="highlight"><pre><span></span>&lt;domain type=&#39;kvm&#39;&gt;
  &lt;name&gt;demovm&lt;/name&gt;
  &lt;uuid&gt;4a9b3f53-fa2a-47f3-a757-dd87720d9d1d&lt;/uuid&gt;
  &lt;memory unit=&#39;KiB&#39;&gt;4194304&lt;/memory&gt;
  &lt;currentMemory unit=&#39;KiB&#39;&gt;4194304&lt;/currentMemory&gt;
  &lt;memoryBacking&gt;
    &lt;hugepages&gt;
      &lt;page size=&#39;2&#39; unit=&#39;M&#39; nodeset=&#39;0&#39;/&gt;
    &lt;/hugepages&gt;
  &lt;/memoryBacking&gt;
  &lt;vcpu placement=&#39;static&#39;&gt;2&lt;/vcpu&gt;
  &lt;cputune&gt;
    &lt;shares&gt;4096&lt;/shares&gt;
    &lt;vcpupin vcpu=&#39;0&#39; cpuset=&#39;4&#39;/&gt;
    &lt;vcpupin vcpu=&#39;1&#39; cpuset=&#39;5&#39;/&gt;
    &lt;emulatorpin cpuset=&#39;4,5&#39;/&gt;
  &lt;/cputune&gt;
  &lt;os&gt;
    &lt;type arch=&#39;x86_64&#39; machine=&#39;pc&#39;&gt;hvm&lt;/type&gt;
    &lt;boot dev=&#39;hd&#39;/&gt;
  &lt;/os&gt;
  &lt;features&gt;
    &lt;acpi/&gt;
    &lt;apic/&gt;
  &lt;/feature&gt;
  &lt;cpu mode=&#39;host-model&#39;&gt;
    &lt;model fallback=&#39;allow&#39;/&gt;
    &lt;topology sockets=&#39;2&#39; cores=&#39;1&#39; threads=&#39;1&#39;/&gt;
    &lt;numa&gt;
      &lt;cell id=&#39;0&#39; cpus=&#39;0-1&#39; memory=&#39;4194304&#39; unit=&#39;KiB&#39; memAccess=&#39;shared&#39;/&gt;
    &lt;/numa&gt;
  &lt;/cpu&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;destroy&lt;/on_crash&gt;
  &lt;devices&gt;
    &lt;emulator&gt;/usr/bin/qemu-kvm&lt;/emulator&gt;
    &lt;disk type=&#39;file&#39; device=&#39;disk&#39;&gt;
      &lt;driver name=&#39;qemu&#39; type=&#39;qcow2&#39; cache=&#39;none&#39;/&gt;
      &lt;source file=&#39;/root/CentOS7_x86_64.qcow2&#39;/&gt;
      &lt;target dev=&#39;vda&#39; bus=&#39;virtio&#39;/&gt;
    &lt;/disk&gt;
    &lt;disk type=&#39;dir&#39; device=&#39;disk&#39;&gt;
      &lt;driver name=&#39;qemu&#39; type=&#39;fat&#39;/&gt;
      &lt;source dir=&#39;/usr/src/dpdk-16.11&#39;/&gt;
      &lt;target dev=&#39;vdb&#39; bus=&#39;virtio&#39;/&gt;
      &lt;readonly/&gt;
    &lt;/disk&gt;
    &lt;interface type=&#39;vhostuser&#39;&gt;
      &lt;mac address=&#39;00:00:00:00:00:01&#39;/&gt;
      &lt;source type=&#39;unix&#39; path=&#39;/usr/local/var/run/openvswitch/dpdkvhostuser0&#39; mode=&#39;client&#39;/&gt;
       &lt;model type=&#39;virtio&#39;/&gt;
      &lt;driver queues=&#39;2&#39;&gt;
        &lt;host mrg_rxbuf=&#39;off&#39;/&gt;
      &lt;/driver&gt;
    &lt;/interface&gt;
    &lt;interface type=&#39;vhostuser&#39;&gt;
      &lt;mac address=&#39;00:00:00:00:00:02&#39;/&gt;
      &lt;source type=&#39;unix&#39; path=&#39;/usr/local/var/run/openvswitch/dpdkvhostuser1&#39; mode=&#39;client&#39;/&gt;
      &lt;model type=&#39;virtio&#39;/&gt;
      &lt;driver queues=&#39;2&#39;&gt;
        &lt;host mrg_rxbuf=&#39;off&#39;/&gt;
      &lt;/driver&gt;
    &lt;/interface&gt;
    &lt;serial type=&#39;pty&#39;&gt;
      &lt;target port=&#39;0&#39;/&gt;
    &lt;/serial&gt;
    &lt;console type=&#39;pty&#39;&gt;
      &lt;target type=&#39;serial&#39; port=&#39;0&#39;/&gt;
    &lt;/console&gt;
  &lt;/devices&gt;
&lt;/domain&gt;
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-topics/windows"></span><div class="section" id="ovs-on-hyper-v-design">
<h4>OVS-on-Hyper-V Design<a class="headerlink" href="#ovs-on-hyper-v-design" title="Permalink to this headline">¶</a></h4>
<p>This document provides details of the effort to develop Open vSwitch on
Microsoft Hyper-V. This document should give enough information to understand
the overall design.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The userspace portion of the OVS has been ported to Hyper-V in a separate
effort, and committed to the openvswitch repo. This document will mostly
emphasize on the kernel driver, though we touch upon some of the aspects of
userspace as well.</p>
</div>
<div class="section" id="background-info">
<h5>Background Info<a class="headerlink" href="#background-info" title="Permalink to this headline">¶</a></h5>
<p>Microsoft’s hypervisor solution - Hyper-V <a class="footnote-reference" href="#id9" id="id1">[1]</a> implements a virtual switch
that is extensible and provides opportunities for other vendors to implement
functional extensions <a class="footnote-reference" href="#id10" id="id2">[2]</a>. The extensions need to be implemented as NDIS
drivers that bind within the extensible switch driver stack provided. The
extensions can broadly provide the functionality of monitoring, modifying and
forwarding packets to destination ports on the Hyper-V extensible switch.
Correspondingly, the extensions can be categorized into the following types and
provide the functionality noted:</p>
<ul class="simple">
<li>Capturing extensions: monitoring packets</li>
<li>Filtering extensions: monitoring, modifying packets</li>
<li>Forwarding extensions: monitoring, modifying, forwarding packets</li>
</ul>
<p>As can be expected, the kernel portion (datapath) of OVS on Hyper-V solution
will be implemented as a forwarding extension.</p>
<p>In Hyper-V, the virtual machine is called the Child Partition. Each VIF or
physical NIC on the Hyper-V extensible switch is attached via a port. Each port
is both on the ingress path or the egress path of the switch. The ingress path
is used for packets being sent out of a port, and egress is used for packet
being received on a port. By design, NDIS provides a layered interface. In this
layered interface, higher level layers call into lower level layers, in the
ingress path. In the egress path, it is the other way round. In addition, there
is a object identifier (OID) interface for control operations Eg. addition of a
port. The workflow for the calls is similar in nature to the packets, where
higher level layers call into the lower level layers. A good representational
diagram of this architecture is in <a class="footnote-reference" href="#id12" id="id3">[4]</a>.</p>
<p>Windows Filtering Platform (WFP)[5]_ is a platform implemented on Hyper-V that
provides APIs and services for filtering packets. WFP has been utilized to
filter on some of the packets that OVS is not equipped to handle directly. More
details in later sections.</p>
<p>IP Helper <a class="footnote-reference" href="#id14" id="id4">[6]</a> is a set of API available on Hyper-V to retrieve information
related to the network configuration information on the host machine. IP Helper
has been used to retrieve some of the configuration information that OVS needs.</p>
</div>
<div class="section" id="design">
<h5>Design<a class="headerlink" href="#design" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><div class="highlight"><pre><span></span>Various blocks of the OVS Windows implementation

                                  +-------------------------------+
                                  |                               |
                                  |        CHILD PARTITION        |
                                  |                               |
  +------+ +--------------+       | +-----------+  +------------+ |
  |      | |              |       | |           |  |            | |
  | ovs- | |     OVS-     |       | | Virtual   |  | Virtual    | |
  | *ctl | |  USERSPACE   |       | | Machine #1|  | Machine #2 | |
  |      | |    DAEMON    |       | |           |  |            | |
  +------+-++---+---------+       | +--+------+-+  +----+------++ | +--------+
  |  dpif-  |   | netdev- |       |    |VIF #1|         |VIF #2|  | |Physical|
  | netlink |   | windows |       |    +------+         +------+  | |  NIC   |
  +---------+   +---------+       |      ||                   /\  | +--------+
User     /\         /\            |      || *#1*         *#4* ||  |     /\
=========||=========||============+------||-------------------||--+     ||
Kernel   ||         ||                   \/                   ||  ||=====/
         \/         \/                +-----+                 +-----+ *#5*
 +-------------------------------+    |     |                 |     |
 |   +----------------------+    |    |     |                 |     |
 |   |   OVS Pseudo Device  |    |    |     |                 |     |
 |   +----------------------+    |    |     |                 |     |
 |      | Netlink Impl. |        |    |     |                 |     |
 |      -----------------        |    |  I  |                 |     |
 | +------------+                |    |  N  |                 |  E  |
 | |  Flowtable | +------------+ |    |  G  |                 |  G  |
 | +------------+ |  Packet    | |*#2*|  R  |                 |  R  |
 |   +--------+   | Processing | |&lt;=&gt; |  E  |                 |  E  |
 |   |   WFP  |   |            | |    |  S  |                 |  S  |
 |   | Driver |   +------------+ |    |  S  |                 |  S  |
 |   +--------+                  |    |     |                 |     |
 |                               |    |     |                 |     |
 |   OVS FORWARDING EXTENSION    |    |     |                 |     |
 +-------------------------------+    +-----+-----------------+-----+
                                      |HYPER-V Extensible Switch *#3|
                                      +-----------------------------+
                                               NDIS STACK
</pre></div>
</div>
<p>This diagram shows the various blocks involved in the OVS Windows
implementation, along with some of the components available in the NDIS stack,
and also the virtual machines. The workflow of a packet being transmitted from
a VIF out and into another VIF and to a physical NIC is also shown. Later on in
this section, we will discuss the flow of a packet at a high level.</p>
<p>The figure gives a general idea of where the OVS userspace and the kernel
components fit in, and how they interface with each other.</p>
<p>The kernel portion (datapath) of OVS on Hyper-V solution has be implemented as
a forwarding extension roughly implementing the following
sub-modules/functionality. Details of each of these sub-components in the
kernel are contained in later sections:</p>
<ul class="simple">
<li>Interfacing with the NDIS stack</li>
<li>Netlink message parser</li>
<li>Netlink sockets</li>
<li>Switch/Datapath management</li>
<li>Interfacing with userspace portion of the OVS solution to implement the
necessary functionality that userspace needs</li>
<li>Port management</li>
<li>Flowtable/Actions/packet forwarding</li>
<li>Tunneling</li>
<li>Event notifications</li>
</ul>
<p>The datapath for the OVS on Linux is a kernel module, and cannot be directly
ported since there are significant differences in architecture even though the
end functionality provided would be similar. Some examples of the differences
are:</p>
<ul class="simple">
<li>Interfacing with the NDIS stack to hook into the NDIS callbacks for
functionality such as receiving and sending packets, packet completions, OIDs
used for events such as a new port appearing on the virtual switch.</li>
<li>Interface between the userspace and the kernel module.</li>
<li>Event notifications are significantly different.</li>
<li>The communication interface between DPIF and the kernel module need not be
implemented in the way OVS on Linux does. That said, it would be advantageous
to have a similar interface to the kernel module for reasons of readability
and maintainability.</li>
<li>Any licensing issues of using Linux kernel code directly.</li>
</ul>
<p>Due to these differences, it was a straightforward decision to develop the
datapath for OVS on Hyper-V from scratch rather than porting the one on Linux.
A re-development focused on the following goals:</p>
<ul class="simple">
<li>Adhere to the existing requirements of userspace portion of OVS (such as
ovs-vswitchd), to minimize changes in the userspace workflow.</li>
<li>Fit well into the typical workflow of a Hyper-V extensible switch forwarding
extension.</li>
</ul>
<p>The userspace portion of the OVS solution is mostly POSIX code, and not very
Linux specific. Majority of the userspace code does not interface directly with
the kernel datapath and was ported independently of the kernel datapath effort.</p>
<p>As explained in the OVS porting design document <a class="footnote-reference" href="#id15" id="id5">[7]</a>, DPIF is the portion of
userspace that interfaces with the kernel portion of the OVS. The interface
that each DPIF provider has to implement is defined in <code class="docutils literal"><span class="pre">dpif-provider.h</span></code>
<a class="footnote-reference" href="#id11" id="id6">[3]</a>.  Though each platform is allowed to have its own implementation of the
DPIF provider, it was found, via community feedback, that it is desired to
share code whenever possible. Thus, the DPIF provider for OVS on Hyper-V shares
code with the DPIF provider on Linux. This interface is implemented in
<code class="docutils literal"><span class="pre">dpif-netlink.c</span></code>.</p>
<p>We&#8217;ll elaborate more on kernel-userspace interface in a dedicated section
below. Here it suffices to say that the DPIF provider implementation for
Windows is netlink-based and shares code with the Linux one.</p>
</div>
<div class="section" id="kernel-module-datapath">
<h5>Kernel Module (Datapath)<a class="headerlink" href="#kernel-module-datapath" title="Permalink to this headline">¶</a></h5>
<div class="section" id="interfacing-with-the-ndis-stack">
<h6>Interfacing with the NDIS Stack<a class="headerlink" href="#interfacing-with-the-ndis-stack" title="Permalink to this headline">¶</a></h6>
<p>For each virtual switch on Hyper-V, the OVS extensible switch extension can be
enabled/disabled. We support enabling the OVS extension on only one switch.
This is consistent with using a single datapath in the kernel on Linux. All the
physical adapters are connected as external adapters to the extensible switch.</p>
<p>When the OVS switch extension registers itself as a filter driver, it also
registers callbacks for the switch/port management and datapath functions. In
other words, when a switch is created on the Hyper-V root partition (host), the
extension gets an activate callback upon which it can initialize the data
structures necessary for OVS to function. Similarly, there are callbacks for
when a port gets added to the Hyper-V switch, and an External Network adapter
or a VM Network adapter is connected/disconnected to the port. There are also
callbacks for when a VIF (NIC of a child partition) send out a packet, or a
packet is received on an external NIC.</p>
<p>As shown in the figures, an extensible switch extension gets to see a packet
sent by the VM (VIF) twice - once on the ingress path and once on the egress
path. Forwarding decisions are to be made on the ingress path. Correspondingly,
we will be hooking onto the following interfaces:</p>
<ul class="simple">
<li>Ingress send indication: intercept packets for performing flow based
forwarding.This includes straight forwarding to output ports. Any packet
modifications needed to be performed are done here either inline or by
creating a new packet. A forwarding action is performed as the flow actions
dictate.</li>
<li>Ingress completion indication: cleanup and free packets that we generated on
the ingress send path, pass-through for packets that we did not generate.</li>
<li>Egress receive indication: pass-through.</li>
<li>Egress completion indication: pass-through.</li>
</ul>
</div>
<div class="section" id="interfacing-with-ovs-userspace">
<h6>Interfacing with OVS Userspace<a class="headerlink" href="#interfacing-with-ovs-userspace" title="Permalink to this headline">¶</a></h6>
<p>We have implemented a pseudo device interface for letting OVS userspace talk to
the OVS kernel module. This is equivalent to the typical character device
interface on POSIX platforms where we can register custom functions for read,
write and ioctl functionality. The pseudo device supports a whole bunch of
ioctls that netdev and DPIF on OVS userspace make use of.</p>
</div>
<div class="section" id="netlink-message-parser">
<h6>Netlink Message Parser<a class="headerlink" href="#netlink-message-parser" title="Permalink to this headline">¶</a></h6>
<p>The communication between OVS userspace and OVS kernel datapath is in the form
of Netlink messages <a class="footnote-reference" href="#id9" id="id7">[1]</a>. More details about this are provided below.  In the
kernel, a full fledged netlink message parser has been implemented along the
lines of the netlink message parser in OVS userspace. In fact, a lot of the
code is ported code.</p>
<p>On the lines of <code class="docutils literal"><span class="pre">struct</span> <span class="pre">ofpbuf</span></code> in OVS userspace, a managed buffer has been
implemented in the kernel datapath to make it easier to parse and construct
netlink messages.</p>
</div>
<div class="section" id="netlink-sockets">
<h6>Netlink Sockets<a class="headerlink" href="#netlink-sockets" title="Permalink to this headline">¶</a></h6>
<p>On Linux, OVS userspace utilizes netlink sockets to pass back and forth netlink
messages. Since much of userspace code including DPIF provider in
dpif-netlink.c (formerly dpif-linux.c) has been reused, pseudo-netlink sockets
have been implemented in OVS userspace. As it is known, Windows lacks native
netlink socket support, and also the socket family is not extensible either.
Hence it is not possible to provide a native implementation of netlink socket.
We emulate netlink sockets in lib/netlink-socket.c and support all of the nl_*
APIs to higher levels. The implementation opens a handle to the pseudo device
for each netlink socket. Some more details on this topic are provided in the
userspace section on netlink sockets.</p>
<p>Typical netlink semantics of read message, write message, dump, and transaction
have been implemented so that higher level layers are not affected by the
netlink implementation not being native.</p>
</div>
<div class="section" id="switch-datapath-management">
<h6>Switch/Datapath Management<a class="headerlink" href="#switch-datapath-management" title="Permalink to this headline">¶</a></h6>
<p>As explained above, we hook onto the management callback functions in the NDIS
interface for when to initialize the OVS data structures, flow tables etc. Some
of this code is also driven by OVS userspace code which sends down ioctls for
operations like creating a tunnel port etc.</p>
</div>
<div class="section" id="port-management">
<h6>Port Management<a class="headerlink" href="#port-management" title="Permalink to this headline">¶</a></h6>
<p>As explained above, we hook onto the management callback functions in the NDIS
interface to know when a port is added/connected to the Hyper-V switch. We use
these callbacks to initialize the port related data structures in OVS. Also,
some of the ports are tunnel ports that don’t exist on the Hyper-V switch and
get added from OVS userspace.</p>
<p>In order to identify a Hyper-V port, we use the value of &#8216;FriendlyName&#8217; field
in each Hyper-V port. We call this the &#8220;OVS-port-name&#8221;. The idea is that OVS
userspace sets &#8216;OVS-port-name&#8217; in each Hyper-V port to the same value as the
&#8216;name&#8217; field of the &#8216;Interface&#8217; table in OVSDB. When OVS userspace calls into
the kernel datapath to add a port, we match the name of the port with the
&#8216;OVS-port-name&#8217; of a Hyper-V port.</p>
<p>We maintain separate hash tables, and separate counters for ports that have
been added from the Hyper-V switch, and for ports that have been added from OVS
userspace.</p>
</div>
<div class="section" id="flowtable-actions-packet-forwarding">
<h6>Flowtable/Actions/Packet Forwarding<a class="headerlink" href="#flowtable-actions-packet-forwarding" title="Permalink to this headline">¶</a></h6>
<p>The flowtable and flow actions based packet forwarding is the core of the OVS
datapath functionality. For each packet on the ingress path, we consult the
flowtable and execute the corresponding actions. The actions can be limited to
simple forwarding to a particular destination port(s), or more commonly
involves modifying the packet to insert a tunnel context or a VLAN ID, and
thereafter forwarding to the external port to send the packet to a destination
host.</p>
</div>
<div class="section" id="tunneling">
<h6>Tunneling<a class="headerlink" href="#tunneling" title="Permalink to this headline">¶</a></h6>
<p>We make use of the Internal Port on a Hyper-V switch for implementing
tunneling. The Internal Port is a virtual adapter that is exposed on the Hyper-
V host, and connected to the Hyper-V switch. Basically, it is an interface
between the host and the virtual switch. The Internal Port acts as the Tunnel
end point for the host (aka VTEP), and holds the VTEP IP address.</p>
<p>Tunneling ports are not actual ports on the Hyper-V switch. These are virtual
ports that OVS maintains and while executing actions, if the outport is a
tunnel port, we short circuit by performing the encapsulation action based on
the tunnel context. The encapsulated packet gets forwarded to the external
port, and appears to the outside world as though it was set from the VTEP.</p>
<p>Similarly, when a tunneled packet enters the OVS from the external port bound
to the internal port (VTEP), and if yes, we short circuit the path, and
directly forward the inner packet to the destination port (mostly a VIF, but
dictated by the flow). We leverage the Windows Filtering Platform (WFP)
framework to be able to receive tunneled packets that cannot be decapsulated by
OVS right away. Currently, fragmented IP packets fall into that category, and
we leverage the code in the host IP stack to reassemble the packet, and
performing decapsulation on the reassembled packet.</p>
<p>We&#8217;ll also be using the IP helper library to provide us IP address and other
information corresponding to the Internal port.</p>
</div>
<div class="section" id="event-notifications">
<h6>Event Notifications<a class="headerlink" href="#event-notifications" title="Permalink to this headline">¶</a></h6>
<p>The pseudo device interface described above is also used for providing event
notifications back to OVS userspace. A shared memory/overlapped IO model is
used.</p>
</div>
<div class="section" id="userspace-components">
<h6>Userspace Components<a class="headerlink" href="#userspace-components" title="Permalink to this headline">¶</a></h6>
<p>The userspace portion of the OVS solution is mostly POSIX code, and not very
Linux specific. Majority of the userspace code does not interface directly with
the kernel datapath and was ported independently of the kernel datapath effort.</p>
<p>In this section, we cover the userspace components that interface with the
kernel datapath.</p>
<p>As explained earlier, OVS on Hyper-V shares the DPIF provider implementation
with Linux. The DPIF provider on Linux uses netlink sockets and netlink
messages. Netlink sockets and messages are extensively used on Linux to
exchange information between userspace and kernel. In order to satisfy these
dependencies, netlink socket (pseudo and non-native) and netlink messages are
implemented on Hyper-V.</p>
<p>The following are the major advantages of sharing DPIF provider code:</p>
<ol class="arabic">
<li><p class="first">Maintenance is simpler:</p>
<p>Any change made to the interface defined in dpif-provider.h need not be
propagated to multiple implementations. Also, developers familiar with the
Linux implementation of the DPIF provider can easily ramp on the Hyper-V
implementation as well.</p>
</li>
<li><p class="first">Netlink messages provides inherent advantages:</p>
<p>Netlink messages are known for their extensibility. Each message is
versioned, so the provided data structures offer a mechanism to perform
version checking and forward/backward compatibility with the kernel module.</p>
</li>
</ol>
</div>
<div class="section" id="id8">
<h6>Netlink Sockets<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h6>
<p>As explained in other sections, an emulation of netlink sockets has been
implemented in <code class="docutils literal"><span class="pre">lib/netlink-socket.c</span></code> for Windows. The implementation creates
a handle to the OVS pseudo device, and emulates netlink socket semantics of
receive message, send message, dump, and transact. Most of the <code class="docutils literal"><span class="pre">nl_*</span></code>
functions are supported.</p>
<p>The fact that the implementation is non-native manifests in various ways.  One
example is that PID for the netlink socket is not automatically assigned in
userspace when a handle is created to the OVS pseudo device. There&#8217;s an extra
command (defined in <code class="docutils literal"><span class="pre">OvsDpInterfaceExt.h</span></code>) that is used to grab the PID
generated in the kernel.</p>
</div>
<div class="section" id="dpif-provider">
<h6>DPIF Provider<a class="headerlink" href="#dpif-provider" title="Permalink to this headline">¶</a></h6>
<p>As has been mentioned in earlier sections, the netlink socket and netlink
message based DPIF provider on Linux has been ported to Windows.</p>
<p>Most of the code is common. Some divergence is in the code to receive packets.
The Linux implementation uses epoll() which is not natively supported on
Windows.</p>
</div>
<div class="section" id="netdev-windows">
<h6>netdev-windows<a class="headerlink" href="#netdev-windows" title="Permalink to this headline">¶</a></h6>
<p>We have a Windows implementation of the interface defined in
<code class="docutils literal"><span class="pre">lib/netdev-provider.h</span></code>. The implementation provides functionality to get
extended information about an interface. It is limited in functionality
compared to the Linux implementation of the netdev provider and cannot be used
to add any interfaces in the kernel such as a tap interface or to send/receive
packets. The netdev-windows implementation uses the datapath interface
extensions defined in <code class="docutils literal"><span class="pre">datapath-windows/include/OvsDpInterfaceExt.h</span></code>.</p>
</div>
<div class="section" id="powershell-extensions-to-set-ovs-port-name">
<h6>Powershell Extensions to Set <code class="docutils literal"><span class="pre">OVS-port-name</span></code><a class="headerlink" href="#powershell-extensions-to-set-ovs-port-name" title="Permalink to this headline">¶</a></h6>
<p>As explained in the section on &#8220;Port management&#8221;, each Hyper-V port has a
&#8216;FriendlyName&#8217; field, which we call as the &#8220;OVS-port-name&#8221; field. We have
implemented powershell command extensions to be able to set the &#8220;OVS-port-name&#8221;
of a Hyper-V port.</p>
</div>
</div>
<div class="section" id="kernel-userspace-interface">
<h5>Kernel-Userspace Interface<a class="headerlink" href="#kernel-userspace-interface" title="Permalink to this headline">¶</a></h5>
<div class="section" id="openvswitch-h-and-ovsdpinterfaceext-h">
<h6>openvswitch.h and OvsDpInterfaceExt.h<a class="headerlink" href="#openvswitch-h-and-ovsdpinterfaceext-h" title="Permalink to this headline">¶</a></h6>
<p>Since the DPIF provider is shared with Linux, the kernel datapath provides the
same interface as the Linux datapath. The interface is defined in
<code class="docutils literal"><span class="pre">datapath/linux/compat/include/linux/openvswitch.h</span></code>. Derivatives of this
interface file are created during OVS userspace compilation. The derivative for
the kernel datapath on Hyper-V is provided in
<code class="docutils literal"><span class="pre">datapath-windows/include/OvsDpInterface.h</span></code>.</p>
<p>That said, there are Windows specific extensions that are defined in the
interface file <code class="docutils literal"><span class="pre">datapath-windows/include/OvsDpInterfaceExt.h</span></code>.</p>
</div>
</div>
<div class="section" id="flow-of-a-packet">
<h5>Flow of a Packet<a class="headerlink" href="#flow-of-a-packet" title="Permalink to this headline">¶</a></h5>
<p>Figure 2 shows the numbered steps in which a packets gets sent out of a VIF and
is forwarded to another VIF or a physical NIC. As mentioned earlier, each VIF
is attached to the switch via a port, and each port is both on the ingress and
egress path of the switch, and depending on whether a packet is being
transmitted or received, one of the paths gets used. In the figure, each step n
is annotated as <code class="docutils literal"><span class="pre">#n</span></code></p>
<p>The steps are as follows:</p>
<ol class="arabic simple">
<li>When a packet is sent out of a VIF or an physical NIC or an internal port,
the packet is part of the ingress path.</li>
<li>The OVS kernel driver gets to intercept this packet.<ol class="loweralpha">
<li>OVS looks up the flows in the flowtable for this packet, and executes the
corresponding action.</li>
<li>If there is not action, the packet is sent up to OVS userspace to examine
the packet and figure out the actions.</li>
<li>Userspace executes the packet by specifying the actions, and might also
insert a flow for such a packet in the future.</li>
<li>The destination ports are added to the packet and sent down to the Hyper-
V switch.</li>
</ol>
</li>
<li>The Hyper-V forwards the packet to the destination ports specified in the
packet, and sends it out on the egress path.</li>
<li>The packet gets forwarded to the destination VIF.</li>
<li>It might also get forwarded to a physical NIC as well, if the physical NIC
has been added as a destination port by OVS.</li>
</ol>
</div>
<div class="section" id="build-deployment">
<h5>Build/Deployment<a class="headerlink" href="#build-deployment" title="Permalink to this headline">¶</a></h5>
<p>The userspace components added as part of OVS Windows implementation have been
integrated with autoconf, and can be built using the steps mentioned in the
BUILD.Windows file. Additional targets need to be specified to make.</p>
<p>The OVS kernel code is part of a Visual Studio 2013 solution, and is compiled
from the IDE. There are plans in the future to move this to a compilation mode
such that we can compile it without an IDE as well.</p>
<p>Once compiled, we have an install script that can be used to load the kernel
driver.</p>
</div>
<div class="section" id="references">
<h5>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h5>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id7">2</a>)</em> Hyper-V Extensible Switch <a class="reference external" href="https://msdn.microsoft.com/windows/hardware/drivers/network/hyper-v-extensible-switch">https://msdn.microsoft.com/windows/hardware/drivers/network/hyper-v-extensible-switch</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Hyper-V Extensible Switch Extensions <a class="reference external" href="https://msdn.microsoft.com/windows/hardware/drivers/network/hyper-v-extensible-switch-extensions">https://msdn.microsoft.com/windows/hardware/drivers/network/hyper-v-extensible-switch-extensions</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[3]</a></td><td>DPIF Provider <a class="reference external" href="http://openvswitch.sourcearchive.com/documentation/1.1.0-1/dpif-provider_8h_source.html">http://openvswitch.sourcearchive.com/documentation/1.1.0-1/dpif-provider_8h_source.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[4]</a></td><td>Hyper-V Extensible Switch Components <a class="reference external" href="https://msdn.microsoft.com/windows/hardware/drivers/network/hyper-v-extensible-switch-components">https://msdn.microsoft.com/windows/hardware/drivers/network/hyper-v-extensible-switch-components</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[5]</td><td>Windows Filtering Platform <a class="reference external" href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa366510(v=vs.85).aspx">https://msdn.microsoft.com/en-us/library/windows/desktop/aa366510(v=vs.85).aspx</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[6]</a></td><td>IP Helper <a class="reference external" href="https://msdn.microsoft.com/windows/hardware/drivers/network/ip-helper">https://msdn.microsoft.com/windows/hardware/drivers/network/ip-helper</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id15" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[7]</a></td><td>How to Port Open vSwitch to New Software or Hardware <a class="reference internal" href="contents.html#document-topics/porting"><em>Porting Open vSwitch to New Software or Hardware</em></a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id16" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[8]</td><td>Netlink <a class="reference external" href="https://en.wikipedia.org/wiki/Netlink">https://en.wikipedia.org/wiki/Netlink</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id17" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[9]</td><td>epoll <a class="reference external" href="https://en.wikipedia.org/wiki/Epoll">https://en.wikipedia.org/wiki/Epoll</a></td></tr>
</tbody>
</table>
</div>
</div>
<span id="document-topics/language-bindings"></span><div class="section" id="language-bindings">
<h4>Language Bindings<a class="headerlink" href="#language-bindings" title="Permalink to this headline">¶</a></h4>
<p>Bindings exist for Open vSwitch in a variety of languages.</p>
<div class="section" id="official-bindings">
<h5>Official Bindings<a class="headerlink" href="#official-bindings" title="Permalink to this headline">¶</a></h5>
<div class="section" id="python">
<h6>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h6>
<p>The Python bindings are part of the <a class="reference external" href="https://github.com/openvswitch/ovs/tree/master/python/ovs">Open vSwitch package</a>. You can install
the bindings using <code class="docutils literal"><span class="pre">pip</span></code>:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ pip install ovs
</pre></div>
</div>
</div>
</div>
<div class="section" id="third-party-bindings">
<h5>Third-Party Bindings<a class="headerlink" href="#third-party-bindings" title="Permalink to this headline">¶</a></h5>
<div class="section" id="lua">
<h6>Lua<a class="headerlink" href="#lua" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><a class="reference external" href="https://github.com/wiladams/LJIT2ovs">LJIT2ovs:</a> LuaJIT binding for Open vSwitch</li>
</ul>
</div>
<div class="section" id="go">
<h6>Go<a class="headerlink" href="#go" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><a class="reference external" href="https://github.com/weaveworks/go-odp">go-odp:</a> A Go library to control the Open vSwitch in-kernel datapath</li>
</ul>
</div>
</div>
</div>
<span id="document-topics/testing"></span><div class="section" id="testing">
<h4>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h4>
<p>It is possible to test Open vSwitch using both tooling provided with Open
vSwitch and using a variety of third party tooling.</p>
<div class="section" id="built-in-tooling">
<h5>Built-in Tooling<a class="headerlink" href="#built-in-tooling" title="Permalink to this headline">¶</a></h5>
<p>Open vSwitch provides a number of different test suites and other tooling for
validating basic functionality of OVS. Before running any of the tests
described here, you must bootstrap, configure and build Open vSwitch as
described in <a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a>. You do not need to install Open
vSwitch or to build or load the kernel module to run these test suites. You do
not need supervisor privilege to run these test suites.</p>
<div class="section" id="unit-tests">
<span id="testing-unit-tests"></span><h6>Unit Tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline">¶</a></h6>
<p>Open vSwitch includes a suite of self-tests. Before you submit patches
upstream, we advise that you run the tests and ensure that they pass. If you
add new features to Open vSwitch, then adding tests for those features will
ensure your features don&#8217;t break as developers modify other areas of Open
vSwitch.</p>
<p>To run all the unit tests in Open vSwitch, one at a time, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make check
</pre></div>
</div>
<p>This takes under 5 minutes on a modern desktop system.</p>
<p>To run all the unit tests in Open vSwitch in parallel, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make check TESTSUITEFLAGS=-j8
</pre></div>
</div>
<p>You can run up to eight threads. This takes under a minute on a modern 4-core
desktop system.</p>
<p>To see a list of all the available tests, run:</p>
<blockquote>
<div>$ make check TESTSUITEFLAGS=&#8211;list</div></blockquote>
<p>To run only a subset of tests, e.g. test 123 and tests 477 through 484, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make check TESTSUITEFLAGS=&#39;123 477-484&#39;
</pre></div>
</div>
<p>Tests do not have inter-dependencies, so you may run any subset.</p>
<p>To run tests matching a keyword, e.g. <code class="docutils literal"><span class="pre">ovsdb</span></code>, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make check TESTSUITEFLAGS=&#39;-k ovsdb&#39;
</pre></div>
</div>
<p>To see a complete list of test options, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make check TESTSUITEFLAGS=--help
</pre></div>
</div>
<p>The results of a testing run are reported in <code class="docutils literal"><span class="pre">tests/testsuite.log</span></code>. Report
report test failures as bugs and include the <code class="docutils literal"><span class="pre">testsuite.log</span></code> in your report.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Sometimes a few tests may fail on some runs but not others. This is usually a
bug in the testsuite, not a bug in Open vSwitch itself. If you find that a
test fails intermittently, please report it, since the developers may not
have noticed. You can make the testsuite automatically rerun tests that fail,
by adding <code class="docutils literal"><span class="pre">RECHECK=yes</span></code> to the <code class="docutils literal"><span class="pre">make</span></code> command line, e.g.:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span>$ make check TESTSUITEFLAGS=-j8 RECHECK=yes
</pre></div>
</div>
</div>
</div>
<div class="section" id="coverage">
<span id="testing-coverage"></span><h6>Coverage<a class="headerlink" href="#coverage" title="Permalink to this headline">¶</a></h6>
<p>If the build was configured with <code class="docutils literal"><span class="pre">--enable-coverage</span></code> and the <code class="docutils literal"><span class="pre">lcov</span></code> utility
is installed, you can run the testsuite and generate a code coverage report by
using the <code class="docutils literal"><span class="pre">check-lcoc</span></code> target:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make check-lcov
</pre></div>
</div>
<p>All the same options are avaiable via TESTSUITEFLAGS. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make check-lcov TESTSUITEFLAGS=-j8 -k ovn
</pre></div>
</div>
</div>
<div class="section" id="valgrind">
<span id="testing-valgrind"></span><h6>Valgrind<a class="headerlink" href="#valgrind" title="Permalink to this headline">¶</a></h6>
<p>If you have <code class="docutils literal"><span class="pre">valgrind</span></code> installed, you can run the testsuite under
valgrind by using the <code class="docutils literal"><span class="pre">check-valgrind</span></code> target:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make check-valgrind
</pre></div>
</div>
<p>When you do this, the &#8220;valgrind&#8221; results for test <code class="docutils literal"><span class="pre">&lt;N&gt;</span></code> are reported in files
named <code class="docutils literal"><span class="pre">tests/testsuite.dir/&lt;N&gt;/valgrind.*</span></code>.</p>
<p>All the same options are available via TESTSUITEFLAGS.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">You may find that the valgrind results are easier to interpret if you put
<code class="docutils literal"><span class="pre">-q</span></code> in <code class="docutils literal"><span class="pre">~/.valgrindrc</span></code>, since that reduces the amount of output.</p>
</div>
</div>
<div class="section" id="oftest">
<span id="testing-oftest"></span><h6>OFTest<a class="headerlink" href="#oftest" title="Permalink to this headline">¶</a></h6>
<p>OFTest is an OpenFlow protocol testing suite. Open vSwitch includes a Makefile
target to run OFTest with Open vSwitch in &#8220;dummy mode&#8221;. In this mode of
testing, no packets travel across physical or virtual networks.  Instead, Unix
domain sockets stand in as simulated networks. This simulation is imperfect,
but it is much easier to set up, does not require extra physical or virtual
hardware, and does not require supervisor privileges.</p>
<p>To run OFTest with Open vSwitch, you must obtain a copy of OFTest and install
its prerequisites. You need a copy of OFTest that includes commit 406614846c5
(make ovs-dummy platform work again). This commit was merged into the OFTest
repository on Feb 1, 2013, so any copy of OFTest more recent than that should
work. Testing OVS in dummy mode does not require root privilege, so you may
ignore that requirement.</p>
<p>Optionally, add the top-level OFTest directory (containing the <code class="docutils literal"><span class="pre">oft</span></code> program)
to your <code class="docutils literal"><span class="pre">$PATH</span></code>. This slightly simplifies running OFTest later.</p>
<p>To run OFTest in dummy mode, run the following command from your Open vSwitch
build directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make check-oftest OFT=&lt;oft-binary&gt;
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">&lt;oft-binary&gt;</span></code> is the absolute path to the <code class="docutils literal"><span class="pre">oft</span></code> program in OFTest.
If you added &#8220;oft&#8221; to your $PATH, you may omit the OFT variable
assignment</p>
<p>By default, <code class="docutils literal"><span class="pre">check-oftest</span></code> passes <code class="docutils literal"><span class="pre">oft</span></code> just enough options to enable dummy
mode. You can use <code class="docutils literal"><span class="pre">OFTFLAGS</span></code> to pass additional options. For example, to run
just the <code class="docutils literal"><span class="pre">basic.Echo</span></code> test instead of all tests (the default) and enable
verbose logging, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make check-oftest OFT=&lt;oft-binary&gt; OFTFLAGS=&#39;--verbose -T basic.Echo&#39;
</pre></div>
</div>
<p>If you use OFTest that does not include commit 4d1f3eb2c792 (oft: change
default port to 6653), merged into the OFTest repository in October 2013, then
you need to add an option to use the IETF-assigned controller port:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make check-oftest OFT=&lt;oft-binary&gt; OFTFLAGS=&#39;--port=6653&#39;
</pre></div>
</div>
<p>Interpret OFTest results cautiously. Open vSwitch can fail a given test in
OFTest for many reasons, including bugs in Open vSwitch, bugs in OFTest, bugs
in the &#8220;dummy mode&#8221; integration, and differing interpretations of the OpenFlow
standard and other standards.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Open vSwitch has not been validated against OFTest. Report test failures that
you believe to represent bugs in Open vSwitch. Include the precise versions
of Open vSwitch and OFTest in your bug report, plus any other information
needed to reproduce the problem.</p>
</div>
</div>
<div class="section" id="ryu">
<span id="id1"></span><h6>Ryu<a class="headerlink" href="#ryu" title="Permalink to this headline">¶</a></h6>
<p>Ryu is an OpenFlow controller written in Python that includes an extensive
OpenFlow testsuite. Open vSwitch includes a Makefile target to run Ryu in
&#8220;dummy mode&#8221;. See <a class="reference internal" href="#testing-oftest"><span>OFTest</span></a> above for an explanation of dummy mode.</p>
<p>To run Ryu tests with Open vSwitch, first read and follow the instructions
under <strong>Testing</strong> above. Second, obtain a copy of Ryu, install its
prerequisites, and build it. You do not need to install Ryu (some of the tests
do not get installed, so it does not help).</p>
<p>To run Ryu tests, run the following command from your Open vSwitch build
directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make check-ryu RYUDIR=&lt;ryu-source-dir&gt;``
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">&lt;ryu-source-dir&gt;</span></code> is the absolute path to the root of the Ryu source
distribution. The default <code class="docutils literal"><span class="pre">&lt;ryu-source-dir&gt;</span></code> is <code class="docutils literal"><span class="pre">$srcdir/../ryu</span></code>
where <code class="docutils literal"><span class="pre">$srcdir</span></code> is your Open vSwitch source directory. If this is correct,
omit <code class="docutils literal"><span class="pre">RYUDIR</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Open vSwitch has not been validated against Ryu. Report test failures that
you believe to represent bugs in Open vSwitch. Include the precise versions
of Open vSwitch and Ryu in your bug report, plus any other information
needed to reproduce the problem.</p>
</div>
</div>
<div class="section" id="datapath-testing">
<h6>Datapath testing<a class="headerlink" href="#datapath-testing" title="Permalink to this headline">¶</a></h6>
<p>Open vSwitch includes a suite of tests specifically for datapath functionality,
which can be run against the userspace or kernel datapaths. If you are
developing datapath features, it is recommended that you use these tests and
build upon them to verify your implementation.</p>
<p>The datapath tests make some assumptions about the environment. They must be
run under root privileges on a Linux system with support for network
namespaces. For ease of use, the OVS source tree includes a vagrant box to
invoke these tests. Running the tests inside Vagrant provides kernel isolation,
protecting your development host from kernel panics or configuration conflicts
in the testsuite. If you wish to run the tests without using the vagrant box,
there are further instructions below.</p>
<div class="section" id="vagrant">
<h7>Vagrant<a class="headerlink" href="#vagrant" title="Permalink to this headline">¶</a></h7>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Requires Vagrant (version 1.7.0 or later) and a compatible hypervisor</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You must <strong>Bootstrap</strong> and <strong>Configure</strong> the sources before you run the steps
described here.</p>
</div>
<p>A Vagrantfile is provided allowing to compile and provision the source tree as
found locally in a virtual machine using the following command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ vagrant up
</pre></div>
</div>
<p>This will bring up a Fedora 23 VM by default. If you wish to use a different
box or a vagrant backend not supported by the default box, the <code class="docutils literal"><span class="pre">Vagrantfile</span></code>
can be modified to use a different box as base.</p>
<p>The VM can be reprovisioned at any time:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ vagrant provision
</pre></div>
</div>
<p>OVS out-of-tree compilation environment can be set up with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./boot.sh
$ vagrant provision --provision-with configure_ovs,build_ovs
</pre></div>
</div>
<p>This will set up an out-of-tree build environment inside the VM in
<code class="docutils literal"><span class="pre">/root/build</span></code>.  The source code can be found in <code class="docutils literal"><span class="pre">/vagrant</span></code>.</p>
<p>To recompile and reinstall OVS in the VM using RPM:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./boot.sh
$ vagrant provision --provision-with configure_ovs,install_rpm
</pre></div>
</div>
<p>Two provisioners are included to run system tests with the OVS kernel module or
with a userspace datapath. This tests are different from the self-tests
mentioned above. To run them:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./boot.sh
$ vagrant provision --provision-with \
    configure_ovs,test_ovs_kmod,test_ovs_system_userspace
</pre></div>
</div>
<p>The results of the testsuite reside in the VM root user&#8217;s home directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ vagrant ssh
$ sudo -s
$ cd /root/build
$ ls tests/system*
</pre></div>
</div>
</div>
<div class="section" id="native">
<h7>Native<a class="headerlink" href="#native" title="Permalink to this headline">¶</a></h7>
<p>The datapath testsuite as invoked by Vagrant above may also be run manually on
a Linux system with root privileges. These tests may take several minutes to
complete, and cannot be run in parallel.</p>
<div class="section" id="userspace-datapath">
<h8>Userspace datapath<a class="headerlink" href="#userspace-datapath" title="Permalink to this headline">¶</a></h8>
<p>To invoke the datapath testsuite with the userspace datapath, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make check-system-userspace
</pre></div>
</div>
<p>The results of the testsuite are in <code class="docutils literal"><span class="pre">tests/system-userspace-traffic.dir</span></code>.</p>
</div>
<div class="section" id="kernel-datapath">
<h8>Kernel datapath<a class="headerlink" href="#kernel-datapath" title="Permalink to this headline">¶</a></h8>
<p>Make targets are also provided for testing the Linux kernel module. Note that
these tests operate by inserting modules into the running Linux kernel, so if
the tests are able to trigger a bug in the OVS kernel module or in the upstream
kernel then the kernel may panic.</p>
<p>To run the testsuite against the kernel module which is currently installed on
your system, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make check-kernel
</pre></div>
</div>
<p>To install the kernel module from the current build directory and run the
testsuite against that kernel module:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ make check-kmod
</pre></div>
</div>
<p>The results of the testsuite are in <code class="docutils literal"><span class="pre">tests/system-kmod-traffic.dir</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="static-code-analysis">
<span id="testing-static-analysis"></span><h6>Static Code Analysis<a class="headerlink" href="#static-code-analysis" title="Permalink to this headline">¶</a></h6>
<p>Static Analysis is a method of debugging Software by examining code rather than
actually executing it. This can be done through &#8216;scan-build&#8217; commandline
utility which internally uses clang (or) gcc to compile the code and also
invokes a static analyzer to do the code analysis. At the end of the build, the
reports are aggregated in to a common folder and can later be analyzed using
&#8216;scan-view&#8217;.</p>
<p>Open vSwitch includes a Makefile target to trigger static code analysis:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./boot.sh
$ ./configure CC=clang  # clang
# or
$ ./configure CC=gcc CFLAGS=&quot;-std=gnu99&quot;  # gcc
$ make clang-analyze
</pre></div>
</div>
<p>You should invoke scan-view to view analysis results. The last line of output
from <code class="docutils literal"><span class="pre">clang-analyze</span></code> will list the command (containing results directory)
that you should invoke to view the results on a browser.</p>
</div>
</div>
<div class="section" id="continuous-integration-with-travis-ci">
<span id="testing-ci"></span><h5>Continuous Integration with Travis CI<a class="headerlink" href="#continuous-integration-with-travis-ci" title="Permalink to this headline">¶</a></h5>
<p>A .travis.yml file is provided to automatically build Open vSwitch with various
build configurations and run the testsuite using Travis CI. Builds will be
performed with gcc, sparse and clang with the -Werror compiler flag included,
therefore the build will fail if a new warning has been introduced.</p>
<p>The CI build is triggered via git push (regardless of the specific branch) or
pull request against any Open vSwitch GitHub repository that is linked to
travis-ci.</p>
<p>Instructions to setup travis-ci for your GitHub repository:</p>
<ol class="arabic">
<li><p class="first">Go to <a class="reference external" href="https://travis-ci.org/">https://travis-ci.org/</a> and sign in using your GitHub ID.</p>
</li>
<li><p class="first">Go to the &#8220;Repositories&#8221; tab and enable the ovs repository. You may disable
builds for pushes or pull requests.</p>
</li>
<li><p class="first">In order to avoid forks sending build failures to the upstream mailing list,
the notification email recipient is encrypted. If you want to receive email
notification for build failures, replace the the encrypted string:</p>
<ol class="arabic">
<li><p class="first">Install the travis-ci CLI (Requires ruby &gt;=2.0): gem install travis</p>
</li>
<li><p class="first">In your Open vSwitch repository: travis encrypt <a class="reference external" href="mailto:mylist&#37;&#52;&#48;mydomain&#46;org">mylist<span>&#64;</span>mydomain<span>&#46;</span>org</a></p>
</li>
<li><p class="first">Add/replace the notifications section in .travis.yml and fill in the
secure string as returned by travis encrypt:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>notifications:
  email:
    recipients:
      - secure: &quot;.....&quot;
</pre></div>
</div>
</li>
</ol>
</li>
</ol>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may remove/omit the notifications section to fall back to default
notification behaviour which is to send an email directly to the author and
committer of the failing commit. Note that the email is only sent if the
author/committer have commit rights for the particular GitHub repository.</p>
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li>Pushing a commit to the repository which breaks the build or the
testsuite will now trigger a email sent to <a class="reference external" href="mailto:mylist&#37;&#52;&#48;mydomain&#46;org">mylist<span>&#64;</span>mydomain<span>&#46;</span>org</a></li>
</ol>
</div>
<div class="section" id="vsperf">
<span id="testing-vsperf"></span><h5>vsperf<a class="headerlink" href="#vsperf" title="Permalink to this headline">¶</a></h5>
<p>The vsperf project aims to develop a vSwitch test framework that can be used to
validate the suitability of different vSwitch implementations in a telco
deployment environment. More information can be found on the <a class="reference external" href="https://wiki.opnfv.org/display/vsperf/VSperf+Home">OPNFV wiki</a>.</p>
</div>
</div>
</div>
</div>
<div class="section" id="ovn">
<h3>OVN<a class="headerlink" href="#ovn" title="Permalink to this headline">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-topics/high-availability"></span><div class="section" id="ovn-gateway-high-availability-plan">
<h4>OVN Gateway High Availability Plan<a class="headerlink" href="#ovn-gateway-high-availability-plan" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre><span></span>OVN Gateway

     +---------------------------+
     |                           |
     |     External Network      |
     |                           |
     +-------------^-------------+
                   |
                   |
             +-----------+
             |           |
             |  Gateway  |
             |           |
             +-----------+
                   ^
                   |
                   |
     +-------------v-------------+
     |                           |
     |    OVN Virtual Network    |
     |                           |
     +---------------------------+
</pre></div>
</div>
<p>The OVN gateway is responsible for shuffling traffic between the tunneled
overlay network (governed by ovn-northd), and the legacy physical network.  In
a naive implementation, the gateway is a single x86 server, or hardware VTEP.
For most deployments, a single system has enough forwarding capacity to service
the entire virtualized network, however, it introduces a single point of
failure.  If this system dies, the entire OVN deployment becomes unavailable.
To mitigate this risk, an HA solution is critical &#8211; by spreading
responsibility across multiple systems, no single server failure can take down
the network.</p>
<p>An HA solution is both critical to the manageability of the system, and
extremely difficult to get right.  The purpose of this document, is to propose
a plan for OVN Gateway High Availability which takes into account our past
experience building similar systems.  It should be considered a fluid changing
proposal, not a set-in-stone decree.</p>
<div class="section" id="basic-architecture">
<h5>Basic Architecture<a class="headerlink" href="#basic-architecture" title="Permalink to this headline">¶</a></h5>
<p>In an OVN deployment, the set of hypervisors and network elements operating
under the guidance of ovn-northd are in what&#8217;s called &#8220;logical space&#8221;.  These
servers use VXLAN, STT, or Geneve to communicate, oblivious to the details of
the underlying physical network.  When these systems need to communicate with
legacy networks, traffic must be routed through a Gateway which translates from
OVN controlled tunnel traffic, to raw physical network traffic.</p>
<p>Since the gateway is typically the only system with a connection to the
physical network all traffic between logical space and the WAN must travel
through it.  This makes it a critical single point of failure &#8211; if the gateway
dies, communication with the WAN ceases for all systems in logical space.</p>
<p>To mitigate this risk, multiple gateways should be run in a &#8220;High Availability
Cluster&#8221; or &#8220;HA Cluster&#8221;.  The HA cluster will be responsible for performing
the duties of a gateways,  while being able to recover gracefully from
individual member failures.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>OVN Gateway HA Cluster

         +---------------------------+
         |                           |
         |     External Network      |
         |                           |
         +-------------^-------------+
                       |
                       |
+----------------------v----------------------+
|                                             |
|          High Availability Cluster          |
|                                             |
| +-----------+  +-----------+  +-----------+ |
| |           |  |           |  |           | |
| |  Gateway  |  |  Gateway  |  |  Gateway  | |
| |           |  |           |  |           | |
| +-----------+  +-----------+  +-----------+ |
+----------------------^----------------------+
                       |
                       |
         +-------------v-------------+
         |                           |
         |    OVN Virtual Network    |
         |                           |
         +---------------------------+
</pre></div>
</div>
<div class="section" id="l2-vs-l3-high-availability">
<h6>L2 vs L3 High Availability<a class="headerlink" href="#l2-vs-l3-high-availability" title="Permalink to this headline">¶</a></h6>
<p>In order to achieve this goal, there are two broad approaches one can take.
The HA cluster can appear to the network like a giant Layer 2 Ethernet Switch,
or like a giant IP Router. These approaches are called L2HA, and L3HA
respectively.  L2HA allows ethernet broadcast domains to extend into logical
space, a significant advantage, but this comes at a cost.  The need to avoid
transient L2 loops during failover significantly complicates their design.  On
the other hand, L3HA works for most use cases, is simpler, and fails more
gracefully.  For these reasons, it is suggested that OVN supports an L3HA
model, leaving L2HA for future work (or third party VTEP providers).  Both
models are discussed further below.</p>
</div>
</div>
<div class="section" id="l3ha">
<h5>L3HA<a class="headerlink" href="#l3ha" title="Permalink to this headline">¶</a></h5>
<p>In this section, we&#8217;ll work through a basic simple L3HA implementation, on top
of which we&#8217;ll gradually build more sophisticated features explaining their
motivations and implementations as we go.</p>
<div class="section" id="naive-active-backup">
<h6>Naive active-backup<a class="headerlink" href="#naive-active-backup" title="Permalink to this headline">¶</a></h6>
<p>Let&#8217;s assume that there are a collection of logical routers which a tenant has
asked for, our task is to schedule these logical routers on one of N gateways,
and gracefully redistribute the routers on gateways which have failed.  The
absolute simplest way to achieve this is what we&#8217;ll call &#8220;naive-active-backup&#8221;.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Naive Active Backup HA Implementation

+----------------+   +----------------+
| Leader         |   | Backup         |
|                |   |                |
|      A B C     |   |                |
|                |   |                |
+----+-+-+-+----++   +-+--------------+
     ^ ^ ^ ^    |      |
     | | | |    |      |
     | | | |  +-+------+---+
     + + + +  | ovn-northd |
     Traffic  +------------+
</pre></div>
</div>
<p>In a naive active-backup, one of the Gateways is chosen (arbitrarily) as a
leader.  All logical routers (A, B, C in the figure), are scheduled on this
leader gateway and all traffic flows through it.  ovn-northd monitors this
gateway via OpenFlow echo requests (or some equivalent), and if the gateway
dies, it recreates the routers on one of the backups.</p>
<p>This approach basically works in most cases and should likely be the starting
point for OVN &#8211; it&#8217;s strictly better than no HA solution and is a good
foundation for more sophisticated solutions.  That said, it&#8217;s not without it&#8217;s
limitations. Specifically, this approach doesn&#8217;t coordinate with the physical
network to minimize disruption during failures, and it tightly couples failover
to ovn-northd (we&#8217;ll discuss why this is bad in a bit), and wastes resources by
leaving backup gateways completely unutilized.</p>
<div class="section" id="router-failover">
<h7>Router Failover<a class="headerlink" href="#router-failover" title="Permalink to this headline">¶</a></h7>
<p>When ovn-northd notices the leader has died and decides to migrate routers to a
backup gateway, the physical network has to be notified to direct traffic to
the new gateway.  Otherwise, traffic could be blackholed for longer than
necessary making failovers worse than they need to be.</p>
<p>For now, let&#8217;s assume that OVN requires all gateways to be on the same IP
subnet on the physical network.  If this isn&#8217;t the case, gateways would need to
participate in routing protocols to orchestrate failovers, something which is
difficult and out of scope of this document.</p>
<p>Since all gateways are on the same IP subnet, we simply need to worry about
updating the MAC learning tables of the Ethernet switches on that subnet.
Presumably, they all have entries for each logical router pointing to the old
leader.  If these entries aren&#8217;t updated, all traffic will be sent to the (now
defunct) old leader, instead of the new one.</p>
<p>In order to mitigate this issue, it&#8217;s recommended that the new gateway sends a
Reverse ARP (RARP) onto the physical network for each logical router it now
controls.  A Reverse ARP is a benign protocol used by many hypervisors when
virtual machines migrate to update L2 forwarding tables.  In this case, the
ethernet source address of the RARP is that of the logical router it
corresponds to, and its destination is the broadcast address.  This causes the
RARP to travel to every L2 switch in the broadcast domain, updating forwarding
tables accordingly.  This strategy is recommended in all failover mechanisms
discussed in this document &#8211; when a router newly boots on a new leader, it
should RARP its MAC address.</p>
</div>
</div>
<div class="section" id="controller-independent-active-backup">
<h6>Controller Independent Active-backup<a class="headerlink" href="#controller-independent-active-backup" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python"><div class="highlight"><pre><span></span>Controller Independent Active-Backup Implementation

+----------------+   +----------------+
| Leader         |   | Backup         |
|                |   |                |
|      A B C     |   |                |
|                |   |                |
+----------------+   +----------------+
     ^ ^ ^ ^
     | | | |
     | | | |
     + + + +
     Traffic
</pre></div>
</div>
<p>The fundamental problem with naive active-backup, is it tightly couples the
failover solution to ovn-northd.  This can significantly increase downtime in
the event of a failover as the (often already busy) ovn-northd controller has
to recompute state for the new leader. Worse, if ovn-northd goes down, we can&#8217;t
perform gateway failover at all.  This violates the principle that control
plane outages should have no impact on dataplane functionality.</p>
<p>In a controller independent active-backup configuration, ovn-northd is
responsible for initial configuration while the HA cluster is responsible for
monitoring the leader, and failing over to a backup if necessary.  ovn-northd
sets HA policy, but doesn&#8217;t actively participate when failovers occur.</p>
<p>Of course, in this model, ovn-northd is not without some responsibility.  Its
role is to pre-plan what should happen in the event of a failure, leaving it to
the individual switches to execute this plan.  It does this by assigning each
gateway a unique leadership priority.  Once assigned, it communicates this
priority to each node it controls.  Nodes use the leadership priority to
determine which gateway in the cluster is the active leader by using a simple
metric: the leader is the gateway that is healthy, with the highest priority.
If that gateway goes down, leadership falls to the next highest priority, and
conversely, if a new gateway comes up with a higher priority, it takes over
leadership.</p>
<p>Thus, in this model, leadership of the HA cluster is determined simply by the
status of its members.  Therefore if we can communicate the status of each
gateway to each transport node, they can individually figure out which is the
leader, and direct traffic accordingly.</p>
<div class="section" id="tunnel-monitoring">
<h7>Tunnel Monitoring<a class="headerlink" href="#tunnel-monitoring" title="Permalink to this headline">¶</a></h7>
<p>Since in this model leadership is determined exclusively by the health status
of member gateways, a key problem is how do we communicate this information to
the relevant transport nodes.  Luckily, we can do this fairly cheaply using
tunnel monitoring protocols like BFD.</p>
<p>The basic idea is pretty straightforward.  Each transport node maintains a
tunnel to every gateway in the HA cluster (not just the leader).  These tunnels
are monitored using the BFD protocol to see which are alive.  Given this
information, hypervisors can trivially compute the highest priority live
gateway, and thus the leader.</p>
<p>In practice, this leadership computation can be performed trivially using the
bundle or group action.  Rather than using OpenFlow to simply output to the
leader, all gateways could be listed in an active-backup bundle action ordered
by their priority.  The bundle action will automatically take into account the
tunnel monitoring status to output the packet to the highest priority live
gateway.</p>
</div>
<div class="section" id="inter-gateway-monitoring">
<h7>Inter-Gateway Monitoring<a class="headerlink" href="#inter-gateway-monitoring" title="Permalink to this headline">¶</a></h7>
<p>One somewhat subtle aspect of this model, is that failovers are not globally
atomic.  When a failover occurs, it will take some time for all hypervisors to
notice and adjust accordingly.  Similarly, if a new high priority Gateway comes
up, it may take some time for all hypervisors to switch over to the new leader.
In order to avoid confusing the physical network, under these circumstances
it&#8217;s important for the backup gateways to drop traffic they&#8217;ve received
erroneously.  In order to do this, each Gateway must know whether or not it is,
in fact active.  This can be achieved by creating a mesh of tunnels between
gateways.  Each gateway monitors the other gateways its cluster to determine
which are alive, and therefore whether or not that gateway happens to be the
leader.  If leading, the gateway forwards traffic normally, otherwise it drops
all traffic.</p>
</div>
<div class="section" id="gateway-leadership-resignation">
<h7>Gateway Leadership Resignation<a class="headerlink" href="#gateway-leadership-resignation" title="Permalink to this headline">¶</a></h7>
<p>Sometimes a gateway may be healthy, but still may not be suitable to lead the
HA cluster.  This could happen for several reasons including:</p>
<ul class="simple">
<li>The physical network is unreachable</li>
<li>BFD (or ping) has detected the next hop router is unreachable</li>
<li>The Gateway recently booted and isn&#8217;t fully configured</li>
</ul>
<p>In this case, the Gateway should resign leadership by holding its tunnels down
using the <code class="docutils literal"><span class="pre">other_config:cpath_down</span></code> flag.  This indicates to participating
hypervisors and Gateways that this gateway should be treated as if it&#8217;s down,
even though its tunnels are still healthy.</p>
</div>
</div>
<div class="section" id="router-specific-active-backup">
<h6>Router Specific Active-Backup<a class="headerlink" href="#router-specific-active-backup" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python"><div class="highlight"><pre><span></span>Router Specific Active-Backup

+----------------+ +----------------+
|                | |                |
|      A C       | |     B D E      |
|                | |                |
+----------------+ +----------------+
              ^ ^   ^ ^
              | |   | |
              | |   | |
              + +   + +
               Traffic
</pre></div>
</div>
<p>Controller independent active-backup is a great advance over naive
active-backup, but it still has one glaring problem &#8211; it under-utilizes the
backup gateways.  In ideal scenario, all traffic would split evenly among the
live set of gateways.  Getting all the way there is somewhat tricky, but as a
step in the direction, one could use the &#8220;Router Specific Active-Backup&#8221;
algorithm.  This algorithm looks a lot like active-backup on a per logical
router basis, with one twist.  It chooses a different active Gateway for each
logical router.  Thus, in situations where there are several logical routers,
all with somewhat balanced load, this algorithm performs better.</p>
<p>Implementation of this strategy is quite straightforward if built on top of
basic controller independent active-backup.  On a per logical router basis, the
algorithm is the same, leadership is determined by the liveness of the
gateways.  The key difference here is that the gateways must have a different
leadership priority for each logical router.  These leadership priorities can
be computed by ovn-northd just as they had been in the controller independent
active-backup model.</p>
<p>Once we have these per logical router priorities, they simply need be
communicated to the members of the gateway cluster and the hypervisors.  The
hypervisors in particular, need simply have an active-backup bundle action (or
group action) per logical router listing the gateways in priority order for
<em>that router</em>, rather than having a single bundle action shared for all the
routers.</p>
<p>Additionally, the gateways need to be updated to take into account individual
router priorities.  Specifically, each gateway should drop traffic of backup
routers it&#8217;s running, and forward traffic of active gateways, instead of simply
dropping or forwarding everything.  This should likely be done by having
ovn-controller recompute OpenFlow for the gateway, though other options exist.</p>
<p>The final complication is that ovn-northd&#8217;s logic must be updated to choose
these per logical router leadership priorities in a more sophisticated manner.
It doesn&#8217;t matter much exactly what algorithm it chooses to do this, beyond
that it should provide good balancing in the common case.  I.E. each logical
routers priorities should be different enough that routers balance to different
gateways even when failures occur.</p>
<div class="section" id="preemption">
<h7>Preemption<a class="headerlink" href="#preemption" title="Permalink to this headline">¶</a></h7>
<p>In an active-backup setup, one issue that users will run into is that of
gateway leader preemption.  If a new Gateway is added to a cluster, or for some
reason an existing gateway is rebooted, we could end up in a situation where
the newly activated gateway has higher priority than any other in the HA
cluster.  In this case, as soon as that gateway appears, it will preempt
leadership from the currently active leader causing an unnecessary failover.
Since failover can be quite expensive, this preemption may be undesirable.</p>
<p>The controller can optionally avoid preemption by cleverly tweaking the
leadership priorities.  For each router, new gateways should be assigned
priorities that put them second in line or later when they eventually come up.
Furthermore, if a gateway goes down for a significant period of time, its old
leadership priorities should be revoked and new ones should be assigned as if
it&#8217;s a brand new gateway.  Note that this should only happen if a gateway has
been down for a while (several minutes), otherwise a flapping gateway could
have wide ranging, unpredictable, consequences.</p>
<p>Note that preemption avoidance should be optional depending on the deployment.
One necessarily sacrifices optimal load balancing to satisfy these requirements
as new gateways will get no traffic on boot.  Thus, this feature represents a
trade-off which must be made on a per installation basis.</p>
</div>
</div>
<div class="section" id="fully-active-active-ha">
<h6>Fully Active-Active HA<a class="headerlink" href="#fully-active-active-ha" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python"><div class="highlight"><pre><span></span>Fully Active-Active HA

+----------------+ +----------------+
|                | |                |
|   A B C D E    | |    A B C D E   |
|                | |                |
+----------------+ +----------------+
              ^ ^   ^ ^
              | |   | |
              | |   | |
              + +   + +
               Traffic
</pre></div>
</div>
<p>The final step in L3HA is to have true active-active HA.  In this scenario each
router has an instance on each Gateway, and a mechanism similar to ECMP is used
to distribute traffic evenly among all instances.  This mechanism would require
Gateways to participate in routing protocols with the physical network to
attract traffic and alert of failures.  It is out of scope of this document,
but may eventually be necessary.</p>
</div>
</div>
<div class="section" id="l2ha">
<h5>L2HA<a class="headerlink" href="#l2ha" title="Permalink to this headline">¶</a></h5>
<p>L2HA is very difficult to get right.  Unlike L3HA, where the consequences of
problems are minor, in L2HA if two gateways are both transiently active, an L2
loop triggers and a broadcast storm results.  In practice to get around this,
gateways end up implementing an overly conservative &#8220;when in doubt drop all
traffic&#8221; policy, or they implement something like MLAG.</p>
<p>MLAG has multiple gateways work together to pretend to be a single L2 switch
with a large LACP bond.  In principle, it&#8217;s the right solution to the problem
as it solves the broadcast storm problem, and has been deployed successfully in
other contexts.  That said, it&#8217;s difficult to get right and not recommended.</p>
</div>
</div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>ovn-architecture(7)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-architecture.7.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-architecture.7.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-architecture.7.txt">(plain text)</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<span id="document-howto/index"></span><div class="section" id="how-to-guides">
<h2>How-to Guides<a class="headerlink" href="#how-to-guides" title="Permalink to this headline">¶</a></h2>
<p>Answers to common &#8220;How do I?&#8221;-style questions. For more information on the
topics covered herein, refer to <a class="reference internal" href="contents.html#document-topics/index"><em>Deep Dive</em></a>.</p>
<div class="section" id="ovs">
<h3>OVS<a class="headerlink" href="#ovs" title="Permalink to this headline">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-howto/kvm"></span><div class="section" id="open-vswitch-with-kvm">
<h4>Open vSwitch with KVM<a class="headerlink" href="#open-vswitch-with-kvm" title="Permalink to this headline">¶</a></h4>
<p>This document describes how to use Open vSwitch with the Kernel-based Virtual
Machine (KVM).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This document assumes that you have Open vSwitch set up on a Linux system.</p>
</div>
<div class="section" id="setup">
<h5>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h5>
<p>KVM uses tunctl to handle various bridging modes, which you can install with
the Debian/Ubuntu package <code class="docutils literal"><span class="pre">uml-utilities</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ apt-get install uml-utilities
</pre></div>
</div>
<p>Next, you will need to modify or create custom versions of the <code class="docutils literal"><span class="pre">qemu-ifup</span></code>
and <code class="docutils literal"><span class="pre">qemu-ifdown</span></code> scripts. In this guide, we&#8217;ll create custom versions that
make use of example Open vSwitch bridges that we&#8217;ll describe in this guide.</p>
<p>Create the following two files and store them in known locations. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>echo &lt;&lt; EOF &gt; /etc/ovs-ifup
#!/bin/sh

switch=&#39;br0&#39;
/sbin/ifconfig $1 0.0.0.0 up
ovs-vsctl add-port ${switch} $1
EOF
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>echo &lt;&lt; EOF &gt; /etc/ovs-ifdown
#!/bin/sh

switch=&#39;br0&#39;
/sbin/ifconfig $1 0.0.0.0 down
ovs-vsctl del-port ${switch} $1
</pre></div>
</div>
<p>The basic usage of Open vSwitch is described at the end of
<a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a>. If you haven&#8217;t already, create a bridge named
<code class="docutils literal"><span class="pre">br0</span></code> with the following command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
</pre></div>
</div>
<p>Then, add a port to the bridge for the NIC that you want your guests to
communicate over (e.g. <code class="docutils literal"><span class="pre">eth0</span></code>):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 eth0
</pre></div>
</div>
<p>Refer to ovs-vsctl(8) for more details.</p>
<p>Next, we&#8217;ll start a guest that will use our ifup and ifdown scripts:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ kvm -m 512 -net nic,macaddr=00:11:22:EE:EE:EE -net \
    tap,script=/etc/ovs-ifup,downscript=/etc/ovs-ifdown -drive \
    file=/path/to/disk-image,boot=on
</pre></div>
</div>
<p>This will start the guest and associate a tap device with it. The <code class="docutils literal"><span class="pre">ovs-ifup</span></code>
script will add a port on the br0 bridge so that the guest will be able to
communicate over that bridge.</p>
<p>To get some more information and for debugging you can use Open vSwitch
utilities such as ovs-dpctl and ovs-ofctl, For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-dpctl show
$ ovs-ofctl show br0
</pre></div>
</div>
<p>You should see tap devices for each KVM guest added as ports to the bridge
(e.g. tap0)</p>
<p>Refer to ovs-dpctl(8) and ovs-ofctl(8) for more details.</p>
</div>
<div class="section" id="bug-reporting">
<h5>Bug Reporting<a class="headerlink" href="#bug-reporting" title="Permalink to this headline">¶</a></h5>
<p>Please report problems to <a class="reference external" href="mailto:bugs&#37;&#52;&#48;openvswitch&#46;org">bugs<span>&#64;</span>openvswitch<span>&#46;</span>org</a>.</p>
</div>
</div>
<span id="document-howto/selinux"></span><div class="section" id="open-vswitch-with-selinux">
<h4>Open vSwitch with SELinux<a class="headerlink" href="#open-vswitch-with-selinux" title="Permalink to this headline">¶</a></h4>
<p>Security-Enhanced Linux (SELinux) is a Linux kernel security module that limits
&#8220;the malicious things&#8221; that certain processes, including OVS, can do to the
system in case they get compromised.  In our case SELinux basically serves as
the &#8220;second line of defense&#8221; that limits the things that OVS processes are
allowed to do.  The &#8220;first line of defense&#8221; is proper input validation that
eliminates code paths that could be used by attacker to do any sort of &#8220;escape
attacks&#8221;, such as file name escape, shell escape, command line argument escape,
buffer escape. Since developers don&#8217;t always implement proper input validation,
then SELinux Access Control&#8217;s goal is to confine damage of such attacks, if
they turned out to be possible.</p>
<p>Besides Type Enforcement there are other SELinux features, but they are out of
scope for this document.</p>
<p>Currently there are two SELinux policies for Open vSwitch:</p>
<ul class="simple">
<li>the one that ships with your Linux distribution (i.e.
selinux-policy-targeted package)</li>
<li>the one that ships with OVS (i.e. openvswitch-selinux-policy package)</li>
</ul>
<div class="section" id="limitations">
<h5>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h5>
<p>If Open vSwitch is directly started from command line, then it will run under
<code class="docutils literal"><span class="pre">unconfined_t</span></code> SELinux domain that basically lets daemon to do whatever it
likes.  This is very important for developers to understand, because they might
introduced code in OVS that invokes new system calls that SELinux policy did
not anticipate.  This means that their feature may have worked out just fine
for them.  However, if someone else would try to run the same code when Open
vSwitch is started through systemctl, then Open vSwitch would get Permission
Denied errors.</p>
<p>Currently the only distributions that enforce SELinux on OVS by default are
RHEL, CentOS and Fedora.  While Ubuntu and Debian also have some SELinux
support, they run Open vSwitch under the unrestricted <code class="docutils literal"><span class="pre">unconfined</span></code> domain.
Also, it seems that Ubuntu is leaning towards Apparmor that works slightly
differently than SELinux.</p>
<p>SELinux and Open vSwitch are moving targets.  What this means is that, if you
solely rely on your Linux distribution&#8217;s SELinux policy, then this policy might
not have correctly anticipated that a newer Open vSwitch version needs extra
white list rules.  However, if you solely rely on SELinux policy that ships
with Open vSwitch, then Open vSwitch developers might not have correctly
anticipated the feature set that your SELinux implementation supports.</p>
</div>
<div class="section" id="installation">
<h5>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h5>
<p>Refer to <a class="reference internal" href="contents.html#document-intro/install/fedora"><em>Fedora, RHEL 7.x Packaging for Open vSwitch</em></a> for instructions on how to build all Open
vSwitch rpm packages.</p>
<p>Once the package is built, install it on your Linux distribution:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ dnf install openvswitch-selinux-policy-2.4.1-1.el7.centos.noarch.rpm
</pre></div>
</div>
<p>Restart Open vSwitch:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ systemctl restart openvswitch
</pre></div>
</div>
</div>
<div class="section" id="troubleshooting">
<h5>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h5>
<p>When SELinux was implemented some of the standard system utilities acquired
<code class="docutils literal"><span class="pre">-Z</span></code> flag (e.g. <code class="docutils literal"><span class="pre">ps</span> <span class="pre">-Z</span></code>, <code class="docutils literal"><span class="pre">ls</span> <span class="pre">-Z</span></code>).  For example, to find out under which
SELinux security domain process runs, use:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ps -AZ | grep ovs-vswitchd
system_u:system_r:openvswitch_t:s0 854 ?    ovs-vswitchd
</pre></div>
</div>
<p>To find out the SELinux label of file or directory, use:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ls -Z /etc/openvswitch/conf.db
system_u:object_r:openvswitch_rw_t:s0 /etc/openvswitch/conf.db
</pre></div>
</div>
<p>If, for example, SELinux policy for Open vSwitch is too strict, then you might
see in Open vSwitch log files &#8220;Permission Denied&#8221; errors:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cat /var/log/openvswitch/ovs-vswitchd.log
vlog|INFO|opened log file /var/log/openvswitch/ovs-vswitchd.log
ovs_numa|INFO|Discovered 2 CPU cores on NUMA node 0
ovs_numa|INFO|Discovered 1 NUMA nodes and 2 CPU cores
reconnect|INFO|unix:/var/run/openvswitch/db.sock: connecting...
reconnect|INFO|unix:/var/run/openvswitch/db.sock: connected
netlink_socket|ERR|fcntl: Permission denied
dpif_netlink|ERR|Generic Netlink family &#39;ovs_datapath&#39; does not exist.
                 The Open vSwitch kernel module is probably not loaded.
dpif|WARN|failed to enumerate system datapaths: Permission denied
dpif|WARN|failed to create datapath ovs-system: Permission denied
</pre></div>
</div>
<p>However, not all &#8220;Permission denied&#8221; errors are caused by SELinux.  So, before
blaming too strict SELinux policy, make sure that indeed SELinux was the one
that denied OVS access to certain resources, for example, run:</p>
<blockquote>
<div>$ grep &#8220;openvswitch_t&#8221; /var/log/audit/audit.log | tail
type=AVC msg=audit(1453235431.640:114671): avc:  denied  { getopt } for  pid=4583 comm=&#8221;ovs-vswitchd&#8221; scontext=system_u:system_r:openvswitch_t:s0 tcontext=system_u:system_r:openvswitch_t:s0 tclass=netlink_generic_socket permissive=0</div></blockquote>
<p>If SELinux denied OVS access to certain resources, then make sure that you have
installed our SELinux policy package that &#8220;loosens&#8221; up distribution&#8217;s SELinux
policy:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ rpm -qa | grep openvswitch-selinux
openvswitch-selinux-policy-2.4.1-1.el7.centos.noarch
</pre></div>
</div>
<p>Then verify that this module was indeed loaded:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># semodule -l | grep openvswitch
openvswitch-custom    1.0
openvswitch          1.1.1
</pre></div>
</div>
<p>If you still see Permission denied errors, then take a look into
<code class="docutils literal"><span class="pre">selinux/openvswitch.te</span></code> file in the OVS source tree and try to add white
list rules.  This is really simple, just run SELinux audit2allow tool:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ grep &quot;openvswitch_t&quot; /var/log/audit/audit.log | audit2allow -M ovslocal
</pre></div>
</div>
</div>
<div class="section" id="contributing-selinux-policy-patches">
<h5>Contributing SELinux policy patches<a class="headerlink" href="#contributing-selinux-policy-patches" title="Permalink to this headline">¶</a></h5>
<p>Here are few things to consider before proposing SELinux policy patches to Open
vSwitch developer mailing list:</p>
<ol class="arabic">
<li><p class="first">The SELinux policy that resides in Open vSwitch source tree amends SELinux
policy that ships with your distributions.</p>
<p>Implications of this are that it is assumed that the distribution&#8217;s Open
vSwitch SELinux module must be already loaded to satisfy dependencies.</p>
</li>
<li><p class="first">The SELinux policy that resides in Open vSwitch source tree must work on all
currently relevant Linux distributions.</p>
<p>Implications of this are that you should use only those SELinux policy
features that are supported by the lowest SELinux version out there.
Typically this means that you should test your SELinux policy changes on the
oldest RHEL or CentOS version that this OVS version supports. Refer to
<a class="reference internal" href="contents.html#document-intro/install/fedora"><em>Fedora, RHEL 7.x Packaging for Open vSwitch</em></a> to find out this.</p>
</li>
<li><p class="first">The SELinux policy is enforced only when state transition to
<code class="docutils literal"><span class="pre">openvswitch_t</span></code> domain happens.</p>
<p>Implications of this are that perhaps instead of loosening SELinux policy
you can do certain things at the time rpm package is installed.</p>
</li>
</ol>
</div>
<div class="section" id="reporting-bugs">
<h5>Reporting Bugs<a class="headerlink" href="#reporting-bugs" title="Permalink to this headline">¶</a></h5>
<p>Report problems to <a class="reference external" href="mailto:bugs&#37;&#52;&#48;openvswitch&#46;org">bugs<span>&#64;</span>openvswitch<span>&#46;</span>org</a>.</p>
</div>
</div>
<span id="document-howto/libvirt"></span><div class="section" id="open-vswitch-with-libvirt">
<h4>Open vSwitch with Libvirt<a class="headerlink" href="#open-vswitch-with-libvirt" title="Permalink to this headline">¶</a></h4>
<p>This document describes how to use Open vSwitch with Libvirt 0.9.11 or later.
This document assumes that you followed <a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a> or
installed Open vSwitch from distribution packaging such as a .deb or .rpm.  The
Open vSwitch support is included by default in Libvirt 0.9.11. Consult
www.libvirt.org for instructions on how to build the latest Libvirt, if your
Linux distribution by default comes with an older Libvirt release.</p>
<div class="section" id="limitations">
<h5>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h5>
<p>Currently there is no Open vSwitch support for networks that are managed by
libvirt (e.g. NAT). As of now, only bridged networks are supported (those where
the user has to manually create the bridge).</p>
</div>
<div class="section" id="setup">
<h5>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h5>
<p>First, create the Open vSwitch bridge by using the ovs-vsctl utility (this must
be done with administrative privileges):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br ovsbr
</pre></div>
</div>
<p>Once that is done, create a VM, if necessary, and edit its Domain XML file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ virsh edit &lt;vm&gt;
</pre></div>
</div>
<p>Lookup in the Domain XML file the <code class="docutils literal"><span class="pre">&lt;interface&gt;</span></code> section. There should be one
such XML section for each interface the VM has:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>&lt;interface type=&#39;network&#39;&gt;
 &lt;mac address=&#39;52:54:00:71:b1:b6&#39;/&gt;
 &lt;source network=&#39;default&#39;/&gt;
 &lt;address type=&#39;pci&#39; domain=&#39;0x0000&#39; bus=&#39;0x00&#39; slot=&#39;0x03&#39; function=&#39;0x0&#39;/&gt;
&lt;/interface&gt;
</pre></div>
</div>
<p>And change it to something like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>&lt;interface type=&#39;bridge&#39;&gt;
 &lt;mac address=&#39;52:54:00:71:b1:b6&#39;/&gt;
 &lt;source bridge=&#39;ovsbr&#39;/&gt;
 &lt;virtualport type=&#39;openvswitch&#39;/&gt;
 &lt;address type=&#39;pci&#39; domain=&#39;0x0000&#39; bus=&#39;0x00&#39; slot=&#39;0x03&#39; function=&#39;0x0&#39;/&gt;
&lt;/interface&gt;
</pre></div>
</div>
<p>The interface type must be set to <code class="docutils literal"><span class="pre">bridge</span></code>. The <code class="docutils literal"><span class="pre">&lt;source&gt;</span></code> XML element
specifies to which bridge this interface will be attached to. The
<code class="docutils literal"><span class="pre">&lt;virtualport&gt;</span></code> element indicates that the bridge in <code class="docutils literal"><span class="pre">&lt;source&gt;</span></code> element is
an Open vSwitch bridge.</p>
<p>Then (re)start the VM and verify if the guest&#8217;s vnet interface is attached to
the ovsbr bridge:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl show
</pre></div>
</div>
</div>
<div class="section" id="troubleshooting">
<h5>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h5>
<p>If the VM does not want to start, then try to run the libvirtd process either
from the terminal, so that all errors are printed in console, or inspect
Libvirt/Open vSwitch log files for possible root cause.</p>
</div>
<div class="section" id="bug-reporting">
<h5>Bug Reporting<a class="headerlink" href="#bug-reporting" title="Permalink to this headline">¶</a></h5>
<p>Report problems to <a class="reference external" href="mailto:bugs&#37;&#52;&#48;openvswitch&#46;org">bugs<span>&#64;</span>openvswitch<span>&#46;</span>org</a>.</p>
</div>
</div>
<span id="document-howto/ssl"></span><div class="section" id="open-vswitch-with-ssl">
<h4>Open vSwitch with SSL<a class="headerlink" href="#open-vswitch-with-ssl" title="Permalink to this headline">¶</a></h4>
<p>If you plan to configure Open vSwitch to connect across the network to an
OpenFlow controller, then we recommend that you build Open vSwitch with
OpenSSL. SSL support ensures integrity and confidentiality of the OpenFlow
connections, increasing network security.</p>
<p>This document describes how to configure an Open vSwitch to connect to an
OpenFlow controller over SSL.  Refer to <a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a>. for
instructions on building Open vSwitch with SSL support.</p>
<p>Open vSwitch uses TLS version 1.0 or later (TLSv1), as specified by RFC 2246,
which is very similar to SSL version 3.0.  TLSv1 was released in January 1999,
so all current software and hardware should implement it.</p>
<p>This document assumes basic familiarity with public-key cryptography and
public-key infrastructure.</p>
<div class="section" id="ssl-concepts-for-openflow">
<h5>SSL Concepts for OpenFlow<a class="headerlink" href="#ssl-concepts-for-openflow" title="Permalink to this headline">¶</a></h5>
<p>This section is an introduction to the public-key infrastructure architectures
that Open vSwitch supports for SSL authentication.</p>
<p>To connect over SSL, every Open vSwitch must have a unique private/public key
pair and a certificate that signs that public key.  Typically, the Open vSwitch
generates its own public/private key pair.  There are two common ways to obtain
a certificate for a switch:</p>
<ul>
<li><p class="first">Self-signed certificates: The Open vSwitch signs its certificate with its own
private key.  In this case, each switch must be individually approved by the
OpenFlow controller(s), since there is no central authority.</p>
<p>This is the only switch PKI model currently supported by NOX
(<a class="reference external" href="http://noxrepo.org">http://noxrepo.org</a>).</p>
</li>
<li><p class="first">Switch certificate authority: A certificate authority (the &#8220;switch CA&#8221;) signs
each Open vSwitch&#8217;s public key.  The OpenFlow controllers then check that any
connecting switches&#8217; certificates are signed by that certificate authority.</p>
<p>This is the only switch PKI model supported by the simple OpenFlow controller
included with Open vSwitch.</p>
</li>
</ul>
<p>Each Open vSwitch must also have a copy of the CA certificate for the
certificate authority that signs OpenFlow controllers&#8217; keys (the &#8220;controller
CA&#8221; certificate).  Typically, the same controller CA certificate is installed
on all of the switches within a given administrative unit.  There are two
common ways for a switch to obtain the controller CA certificate:</p>
<ul class="simple">
<li>Manually copy the certificate to the switch through some secure means, e.g.
using a USB flash drive, or over the network with &#8220;scp&#8221;, or even FTP or HTTP
followed by manual verification.</li>
<li>Open vSwitch &#8220;bootstrap&#8221; mode, in which Open vSwitch accepts and saves the
controller CA certificate that it obtains from the OpenFlow controller on its
first connection.  Thereafter the switch will only connect to controllers
signed by the same CA certificate.</li>
</ul>
</div>
<div class="section" id="establishing-a-public-key-infrastructure">
<h5>Establishing a Public Key Infrastructure<a class="headerlink" href="#establishing-a-public-key-infrastructure" title="Permalink to this headline">¶</a></h5>
<p>Open vSwitch can make use of your existing public key infrastructure.  If you
already have a PKI, you may skip forward to the next section.  Otherwise, if
you do not have a PKI, the ovs-pki script included with Open vSwitch can help.
To create an initial PKI structure, invoke it as:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-pki init
</pre></div>
</div>
<p>This will create and populate a new PKI directory.  The default location for
the PKI directory depends on how the Open vSwitch tree was configured (to see
the configured default, look for the <code class="docutils literal"><span class="pre">--dir</span></code> option description in the output
of <code class="docutils literal"><span class="pre">ovs-pki</span> <span class="pre">--help</span></code>).</p>
<p>The pki directory contains two important subdirectories.  The <cite>controllerca</cite>
subdirectory contains controller CA files, including the following:</p>
<dl class="docutils">
<dt><cite>cacert.pem</cite></dt>
<dd>Root certificate for the controller certificate authority.  Each Open vSwitch
must have a copy of this file to allow it to authenticate valid controllers.</dd>
<dt><cite>private/cakey.pem</cite></dt>
<dd>Private signing key for the controller certificate authority.  This file must
be kept secret.  There is no need for switches or controllers to have a copy
of it.</dd>
</dl>
<p>The <cite>switchca</cite> subdirectory contains switch CA files, analogous to those in the
<cite>controllerca</cite> subdirectory:</p>
<dl class="docutils">
<dt><cite>cacert.pem</cite></dt>
<dd>Root certificate for the switch certificate authority.  The OpenFlow
controller must have this file to enable it to authenticate valid switches.</dd>
<dt><cite>private/cakey.pem</cite></dt>
<dd>Private signing key for the switch certificate authority.  This file must be
kept secret.  There is no need for switches or controllers to have a copy of
it.</dd>
</dl>
<p>After you create the initial structure, you can create keys and certificates
for switches and controllers with ovs-pki.  Refer to the ovs-pki(8) manage for
complete details.  A few examples of its use follow:</p>
<div class="section" id="controller-key-generation">
<h6>Controller Key Generation<a class="headerlink" href="#controller-key-generation" title="Permalink to this headline">¶</a></h6>
<p>To create a controller private key and certificate in files named
ctl-privkey.pem and ctl-cert.pem, run the following on the machine that
contains the PKI structure:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-pki req+sign ctl controller
</pre></div>
</div>
<p>ctl-privkey.pem and ctl-cert.pem would need to be copied to the controller for
its use at runtime.  If, for testing purposes, you were to use
ovs-testcontroller, the simple OpenFlow controller included with Open vSwitch,
then the &#8211;private-key and &#8211;certificate options, respectively, would point to
these files.</p>
<p>It is very important to make sure that no stray copies of ctl-privkey.pem are
created, because they could be used to impersonate the controller.</p>
</div>
<div class="section" id="switch-key-generation-with-self-signed-certificates">
<h6>Switch Key Generation with Self-Signed Certificates<a class="headerlink" href="#switch-key-generation-with-self-signed-certificates" title="Permalink to this headline">¶</a></h6>
<p>If you are using self-signed certificates (see &#8220;SSL Concepts for OpenFlow&#8221;),
this is one way to create an acceptable certificate for your controller to
approve.</p>
<ol class="arabic">
<li><p class="first">Run the following command on the Open vSwitch itself:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-pki self-sign sc
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This command does not require a copy of any of the PKI files generated by
<code class="docutils literal"><span class="pre">ovs-pki</span> <span class="pre">init</span></code>, and you should not copy them to the switch because some
of them have contents that must remain secret for security.)</p>
</div>
<p>The <code class="docutils literal"><span class="pre">ovs-pki</span> <span class="pre">self-sign</span></code> command has the following output:</p>
<dl class="docutils">
<dt>sc-privkey.pem</dt>
<dd><p class="first last">the switch private key file.  For security, the contents of this file must
remain secret.  There is ordinarily no need to copy this file off the Open
vSwitch.</p>
</dd>
<dt>sc-cert.pem</dt>
<dd><p class="first last">the switch certificate, signed by the switch&#8217;s own private key.  Its
contents are not a secret.</p>
</dd>
</dl>
</li>
<li><p class="first">Optionally, copy <cite>controllerca/cacert.pem</cite> from the machine that has the
OpenFlow PKI structure and verify that it is correct.  (Otherwise, you will
have to use CA certificate bootstrapping when you configure Open vSwitch in
the next step.)</p>
</li>
<li><p class="first">Configure Open vSwitch to use the keys and certificates (see &#8220;Configuring
SSL Support&#8221;, below).</p>
</li>
</ol>
</div>
<div class="section" id="switch-key-generation-with-a-switch-pki-easy-method">
<h6>Switch Key Generation with a Switch PKI (Easy Method)<a class="headerlink" href="#switch-key-generation-with-a-switch-pki-easy-method" title="Permalink to this headline">¶</a></h6>
<p>If you are using a switch PKI (see &#8220;SSL Concepts for OpenFlow&#8221;, above), this
method of switch key generation is a little easier than the alternate method
described below, but it is also a little less secure because it requires
copying a sensitive private key from file from the machine hosting the PKI to
the switch.</p>
<ol class="arabic">
<li><p class="first">Run the following on the machine that contains the PKI structure:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-pki req+sign sc switch
</pre></div>
</div>
<p>This command has the following output:</p>
<dl class="docutils">
<dt>sc-privkey.pem</dt>
<dd><p class="first last">the switch private key file.  For security, the contents of this file must
remain secret.</p>
</dd>
<dt>sc-cert.pem</dt>
<dd><p class="first last">the switch certificate.  Its contents are not a secret.</p>
</dd>
</dl>
</li>
<li><p class="first">Copy sc-privkey.pem and sc-cert.pem, plus controllerca/cacert.pem, to the
Open vSwitch.</p>
</li>
<li><p class="first">Delete the copies of sc-privkey.pem and sc-cert.pem on the PKI machine and
any other copies that may have been made in transit.  It is very important
to make sure that there are no stray copies of sc-privkey.pem, because they
could be used to impersonate the switch.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Don&#8217;t delete controllerca/cacert.pem!  It is not security-sensitive and
you will need it to configure additional switches.</p>
</div>
</li>
<li><p class="first">Configure Open vSwitch to use the keys and certificates (see &#8220;Configuring
SSL Support&#8221;, below).</p>
</li>
</ol>
</div>
<div class="section" id="switch-key-generation-with-a-switch-pki-more-secure">
<h6>Switch Key Generation with a Switch PKI (More Secure)<a class="headerlink" href="#switch-key-generation-with-a-switch-pki-more-secure" title="Permalink to this headline">¶</a></h6>
<p>If you are using a switch PKI (see &#8220;SSL Concepts for OpenFlow&#8221;, above), then,
compared to the previous method, the method described here takes a little more
work, but it does not involve copying the private key from one machine to
another, so it may also be a little more secure.</p>
<ol class="arabic">
<li><p class="first">Run the following command on the Open vSwitch itself:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-pki req sc
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This command does not require a copy of any of the PKI files generated by
&#8220;ovs-pki init&#8221;, and you should not copy them to the switch because some of
them have contents that must remain secret for security.</p>
</div>
<p>The &#8220;ovs-pki req&#8221; command has the following output:</p>
<dl class="docutils">
<dt>sc-privkey.pem</dt>
<dd><p class="first last">the switch private key file.  For security, the contents of this file must
remain secret.  There is ordinarily no need to copy this file off the Open
vSwitch.</p>
</dd>
<dt>sc-req.pem</dt>
<dd><p class="first last">the switch &#8220;certificate request&#8221;, which is essentially the switch&#8217;s public
key.  Its contents are not a secret.</p>
</dd>
<dt>a fingerprint</dt>
<dd><p class="first last">this is output on stdout.</p>
</dd>
</dl>
</li>
<li><p class="first">Write the fingerprint down on a slip of paper and copy <cite>sc-req.pem</cite> to the
machine that contains the PKI structure.</p>
</li>
<li><p class="first">On the machine that contains the PKI structure, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-pki sign sc switch
</pre></div>
</div>
<p>This command will output a fingerprint to stdout and request that you verify
it.  Check that it is the same as the fingerprint that you wrote down on the
slip of paper before you answer &#8220;yes&#8221;.</p>
<p><code class="docutils literal"><span class="pre">ovs-pki</span> <span class="pre">sign</span></code> creates a file named <cite>sc-cert.pem</cite>, which is the switch
certificate.  Its contents are not a secret.</p>
</li>
<li><p class="first">Copy the generated <cite>sc-cert.pem</cite>, plus <cite>controllerca/cacert.pem</cite> from the
PKI structure, to the Open vSwitch, and verify that they were copied
correctly.</p>
<p>You may delete <cite>sc-cert.pem</cite> from the machine that hosts the PKI
structure now, although it is not important that you do so.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Don&#8217;t delete <cite>controllerca/cacert.pem</cite>!  It is not security-sensitive and
you will need it to configure additional switches.</p>
</div>
</li>
<li><p class="first">Configure Open vSwitch to use the keys and certificates (see &#8220;Configuring
SSL Support&#8221;, below).</p>
</li>
</ol>
</div>
</div>
<div class="section" id="configuring-ssl-support">
<h5>Configuring SSL Support<a class="headerlink" href="#configuring-ssl-support" title="Permalink to this headline">¶</a></h5>
<p>SSL configuration requires three additional configuration files.  The first two
of these are unique to each Open vSwitch.  If you used the instructions above
to build your PKI, then these files will be named <cite>sc-privkey.pem</cite> and
<cite>sc-cert.pem</cite>, respectively:</p>
<ul>
<li><p class="first">A private key file, which contains the private half of an RSA or DSA key.</p>
<p>This file can be generated on the Open vSwitch itself, for the greatest
security, or it can be generated elsewhere and copied to the Open vSwitch.</p>
<p>The contents of the private key file are secret and must not be exposed.</p>
</li>
<li><p class="first">A certificate file, which certifies that the private key is that of a
trustworthy Open vSwitch.</p>
<p>This file has to be generated on a machine that has the private key for the
switch certification authority, which should not be an Open vSwitch; ideally,
it should be a machine that is not networked at all.</p>
<p>The certificate file itself is not a secret.</p>
</li>
</ul>
<p>The third configuration file is typically the same across all the switches in a
given administrative unit.  If you used the instructions above to build your
PKI, then this file will be named <cite>cacert.pem</cite>:</p>
<ul class="simple">
<li>The root certificate for the controller certificate authority.  The Open
vSwitch verifies it that is authorized to connect to an OpenFlow controller
by verifying a signature against this CA certificate.</li>
</ul>
<p>Once you have these files, configure ovs-vswitchd to use them using the
<code class="docutils literal"><span class="pre">ovs-vsctl</span> <span class="pre">set-ssl</span></code> command, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set-ssl /etc/openvswitch/sc-privkey.pem \
    /etc/openvswitch/sc-cert.pem /etc/openvswitch/cacert.pem
</pre></div>
</div>
<p>Substitute the correct file names, of course, if they differ from the ones used
above.  You should use absolute file names (ones that begin with <code class="docutils literal"><span class="pre">/</span></code>),
because ovs-vswitchd&#8217;s current directory is unrelated to the one from which you
run ovs-vsctl.</p>
<p>If you are using self-signed certificates (see &#8220;SSL Concepts for OpenFlow&#8221;) and
you did not copy controllerca/cacert.pem from the PKI machine to the Open
vSwitch, then add the <code class="docutils literal"><span class="pre">--bootstrap</span></code> option, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl -- --bootstrap set-ssl /etc/openvswitch/sc-privkey.pem \
    /etc/openvswitch/sc-cert.pem /etc/openvswitch/cacert.pem
</pre></div>
</div>
<p>After you have added all of these configuration keys, you may specify <code class="docutils literal"><span class="pre">ssl:</span></code>
connection methods elsewhere in the configuration database.  <code class="docutils literal"><span class="pre">tcp:</span></code> connection
methods are still allowed even after SSL has been configured, so for security
you should use only <code class="docutils literal"><span class="pre">ssl:</span></code> connections.</p>
</div>
<div class="section" id="reporting-bugs">
<h5>Reporting Bugs<a class="headerlink" href="#reporting-bugs" title="Permalink to this headline">¶</a></h5>
<p>Report problems to <a class="reference external" href="mailto:bugs&#37;&#52;&#48;openvswitch&#46;org">bugs<span>&#64;</span>openvswitch<span>&#46;</span>org</a>.</p>
</div>
</div>
<span id="document-howto/lisp"></span><div class="section" id="using-lisp-tunneling">
<h4>Using LISP tunneling<a class="headerlink" href="#using-lisp-tunneling" title="Permalink to this headline">¶</a></h4>
<p>LISP is a layer 3 tunneling mechanism, meaning that encapsulated packets do not
carry Ethernet headers, and ARP requests shouldn&#8217;t be sent over the tunnel.
Because of this, there are some additional steps required for setting up LISP
tunnels in Open vSwitch, until support for L3 tunnels will improve.</p>
<p>This guide assumes tunneling between two VMs connected to OVS bridges on
different hypervisors reachable over IPv4.  Of course, more than one VM may be
connected to any of the hypervisors, and a hypervisor may communicate with
several different hypervisors over the same lisp tunneling interface.  A LISP
&#8220;map-cache&#8221; can be implemented using flows, see example at the bottom of this
file.</p>
<p>There are several scenarios:</p>
<ol class="arabic simple">
<li>the VMs have IP addresses in the same subnet and the hypervisors are also
in a single subnet (although one different from the VM&#8217;s);</li>
<li>the VMs have IP addresses in the same subnet but the hypervisors are
separated by a router;</li>
<li>the VMs are in different subnets.</li>
</ol>
<p>In cases 1) and 3) ARP resolution can work as normal: ARP traffic is configured
not to go through the LISP tunnel.  For case 1) ARP is able to reach the other
VM, if both OVS instances default to MAC address learning.  Case 3) requires
the hypervisor be configured as the default router for the VMs.</p>
<p>In case 2) the VMs expect ARP replies from each other, but this is not possible
over a layer 3 tunnel.  One solution is to have static MAC address entries
preconfigured on the VMs (e.g., <code class="docutils literal"><span class="pre">arp</span> <span class="pre">-f</span> <span class="pre">/etc/ethers</span></code> on startup on Unix based
VMs), or have the hypervisor do proxy ARP.  In this scenario, the eth0
interfaces need not be added to the br0 bridge in the examples below.</p>
<p>On the receiving side, the packet arrives without the original MAC header.  The
LISP tunneling code attaches a header with harcoded source and destination MAC
address <code class="docutils literal"><span class="pre">02:00:00:00:00:00</span></code>.  This address has all bits set to 0, except the
locally administered bit, in order to avoid potential collisions with existing
allocations.  In order for packets to reach their intended destination, the
destination MAC address needs to be rewritten.  This can be done using the flow
table.</p>
<p>See below for an example setup, and the associated flow rules to enable LISP
tunneling.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Diagram

       +---+                               +---+
       |VM1|                               |VM2|
       +---+                               +---+
         |                                   |
    +--[tap0]--+                       +--[tap0]---+
    |          |                       |           |
[lisp0] OVS1 [eth0]-----------------[eth0] OVS2 [lisp0]
    |          |                       |           |
    +----------+                       +-----------+
</pre></div>
</div>
<p>On each hypervisor, interfaces tap0, eth0, and lisp0 are added to a single
bridge instance, and become numbered 1, 2, and 3 respectively:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 tap0
$ ovs-vsctl add-port br0 eth0
$ ovs-vsctl add-port br0 lisp0 \
  -- set Interface lisp0 type=lisp options:remote_ip=flow options:key=flow
</pre></div>
</div>
<p>The last command sets up flow based tunneling on the lisp0 interface.  From
the LISP point of view, this is like having the Tunnel Router map cache
implemented as flow rules.</p>
<p>Flows on br0 should be configured as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>priority=3,dl_dst=02:00:00:00:00:00,action=mod_dl_dst:&lt;VMx_MAC&gt;,output:1
priority=2,in_port=1,dl_type=0x0806,action=NORMAL
priority=1,in_port=1,dl_type=0x0800,vlan_tci=0,nw_src=&lt;EID_prefix&gt;,action=set_field:&lt;OVSx_IP&gt;-&gt;tun_dst,output:3
priority=0,action=NORMAL
</pre></div>
</div>
<p>The third rule is like a map cache entry: the <code class="docutils literal"><span class="pre">&lt;EID_prefix&gt;</span></code> specified by the
<code class="docutils literal"><span class="pre">nw_src</span></code> match field is mapped to the RLOC <code class="docutils literal"><span class="pre">&lt;OVSx_IP&gt;</span></code>, which is set as the
tunnel destination for this particular flow.</p>
<p>Optionally, if you want to use Instance ID in a flow, you can add
<code class="docutils literal"><span class="pre">set_tunnel:&lt;IID&gt;</span></code> to the action list.</p>
</div>
<span id="document-howto/tunneling"></span><div class="section" id="connecting-vms-using-tunnels">
<h4>Connecting VMs Using Tunnels<a class="headerlink" href="#connecting-vms-using-tunnels" title="Permalink to this headline">¶</a></h4>
<p>This document describes how to use Open vSwitch to allow VMs on two different
hosts to communicate over port-based GRE tunnels.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This guide covers the steps required to configure GRE tunneling. The same
approach can be used for any of the other tunneling protocols supported by
Open vSwitch.</p>
</div>
<img alt="_images/tunneling.png" class="align-center" src="_images/tunneling.png" />
<div class="section" id="setup">
<h5>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h5>
<p>This guide assumes the environment is configured as described below.</p>
<div class="section" id="two-physical-networks">
<h6>Two Physical Networks<a class="headerlink" href="#two-physical-networks" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p class="first">Transport Network</p>
<p>Ethernet network for tunnel traffic between hosts running OVS. Depending on
the tunneling protocol being used (this cookbook uses GRE), some
configuration of the physical switches may be required (for example, it may
be necessary to adjust the MTU). Configuration of the physical switching
hardware is outside the scope of this cookbook entry.</p>
</li>
<li><p class="first">Management Network</p>
<p>Strictly speaking this network is not required, but it is a simple way to
give the physical host an IP address for remote access since an IP address
cannot be assigned directly to a physical interface that is part of an OVS
bridge.</p>
</li>
</ul>
</div>
<div class="section" id="two-physical-hosts">
<h6>Two Physical Hosts<a class="headerlink" href="#two-physical-hosts" title="Permalink to this headline">¶</a></h6>
<p>The environment assumes the use of two hosts, named <cite>host1</cite> and <cite>host2</cite>. Both
hosts are hypervisors running Open vSwitch. Each host has two NICs, <cite>eth0</cite> and
<cite>eth1</cite>, which are configured as follows:</p>
<ul class="simple">
<li><cite>eth0</cite> is connected to the Transport Network. <cite>eth0</cite> has an IP address that
is used to communicate with Host2 over the Transport Network.</li>
<li><cite>eth1</cite> is connected to the Management Network. <cite>eth1</cite> has an IP address that
is used to reach the physical host for management.</li>
</ul>
</div>
<div class="section" id="four-virtual-machines">
<h6>Four Virtual Machines<a class="headerlink" href="#four-virtual-machines" title="Permalink to this headline">¶</a></h6>
<p>Each host will run two virtual machines (VMs). <cite>vm1</cite> and <cite>vm2</cite> are running on
<cite>host1</cite>, while <cite>vm3</cite> and <cite>vm4</cite> are running on <cite>host2</cite>.</p>
<p>Each VM has a single interface that appears as a Linux device (e.g., <code class="docutils literal"><span class="pre">tap0</span></code>)
on the physical host.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For Xen/XenServer, VM interfaces appears as Linux devices with names like
<code class="docutils literal"><span class="pre">vif1.0</span></code>. Other Linux systems may present these interfaces as <code class="docutils literal"><span class="pre">vnet0</span></code>,
<code class="docutils literal"><span class="pre">vnet1</span></code>, etc.</p>
</div>
</div>
</div>
<div class="section" id="configuration-steps">
<h5>Configuration Steps<a class="headerlink" href="#configuration-steps" title="Permalink to this headline">¶</a></h5>
<p>Before you begin, you&#8217;ll want to ensure that you know the IP addresses assigned
to <cite>eth0</cite> on both <cite>host1</cite> and <cite>host2</cite>, as they will be needed during the
configuration.</p>
<p>Perform the following configuration on <cite>host1</cite>.</p>
<ol class="arabic">
<li><p class="first">Create an OVS bridge:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You will <em>not</em> add <cite>eth0</cite> to the OVS bridge.</p>
</div>
</li>
<li><p class="first">Boot <cite>vm1</cite> and <cite>vm2</cite> on <cite>host1</cite>. If the VMs are not automatically attached
to OVS, add them to the OVS bridge you just created (the commands below
assume <code class="docutils literal"><span class="pre">tap0</span></code> is for <cite>vm1</cite> and <code class="docutils literal"><span class="pre">tap1</span></code> is for <cite>vm2</cite>):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 tap0
$ ovs-vsctl add-port br0 tap1
</pre></div>
</div>
</li>
<li><p class="first">Add a port for the GRE tunnel:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 gre0 \
    -- set interface gre0 type=gre options:remote_ip=&lt;IP of eth0 on host2&gt;
</pre></div>
</div>
</li>
</ol>
<p>Create a mirrored configuration on <cite>host2</cite> using the same basic steps:</p>
<ol class="arabic">
<li><p class="first">Create an OVS bridge, but do not add any physical interfaces to the bridge:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
</pre></div>
</div>
</li>
<li><p class="first">Launch <cite>vm3</cite> and <cite>vm4</cite> on <cite>host2</cite>, adding them to the OVS bridge if needed
(again, <code class="docutils literal"><span class="pre">tap0</span></code> is assumed to be for <cite>vm3</cite> and <code class="docutils literal"><span class="pre">tap1</span></code> is assumed to be
for <cite>vm4</cite>):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 tap0
$ ovs-vsctl add-port br0 tap1
</pre></div>
</div>
</li>
<li><p class="first">Create the GRE tunnel on <cite>host2</cite>, this time using the IP address for
<code class="docutils literal"><span class="pre">eth0</span></code> on <cite>host1</cite> when specifying the <code class="docutils literal"><span class="pre">remote_ip</span></code> option:</p>
<blockquote>
<div><dl class="docutils">
<dt>$ ovs-vsctl add-port br0 gre0 </dt>
<dd><p class="first last">&#8211; set interface gre0 type=gre options:remote_ip=&lt;IP of eth0 on host1&gt;</p>
</dd>
</dl>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="testing">
<h5>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h5>
<p>Pings between any of the VMs should work, regardless of whether the VMs are
running on the same host or different hosts.</p>
<p>Using <code class="docutils literal"><span class="pre">ip</span> <span class="pre">route</span> <span class="pre">show</span></code> (or equivalent command), the routing table of the
operating system running inside the VM should show no knowledge of the IP
subnets used by the hosts, only the IP subnet(s) configured within the VM&#8217;s
operating system. To help illustrate this point, it may be preferable to use
very different IP subnet assignments within the guest VMs than what is used on
the hosts.</p>
</div>
<div class="section" id="troubleshooting">
<h5>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h5>
<p>If connectivity between VMs on different hosts isn&#8217;t working, check the
following items:</p>
<ul class="simple">
<li>Make sure that <cite>host1</cite> and <cite>host2</cite> have full network connectivity over
<code class="docutils literal"><span class="pre">eth0</span></code> (the NIC attached to the Transport Network). This may necessitate
the use of additional IP routes or IP routing rules.</li>
<li>Make sure that <code class="docutils literal"><span class="pre">gre0</span></code> on <cite>host1</cite> points to <code class="docutils literal"><span class="pre">eth0</span></code> on <cite>host2</cite>, and that
<code class="docutils literal"><span class="pre">gre0</span></code> on <cite>host2</cite> points to <code class="docutils literal"><span class="pre">eth0</span></code> on <cite>host1</cite>.</li>
<li>Ensure that all the VMs are assigned IP addresses on the same subnet; there
is no IP routing functionality in this configuration.</li>
</ul>
</div>
</div>
<span id="document-howto/userspace-tunneling"></span><div class="section" id="connecting-vms-using-tunnels-userspace">
<h4>Connecting VMs Using Tunnels (Userspace)<a class="headerlink" href="#connecting-vms-using-tunnels-userspace" title="Permalink to this headline">¶</a></h4>
<p>This document describes how to use Open vSwitch to allow VMs on two different
hosts to communicate over VXLAN tunnels. Unlike <a class="reference internal" href="contents.html#document-howto/tunneling"><em>Connecting VMs Using Tunnels</em></a>, this
configuration works entirely in userspace.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This guide covers the steps required to configure VXLAN tunneling. The same
approach can be used for any of the other tunneling protocols supported by
Open vSwitch.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>+--------------+
|     vm0      | 192.168.1.1/24
+--------------+
   (vm_port0)
       |
       |
       |
+--------------+
|    br-int    |                                    192.168.1.2/24
+--------------+                                   +--------------+
|    vxlan0    |                                   |    vxlan0    |
+--------------+                                   +--------------+
       |                                                  |
       |                                                  |
       |                                                  |
 172.168.1.1/24                                           |
+--------------+                                          |
|    br-phy    |                                   172.168.1.2/24
+--------------+                                  +---------------+
|  dpdk0/eth1  |----------------------------------|      eth1     |
+--------------+                                  +---------------+
Host A with OVS.                                     Remote host.
</pre></div>
</div>
<div class="section" id="setup">
<h5>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h5>
<p>This guide assumes the environment is configured as described below.</p>
<div class="section" id="two-physical-hosts">
<h6>Two Physical Hosts<a class="headerlink" href="#two-physical-hosts" title="Permalink to this headline">¶</a></h6>
<p>The environment assumes the use of two hosts, named <cite>host1</cite> and <cite>host2</cite>. We
only detail the configuration of <cite>host1</cite> but a similar configuration can be
used for <cite>host2</cite>. Both hosts should be configured with Open vSwitch (with or
without the DPDK datapath), QEMU/KVM and suitable VM images. Open vSwitch
should be running before proceeding.</p>
</div>
</div>
<div class="section" id="configuration-steps">
<h5>Configuration Steps<a class="headerlink" href="#configuration-steps" title="Permalink to this headline">¶</a></h5>
<p>Perform the folowing configuration on <cite>host1</cite>:</p>
<ol class="arabic">
<li><p class="first">Create a <code class="docutils literal"><span class="pre">br-int</span></code> bridge:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl --may-exist add-br br-int \
  -- set Bridge br-int datapath_type=netdev \
  -- br-set-external-id br-int bridge-id br-int \
  -- set bridge br-int fail-mode=standalone
</pre></div>
</div>
</li>
<li><p class="first">Add a port to this bridge. If using tap ports, first boot a VM and then add
the port to the bridge:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 tap0
</pre></div>
</div>
<p>If using DPDK vhost-user ports, add the port and then boot the VM
accordingly, using <code class="docutils literal"><span class="pre">vm_port0</span></code> as the interface name:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br-int vm_port0 \
    -- set Interface vm_port0 type=dpdkvhostuser
</pre></div>
</div>
</li>
<li><p class="first">Configure the IP address of the VM interface <em>in the VM itself</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ip addr add 192.168.1.1/24 dev eth0
</pre></div>
</div>
</li>
<li><p class="first">On <cite>host1</cite>, add a port for the VXLAN tunnel:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br-int vxlan0 \
  -- set interface vxlan0 type=vxlan options:remote_ip=172.168.1.2
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">172.168.1.2</span></code> is the remote tunnel end point address. On the remote
host this will be <code class="docutils literal"><span class="pre">172.168.1.1</span></code></p>
</div>
</li>
<li><p class="first">Create a <code class="docutils literal"><span class="pre">br-phy</span></code> bridge:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl --may-exist add-br br-phy \
    -- set Bridge br-phy datapath_type=netdev \
    -- br-set-external-id br-phy bridge-id br-phy \
    -- set bridge br-phy fail-mode=standalone \
         other_config:hwaddr=&lt;mac address of eth1 interface&gt;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This additional bridge is required when running Open vSwitch in userspace
rather than kernel-based Open vSwitch. The purpose of this bridge is to
allow use of the kernel network stack for routing and ARP resolution.
The datapath needs to look-up the routing table and ARP table to prepare
the tunnel header and transmit data to the output port.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">eth1</span></code> is used rather than <code class="docutils literal"><span class="pre">eth0</span></code>. This is to ensure network
connectivity is retained.</p>
</div>
</li>
<li><p class="first">Attach <code class="docutils literal"><span class="pre">eth1</span></code>/<code class="docutils literal"><span class="pre">dpdk0</span></code> to the <code class="docutils literal"><span class="pre">br-phy</span></code> bridge.</p>
<p>If the physical port <code class="docutils literal"><span class="pre">eth1</span></code> is operating as a kernel network interface,
run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl --timeout 10 add-port br-phy eth1
$ ip addr add 172.168.1.1/24 dev br-phy
$ ip link set br-phy up
$ ip addr flush dev eth1 2&gt;/dev/null
$ ip link set eth1 up
$ iptables -F
</pre></div>
</div>
<p>If instead the interface is a DPDK interface and bound to the <code class="docutils literal"><span class="pre">igb_uio</span></code> or
<code class="docutils literal"><span class="pre">vfio</span></code> driver, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl --timeout 10 add-port br-phy dpdk0 \
  -- set Interface dpdk0 type=dpdk options:dpdk-devargs=0000:06:00.0
$ ip addr add 172.168.1.1/24 dev br-phy
$ ip link set br-phy up
$ iptables -F
</pre></div>
</div>
<p>The commands are different as DPDK interfaces are not managed by the kernel,
thus, the port details are not visible to any <code class="docutils literal"><span class="pre">ip</span></code> commands.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Attempting to use the kernel network commands for a DPDK interface will
result in a loss of connectivity through <code class="docutils literal"><span class="pre">eth1</span></code>. Refer to
<a class="reference internal" href="contents.html#document-faq/configuration"><em>Basic Configuration</em></a> for more details.</p>
</div>
</li>
</ol>
<p>Once complete, check the cached routes using ovs-appctl command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ovs/route/show
</pre></div>
</div>
<p>If the tunnel route is missing, adding it now:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ovs/route/add 172.168.1.1/24 br-eth1
</pre></div>
</div>
<p>Repeat these steps if necessary for <cite>host2</cite>, but using <code class="docutils literal"><span class="pre">192.168.1.1</span></code> and
<code class="docutils literal"><span class="pre">172.168.1.2</span></code> for the VM and tunnel interface IP addresses, respectively.</p>
</div>
<div class="section" id="testing">
<h5>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h5>
<p>With this setup, ping to VXLAN target device (<code class="docutils literal"><span class="pre">192.168.1.2</span></code>) should work.
Traffic will be VXLAN encapsulated and sent over the <code class="docutils literal"><span class="pre">eth1</span></code>/<code class="docutils literal"><span class="pre">dpdk0</span></code>
interface.</p>
</div>
<div class="section" id="tunneling-related-commands">
<h5>Tunneling-related Commands<a class="headerlink" href="#tunneling-related-commands" title="Permalink to this headline">¶</a></h5>
<div class="section" id="tunnel-routing-table">
<h6>Tunnel routing table<a class="headerlink" href="#tunnel-routing-table" title="Permalink to this headline">¶</a></h6>
<p>To add route:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ovs/route/add &lt;IP address&gt;/&lt;prefix length&gt; &lt;output-bridge-name&gt; &lt;gw&gt;
</pre></div>
</div>
<p>To see all routes configured:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ovs/route/show
</pre></div>
</div>
<p>To delete route:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ovs/route/del &lt;IP address&gt;/&lt;prefix length&gt;
</pre></div>
</div>
<p>To look up and display the route for a destination:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl ovs/route/lookup &lt;IP address&gt;
</pre></div>
</div>
</div>
<div class="section" id="arp">
<h6>ARP<a class="headerlink" href="#arp" title="Permalink to this headline">¶</a></h6>
<p>To see arp cache content:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl tnl/arp/show
</pre></div>
</div>
<p>To flush arp cache:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl tnl/arp/flush
</pre></div>
</div>
<p>To set a specific arp entry:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl tnl/arp/set &lt;bridge&gt; &lt;IP address&gt; &lt;MAC address&gt;
</pre></div>
</div>
</div>
<div class="section" id="ports">
<h6>Ports<a class="headerlink" href="#ports" title="Permalink to this headline">¶</a></h6>
<p>To check tunnel ports listening in ovs-vswitchd:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl tnl/ports/show
</pre></div>
</div>
<p>To set range for VxLan UDP source port:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl tnl/egress_port_range &lt;num1&gt; &lt;num2&gt;
</pre></div>
</div>
<p>To show current range:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl tnl/egress_port_range
</pre></div>
</div>
</div>
<div class="section" id="datapath">
<h6>Datapath<a class="headerlink" href="#datapath" title="Permalink to this headline">¶</a></h6>
<p>To check datapath ports:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl dpif/show
</pre></div>
</div>
<p>To check datapath flows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl dpif/dump-flows
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-howto/vlan"></span><div class="section" id="isolating-vm-traffic-using-vlans">
<h4>Isolating VM Traffic Using VLANs<a class="headerlink" href="#isolating-vm-traffic-using-vlans" title="Permalink to this headline">¶</a></h4>
<p>This document describes how to use Open vSwitch is to isolate VM traffic using
VLANs.</p>
<img alt="_images/vlan.png" class="align-center" src="_images/vlan.png" />
<div class="section" id="setup">
<h5>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h5>
<p>This guide assumes the environment is configured as described below.</p>
<div class="section" id="two-physical-networks">
<h6>Two Physical Networks<a class="headerlink" href="#two-physical-networks" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p class="first">Data Network</p>
<p>Ethernet network for VM data traffic, which will carry VLAN-tagged traffic
between VMs. Your physical switch(es) must be capable of forwarding
VLAN-tagged traffic and the physical switch ports should operate as VLAN
trunks. (Usually this is the default behavior. Configuring your physical
switching hardware is beyond the scope of this document.)</p>
</li>
<li><p class="first">Management Network</p>
<p>This network is not strictly required, but it is a simple way to give the
physical host an IP address for remote access, since an IP address cannot be
assigned directly to eth0 (more on that in a moment).</p>
</li>
</ul>
</div>
<div class="section" id="two-physical-hosts">
<h6>Two Physical Hosts<a class="headerlink" href="#two-physical-hosts" title="Permalink to this headline">¶</a></h6>
<p>The environment assumes the use of two hosts: <cite>host1</cite> and <cite>host2</cite>. Both hosts
are running Open vSwitch. Each host has two NICs, eth0 and eth1, which are
configured as follows:</p>
<ul class="simple">
<li>eth0 is connected to the Data Network. No IP address is assigned to eth0.</li>
<li>eth1 is connected to the Management Network (if necessary). eth1 has an IP
address that is used to reach the physical host for management.</li>
</ul>
</div>
<div class="section" id="four-virtual-machines">
<h6>Four Virtual Machines<a class="headerlink" href="#four-virtual-machines" title="Permalink to this headline">¶</a></h6>
<p>Each host will run two virtual machines (VMs). <cite>vm1</cite> and <cite>vm2</cite> are running on
<cite>host1</cite>, while <cite>vm3</cite> and <cite>vm4</cite> are running on <cite>host2</cite>.</p>
<p>Each VM has a single interface that appears as a Linux device (e.g., <code class="docutils literal"><span class="pre">tap0</span></code>)
on the physical host.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For Xen/XenServer, VM interfaces appears as Linux devices with names like
<code class="docutils literal"><span class="pre">vif1.0</span></code>. Other Linux systems may present these interfaces as <code class="docutils literal"><span class="pre">vnet0</span></code>,
<code class="docutils literal"><span class="pre">vnet1</span></code>, etc.</p>
</div>
</div>
</div>
<div class="section" id="configuration-steps">
<h5>Configuration Steps<a class="headerlink" href="#configuration-steps" title="Permalink to this headline">¶</a></h5>
<p>Perform the following configuration on <cite>host1</cite>:</p>
<ol class="arabic">
<li><p class="first">Create an OVS bridge:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
</pre></div>
</div>
</li>
<li><p class="first">Add <code class="docutils literal"><span class="pre">eth0</span></code> to the bridge:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 eth0
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, all OVS ports are VLAN trunks, so eth0 will pass all VLANs</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When you add eth0 to the OVS bridge, any IP addresses that might have
been assigned to eth0 stop working. IP address assigned to eth0 should be
migrated to a different interface before adding eth0 to the OVS bridge.
This is the reason for the separate management connection via eth1.</p>
</div>
</li>
<li><p class="first">Add <cite>vm1</cite> as an &#8220;access port&#8221; on VLAN 100. This means that traffic coming
into OVS from VM1 will be untagged and considered part of VLAN 100:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 tap0 tag=100
</pre></div>
</div>
<p>Add VM2 on VLAN 200:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 tap1 tag=200
</pre></div>
</div>
</li>
</ol>
<p>Repeat these steps on <cite>host2</cite>:</p>
<ol class="arabic">
<li><p class="first">Setup a bridge with eth0 as a VLAN trunk:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 eth0
</pre></div>
</div>
</li>
<li><p class="first">Add VM3 to VLAN 100:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 tap0 tag=100
</pre></div>
</div>
</li>
<li><p class="first">Add VM4 to VLAN 200:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 tap1 tag=200
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="validation">
<h5>Validation<a class="headerlink" href="#validation" title="Permalink to this headline">¶</a></h5>
<p>Pings from <cite>vm1</cite> to <cite>vm3</cite> should succeed, as these two VMs are on the same
VLAN.</p>
<p>Pings from <cite>vm2</cite> to <cite>vm4</cite> should also succeed, since these VMs are also on the
same VLAN as each other.</p>
<p>Pings from <cite>vm1</cite>/<cite>vm3</cite> to <cite>vm2</cite>/<cite>vm4</cite> should not succeed, as these VMs are on
different VLANs. If you have a router configured to forward between the VLANs,
then pings will work, but packets arriving at <cite>vm3</cite> should have the source MAC
address of the router, not of <cite>vm1</cite>.</p>
</div>
</div>
<span id="document-howto/qos"></span><div class="section" id="quality-of-service-qos-rate-limiting">
<h4>Quality of Service (QoS) Rate Limiting<a class="headerlink" href="#quality-of-service-qos-rate-limiting" title="Permalink to this headline">¶</a></h4>
<p>This document explains how to use Open vSwitch to rate-limit traffic by a VM to
either 1 Mbps or 10 Mbps.</p>
<img alt="_images/qos.png" class="align-center" src="_images/qos.png" />
<div class="section" id="setup">
<h5>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h5>
<p>This guide assumes the environment is configured as described below.</p>
<div class="section" id="one-physical-network">
<h6>One Physical Network<a class="headerlink" href="#one-physical-network" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p class="first">Data Network</p>
<p>Ethernet network for VM data traffic. This network is used to send traffic to
and from an external host used for measuring the rate at which a VM is
sending. For experimentation, this physical network is optional; you can
instead connect all VMs to a bridge that is not connected to a physical
interface and use a VM as the measurement host.</p>
</li>
</ul>
<p>There may be other networks (for example, a network for management traffic),
but this guide is only concerned with the Data Network.</p>
</div>
<div class="section" id="two-physical-hosts">
<h6>Two Physical Hosts<a class="headerlink" href="#two-physical-hosts" title="Permalink to this headline">¶</a></h6>
<p>The first host, named <cite>host1</cite>, is a hypervisor that runs Open vSwitch and has
one NIC. This single NIC, <cite>eth0</cite>, is connected to the Data Network. Because it
is participating in an OVS bridge, no IP address can be assigned on <cite>eth0</cite>.</p>
<p>The second host, named Measurement Host, can be any host capable of measuring
throughput from a VM. For this guide, we use <a class="reference external" href="http://www.netperf.org">netperf</a>, a free tool for testing the rate at which one host
can send to another. The Measurement Host has only a single NIC, <cite>eth0</cite>, which
is connected to the Data Network. <cite>eth0</cite> has an IP address that can reach any
VM on <cite>host1</cite>.</p>
</div>
<div class="section" id="two-vms">
<h6>Two VMs<a class="headerlink" href="#two-vms" title="Permalink to this headline">¶</a></h6>
<p>Both VMs (<cite>vm1</cite> and <cite>vm2</cite>) run on <cite>host1</cite>.</p>
<p>Each VM has a single interface that appears as a Linux device (e.g., <code class="docutils literal"><span class="pre">tap0</span></code>) on the physical host.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For Xen/XenServer, VM interfaces appears as Linux devices with names like
<code class="docutils literal"><span class="pre">vif1.0</span></code>. Other Linux systems may present these interfaces as <code class="docutils literal"><span class="pre">vnet0</span></code>,
<code class="docutils literal"><span class="pre">vnet1</span></code>, etc.</p>
</div>
</div>
</div>
<div class="section" id="configuration-steps">
<h5>Configuration Steps<a class="headerlink" href="#configuration-steps" title="Permalink to this headline">¶</a></h5>
<p>For both VMs, we modify the Interface table to configure an ingress policing rule. There are two values to set:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">ingress_policing_rate</span></code></dt>
<dd>the maximum rate (in Kbps) that this VM should be allowed to send</dd>
<dt><code class="docutils literal"><span class="pre">ingress_policing_burst</span></code></dt>
<dd>a parameter to the policing algorithm to indicate the maximum amount of data
(in Kb) that this interface can send beyond the policing rate.</dd>
</dl>
<p>To rate limit VM1 to 1 Mbps, use these commands:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set interface tap0 ingress_policing_rate=1000
$ ovs-vsctl set interface tap0 ingress_policing_burst=100
</pre></div>
</div>
<p>Similarly, to limit <cite>vm2</cite> to 10 Mbps, enter these commands on <cite>host1</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set interface tap1 ingress_policing_rate=10000
$ ovs-vsctl set interface tap1 ingress_policing_burst=1000
</pre></div>
</div>
<p>To see the current limits applied to VM1, run this command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl list interface tap0
</pre></div>
</div>
</div>
<div class="section" id="testing">
<h5>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h5>
<p>To test the configuration, make sure <cite>netperf</cite> is installed and running on both
VMs and on the Measurement Host. <cite>netperf</cite> consists of a client (<code class="docutils literal"><span class="pre">netperf</span></code>)
and a server (<code class="docutils literal"><span class="pre">netserver</span></code>). In this example, we run <code class="docutils literal"><span class="pre">netserver</span></code> on the
Measurement Host (installing Netperf usually starts <code class="docutils literal"><span class="pre">netserver</span></code> as a daemon,
meaning this is running by default).</p>
<p>For this example, we assume that the Measurement Host has an IP of 10.0.0.100
and is reachable from both VMs.</p>
<p>From <cite>vm1</cite>, run this command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ netperf -H 10.0.0.100
</pre></div>
</div>
<p>This will cause VM1 to send TCP traffic as quickly as it can to the Measurement
Host. After 10 seconds, this will output a series of values. We are interested
in the &#8220;Throughput&#8221; value, which is measured in Mbps (10^6 bits/sec). For VM1
this value should be near 1. Running the same command on VM2 should give a
result near 10.</p>
</div>
<div class="section" id="troubleshooting">
<h5>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h5>
<p>Open vSwitch uses the Linux <a class="reference external" href="http://lartc.org/howto/lartc.qdisc.html">traffic-control</a> capability for rate-limiting. If
you are not seeing the configured rate-limit have any effect, make sure that
your kernel is built with &#8220;ingress qdisc&#8221; enabled, and that the user-space
utilities (e.g., <code class="docutils literal"><span class="pre">/sbin/tc</span></code>) are installed.</p>
</div>
<div class="section" id="additional-information">
<h5>Additional Information<a class="headerlink" href="#additional-information" title="Permalink to this headline">¶</a></h5>
<p>Open vSwitch&#8217;s rate-limiting uses policing, which does not queue packets. It
drops any packets beyond the specified rate. Specifying a larger burst size
lets the algorithm be more forgiving, which is important for protocols like TCP
that react severely to dropped packets. Setting a burst size of less than than
the MTU (e.g., 10 kb) should be avoided.</p>
<p>For TCP traffic, setting a burst size to be a sizeable fraction (e.g., &gt; 10%)
of the overall policy rate helps a flow come closer to achieving the full rate.
If a burst size is set to be a large fraction of the overall rate, the client
will actually experience an average rate slightly higher than the specific
policing rate.</p>
<p>For UDP traffic, set the burst size to be slightly greater than the MTU and
make sure that your performance tool does not send packets that are larger than
your MTU (otherwise these packets will be fragmented, causing poor
performance). For example, you can force netperf to send UDP traffic as 1000
byte packets by running:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ netperf -H 10.0.0.100 -t UDP_STREAM -- -m 1000
</pre></div>
</div>
</div>
</div>
<span id="document-howto/vtep"></span><div class="section" id="how-to-use-the-vtep-emulator">
<h4>How to Use the VTEP Emulator<a class="headerlink" href="#how-to-use-the-vtep-emulator" title="Permalink to this headline">¶</a></h4>
<p>This document explains how to use ovs-vtep, a VXLAN Tunnel Endpoint (VTEP)
emulator that uses Open vSwitch for forwarding. VTEPs are the entities that
handle VXLAN frame encapsulation and decapsulation in a network.</p>
<div class="section" id="requirements">
<h5>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h5>
<p>The VTEP emulator is a Python script that invokes calls to tools like vtep-ctl
and ovs-vsctl. It is only useful when Open vSwitch daemons like ovsdb-server
and ovs-vswitchd are running and installed. To do this, either:</p>
<ul class="simple">
<li>Follow the instructions in <a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a> (don&#8217;t start any
daemons yet).</li>
<li>Follow the instructions in <a class="reference internal" href="contents.html#document-intro/install/debian"><em>Debian Packaging for Open vSwitch</em></a> and then install the
<code class="docutils literal"><span class="pre">openvswitch-vtep</span></code> package (if operating on a debian based machine).  This
will automatically start the daemons.</li>
</ul>
</div>
<div class="section" id="design">
<h5>Design<a class="headerlink" href="#design" title="Permalink to this headline">¶</a></h5>
<p>At the end of this process, you should have the following setup:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Architecture

+---------------------------------------------------+
| Host Machine                                      |
|                                                   |
|                                                   |
|       +---------+ +---------+                     |
|       |         | |         |                     |
|       |   VM1   | |   VM2   |                     |
|       |         | |         |                     |
|       +----o----+ +----o----+                     |
|            |           |                          |
| br0 +------o-----------o--------------------o--+  |
|            p0          p1                  br0    |
|                                                   |
|                                                   |
|                              +------+   +------+  |
+------------------------------| eth0 |---| eth1 |--+
                               +------+   +------+
                               10.1.1.1   10.2.2.1
                  MANAGEMENT      |          |
                +-----------------o----+     |
                                             |
                             DATA/TUNNEL     |
                           +-----------------o---+
</pre></div>
</div>
<p>Some important points.</p>
<ul class="simple">
<li>We will use Open vSwitch to create our &#8220;physical&#8221; switch labeled <code class="docutils literal"><span class="pre">br0</span></code></li>
<li>Our &#8220;physical&#8221; switch <code class="docutils literal"><span class="pre">br0</span></code> will have one internal port also named <code class="docutils literal"><span class="pre">br0</span></code>
and two &#8220;physical&#8221; ports, namely <code class="docutils literal"><span class="pre">p0</span></code> and <code class="docutils literal"><span class="pre">p1</span></code>.</li>
<li>The host machine may have two external interfaces. We will use <code class="docutils literal"><span class="pre">eth0</span></code> for
management traffic and <code class="docutils literal"><span class="pre">eth1</span></code> for tunnel traffic (One can use a single
interface to achieve both). Please take note of their IP addresses in the
diagram. You do not have to use exactly the same IP addresses. Just know that
the above will be used in the steps below.</li>
<li>You can optionally connect physical machines instead of virtual machines to
switch <code class="docutils literal"><span class="pre">br0</span></code>. In that case:<ul>
<li>Make sure you have two extra physical interfaces in your host machine,
<code class="docutils literal"><span class="pre">eth2</span></code> and <code class="docutils literal"><span class="pre">eth3</span></code>.</li>
<li>In the rest of this doc, replace <code class="docutils literal"><span class="pre">p0</span></code> with <code class="docutils literal"><span class="pre">eth2</span></code> and <code class="docutils literal"><span class="pre">p1</span></code> with
<code class="docutils literal"><span class="pre">eth3</span></code>.</li>
</ul>
</li>
</ul>
<ol class="arabic simple" start="5">
<li>In addition to implementing <code class="docutils literal"><span class="pre">p0</span></code> and <code class="docutils literal"><span class="pre">p1</span></code> as physical interfaces, you
can also optionally implement them as standalone TAP devices, or VM
interfaces for simulation.</li>
<li>Creating and attaching the VMs is outside the scope of this document and is
included in the diagram for reference purposes only.</li>
</ol>
</div>
<div class="section" id="startup">
<h5>Startup<a class="headerlink" href="#startup" title="Permalink to this headline">¶</a></h5>
<p>These instructions describe how to run with a single ovsdb-server instance that
handles both the OVS and VTEP schema. You can skip steps 1-3 if you installed
using the debian packages as mentioned in step 2 of the &#8220;Requirements&#8221; section.</p>
<ol class="arabic">
<li><p class="first">Create the initial OVS and VTEP schemas:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span> $ ovsdb-tool create /etc/openvswitch/ovs.db vswitchd/vswitch.ovsschema
 $ ovsdb-tool create /etc/openvswitch/vtep.db vtep/vtep.ovsschema
```
</pre></div>
</div>
</li>
<li><p class="first">Start ovsdb-server and have it handle both databases:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovsdb-server --pidfile --detach --log-file \
    --remote punix:/var/run/openvswitch/db.sock \
    --remote=db:hardware_vtep,Global,managers \
    /etc/openvswitch/ovs.db /etc/openvswitch/vtep.db
</pre></div>
</div>
</li>
<li><p class="first">Start ovs-vswitchd as normal:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vswitchd --log-file --detach --pidfile \
    unix:/var/run/openvswitch/db.sock
</pre></div>
</div>
</li>
<li><p class="first">Create a &#8220;physical&#8221; switch and its ports in OVS:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 p0
$ ovs-vsctl add-port br0 p1
</pre></div>
</div>
</li>
<li><p class="first">Configure the physical switch in the VTEP database:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ vtep-ctl add-ps br0
$ vtep-ctl set Physical_Switch br0 tunnel_ips=10.2.2.1
</pre></div>
</div>
</li>
<li><p class="first">Start the VTEP emulator. If you installed the components following
<a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a>, run the following from the <code class="docutils literal"><span class="pre">vtep</span></code>
directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ./ovs-vtep --log-file=/var/log/openvswitch/ovs-vtep.log \
    --pidfile=/var/run/openvswitch/ovs-vtep.pid \
    --detach br0
</pre></div>
</div>
<p>If the installation was done by installing the openvswitch-vtep package, you
can find ovs-vtep at <code class="docutils literal"><span class="pre">/usr/share/openvswitch/scripts</span></code>.</p>
</li>
<li><p class="first">Configure the VTEP database&#8217;s manager to point at an NVC:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ vtep-ctl set-manager tcp:&lt;CONTROLLER IP&gt;:6640
</pre></div>
</div>
<p>Where <code class="docutils literal"><span class="pre">&lt;CONTROLLER</span> <span class="pre">IP&gt;</span></code> is your controller&#8217;s IP address that is accessible
via the Host Machine&#8217;s eth0 interface.</p>
</li>
</ol>
</div>
<div class="section" id="simulating-an-nvc">
<h5>Simulating an NVC<a class="headerlink" href="#simulating-an-nvc" title="Permalink to this headline">¶</a></h5>
<p>A VTEP implementation expects to be driven by a Network Virtualization
Controller (NVC), such as NSX.  If one does not exist, it&#8217;s possible to use
vtep-ctl to simulate one:</p>
<ol class="arabic">
<li><p class="first">Create a logical switch:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ vtep-ctl add-ls ls0
</pre></div>
</div>
</li>
<li><p class="first">Bind the logical switch to a port:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ vtep-ctl bind-ls br0 p0 0 ls0
$ vtep-ctl set Logical_Switch ls0 tunnel_key=33
</pre></div>
</div>
</li>
<li><p class="first">Direct unknown destinations out a tunnel.</p>
<p>For handling L2 broadcast, multicast and unknown unicast traffic, packets
can be sent to all members of a logical switch referenced by a physical
switch.  The &#8220;unknown-dst&#8221; address below is used to represent these packets.
There are different modes to replicate the packets.  The default mode of
replication is to send the traffic to a service node, which can be a
hypervisor, server or appliance, and let the service node handle replication
to other transport nodes (hypervisors or other VTEP physical switches).
This mode is called <em>service node</em> replication.  An alternate mode of
replication, called <em>source node</em> replication, involves the source node
sending to all other transport nodes.  Hypervisors are always responsible
for doing their own replication for locally attached VMs in both modes.
Service node mode is the default.  Service node replication mode is
considered a basic requirement because it only requires sending the packet
to a single transport node.  The following configuration is for service node
replication mode as only a single transport node destination is specified
for the unknown-dst address:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ vtep-ctl add-mcast-remote ls0 unknown-dst 10.2.2.2
</pre></div>
</div>
</li>
<li><p class="first">Optionally, change the replication mode from a default of <code class="docutils literal"><span class="pre">service_node</span></code>
to <code class="docutils literal"><span class="pre">source_node</span></code>, which can be done at the logical switch level:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ vtep-ctl set-replication-mode ls0 source_node
</pre></div>
</div>
</li>
<li><p class="first">Direct unicast destinations out a different tunnel:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ vtep-ctl add-ucast-remote ls0 00:11:22:33:44:55 10.2.2.3
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<span id="document-howto/sflow"></span><div class="section" id="monitoring-vm-trafic-using-sflow">
<h4>Monitoring VM Trafic Using sFlow<a class="headerlink" href="#monitoring-vm-trafic-using-sflow" title="Permalink to this headline">¶</a></h4>
<p>This document describes how to use Open vSwitch is to monitor traffic sent
between two VMs on the same host using an sFlow collector.
VLANs.</p>
<img alt="_images/sflow.png" class="align-center" src="_images/sflow.png" />
<div class="section" id="setup">
<h5>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h5>
<p>This guide assumes the environment is configured as described below.</p>
<div class="section" id="two-physical-networks">
<h6>Two Physical Networks<a class="headerlink" href="#two-physical-networks" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p class="first">Data Network</p>
<blockquote>
<div><p>Ethernet network for VM data traffic. For experimentation, this physical
network is optional. You can instead connect all VMs to a bridge that is not
connected to a physical interface.</p>
</div></blockquote>
</li>
<li><p class="first">Management Network</p>
<p>This network must exist, as it is used to send sFlow data from the agent to
the remote collector.</p>
</li>
</ul>
</div>
<div class="section" id="two-physical-hosts">
<h6>Two Physical Hosts<a class="headerlink" href="#two-physical-hosts" title="Permalink to this headline">¶</a></h6>
<p>The environment assumes the use of two hosts: <cite>host1</cite> and <cite>hostMon</cite>. <cite>host</cite> is
a hypervisor that run Open vSwitch and has two NICs:</p>
<ul class="simple">
<li>eth0 is connected to the Data Network. No IP address can be assigned on eth0
because it is part of an OVS bridge.</li>
<li>eth1 is connected to the Management Network. eth1 has an IP address for
management traffic, including sFlow.</li>
</ul>
<p><cite>hostMon</cite> can be any computer that can run the sFlow collector. For this
cookbook entry, we use <a class="reference external" href="http://www.inmon.com/products/sFlowTrend.php">sFlowTrend</a>, a free sFlow collector that
is a simple cross-platform Java download. Other sFlow collectors should work
equally well. <cite>hostMon</cite> has a single NIC, <cite>eth0</cite>, that is connected to the
Management Network. <cite>eth0</cite> has an IP adress that can reach <cite>eth1</cite> on <cite>host1</cite>.</p>
</div>
<div class="section" id="two-virtual-machines">
<h6>Two Virtual Machines<a class="headerlink" href="#two-virtual-machines" title="Permalink to this headline">¶</a></h6>
<p>This guide uses two virtual machines - <cite>vm1</cite> and <cite>vm2</cite>-  running on <cite>host1</cite>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For Xen/XenServer, VM interfaces appears as Linux devices with names like
<code class="docutils literal"><span class="pre">vif1.0</span></code>. Other Linux systems may present these interfaces as <code class="docutils literal"><span class="pre">vnet0</span></code>,
<code class="docutils literal"><span class="pre">vnet1</span></code>, etc.</p>
</div>
</div>
</div>
<div class="section" id="configuration-steps">
<h5>Configuration Steps<a class="headerlink" href="#configuration-steps" title="Permalink to this headline">¶</a></h5>
<p>On <cite>host1</cite>, define the following configuration values in your shell
environment:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>COLLECTOR_IP=10.0.0.1
COLLECTOR_PORT=6343
AGENT_IP=eth1
HEADER_BYTES=128
SAMPLING_N=64
POLLING_SECS=10
</pre></div>
</div>
<p>Port 6343 (<code class="docutils literal"><span class="pre">COLLECTOR_PORT</span></code>) is the default port number for sFlowTrend. If
you are using an sFlow collector other than sFlowTrend, set this value to the
appropriate port for your particular collector. Set your own IP address for the
collector in the place of 10.0.0.1 (<code class="docutils literal"><span class="pre">COLLECTOR_IP</span></code>). Setting the <code class="docutils literal"><span class="pre">AGENT_IP</span></code>
value to eth1 indicates that the sFlow agent should send traffic from <cite>eth1</cite>&#8216;s
IP address. The other values indicate settings regarding the frequency and type
of packet sampling that sFlow should perform.</p>
<p>Still on <cite>host1</cite>, run the following command to create an sFlow configuration
and attach it to bridge br0:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl -- --id=@sflow create sflow agent=${AGENT_IP} \
    target=&quot;${COLLECTOR_IP}:${COLLECTOR_PORT}&quot; header=${HEADER_BYTES} \
    sampling=${SAMPLING_N} polling=${POLLING_SECS} \
      -- set bridge br0 sflow=@sflow
</pre></div>
</div>
<p>Make note of the UUID that is returned by this command; this value is necessary
to remove the sFlow configuration.</p>
<p>On <cite>hostMon</cite>, go to the <a class="reference external" href="http://www.inmon.com/products/sFlowTrend.php">sFlowTrend</a> and click &#8220;Install&#8221; in the
upper right-hand corner. If you have Java installed, this will download and
start the sFlowTrend application. Once sFlowTrend is running, the light in the
lower right-hand corner of the sFlowTrend application should blink green to
indicate that the collector is receiving traffic.</p>
<p>The sFlow configuration is now complete, and sFlowTrend on <cite>hostMon</cite> should be
receiving sFlow data from OVS on <cite>host1</cite>.</p>
<p>To configure sFlow on additional bridges, just replace <code class="docutils literal"><span class="pre">br0</span></code> in the above
command with a different bridge name.</p>
<p>To remove sFlow configuration from a bridge (in this case, <code class="docutils literal"><span class="pre">br0</span></code>), run this
command, where &#8220;sFlow UUID&#8221; is the UUID returned by the command used to set the
sFlow configuration initially:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl remove bridge br0 sflow &lt;sFlow UUID&gt;
</pre></div>
</div>
<p>To see all current sets of sFlow configuration parameters, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl list sflow
</pre></div>
</div>
</div>
<div class="section" id="troubleshooting">
<h5>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h5>
<p>If sFlow data isn&#8217;t being collected and displayed by sFlowTrend, check the
following items:</p>
<ul>
<li><p class="first">Make sure the VMs are sending/receiving network traffic over bridge br0,
preferably to multiple other hosts and using a variety of protocols.</p>
</li>
<li><p class="first">To confirm that the agent is sending traffic, check that running the
following command shows that the agent on the physical server is sending
traffic to the collector IP address (change the port below to match the port
your collector is using):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ tcpdump -ni eth1 udp port 6343
</pre></div>
</div>
</li>
</ul>
<p>If no traffic is being sent, there is a problem with the configuration of OVS.
If traffic is being sent but nothing is visible in the sFlowTrend user
interface, this may indicate a configuration problem with the collector.</p>
<p>Check to make sure the host running the collector (<cite>hostMon</cite>) does not have a
firewall that would prevent UDP port 6343 from reaching the collector.</p>
</div>
<div class="section" id="credit">
<h5>Credit<a class="headerlink" href="#credit" title="Permalink to this headline">¶</a></h5>
<p>This document is heavily based on content from Neil McKee at InMon:</p>
<ul class="simple">
<li><a class="reference external" href="https://mail.openvswitch.org/pipermail/ovs-dev/2010-July/165245.html">https://mail.openvswitch.org/pipermail/ovs-dev/2010-July/165245.html</a></li>
<li><a class="reference external" href="http://blog.sflow.com/2010/01/open-vswitch.html">http://blog.sflow.com/2010/01/open-vswitch.html</a> (note: the configuration
syntax is out of date, but the high-level descriptions are correct)</li>
</ul>
</div>
</div>
<span id="document-howto/dpdk"></span><div class="section" id="using-open-vswitch-with-dpdk">
<h4>Using Open vSwitch with DPDK<a class="headerlink" href="#using-open-vswitch-with-dpdk" title="Permalink to this headline">¶</a></h4>
<p>This document describes how to use Open vSwitch with DPDK datapath.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Using the DPDK datapath requires building OVS with DPDK support. Refer to
<a class="reference internal" href="contents.html#document-intro/install/dpdk"><em>Open vSwitch with DPDK</em></a> for more information.</p>
</div>
<div class="section" id="ports-and-bridges">
<h5>Ports and Bridges<a class="headerlink" href="#ports-and-bridges" title="Permalink to this headline">¶</a></h5>
<p>ovs-vsctl can be used to set up bridges and other Open vSwitch features.
Bridges should be created with a <code class="docutils literal"><span class="pre">datapath_type=netdev</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
</pre></div>
</div>
<p>ovs-vsctl can also be used to add DPDK devices. OVS expects DPDK device names
to start with <code class="docutils literal"><span class="pre">dpdk</span></code> and end with a portid. ovs-vswitchd should print the
number of dpdk devices found in the log file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 dpdk-p0 -- set Interface dpdk-p0 type=dpdk \
    options:dpdk-devargs=0000:01:00.0
$ ovs-vsctl add-port br0 dpdk-p1 -- set Interface dpdk-p1 type=dpdk \
    options:dpdk-devargs=0000:01:00.1
</pre></div>
</div>
<p>After the DPDK ports get added to switch, a polling thread continuously polls
DPDK devices and consumes 100% of the core, as can be checked from <code class="docutils literal"><span class="pre">top</span></code> and
<code class="docutils literal"><span class="pre">ps</span></code> commands:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ top -H
$ ps -eLo pid,psr,comm | grep pmd
</pre></div>
</div>
<p>Creating bonds of DPDK interfaces is slightly different to creating bonds of
system interfaces. For DPDK, the interface type and devargs must be explicitly
set. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-bond br0 dpdkbond p0 p1 \
    -- set Interface p0 type=dpdk options:dpdk-devargs=0000:01:00.0 \
    -- set Interface p1 type=dpdk options:dpdk-devargs=0000:01:00.1
</pre></div>
</div>
<p>To stop ovs-vswitchd &amp; delete bridge, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl -t ovs-vswitchd exit
$ ovs-appctl -t ovsdb-server exit
$ ovs-vsctl del-br br0
</pre></div>
</div>
</div>
<div class="section" id="pmd-thread-statistics">
<h5>PMD Thread Statistics<a class="headerlink" href="#pmd-thread-statistics" title="Permalink to this headline">¶</a></h5>
<p>To show current stats:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl dpif-netdev/pmd-stats-show
</pre></div>
</div>
<p>To clear previous stats:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl dpif-netdev/pmd-stats-clear
</pre></div>
</div>
</div>
<div class="section" id="port-rxq-assigment-to-pmd-threads">
<h5>Port/RXQ Assigment to PMD Threads<a class="headerlink" href="#port-rxq-assigment-to-pmd-threads" title="Permalink to this headline">¶</a></h5>
<p>To show port/rxq assignment:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl dpif-netdev/pmd-rxq-show
</pre></div>
</div>
<p>To change default rxq assignment to pmd threads, rxqs may be manually pinned to
desired cores using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set Interface &lt;iface&gt; \
    other_config:pmd-rxq-affinity=&lt;rxq-affinity-list&gt;
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&lt;rxq-affinity-list&gt;</span></code> is a CSV list of <code class="docutils literal"><span class="pre">&lt;queue-id&gt;:&lt;core-id&gt;</span></code> values</li>
</ul>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set interface dpdk-p0 options:n_rxq=4 \
    other_config:pmd-rxq-affinity=&quot;0:3,1:7,3:8&quot;
</pre></div>
</div>
<p>This will ensure:</p>
<ul class="simple">
<li>Queue #0 pinned to core 3</li>
<li>Queue #1 pinned to core 7</li>
<li>Queue #2 not pinned</li>
<li>Queue #3 pinned to core 8</li>
</ul>
<p>After that PMD threads on cores where RX queues was pinned will become
<code class="docutils literal"><span class="pre">isolated</span></code>. This means that this thread will poll only pinned RX queues.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If there are no <code class="docutils literal"><span class="pre">non-isolated</span></code> PMD threads, <code class="docutils literal"><span class="pre">non-pinned</span></code> RX queues will
not be polled. Also, if provided <code class="docutils literal"><span class="pre">core_id</span></code> is not available (ex. this
<code class="docutils literal"><span class="pre">core_id</span></code> not in <code class="docutils literal"><span class="pre">pmd-cpu-mask</span></code>), RX queue will not be polled by any PMD
thread.</p>
</div>
</div>
<div class="section" id="qos">
<h5>QoS<a class="headerlink" href="#qos" title="Permalink to this headline">¶</a></h5>
<p>Assuming you have a vhost-user port transmitting traffic consisting of packets
of size 64 bytes, the following command would limit the egress transmission
rate of the port to ~1,000,000 packets per second:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set port vhost-user0 qos=@newqos -- \
    --id=@newqos create qos type=egress-policer other-config:cir=46000000 \
    other-config:cbs=2048`
</pre></div>
</div>
<p>To examine the QoS configuration of the port, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl -t ovs-vswitchd qos/show vhost-user0
</pre></div>
</div>
<p>To clear the QoS configuration from the port and ovsdb, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl destroy QoS vhost-user0 -- clear Port vhost-user0 qos
</pre></div>
</div>
<p>Refer to vswitch.xml for more details on egress-policer.</p>
</div>
<div class="section" id="rate-limiting">
<h5>Rate Limiting<a class="headerlink" href="#rate-limiting" title="Permalink to this headline">¶</a></h5>
<p>Here is an example on Ingress Policing usage. Assuming you have a vhost-user
port receiving traffic consisting of packets of size 64 bytes, the following
command would limit the reception rate of the port to ~1,000,000 packets per
second:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set interface vhost-user0 ingress_policing_rate=368000 \
    ingress_policing_burst=1000`
</pre></div>
</div>
<p>To examine the ingress policer configuration of the port:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl list interface vhost-user0
</pre></div>
</div>
<p>To clear the ingress policer configuration from the port:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set interface vhost-user0 ingress_policing_rate=0
</pre></div>
</div>
<p>Refer to vswitch.xml for more details on ingress-policer.</p>
</div>
<div class="section" id="flow-control">
<h5>Flow Control<a class="headerlink" href="#flow-control" title="Permalink to this headline">¶</a></h5>
<p>Flow control can be enabled only on DPDK physical ports. To enable flow control
support at tx side while adding a port, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 dpdk-p0 -- set Interface dpdk-p0 type=dpdk \
    options:dpdk-devargs=0000:01:00.0 options:tx-flow-ctrl=true
</pre></div>
</div>
<p>Similarly, to enable rx flow control, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 dpdk-p0 -- set Interface dpdk-p0 type=dpdk \
    options:dpdk-devargs=0000:01:00.0 options:rx-flow-ctrl=true
</pre></div>
</div>
<p>To enable flow control auto-negotiation, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 dpdk-p0 -- set Interface dpdk-p0 type=dpdk \
    options:dpdk-devargs=0000:01:00.0 options:flow-ctrl-autoneg=true
</pre></div>
</div>
<p>To turn ON the tx flow control at run time for an existing port, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set Interface dpdk-p0 options:tx-flow-ctrl=true
</pre></div>
</div>
<p>The flow control parameters can be turned off by setting <code class="docutils literal"><span class="pre">false</span></code> to the
respective parameter. To disable the flow control at tx side, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set Interface dpdk-p0 options:tx-flow-ctrl=false
</pre></div>
</div>
</div>
<div class="section" id="pdump">
<h5>pdump<a class="headerlink" href="#pdump" title="Permalink to this headline">¶</a></h5>
<p>pdump allows you to listen on DPDK ports and view the traffic that is passing
on them. To use this utility, one must have libpcap installed on the system.
Furthermore, DPDK must be built with <code class="docutils literal"><span class="pre">CONFIG_RTE_LIBRTE_PDUMP=y</span></code> and
<code class="docutils literal"><span class="pre">CONFIG_RTE_LIBRTE_PMD_PCAP=y</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">A performance decrease is expected when using a monitoring application like
the DPDK pdump app.</p>
</div>
<p>To use pdump, simply launch OVS as usual, then navigate to the <code class="docutils literal"><span class="pre">app/pdump</span></code>
directory in DPDK, <code class="docutils literal"><span class="pre">make</span></code> the application and run like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ sudo ./build/app/dpdk-pdump -- \
    --pdump port=0,queue=0,rx-dev=/tmp/pkts.pcap \
    --server-socket-path=/usr/local/var/run/openvswitch
</pre></div>
</div>
<p>The above command captures traffic received on queue 0 of port 0 and stores it
in <code class="docutils literal"><span class="pre">/tmp/pkts.pcap</span></code>. Other combinations of port numbers, queues numbers and
pcap locations are of course also available to use. For example, to capture all
packets that traverse port 0 in a single pcap file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ sudo ./build/app/dpdk-pdump -- \
    --pdump &#39;port=0,queue=*,rx-dev=/tmp/pkts.pcap,tx-dev=/tmp/pkts.pcap&#39; \
    --server-socket-path=/usr/local/var/run/openvswitch
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">server-socket-path</span></code> must be set to the value of <code class="docutils literal"><span class="pre">ovs_rundir()</span></code> which
typically resolves to <code class="docutils literal"><span class="pre">/usr/local/var/run/openvswitch</span></code>.</p>
<p>Many tools are available to view the contents of the pcap file. Once example is
tcpdump. Issue the following command to view the contents of <code class="docutils literal"><span class="pre">pkts.pcap</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ tcpdump -r pkts.pcap
</pre></div>
</div>
<p>More information on the pdump app and its usage can be found in the <a class="reference external" href="http://dpdk.org/doc/guides/tools/pdump.html">DPDK docs</a>.</p>
</div>
<div class="section" id="jumbo-frames">
<h5>Jumbo Frames<a class="headerlink" href="#jumbo-frames" title="Permalink to this headline">¶</a></h5>
<p>By default, DPDK ports are configured with standard Ethernet MTU (1500B). To
enable Jumbo Frames support for a DPDK port, change the Interface&#8217;s
<code class="docutils literal"><span class="pre">mtu_request</span></code> attribute to a sufficiently large value. For example, to add a
DPDK Phy port with MTU of 9000:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 dpdk-p0 -- set Interface dpdk-p0 type=dpdk \
      options:dpdk-devargs=0000:01:00.0 mtu_request=9000
</pre></div>
</div>
<p>Similarly, to change the MTU of an existing port to 6200:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set Interface dpdk-p0 mtu_request=6200
</pre></div>
</div>
<p>Some additional configuration is needed to take advantage of jumbo frames with
vHost ports:</p>
<ol class="arabic">
<li><p class="first"><em>mergeable buffers</em> must be enabled for vHost ports, as demonstrated in the
QEMU command line snippet below:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>-netdev type=vhost-user,id=mynet1,chardev=char0,vhostforce \
-device virtio-net-pci,mac=00:00:00:00:00:01,netdev=mynet1,mrg_rxbuf=on
</pre></div>
</div>
</li>
<li><p class="first">Where virtio devices are bound to the Linux kernel driver in a guest
environment (i.e. interfaces are not bound to an in-guest DPDK driver), the
MTU of those logical network interfaces must also be increased to a
sufficiently large value. This avoids segmentation of Jumbo Frames received
in the guest. Note that &#8216;MTU&#8217; refers to the length of the IP packet only,
and not that of the entire frame.</p>
<p>To calculate the exact MTU of a standard IPv4 frame, subtract the L2 header
and CRC lengths (i.e. 18B) from the max supported frame size.  So, to set
the MTU for a 9018B Jumbo Frame:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ifconfig eth1 mtu 9000
</pre></div>
</div>
</li>
</ol>
<p>When Jumbo Frames are enabled, the size of a DPDK port&#8217;s mbuf segments are
increased, such that a full Jumbo Frame of a specific size may be accommodated
within a single mbuf segment.</p>
<p>Jumbo frame support has been validated against 9728B frames, which is the
largest frame size supported by Fortville NIC using the DPDK i40e driver, but
larger frames and other DPDK NIC drivers may be supported. These cases are
common for use cases involving East-West traffic only.</p>
</div>
<div class="section" id="rx-checksum-offload">
<h5>Rx Checksum Offload<a class="headerlink" href="#rx-checksum-offload" title="Permalink to this headline">¶</a></h5>
<p>By default, DPDK physical ports are enabled with Rx checksum offload. Rx
checksum offload can be configured on a DPDK physical port either when adding
or at run time.</p>
<p>To disable Rx checksum offload when adding a DPDK port dpdk-p0:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 dpdk-p0 -- set Interface dpdk-p0 type=dpdk \
  options:dpdk-devargs=0000:01:00.0 options:rx-checksum-offload=false
</pre></div>
</div>
<p>Similarly to disable the Rx checksum offloading on a existing DPDK port dpdk-p0:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set Interface dpdk-p0 options:rx-checksum-offload=false
</pre></div>
</div>
<p>Rx checksum offload can offer performance improvement only for tunneling
traffic in OVS-DPDK because the checksum validation of tunnel packets is
offloaded to the NIC. Also enabling Rx checksum may slightly reduce the
performance of non-tunnel traffic, specifically for smaller size packet.
DPDK vectorization is disabled when checksum offloading is configured on DPDK
physical ports which in turn effects the non-tunnel traffic performance.
So it is advised to turn off the Rx checksum offload for non-tunnel traffic use
cases to achieve the best performance.</p>
</div>
<div class="section" id="port-hotplug">
<span id="id1"></span><h5>Port Hotplug<a class="headerlink" href="#port-hotplug" title="Permalink to this headline">¶</a></h5>
<p>OVS supports port hotplugging, allowing the use of ports that were not bound
to DPDK when vswitchd was started.
In order to attach a port, it has to be bound to DPDK using the
<code class="docutils literal"><span class="pre">dpdk_nic_bind.py</span></code> script:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ $DPDK_DIR/tools/dpdk_nic_bind.py --bind=igb_uio 0000:01:00.0
</pre></div>
</div>
<p>Then it can be attached to OVS:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 dpdkx -- set Interface dpdkx type=dpdk \
    options:dpdk-devargs=0000:01:00.0
</pre></div>
</div>
<p>It is also possible to detach a port from ovs, the user has to remove the
port using the del-port command, then it can be detached using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl netdev-dpdk/detach 0000:01:00.0
</pre></div>
</div>
<p>This feature is not supported with VFIO and does not work with some NICs.
For more information please refer to the <a class="reference external" href="http://dpdk.org/doc/guides/prog_guide/port_hotplug_framework.html#hotplug">DPDK Port Hotplug Framework</a>.</p>
</div>
<div class="section" id="vdev-support">
<span id="id2"></span><h5>Vdev Support<a class="headerlink" href="#vdev-support" title="Permalink to this headline">¶</a></h5>
<p>DPDK provides drivers for both physical and virtual devices. Physical DPDK
devices are added to OVS by specifying a valid PCI address in &#8216;dpdk-devargs&#8217;.
Virtual DPDK devices which do not have PCI addresses can be added using a
different format for &#8216;dpdk-devargs&#8217;.</p>
<p>Typically, the format expected is &#8216;eth_&lt;driver_name&gt;&lt;x&gt;&#8217; where &#8216;x&#8217; is a
number between 0 and RTE_MAX_ETHPORTS -1 (31).</p>
<p>For example to add a dpdk port that uses the &#8216;null&#8217; DPDK PMD driver:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 null0 -- set Interface null0 type=dpdk \
    options:dpdk-devargs=eth_null0
</pre></div>
</div>
<p>Similarly, to add a dpdk port that uses the &#8216;af_packet&#8217; DPDK PMD driver:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-port br0 myeth0 -- set Interface myeth0 type=dpdk \
    options:dpdk-devargs=eth_af_packet0,iface=eth0
</pre></div>
</div>
<p>More information on the different types of virtual DPDK PMDs can be found in
the <a class="reference external" href="http://dpdk.org/doc/guides/nics/overview.html">DPDK documentation</a>.</p>
<p>Note: Not all DPDK virtual PMD drivers have been tested and verified to work.</p>
</div>
<div class="section" id="ovs-with-dpdk-inside-vms">
<span id="dpdk-ovs-in-guest"></span><h5>OVS with DPDK Inside VMs<a class="headerlink" href="#ovs-with-dpdk-inside-vms" title="Permalink to this headline">¶</a></h5>
<p>Additional configuration is required if you want to run ovs-vswitchd with DPDK
backend inside a QEMU virtual machine. ovs-vswitchd creates separate DPDK TX
queues for each CPU core available. This operation fails inside QEMU virtual
machine because, by default, VirtIO NIC provided to the guest is configured to
support only single TX queue and single RX queue. To change this behavior, you
need to turn on <code class="docutils literal"><span class="pre">mq</span></code> (multiqueue) property of all <code class="docutils literal"><span class="pre">virtio-net-pci</span></code> devices
emulated by QEMU and used by DPDK.  You may do it manually (by changing QEMU
command line) or, if you use Libvirt, by adding the following string to
<code class="docutils literal"><span class="pre">&lt;interface&gt;</span></code> sections of all network devices used by DPDK:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>&lt;driver name=&#39;vhost&#39; queues=&#39;N&#39;/&gt;
</pre></div>
</div>
<p>where:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">N</span></code></dt>
<dd>determines how many queues can be used by the guest.</dd>
</dl>
<p>This requires QEMU &gt;= 2.2.</p>
</div>
<div class="section" id="phy-phy">
<span id="dpdk-phy-phy"></span><h5>PHY-PHY<a class="headerlink" href="#phy-phy" title="Permalink to this headline">¶</a></h5>
<p>Add a userspace bridge and two <code class="docutils literal"><span class="pre">dpdk</span></code> (PHY) ports:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># Add userspace bridge
$ ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev

# Add two dpdk ports
$ ovs-vsctl add-port br0 phy0 -- set Interface phy0 type=dpdk \
      options:dpdk-devargs=0000:01:00.0 ofport_request=1

$ ovs-vsctl add-port br0 phy1 -- set Interface phy1 type=dpdk
      options:dpdk-devargs=0000:01:00.1 ofport_request=2
</pre></div>
</div>
<p>Add test flows to forward packets betwen DPDK port 0 and port 1:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># Clear current flows
$ ovs-ofctl del-flows br0

# Add flows between port 1 (phy0) to port 2 (phy1)
$ ovs-ofctl add-flow br0 in_port=1,action=output:2
$ ovs-ofctl add-flow br0 in_port=2,action=output:1
</pre></div>
</div>
<p>Transmit traffic into either port. You should see it returned via the other.</p>
</div>
<div class="section" id="phy-vm-phy-vhost-loopback">
<span id="dpdk-vhost-loopback"></span><h5>PHY-VM-PHY (vHost Loopback)<a class="headerlink" href="#phy-vm-phy-vhost-loopback" title="Permalink to this headline">¶</a></h5>
<p>Add a userspace bridge, two <code class="docutils literal"><span class="pre">dpdk</span></code> (PHY) ports, and two <code class="docutils literal"><span class="pre">dpdkvhostuser</span></code>
ports:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># Add userspace bridge
$ ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev

# Add two dpdk ports
$ ovs-vsctl add-port br0 phy0 -- set Interface phy0 type=dpdk \
      options:dpdk-devargs=0000:01:00.0 ofport_request=1

$ ovs-vsctl add-port br0 phy1 -- set Interface phy1 type=dpdk
      options:dpdk-devargs=0000:01:00.1 ofport_request=2

# Add two dpdkvhostuser ports
$ ovs-vsctl add-port br0 dpdkvhostuser0 \
    -- set Interface dpdkvhostuser0 type=dpdkvhostuser ofport_request=3
$ ovs-vsctl add-port br0 dpdkvhostuser1 \
    -- set Interface dpdkvhostuser1 type=dpdkvhostuser ofport_request=4
</pre></div>
</div>
<p>Add test flows to forward packets betwen DPDK devices and VM ports:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># Clear current flows
$ ovs-ofctl del-flows br0

# Add flows
$ ovs-ofctl add-flow br0 in_port=1,action=output:3
$ ovs-ofctl add-flow br0 in_port=3,action=output:1
$ ovs-ofctl add-flow br0 in_port=4,action=output:2
$ ovs-ofctl add-flow br0 in_port=2,action=output:4

# Dump flows
$ ovs-ofctl dump-flows br0
</pre></div>
</div>
<p>Create a VM using the following configuration:</p>
<table border="1" class="docutils">
<colgroup>
<col width="47%" />
<col width="17%" />
<col width="36%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>configuration</td>
<td>values</td>
<td>comments</td>
</tr>
<tr class="row-even"><td>qemu version
qemu thread affinity
memory
cores
Qcow2 image
mrg_rxbuf</td>
<td>2.2.0
core 5
4GB
2
CentOS7
off</td>
<td>n/a
taskset 0x20
n/a
n/a
n/a
n/a</td>
</tr>
</tbody>
</table>
<p>You can do this directly with QEMU via the <code class="docutils literal"><span class="pre">qemu-system-x86_64</span></code> application:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ export VM_NAME=vhost-vm
$ export GUEST_MEM=3072M
$ export QCOW2_IMAGE=/root/CentOS7_x86_64.qcow2
$ export VHOST_SOCK_DIR=/usr/local/var/run/openvswitch

$ taskset 0x20 qemu-system-x86_64 -name $VM_NAME -cpu host -enable-kvm \
  -m $GUEST_MEM -drive file=$QCOW2_IMAGE --nographic -snapshot \
  -numa node,memdev=mem -mem-prealloc -smp sockets=1,cores=2 \
  -object memory-backend-file,id=mem,size=$GUEST_MEM,mem-path=/dev/hugepages,share=on \
  -chardev socket,id=char0,path=$VHOST_SOCK_DIR/dpdkvhostuser0 \
  -netdev type=vhost-user,id=mynet1,chardev=char0,vhostforce \
  -device virtio-net-pci,mac=00:00:00:00:00:01,netdev=mynet1,mrg_rxbuf=off \
  -chardev socket,id=char1,path=$VHOST_SOCK_DIR/dpdkvhostuser1 \
  -netdev type=vhost-user,id=mynet2,chardev=char1,vhostforce \
  -device virtio-net-pci,mac=00:00:00:00:00:02,netdev=mynet2,mrg_rxbuf=off
</pre></div>
</div>
<p>For a explanation of this command, along with alternative approaches such as
booting the VM via libvirt, refer to <a class="reference internal" href="contents.html#document-topics/dpdk/vhost-user"><em>DPDK vHost User Ports</em></a>.</p>
<p>Once the guest is configured and booted, configure DPDK packet forwarding
within the guest. To accomplish this, build the <code class="docutils literal"><span class="pre">testpmd</span></code> application as
described in <a class="reference internal" href="contents.html#dpdk-testpmd"><span>DPDK in the Guest</span></a>. Once compiled, run the application:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cd $DPDK_DIR/app/test-pmd;
$ ./testpmd -c 0x3 -n 4 --socket-mem 1024 -- \
    --burst=64 -i --txqflags=0xf00 --disable-hw-vlan
$ set fwd mac retry
$ start
</pre></div>
</div>
<p>When you finish testing, bind the vNICs back to kernel:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ $DPDK_DIR/tools/dpdk-devbind.py --bind=virtio-pci 0000:00:03.0
$ $DPDK_DIR/tools/dpdk-devbind.py --bind=virtio-pci 0000:00:04.0
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Valid PCI IDs must be passed in above example. The PCI IDs can be retrieved
like so:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span>$ $DPDK_DIR/tools/dpdk-devbind.py --status
</pre></div>
</div>
</div>
<p>More information on the dpdkvhostuser ports can be found in
<a class="reference internal" href="contents.html#document-topics/dpdk/vhost-user"><em>DPDK vHost User Ports</em></a>.</p>
<div class="section" id="phy-vm-phy-vhost-loopback-kernel-forwarding">
<h6>PHY-VM-PHY (vHost Loopback) (Kernel Forwarding)<a class="headerlink" href="#phy-vm-phy-vhost-loopback-kernel-forwarding" title="Permalink to this headline">¶</a></h6>
<p><a class="reference internal" href="#dpdk-vhost-loopback"><span>PHY-VM-PHY (vHost Loopback)</span></a> details steps for PHY-VM-PHY loopback
testcase and packet forwarding using DPDK testpmd application in the Guest VM.
For users wishing to do packet forwarding using kernel stack below, you need to
run the below commands on the guest:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ifconfig eth1 1.1.1.2/24
$ ifconfig eth2 1.1.2.2/24
$ systemctl stop firewalld.service
$ systemctl stop iptables.service
$ sysctl -w net.ipv4.ip_forward=1
$ sysctl -w net.ipv4.conf.all.rp_filter=0
$ sysctl -w net.ipv4.conf.eth1.rp_filter=0
$ sysctl -w net.ipv4.conf.eth2.rp_filter=0
$ route add -net 1.1.2.0/24 eth2
$ route add -net 1.1.1.0/24 eth1
$ arp -s 1.1.2.99 DE:AD:BE:EF:CA:FE
$ arp -s 1.1.1.99 DE:AD:BE:EF:CA:EE
</pre></div>
</div>
</div>
<div class="section" id="phy-vm-phy-vhost-multiqueue">
<h6>PHY-VM-PHY (vHost Multiqueue)<a class="headerlink" href="#phy-vm-phy-vhost-multiqueue" title="Permalink to this headline">¶</a></h6>
<p>vHost Multiqueue functionality can also be validated using the PHY-VM-PHY
configuration. To begin, follow the steps described in <a class="reference internal" href="#dpdk-phy-phy"><span>PHY-PHY</span></a> to
create and initialize the database, start ovs-vswitchd and add <code class="docutils literal"><span class="pre">dpdk</span></code>-type
devices to bridge <code class="docutils literal"><span class="pre">br0</span></code>. Once complete, follow the below steps:</p>
<ol class="arabic">
<li><p class="first">Configure PMD and RXQs.</p>
<p>For example, set the number of dpdk port rx queues to at least 2  The number
of rx queues at vhost-user interface gets automatically configured after
virtio device connection and doesn&#8217;t need manual configuration:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set Open_vSwitch . other_config:pmd-cpu-mask=0xc
$ ovs-vsctl set Interface phy0 options:n_rxq=2
$ ovs-vsctl set Interface phy1 options:n_rxq=2
</pre></div>
</div>
</li>
<li><p class="first">Instantiate Guest VM using QEMU cmdline</p>
<p>We must configure with appropriate software versions to ensure this feature
is supported.</p>
<table border="1" class="docutils" id="id3">
<caption><span class="caption-text">Recommended BIOS Settings</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>QEMU version</td>
<td>2.5.0</td>
</tr>
<tr class="row-odd"><td>QEMU thread affinity</td>
<td>2 cores (taskset 0x30)</td>
</tr>
<tr class="row-even"><td>Memory</td>
<td>4 GB</td>
</tr>
<tr class="row-odd"><td>Cores</td>
<td>2</td>
</tr>
<tr class="row-even"><td>Distro</td>
<td>Fedora 22</td>
</tr>
<tr class="row-odd"><td>Multiqueue</td>
<td>Enabled</td>
</tr>
</tbody>
</table>
<p>To do this, instantiate the guest as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ export VM_NAME=vhost-vm
$ export GUEST_MEM=4096M
$ export QCOW2_IMAGE=/root/Fedora22_x86_64.qcow2
$ export VHOST_SOCK_DIR=/usr/local/var/run/openvswitch
$ taskset 0x30 qemu-system-x86_64 -cpu host -smp 2,cores=2 -m 4096M \
    -drive file=$QCOW2_IMAGE --enable-kvm -name $VM_NAME \
    -nographic -numa node,memdev=mem -mem-prealloc \
    -object memory-backend-file,id=mem,size=$GUEST_MEM,mem-path=/dev/hugepages,share=on \
    -chardev socket,id=char1,path=$VHOST_SOCK_DIR/dpdkvhostuser0 \
    -netdev type=vhost-user,id=mynet1,chardev=char1,vhostforce,queues=2 \
    -device virtio-net-pci,mac=00:00:00:00:00:01,netdev=mynet1,mq=on,vectors=6 \
    -chardev socket,id=char2,path=$VHOST_SOCK_DIR/dpdkvhostuser1 \
    -netdev type=vhost-user,id=mynet2,chardev=char2,vhostforce,queues=2 \
    -device virtio-net-pci,mac=00:00:00:00:00:02,netdev=mynet2,mq=on,vectors=6
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Queue value above should match the queues configured in OVS, The vector
value should be set to &#8220;number of queues x 2 + 2&#8221;</p>
</div>
</li>
<li><p class="first">Configure the guest interface</p>
<p>Assuming there are 2 interfaces in the guest named eth0, eth1 check the
channel configuration and set the number of combined channels to 2 for
virtio devices:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ethtool -l eth0
$ ethtool -L eth0 combined 2
$ ethtool -L eth1 combined 2
</pre></div>
</div>
<p>More information can be found in vHost walkthrough section.</p>
</li>
<li><p class="first">Configure kernel packet forwarding</p>
<p>Configure IP and enable interfaces:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ifconfig eth0 5.5.5.1/24 up
$ ifconfig eth1 90.90.90.1/24 up
</pre></div>
</div>
<p>Configure IP forwarding and add route entries:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ sysctl -w net.ipv4.ip_forward=1
$ sysctl -w net.ipv4.conf.all.rp_filter=0
$ sysctl -w net.ipv4.conf.eth0.rp_filter=0
$ sysctl -w net.ipv4.conf.eth1.rp_filter=0
$ ip route add 2.1.1.0/24 dev eth1
$ route add default gw 2.1.1.2 eth1
$ route add default gw 90.90.90.90 eth1
$ arp -s 90.90.90.90 DE:AD:BE:EF:CA:FE
$ arp -s 2.1.1.2 DE:AD:BE:EF:CA:FA
</pre></div>
</div>
<p>Check traffic on multiple queues:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cat /proc/interrupts | grep virtio
</pre></div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="ovn">
<h3>OVN<a class="headerlink" href="#ovn" title="Permalink to this headline">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-howto/docker"></span><div class="section" id="open-virtual-networking-with-docker">
<h4>Open Virtual Networking With Docker<a class="headerlink" href="#open-virtual-networking-with-docker" title="Permalink to this headline">¶</a></h4>
<p>This document describes how to use Open Virtual Networking with Docker 1.9.0
or later.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Requires Docker version 1.9.0 or later. Only Docker 1.9.0+ comes with support
for multi-host networking. Consult www.docker.com for instructions on how to
install Docker.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You must build and install Open vSwitch before proceeding with the below
guide. Refer to <a class="reference internal" href="contents.html#document-intro/install/index"><em>Installing Open vSwitch</em></a> for more information.</p>
</div>
<div class="section" id="setup">
<h5>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h5>
<p>For multi-host networking with OVN and Docker, Docker has to be started with a
destributed key-value store. For example, if you decide to use consul as your
distributed key-value store and your host IP address is <code class="docutils literal"><span class="pre">$HOST_IP</span></code>, start
your Docker daemon with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ docker daemon --cluster-store=consul://127.0.0.1:8500 \
    --cluster-advertise=$HOST_IP:0
</pre></div>
</div>
<p>OVN provides network virtualization to containers. OVN&#8217;s integration with
Docker currently works in two modes - the &#8220;underlay&#8221; mode or the &#8220;overlay&#8221;
mode.</p>
<p>In the &#8220;underlay&#8221; mode, OVN requires a OpenStack setup to provide container
networking. In this mode, one can create logical networks and can have
containers running inside VMs, standalone VMs (without having any containers
running inside them) and physical machines connected to the same logical
network. This is a multi-tenant, multi-host solution.</p>
<p>In the &#8220;overlay&#8221; mode, OVN can create a logical network amongst containers
running on multiple hosts. This is a single-tenant (extendable to multi-tenants
depending on the security characteristics of the workloads), multi-host
solution. In this mode, you do not need a pre-created OpenStack setup.</p>
<p>For both the modes to work, a user has to install and start Open vSwitch in
each VM/host that they plan to run their containers on.</p>
</div>
<div class="section" id="the-overlay-mode">
<span id="docker-overlay"></span><h5>The &#8220;overlay&#8221; mode<a class="headerlink" href="#the-overlay-mode" title="Permalink to this headline">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">OVN in &#8220;overlay&#8221; mode needs a minimum Open vSwitch version of 2.5.</p>
</div>
<ol class="arabic simple">
<li>Start the central components.</li>
</ol>
<blockquote>
<div><p>OVN architecture has a central component which stores your networking intent
in a database. On one of your machines, with an IP Address of
<code class="docutils literal"><span class="pre">$CENTRAL_IP</span></code>, where you have installed and started Open vSwitch, you will
need to start some central components.</p>
<p>Start ovn-northd daemon. This daemon translates networking intent from Docker
stored in the OVN_Northbound database to logical flows in <code class="docutils literal"><span class="pre">OVN_Southbound</span></code>
database. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ /usr/share/openvswitch/scripts/ovn-ctl start_northd
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="2">
<li><p class="first">One time setup</p>
<p>On each host, where you plan to spawn your containers, you will need to run
the below command once. You may need to run it again if your OVS database
gets cleared. It is harmless to run it again in any case:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set Open_vSwitch . \
    external_ids:ovn-remote=&quot;tcp:$CENTRAL_IP:6642&quot; \
    external_ids:ovn-nb=&quot;tcp:$CENTRAL_IP:6641&quot; \
    external_ids:ovn-encap-ip=$LOCAL_IP \
    external_ids:ovn-encap-type=&quot;$ENCAP_TYPE&quot;
</pre></div>
</div>
<p>where:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">$LOCAL_IP</span></code></dt>
<dd><p class="first last">is the IP address via which other hosts can reach this host.  This acts as
your local tunnel endpoint.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">$ENCAP_TYPE</span></code></dt>
<dd><p class="first">is the type of tunnel that you would like to use for overlay networking.
The options are <code class="docutils literal"><span class="pre">geneve</span></code> or <code class="docutils literal"><span class="pre">stt</span></code>. Your kernel must have support for
your chosen <code class="docutils literal"><span class="pre">$ENCAP_TYPE</span></code>. Both <code class="docutils literal"><span class="pre">geneve</span></code> and <code class="docutils literal"><span class="pre">stt</span></code> are part of the
Open vSwitch kernel module that is compiled from this repo. If you use the
Open vSwitch kernel module from upstream Linux, you will need a minumum
kernel version of 3.18 for <code class="docutils literal"><span class="pre">geneve</span></code>. There is no <code class="docutils literal"><span class="pre">stt</span></code> support in
upstream Linux. You can verify whether you have the support in your kernel
as follows:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span>$ lsmod | grep $ENCAP_TYPE
</pre></div>
</div>
</dd>
</dl>
<p>In addition, each Open vSwitch instance in an OVN deployment needs a unique,
persistent identifier, called the <code class="docutils literal"><span class="pre">system-id</span></code>.  If you install OVS from
distribution packaging for Open vSwitch (e.g. .deb or .rpm packages), or if
you use the ovs-ctl utility included with Open vSwitch, it automatically
configures a system-id.  If you start Open vSwitch manually, you should set
one up yourself. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ id_file=/etc/openvswitch/system-id.conf
$ test -e $id_file || uuidgen &gt; $id_file
$ ovs-vsctl set Open_vSwitch . external_ids:system-id=$(cat $id_file)
</pre></div>
</div>
</li>
<li><p class="first">Start the <code class="docutils literal"><span class="pre">ovn-controller</span></code>.</p>
<p>You need to run the below command on every boot:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ /usr/share/openvswitch/scripts/ovn-ctl start_controller
</pre></div>
</div>
</li>
<li><p class="first">Start the Open vSwitch network driver.</p>
<p>By default Docker uses Linux bridge for networking. But it has support for
external drivers. To use Open vSwitch instead of the Linux bridge, you will
need to start the Open vSwitch driver.</p>
<p>The Open vSwitch driver uses the Python&#8217;s flask module to listen to Docker&#8217;s
networking api calls. So, if your host does not have Python&#8217;s flask module,
install it:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ sudo pip install Flask
</pre></div>
</div>
<p>Start the Open vSwitch driver on every host where you plan to create your
containers. Refer to the note on <code class="docutils literal"><span class="pre">$OVS_PYTHON_LIBS_PATH</span></code> that is used below
at the end of this document:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ PYTHONPATH=$OVS_PYTHON_LIBS_PATH ovn-docker-overlay-driver --detach
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">$OVS_PYTHON_LIBS_PATH</span></code> variable should point to the directory where
Open vSwitch Python modules are installed. If you installed Open vSwitch
Python modules via the Debian package of <code class="docutils literal"><span class="pre">python-openvswitch</span></code> or via pip
by running <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">ovs</span></code>, you do not need to specify the PATH. If
you installed it by following the instructions in
<a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a>, then you should specify the PATH. In this
case, the PATH depends on the options passed to <code class="docutils literal"><span class="pre">./configure</span></code>. It is
usually either <code class="docutils literal"><span class="pre">/usr/share/openvswitch/python</span></code> or
<code class="docutils literal"><span class="pre">/usr/local/share/openvswitch/python</span></code></p>
</div>
</li>
</ol>
<p>Docker has inbuilt primitives that closely match OVN&#8217;s logical switches and
logical port concepts. Consult Docker&#8217;s documentation for all the possible
commands. Here are some examples.</p>
<div class="section" id="create-a-logical-switch">
<h6>Create a logical switch<a class="headerlink" href="#create-a-logical-switch" title="Permalink to this headline">¶</a></h6>
<p>To create a logical switch with name &#8216;foo&#8217;, on subnet &#8216;192.168.1.0/24&#8217;, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ NID=`docker network create -d openvswitch --subnet=192.168.1.0/24 foo`
</pre></div>
</div>
</div>
<div class="section" id="list-all-logical-switches">
<h6>List all logical switches<a class="headerlink" href="#list-all-logical-switches" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ docker network ls
</pre></div>
</div>
<p>You can also look at this logical switch in OVN&#8217;s northbound database by
running the following command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovn-nbctl --db=tcp:$CENTRAL_IP:6640 ls-list
</pre></div>
</div>
</div>
<div class="section" id="delete-a-logical-switch">
<h6>Delete a logical switch<a class="headerlink" href="#delete-a-logical-switch" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ docker network rm bar
</pre></div>
</div>
</div>
<div class="section" id="create-a-logical-port">
<h6>Create a logical port<a class="headerlink" href="#create-a-logical-port" title="Permalink to this headline">¶</a></h6>
<p>Docker creates your logical port and attaches it to the logical network in a
single step. For example, to attach a logical port to network <code class="docutils literal"><span class="pre">foo</span></code> inside
container busybox, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ docker run -itd --net=foo --name=busybox busybox
</pre></div>
</div>
</div>
<div class="section" id="list-all-logical-ports">
<h6>List all logical ports<a class="headerlink" href="#list-all-logical-ports" title="Permalink to this headline">¶</a></h6>
<p>Docker does not currently have a CLI command to list all logical ports but you
can look at them in the OVN database by running:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovn-nbctl --db=tcp:$CENTRAL_IP:6640 lsp-list $NID
</pre></div>
</div>
</div>
<div class="section" id="create-and-attach-a-logical-port-to-a-running-container">
<h6>Create and attach a logical port to a running container<a class="headerlink" href="#create-and-attach-a-logical-port-to-a-running-container" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ docker network create -d openvswitch --subnet=192.168.2.0/24 bar
$ docker network connect bar busybox
</pre></div>
</div>
</div>
<div class="section" id="detach-and-delete-a-logical-port-from-a-running-container">
<h6>Detach and delete a logical port from a running container<a class="headerlink" href="#detach-and-delete-a-logical-port-from-a-running-container" title="Permalink to this headline">¶</a></h6>
<p>You can delete your logical port and detach it from a running container
by running:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ docker network disconnect bar busybox
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-underlay-mode">
<span id="docker-underlay"></span><h5>The &#8220;underlay&#8221; mode<a class="headerlink" href="#the-underlay-mode" title="Permalink to this headline">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This mode requires that you have a OpenStack setup pre-installed with
OVN providing the underlay networking.</p>
</div>
<ol class="arabic">
<li><p class="first">One time setup</p>
<p>A OpenStack tenant creates a VM with a single network interface (or multiple)
that belongs to management logical networks. The tenant needs to fetch the
port-id associated with the interface via which he plans to send the container
traffic inside the spawned VM. This can be obtained by running the below
command to fetch the &#8216;id&#8217; associated with the VM:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ nova list
</pre></div>
</div>
<p>and then by running:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ neutron port-list --device_id=$id
</pre></div>
</div>
<p>Inside the VM, download the OpenStack RC file that contains the tenant
information (henceforth referred to as <code class="docutils literal"><span class="pre">openrc.sh</span></code>). Edit the file and add the
previously obtained port-id information to the file by appending the following
line:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ export OS_VIF_ID=$port_id
</pre></div>
</div>
<p>After this edit, the file will look something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>#!/bin/bash
export OS_AUTH_URL=http://10.33.75.122:5000/v2.0
export OS_TENANT_ID=fab106b215d943c3bad519492278443d
export OS_TENANT_NAME=&quot;demo&quot;
export OS_USERNAME=&quot;demo&quot;
export OS_VIF_ID=e798c371-85f4-4f2d-ad65-d09dd1d3c1c9
</pre></div>
</div>
</li>
<li><p class="first">Create the Open vSwitch bridge</p>
<p>If your VM has one ethernet interface (e.g.: &#8216;eth0&#8217;), you will need to add
that device as a port to an Open vSwitch bridge &#8216;breth0&#8217; and move its IP
address and route related information to that bridge. (If it has multiple
network interfaces, you will need to create and attach an Open vSwitch
bridge for the interface via which you plan to send your container
traffic.)</p>
<p>If you use DHCP to obtain an IP address, then you should kill the DHCP
client that was listening on the physical Ethernet interface (e.g. eth0) and
start one listening on the Open vSwitch bridge (e.g. breth0).</p>
<p>Depending on your VM, you can make the above step persistent across reboots.
For example, if your VM is Debian/Ubuntu-based, read
<cite>openvswitch-switch.README.Debian</cite> found in <cite>debian</cite> folder. If your VM is
RHEL-based, refer to <a class="reference internal" href="contents.html#document-intro/install/rhel"><em>RHEL 5.6, 6.x Packaging for Open vSwitch</em></a>.</p>
</li>
<li><p class="first">Start the Open vSwitch network driver</p>
<p>The Open vSwitch driver uses the Python&#8217;s flask module to listen to Docker&#8217;s
networking api calls. The driver also uses OpenStack&#8217;s
<code class="docutils literal"><span class="pre">python-neutronclient</span></code> libraries. If your host does not have Python&#8217;s
<code class="docutils literal"><span class="pre">flask</span></code> module or <code class="docutils literal"><span class="pre">python-neutronclient</span></code> you must install them. For
example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ pip install python-neutronclient
$ pip install Flask
</pre></div>
</div>
<p>Once installed, source the <code class="docutils literal"><span class="pre">openrc</span></code> file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ . ./openrc.sh
</pre></div>
</div>
<p>Start the network driver and provide your OpenStack tenant password when
prompted:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ PYTHONPATH=$OVS_PYTHON_LIBS_PATH ovn-docker-underlay-driver \
    --bridge breth0 --detach
</pre></div>
</div>
</li>
</ol>
<p>From here-on you can use the same Docker commands as described in
<a class="reference internal" href="#docker-overlay">docker-overlay</a>.</p>
<p>Refer the the ovs-architecture man pages (<code class="docutils literal"><span class="pre">man</span> <span class="pre">ovn-architecture</span></code>) to
understand OVN&#8217;s architecture in detail.</p>
</div>
</div>
<span id="document-howto/openstack-containers"></span><div class="section" id="integration-of-containers-with-ovn-and-openstack">
<h4>Integration of Containers with OVN and OpenStack<a class="headerlink" href="#integration-of-containers-with-ovn-and-openstack" title="Permalink to this headline">¶</a></h4>
<p>Isolation between containers is weaker than isolation between VMs, so some
environments deploy containers for different tenants in separate VMs as an
additional security measure.  This document describes creation of containers
inside VMs and how they can be made part of the logical networks securely.  The
created logical network can include VMs, containers and physical machines as
endpoints.  To better understand the proposed integration of containers with
OVN and OpenStack, this document describes the end to end workflow with an
example.</p>
<ul class="simple">
<li>A OpenStack tenant creates a VM (say VM-A) with a single network interface
that belongs to a management logical network.  The VM is meant to host
containers.  OpenStack Nova chooses the hypervisor on which VM-A is created.</li>
<li>A Neutron port may have been created in advance and passed in to Nova with
the request to create a new VM.  If not, Nova will issue a request to Neutron
to create a new port.  The ID of the logical port from Neutron will also be
used as the vif-id for the virtual network interface (VIF) of VM-A.</li>
<li>When VM-A is created on a hypervisor, its VIF gets added to the Open vSwitch
integration bridge.  This creates a row in the Interface table of the
<code class="docutils literal"><span class="pre">Open_vSwitch</span></code> database.  As explained in the <a class="reference internal" href="contents.html#document-topics/integration"><em>integration guide</em></a>, the vif-id associated with the VM network interface
gets added in the <code class="docutils literal"><span class="pre">external_ids:iface-id</span></code> column of the newly created row
in the Interface table.</li>
<li>Since VM-A belongs to a logical network, it gets an IP address.  This IP
address is used to spawn containers (either manually or through container
orchestration systems) inside that VM and to monitor the health of the
created containers.</li>
<li>The vif-id associated with the VM&#8217;s network interface can be obtained by
making a call to Neutron using tenant credentials.</li>
<li>This flow assumes a component called a &#8220;container network plugin&#8221;.  If you
take Docker as an example for containers, you could envision the plugin to be
either a wrapper around Docker or a feature of Docker itself that understands
how to perform part of this workflow to get a container connected to a
logical network managed by Neutron.  The rest of the flow refers to this
logical component that does not yet exist as the &#8220;container network plugin&#8221;.</li>
<li>All the calls to Neutron will need tenant credentials.  These calls can
either be made from inside the tenant VM as part of a container network
plugin or from outside the tenant VM (if the tenant is not comfortable using
temporary Keystone tokens from inside the tenant VMs).  For simplicity, this
document explains the work flow using the former method.</li>
<li>The container hosting VM will need Open vSwitch installed in it.  The only
work for Open vSwitch inside the VM is to tag network traffic coming from
containers.</li>
<li>When a container needs to be created inside the VM with a container network
interface that is expected to be attached to a particular logical switch, the
network plugin in that VM chooses any unused VLAN (This VLAN tag only needs
to be unique inside that VM.  This limits the number of container interfaces
to 4096 inside a single VM).  This VLAN tag is stripped out in the hypervisor
by OVN and is only useful as a context (or metadata) for OVN.</li>
<li>The container network plugin then makes a call to Neutron to create a logical
port.  In addition to all the inputs that a call to create a port in Neutron
that are currently needed, it sends the vif-id and the VLAN tag as inputs.</li>
<li>Neutron in turn will verify that the vif-id belongs to the tenant in question
and then uses the OVN specific plugin to create a new row in the
Logical_Switch_Port table of the OVN Northbound Database.  Neutron responds
back with an IP address and MAC address for that network interface.  So
Neutron becomes the IPAM system and provides unique IP and MAC addresses
across VMs and containers in the same logical network.</li>
<li>The Neutron API call above to create a logical port for the container could
add a relatively significant amount of time to container creation.  However,
an optimization is possible here.  Logical ports could be created in advance
and reused by the container system doing container orchestration.  Additional
Neutron API calls would only be needed if the port needs to be attached to a
different logical network.</li>
<li>When a container is eventually deleted, the network plugin in that VM may
make a call to Neutron to delete that port.  Neutron in turn will delete the
entry in the <code class="docutils literal"><span class="pre">Logical_Switch_Port</span></code> table of the OVN Northbound Database.</li>
</ul>
<p>As an example, consider Docker containers.  Since Docker currently does not
have a network plugin feature, this example uses a hypothetical wrapper around
Docker to make calls to Neutron.</p>
<ul>
<li><p class="first">Create a Logical switch:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovn-docker --cred=cca86bd13a564ac2a63ddf14bf45d37f create network LS1
</pre></div>
</div>
<p>The above command will make a call to Neutron with the credentials to create
a logical switch.  The above is optional if the logical switch has already
been created from outside the VM.</p>
</li>
<li><p class="first">List networks available to the tenant:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovn-docker --cred=cca86bd13a564ac2a63ddf14bf45d37f list networks
</pre></div>
</div>
</li>
<li><p class="first">Create a container and attach a interface to the previously created switch as
a logical port:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovn-docker --cred=cca86bd13a564ac2a63ddf14bf45d37f --vif-id=$VIF_ID \
    --network=LS1 run -d --net=none ubuntu:14.04 /bin/sh -c \
    &quot;while true; do echo hello world; sleep 1; done&quot;
</pre></div>
</div>
<p>The above command will make a call to Neutron with all the inputs it
currently needs to create a logical port.  In addition, it passes the $VIF_ID
and a unused VLAN.  Neutron will add that information in OVN and return back
a MAC address and IP address for that interface.  ovn-docker will then create
a veth pair, insert one end inside the container as &#8216;eth0&#8217; and the other end
as a port of a local OVS bridge as an access port of the chosen VLAN.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<span id="document-ref/index"></span><div class="section" id="reference-guide">
<h2>Reference Guide<a class="headerlink" href="#reference-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="man-pages">
<h3>Man Pages<a class="headerlink" href="#man-pages" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>ovn-architecture(7)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-architecture.7.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-architecture.7.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-architecture.7.txt">(plain text)</a></td>
</tr>
<tr class="row-even"><td>ovn-controller(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-controller.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-controller.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-controller.8.txt">(plain text)</a></td>
</tr>
<tr class="row-odd"><td>ovn-controller-vtep(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-controller-vtep.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-controller-vtep.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-controller-vtep.8.txt">(plain text)</a></td>
</tr>
<tr class="row-even"><td>ovn-ctl(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-ctl.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-ctl.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-ctl.8.txt">(plain text)</a></td>
</tr>
<tr class="row-odd"><td>ovn-nb(5)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-nb.5.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-nb.5.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-nb.5.txt">(plain text)</a></td>
</tr>
<tr class="row-even"><td>ovn-nbctl(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-nbctl.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-nbctl.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-nbctl.8.txt">(plain text)</a></td>
</tr>
<tr class="row-odd"><td>ovn-northd(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-northd.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-northd.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-northd.8.txt">(plain text)</a></td>
</tr>
<tr class="row-even"><td>ovn-sb(5)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-sb.5.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-sb.5.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-sb.5.txt">(plain text)</a></td>
</tr>
<tr class="row-odd"><td>ovn-sbctl(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-sbctl.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-sbctl.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-sbctl.8.txt">(plain text)</a></td>
</tr>
<tr class="row-even"><td>ovn-trace(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-trace.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-trace.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovn-trace.8.txt">(plain text)</a></td>
</tr>
<tr class="row-odd"><td>ovs-appctl(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-appctl.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-appctl.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-appctl.8.txt">(plain text)</a></td>
</tr>
<tr class="row-even"><td>ovs-bugtool(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-bugtool.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-bugtool.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-bugtool.8.txt">(plain text)</a></td>
</tr>
<tr class="row-odd"><td>ovs-ctl(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-ctl.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-ctl.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-ctl.8.txt">(plain text)</a></td>
</tr>
<tr class="row-even"><td>ovsdb-client(1)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovsdb-client.1.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovsdb-client.1.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovsdb-client.1.txt">(plain text)</a></td>
</tr>
<tr class="row-odd"><td>ovsdb-server(1)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovsdb-server.1.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovsdb-server.1.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovsdb-server.1.txt">(plain text)</a></td>
</tr>
<tr class="row-even"><td>ovsdb-tool(1)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovsdb-tool.1.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovsdb-tool.1.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovsdb-tool.1.txt">(plain text)</a></td>
</tr>
<tr class="row-odd"><td>ovs-dpctl(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-dpctl.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-dpctl.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-dpctl.8.txt">(plain text)</a></td>
</tr>
<tr class="row-even"><td>ovs-dpctl-top(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-dpctl-top.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-dpctl-top.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-dpctl-top.8.txt">(plain text)</a></td>
</tr>
<tr class="row-odd"><td>ovs-fields(7)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-fields.7.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-fields.7.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-fields.7.txt">(plain text)</a></td>
</tr>
<tr class="row-even"><td>ovs-l3ping(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-l3ping.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-l3ping.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-l3ping.8.txt">(plain text)</a></td>
</tr>
<tr class="row-odd"><td>ovs-ofctl(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-ofctl.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-ofctl.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-ofctl.8.txt">(plain text)</a></td>
</tr>
<tr class="row-even"><td>ovs-parse-backtrace(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-parse-backtrace.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-parse-backtrace.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-parse-backtrace.8.txt">(plain text)</a></td>
</tr>
<tr class="row-odd"><td>ovs-pcap(1)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-pcap.1.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-pcap.1.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-pcap.1.txt">(plain text)</a></td>
</tr>
<tr class="row-even"><td>ovs-pki(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-pki.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-pki.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-pki.8.txt">(plain text)</a></td>
</tr>
<tr class="row-odd"><td>ovs-tcpdump(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-tcpdump.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-tcpdump.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-tcpdump.8.txt">(plain text)</a></td>
</tr>
<tr class="row-even"><td>ovs-tcpundump(1)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-tcpundump.1.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-tcpundump.1.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-tcpundump.1.txt">(plain text)</a></td>
</tr>
<tr class="row-odd"><td>ovs-test(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-test.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-test.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-test.8.txt">(plain text)</a></td>
</tr>
<tr class="row-even"><td>ovs-testcontroller(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-testcontroller.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-testcontroller.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-testcontroller.8.txt">(plain text)</a></td>
</tr>
<tr class="row-odd"><td>ovs-vlan-bug-workaround(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-vlan-bug-workaround.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-vlan-bug-workaround.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-vlan-bug-workaround.8.txt">(plain text)</a></td>
</tr>
<tr class="row-even"><td>ovs-vlan-test(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-vlan-test.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-vlan-test.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-vlan-test.8.txt">(plain text)</a></td>
</tr>
<tr class="row-odd"><td>ovs-vsctl(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-vsctl.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-vsctl.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-vsctl.8.txt">(plain text)</a></td>
</tr>
<tr class="row-even"><td>ovs-vswitchd(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-vswitchd.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-vswitchd.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-vswitchd.8.txt">(plain text)</a></td>
</tr>
<tr class="row-odd"><td>ovs-vswitchd.conf.db(5)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-vswitchd.conf.db.5.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-vswitchd.conf.db.5.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-vswitchd.conf.db.5.txt">(plain text)</a></td>
</tr>
<tr class="row-even"><td>vtep(5)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/vtep.5.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/vtep.5.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/vtep.5.txt">(plain text)</a></td>
</tr>
<tr class="row-odd"><td>vtep-ctl(8)</td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/vtep-ctl.8.pdf">(pdf)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/vtep-ctl.8.html">(html)</a></td>
<td><a class="reference external" href="http://openvswitch.org/support/dist-docs/vtep-ctl.8.html">(plain text)</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<span id="document-faq/index"></span><div class="section" id="open-vswitch-faq">
<h2>Open vSwitch FAQ<a class="headerlink" href="#open-vswitch-faq" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-faq/configuration"></span><div class="section" id="basic-configuration">
<h3>Basic Configuration<a class="headerlink" href="#basic-configuration" title="Permalink to this headline">¶</a></h3>
<p>Q: How do I configure a port as an access port?</p>
<blockquote>
<div><p>A. Add <code class="docutils literal"><span class="pre">tag=VLAN</span></code> to your <code class="docutils literal"><span class="pre">ovs-vsctl</span> <span class="pre">add-port</span></code> command. For example,
the following commands configure br0 with eth0 as a trunk port (the
default) and tap0 as an access port for VLAN 9:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 eth0
$ ovs-vsctl add-port br0 tap0 tag=9
</pre></div>
</div>
<p>If you want to configure an already added port as an access port, use
<code class="docutils literal"><span class="pre">ovs-vsctl</span> <span class="pre">set</span></code>, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set port tap0 tag=9
</pre></div>
</div>
</div></blockquote>
<p>Q: How do I configure a port as a SPAN port, that is, enable mirroring of all
traffic to that port?</p>
<blockquote>
<div><p>A. The following commands configure br0 with eth0 and tap0 as trunk ports.
All traffic coming in or going out on eth0 or tap0 is also mirrored to
tap1; any traffic arriving on tap1 is dropped:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 eth0
$ ovs-vsctl add-port br0 tap0
$ ovs-vsctl add-port br0 tap1 \
    -- --id=@p get port tap1 \
    -- --id=@m create mirror name=m0 select-all=true output-port=@p \
    -- set bridge br0 mirrors=@m
</pre></div>
</div>
<p>To later disable mirroring, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl clear bridge br0 mirrors
</pre></div>
</div>
</div></blockquote>
<p>Q: Does Open vSwitch support configuring a port in promiscuous mode?</p>
<blockquote>
<div><p>A: Yes.  How you configure it depends on what you mean by &#8220;promiscuous
mode&#8221;:</p>
<ul>
<li><p class="first">Conventionally, &#8220;promiscuous mode&#8221; is a feature of a network interface
card.  Ordinarily, a NIC passes to the CPU only the packets actually
destined to its host machine.  It discards the rest to avoid wasting
memory and CPU cycles.  When promiscuous mode is enabled, however, it
passes every packet to the CPU.  On an old-style shared-media or
hub-based network, this allows the host to spy on all packets on the
network.  But in the switched networks that are almost everywhere these
days, promiscuous mode doesn&#8217;t have much effect, because few packets not
destined to a host are delivered to the host&#8217;s NIC.</p>
<p>This form of promiscuous mode is configured in the guest OS of the VMs on
your bridge, e.g. with &#8220;ifconfig&#8221;.</p>
</li>
<li><p class="first">The VMware vSwitch uses a different definition of &#8220;promiscuous mode&#8221;.
When you configure promiscuous mode on a VMware vNIC, the vSwitch sends a
copy of every packet received by the vSwitch to that vNIC.  That has a
much bigger effect than just enabling promiscuous mode in a guest OS.
Rather than getting a few stray packets for which the switch does not yet
know the correct destination, the vNIC gets every packet.  The effect is
similar to replacing the vSwitch by a virtual hub.</p>
<p>This &#8220;promiscuous mode&#8221; is what switches normally call &#8220;port mirroring&#8221;
or &#8220;SPAN&#8221;.  For information on how to configure SPAN, see &#8220;How do I
configure a port as a SPAN port, that is, enable mirroring of all traffic
to that port?&#8221;</p>
</li>
</ul>
</div></blockquote>
<p>Q: How do I configure a DPDK port as an access port?</p>
<blockquote>
<div><p>A: Firstly, you must have a DPDK-enabled version of Open vSwitch.</p>
<p>If your version is DPDK-enabled it will support the other-config:dpdk-init
configuration in the database and will display lines with &#8220;EAL:...&#8221; during
startup when other_config:dpdk-init is set to &#8216;true&#8217;.</p>
<p>Secondly, when adding a DPDK port, unlike a system port, the type for the
interface and valid dpdk-devargs must be specified. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 myportname -- set Interface myportname \
    type=dpdk options:dpdk-devargs=0000:06:00.0
</pre></div>
</div>
<p>Refer to <a class="reference internal" href="contents.html#document-intro/install/dpdk"><em>Open vSwitch with DPDK</em></a> for more information on enabling and
using DPDK with Open vSwitch.</p>
</div></blockquote>
<p>Q: How do I configure a VLAN as an RSPAN VLAN, that is, enable mirroring of all
traffic to that VLAN?</p>
<blockquote>
<div><p>A: The following commands configure br0 with eth0 as a trunk port and tap0
as an access port for VLAN 10.  All traffic coming in or going out on tap0,
as well as traffic coming in or going out on eth0 in VLAN 10, is also
mirrored to VLAN 15 on eth0.  The original tag for VLAN 10, in cases where
one is present, is dropped as part of mirroring:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 eth0
$ ovs-vsctl add-port br0 tap0 tag=10
$ ovs-vsctl \
    -- --id=@m create mirror name=m0 select-all=true select-vlan=10 \
       output-vlan=15 \
    -- set bridge br0 mirrors=@m
</pre></div>
</div>
<p>To later disable mirroring, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl clear bridge br0 mirrors
</pre></div>
</div>
<p>Mirroring to a VLAN can disrupt a network that contains unmanaged switches.
See ovs-vswitchd.conf.db(5) for details. Mirroring to a GRE tunnel has
fewer caveats than mirroring to a VLAN and should generally be preferred.</p>
</div></blockquote>
<p>Q: Can I mirror more than one input VLAN to an RSPAN VLAN?</p>
<blockquote>
<div><p>A: Yes, but mirroring to a VLAN strips the original VLAN tag in favor of
the specified output-vlan.  This loss of information may make the mirrored
traffic too hard to interpret.</p>
<p>To mirror multiple VLANs, use the commands above, but specify a
comma-separated list of VLANs as the value for select-vlan.  To mirror
every VLAN, use the commands above, but omit select-vlan and its value
entirely.</p>
<p>When a packet arrives on a VLAN that is used as a mirror output VLAN, the
mirror is disregarded.  Instead, in standalone mode, OVS floods the packet
across all the ports for which the mirror output VLAN is configured.  (If
an OpenFlow controller is in use, then it can override this behavior
through the flow table.)  If OVS is used as an intermediate switch, rather
than an edge switch, this ensures that the RSPAN traffic is distributed
through the network.</p>
<p>Mirroring to a VLAN can disrupt a network that contains unmanaged switches.
See ovs-vswitchd.conf.db(5) for details.  Mirroring to a GRE tunnel has
fewer caveats than mirroring to a VLAN and should generally be preferred.</p>
</div></blockquote>
<p>Q: How do I configure mirroring of all traffic to a GRE tunnel?</p>
<blockquote>
<div><p>A: The following commands configure br0 with eth0 and tap0 as trunk ports.
All traffic coming in or going out on eth0 or tap0 is also mirrored to
gre0, a GRE tunnel to the remote host 192.168.1.10; any traffic arriving on
gre0 is dropped:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 eth0
$ ovs-vsctl add-port br0 tap0
$ ovs-vsctl add-port br0 gre0 \
     -- set interface gre0 type=gre options:remote_ip=192.168.1.10 \
     -- --id=@p get port gre0 \
     -- --id=@m create mirror name=m0 select-all=true output-port=@p \
     -- set bridge br0 mirrors=@m
</pre></div>
</div>
<p>To later disable mirroring and destroy the GRE tunnel:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl clear bridge br0 mirrors
$ ovs-vsctl del-port br0 gre0
</pre></div>
</div>
</div></blockquote>
<p>Q: Does Open vSwitch support ERSPAN?</p>
<blockquote>
<div>A: No.  As an alternative, Open vSwitch supports mirroring to a GRE tunnel
(see above).</div></blockquote>
<p>Q: How do I connect two bridges?</p>
<blockquote>
<div><p>A: First, why do you want to do this?  Two connected bridges are not much
different from a single bridge, so you might as well just have a single
bridge with all your ports on it.</p>
<p>If you still want to connect two bridges, you can use a pair of patch
ports.  The following example creates bridges br0 and br1, adds eth0 and
tap0 to br0, adds tap1 to br1, and then connects br0 and br1 with a pair of
patch ports.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 eth0
$ ovs-vsctl add-port br0 tap0
$ ovs-vsctl add-br br1
$ ovs-vsctl add-port br1 tap1
$ ovs-vsctl \
    -- add-port br0 patch0 \
    -- set interface patch0 type=patch options:peer=patch1 \
    -- add-port br1 patch1 \
    -- set interface patch1 type=patch options:peer=patch0
</pre></div>
</div>
<p>Bridges connected with patch ports are much like a single bridge. For
instance, if the example above also added eth1 to br1, and both eth0 and
eth1 happened to be connected to the same next-hop switch, then you could
loop your network just as you would if you added eth0 and eth1 to the same
bridge (see the &#8220;Configuration Problems&#8221; section below for more
information).</p>
<p>If you are using Open vSwitch 1.9 or an earlier version, then you need to
be using the kernel module bundled with Open vSwitch rather than the one
that is integrated into Linux 3.3 and later, because Open vSwitch 1.9 and
earlier versions need kernel support for patch ports. This also means that
in Open vSwitch 1.9 and earlier, patch ports will not work with the
userspace datapath, only with the kernel module.</p>
</div></blockquote>
<p>Q: How do I configure a bridge without an OpenFlow local port?  (Local port in
the sense of OFPP_LOCAL)</p>
<blockquote>
<div>A: Open vSwitch does not support such a configuration.  Bridges always have
their local ports.</div></blockquote>
</div>
<span id="document-faq/contributing"></span><div class="section" id="development">
<h3>Development<a class="headerlink" href="#development" title="Permalink to this headline">¶</a></h3>
<p>Q: How do I implement a new OpenFlow message?</p>
<blockquote>
<div><p>A: Add your new message to <code class="docutils literal"><span class="pre">enum</span> <span class="pre">ofpraw</span></code> and <code class="docutils literal"><span class="pre">enum</span> <span class="pre">ofptype</span></code> in
<code class="docutils literal"><span class="pre">lib/ofp-msgs.h</span></code>, following the existing pattern.  Then recompile and fix
all of the new warnings, implementing new functionality for the new message
as needed.  (If you configure with <code class="docutils literal"><span class="pre">--enable-Werror</span></code>, as described in
<a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a>, then it is impossible to miss any warnings.)</p>
<p>If you need to add an OpenFlow vendor extension message for a vendor that
doesn&#8217;t yet have any extension messages, then you will also need to edit
<code class="docutils literal"><span class="pre">build-aux/extract-ofp-msgs</span></code>.</p>
</div></blockquote>
<p>Q: How do I add support for a new field or header?</p>
<blockquote>
<div><p>A: Add new members for your field to <code class="docutils literal"><span class="pre">struct</span> <span class="pre">flow</span></code> in <code class="docutils literal"><span class="pre">lib/flow.h</span></code>, and
add new enumerations for your new field to <code class="docutils literal"><span class="pre">enum</span> <span class="pre">mf_field_id</span></code> in
<code class="docutils literal"><span class="pre">lib/meta-flow.h</span></code>, following the existing pattern.  Also, add support to
<code class="docutils literal"><span class="pre">miniflow_extract()</span></code> in <code class="docutils literal"><span class="pre">lib/flow.c</span></code> for extracting your new field from
a packet into struct miniflow, and to <code class="docutils literal"><span class="pre">nx_put_raw()</span></code> in
<code class="docutils literal"><span class="pre">lib/nx-match.c</span></code> to output your new field in OXM matches.  Then recompile
and fix all of the new warnings, implementing new functionality for the new
field or header as needed.  (If you configure with <code class="docutils literal"><span class="pre">--enable-Werror</span></code>, as
described in <a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a>, then it is impossible to miss
any warnings.)</p>
<p>If you want kernel datapath support for your new field, you also need to
modify the kernel module for the operating systems you are interested in.
This isn&#8217;t mandatory, since fields understood only by userspace work too
(with a performance penalty), so it&#8217;s reasonable to start development
without it.  If you implement kernel module support for Linux, then the
Linux kernel &#8220;netdev&#8221; mailing list is the place to submit that support
first; please read up on the Linux kernel development process separately.
The Windows datapath kernel module support, on the other hand, is
maintained within the OVS tree, so patches for that can go directly to
ovs-dev.</p>
</div></blockquote>
<p>Q: How do I add support for a new OpenFlow action?</p>
<blockquote>
<div><p>A: Add your new action to <code class="docutils literal"><span class="pre">enum</span> <span class="pre">ofp_raw_action_type</span></code> in
<code class="docutils literal"><span class="pre">lib/ofp-actions.c</span></code>, following the existing pattern.  Then recompile and
fix all of the new warnings, implementing new functionality for the new
action as needed.  (If you configure with <code class="docutils literal"><span class="pre">--enable-Werror</span></code>, as described
in the <a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a>, then it is impossible to miss any
warnings.)</p>
<p>If you need to add an OpenFlow vendor extension action for a vendor that
doesn&#8217;t yet have any extension actions, then you will also need to edit
<code class="docutils literal"><span class="pre">build-aux/extract-ofp-actions</span></code>.</p>
</div></blockquote>
</div>
<span id="document-faq/design"></span><div class="section" id="implementation-details">
<h3>Implementation Details<a class="headerlink" href="#implementation-details" title="Permalink to this headline">¶</a></h3>
<p>Q: I hear OVS has a couple of kinds of flows.  Can you tell me about them?</p>
<blockquote>
<div><p>A: Open vSwitch uses different kinds of flows for different purposes:</p>
<ul>
<li><p class="first">OpenFlow flows are the most important kind of flow.  OpenFlow controllers
use these flows to define a switch&#8217;s policy.  OpenFlow flows support
wildcards, priorities, and multiple tables.</p>
<p>When in-band control is in use, Open vSwitch sets up a few &#8220;hidden&#8221;
flows, with priority higher than a controller or the user can configure,
that are not visible via OpenFlow.  (See the &#8220;Controller&#8221; section of the
FAQ for more information about hidden flows.)</p>
</li>
<li><p class="first">The Open vSwitch software switch implementation uses a second kind of
flow internally.  These flows, called &#8220;datapath&#8221; or &#8220;kernel&#8221; flows, do
not support priorities and comprise only a single table, which makes them
suitable for caching.  (Like OpenFlow flows, datapath flows do support
wildcarding, in Open vSwitch 1.11 and later.)  OpenFlow flows and
datapath flows also support different actions and number ports
differently.</p>
<p>Datapath flows are an implementation detail that is subject to change in
future versions of Open vSwitch.  Even with the current version of Open
vSwitch, hardware switch implementations do not necessarily use this
architecture.</p>
</li>
</ul>
</div></blockquote>
<p>Users and controllers directly control only the OpenFlow flow table.  Open
vSwitch manages the datapath flow table itself, so users should not normally be
concerned with it.</p>
<p>Q: Why are there so many different ways to dump flows?</p>
<blockquote>
<div><p>A: Open vSwitch has two kinds of flows (see the previous question), so it
has commands with different purposes for dumping each kind of flow:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">ovs-ofctl</span> <span class="pre">dump-flows</span> <span class="pre">&lt;br&gt;</span></code> dumps OpenFlow flows, excluding hidden
flows.  This is the most commonly useful form of flow dump.  (Unlike the
other commands, this should work with any OpenFlow switch, not just Open
vSwitch.)</li>
<li><code class="docutils literal"><span class="pre">ovs-appctl</span> <span class="pre">bridge/dump-flows</span> <span class="pre">&lt;br&gt;</span></code> dumps OpenFlow flows, including
hidden flows.  This is occasionally useful for troubleshooting suspected
issues with in-band control.</li>
<li><code class="docutils literal"><span class="pre">ovs-dpctl</span> <span class="pre">dump-flows</span> <span class="pre">[dp]</span></code> dumps the datapath flow table entries for a
Linux kernel-based datapath.  In Open vSwitch 1.10 and later,
ovs-vswitchd merges multiple switches into a single datapath, so it will
show all the flows on all your kernel-based switches.  This command can
occasionally be useful for debugging.</li>
<li><code class="docutils literal"><span class="pre">ovs-appctl</span> <span class="pre">dpif/dump-flows</span> <span class="pre">&lt;br&gt;</span></code>, new in Open vSwitch 1.10, dumps
datapath flows for only the specified bridge, regardless of the type.</li>
</ul>
</div></blockquote>
<p>Q: How does multicast snooping works with VLANs?</p>
<blockquote>
<div>A: Open vSwitch maintains snooping tables for each VLAN.</div></blockquote>
<p>Q: Can OVS populate the kernel flow table in advance instead of in reaction to
packets?</p>
<blockquote>
<div><p>A: No.  There are several reasons:</p>
<ul class="simple">
<li>Kernel flows are not as sophisticated as OpenFlow flows, which means that
some OpenFlow policies could require a large number of kernel flows.  The
&#8220;conjunctive match&#8221; feature is an extreme example: the number of kernel
flows it requires is the product of the number of flows in each
dimension.</li>
<li>With multiple OpenFlow flow tables and simple sets of actions, the number
of kernel flows required can be as large as the product of the number of
flows in each dimension.  With more sophisticated actions, the number of
kernel flows could be even larger.</li>
<li>Open vSwitch is designed so that any version of OVS userspace
interoperates with any version of the OVS kernel module.  This forward
and backward compatibility requires that userspace observe how the kernel
module parses received packets.  This is only possible in a
straightforward way when userspace adds kernel flows in reaction to
received packets.</li>
</ul>
<p>For more relevant information on the architecture of Open vSwitch, please
read &#8220;The Design and Implementation of Open vSwitch&#8221;, published in USENIX
NSDI 2015.</p>
</div></blockquote>
<p>Q: How many packets does OVS buffer?</p>
<blockquote>
<div><p>A: Open vSwitch fast path packet processing uses a &#8220;run to completion&#8221;
model in which every packet is completely handled in a single pass.
Therefore, in the common case where a packet just passes through the fast
path, Open vSwitch does not buffer packets itself.  The operating system
and the network drivers involved in receiving and later in transmitting the
packet do often include buffering.  Open vSwitch is only a middleman
between these and does not have direct access or influence over their
buffers.</p>
<p>Outside the common case, Open vSwitch does sometimes buffer packets.  When
the OVS fast path processes a packet that does not match any of the flows
in its megaflow cache, it passes that packet to the Open vSwitch slow path.
This procedure queues a copy of the packet to the Open vSwitch userspace
which processes it and, if necessary, passes it back to the kernel module.
Queuing the packet to userspace as part of this process involves buffering.
(Going the opposite direction does not, because the kernel actually
processes the request synchronously.)  A few other exceptional cases also
queue packets to userspace for processing; most of these are due to
OpenFlow actions that the fast path cannot handle and that must therefore
be handled by the slow path instead.</p>
<p>OpenFlow also has a concept of packet buffering.  When an OpenFlow switch
sends a packet to a controller, it may opt to retain a copy of the packet
in an OpenFlow &#8220;packet buffer&#8221;.  Later, if the controller wants to tell the
switch to forward a copy of that packet, it can refer to the packet through
its assigned buffer, instead of sending the whole packet back to the
switch, thereby saving bandwidth in the OpenFlow control channel.  Before
Open vSwitch 2.7, OVS implemented such buffering; Open vSwitch 2.7 and
later do not.</p>
</div></blockquote>
</div>
<span id="document-faq/general"></span><div class="section" id="general">
<h3>General<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h3>
<p>Q: What is Open vSwitch?</p>
<blockquote>
<div><p>A: Open vSwitch is a production quality open source software switch
designed to be used as a vswitch in virtualized server environments.  A
vswitch forwards traffic between different VMs on the same physical host
and also forwards traffic between VMs and the physical network.  Open
vSwitch supports standard management interfaces (e.g. sFlow, NetFlow,
IPFIX, RSPAN, CLI), and is open to programmatic extension and control using
OpenFlow and the OVSDB management protocol.</p>
<p>Open vSwitch as designed to be compatible with modern switching chipsets.
This means that it can be ported to existing high-fanout switches allowing
the same flexible control of the physical infrastructure as the virtual
infrastructure.  It also means that Open vSwitch will be able to take
advantage of on-NIC switching chipsets as their functionality matures.</p>
</div></blockquote>
<p>Q: What virtualization platforms can use Open vSwitch?</p>
<blockquote>
<div>A: Open vSwitch can currently run on any Linux-based virtualization
platform (kernel 3.10 and newer), including: KVM, VirtualBox, Xen, Xen
Cloud Platform, XenServer. As of Linux 3.3 it is part of the mainline
kernel.  The bulk of the code is written in platform- independent C and is
easily ported to other environments.  We welcome inquires about integrating
Open vSwitch with other virtualization platforms.</div></blockquote>
<p>Q: How can I try Open vSwitch?</p>
<blockquote>
<div><p>A: The Open vSwitch source code can be built on a Linux system.  You can
build and experiment with Open vSwitch on any Linux machine.  Packages for
various Linux distributions are available on many platforms, including:
Debian, Ubuntu, Fedora.</p>
<p>You may also download and run a virtualization platform that already has
Open vSwitch integrated.  For example, download a recent ISO for XenServer
or Xen Cloud Platform.  Be aware that the version integrated with a
particular platform may not be the most recent Open vSwitch release.</p>
</div></blockquote>
<p>Q: Does Open vSwitch only work on Linux?</p>
<blockquote>
<div><p>A: No, Open vSwitch has been ported to a number of different operating
systems and hardware platforms.  Most of the development work occurs on
Linux, but the code should be portable to any POSIX system.  We&#8217;ve seen
Open vSwitch ported to a number of different platforms, including FreeBSD,
Windows, and even non-POSIX embedded systems.</p>
<p>By definition, the Open vSwitch Linux kernel module only works on Linux and
will provide the highest performance.  However, a userspace datapath is
available that should be very portable.</p>
</div></blockquote>
<p>Q: What&#8217;s involved with porting Open vSwitch to a new platform or switching ASIC?</p>
<blockquote>
<div>A: <a class="reference internal" href="contents.html#document-topics/porting"><em>Porting Open vSwitch to New Software or Hardware</em></a> describes how one would go about porting Open
vSwitch to a new operating system or hardware platform.</div></blockquote>
<p>Q: Why would I use Open vSwitch instead of the Linux bridge?</p>
<blockquote>
<div>A: Open vSwitch is specially designed to make it easier to manage VM
network configuration and monitor state spread across many physical hosts
in dynamic virtualized environments.  Refer to <a class="reference internal" href="contents.html#document-intro/why-ovs"><em>Why Open vSwitch?</em></a> for a
more detailed description of how Open vSwitch relates to the Linux Bridge.</div></blockquote>
<p>Q: How is Open vSwitch related to distributed virtual switches like the VMware
vNetwork distributed switch or the Cisco Nexus 1000V?</p>
<blockquote>
<div><p>A: Distributed vswitch applications (e.g., VMware vNetwork distributed
switch, Cisco Nexus 1000V) provide a centralized way to configure and
monitor the network state of VMs that are spread across many physical
hosts.  Open vSwitch is not a distributed vswitch itself, rather it runs on
each physical host and supports remote management in a way that makes it
easier for developers of virtualization/cloud management platforms to offer
distributed vswitch capabilities.</p>
<p>To aid in distribution, Open vSwitch provides two open protocols that are
specially designed for remote management in virtualized network
environments: OpenFlow, which exposes flow-based forwarding state, and the
OVSDB management protocol, which exposes switch port state.  In addition to
the switch implementation itself, Open vSwitch includes tools (ovs-ofctl,
ovs-vsctl) that developers can script and extend to provide distributed
vswitch capabilities that are closely integrated with their virtualization
management platform.</p>
</div></blockquote>
<p>Q: Why doesn&#8217;t Open vSwitch support distribution?</p>
<blockquote>
<div>A: Open vSwitch is intended to be a useful component for building flexible
network infrastructure. There are many different approaches to distribution
which balance trade-offs between simplicity, scalability, hardware
compatibility, convergence times, logical forwarding model, etc. The goal
of Open vSwitch is to be able to support all as a primitive building block
rather than choose a particular point in the distributed design space.</div></blockquote>
<p>Q: How can I contribute to the Open vSwitch Community?</p>
<blockquote>
<div>A: You can start by joining the mailing lists and helping to answer
questions.  You can also suggest improvements to documentation.  If you
have a feature or bug you would like to work on, send a mail to one of the
<a class="reference internal" href="contents.html#document-internals/mailing-lists"><em>mailing lists</em></a>.</div></blockquote>
<p>Q: Why can I no longer connect to my OpenFlow controller or OVSDB manager?</p>
<blockquote>
<div>A: Starting in OVS 2.4, we switched the default ports to the IANA-specified
port numbers for OpenFlow (6633-&gt;6653) and OVSDB (6632-&gt;6640).  We
recommend using these port numbers, but if you cannot, all the programs
allow overriding the default port.  See the appropriate man page.</div></blockquote>
</div>
<span id="document-faq/issues"></span><div class="section" id="common-configuration-issues">
<h3>Common Configuration Issues<a class="headerlink" href="#common-configuration-issues" title="Permalink to this headline">¶</a></h3>
<p>Q: I created a bridge and added my Ethernet port to it, using commands like
these:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 eth0
</pre></div>
</div>
<p>and as soon as I ran the &#8220;add-port&#8221; command I lost all connectivity through
eth0.  Help!</p>
<blockquote>
<div><p>A: A physical Ethernet device that is part of an Open vSwitch bridge should
not have an IP address.  If one does, then that IP address will not be
fully functional.</p>
<p>You can restore functionality by moving the IP address to an Open vSwitch
&#8220;internal&#8221; device, such as the network device named after the bridge
itself.  For example, assuming that eth0&#8217;s IP address is 192.168.128.5, you
could run the commands below to fix up the situation:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ifconfig eth0 0.0.0.0
$ ifconfig br0 192.168.128.5
</pre></div>
</div>
<p>(If your only connection to the machine running OVS is through the IP
address in question, then you would want to run all of these commands on a
single command line, or put them into a script.)  If there were any
additional routes assigned to eth0, then you would also want to use
commands to adjust these routes to go through br0.</p>
<p>If you use DHCP to obtain an IP address, then you should kill the DHCP
client that was listening on the physical Ethernet interface (e.g. eth0)
and start one listening on the internal interface (e.g. br0).  You might
still need to manually clear the IP address from the physical interface
(e.g. with &#8220;ifconfig eth0 0.0.0.0&#8221;).</p>
<p>There is no compelling reason why Open vSwitch must work this way.
However, this is the way that the Linux kernel bridge module has always
worked, so it&#8217;s a model that those accustomed to Linux bridging are already
used to.  Also, the model that most people expect is not implementable
without kernel changes on all the versions of Linux that Open vSwitch
supports.</p>
<p>By the way, this issue is not specific to physical Ethernet devices.  It
applies to all network devices except Open vSwitch &#8220;internal&#8221; devices.</p>
</div></blockquote>
<p>Q: I created a bridge and added a couple of Ethernet ports to it, using
commands like these:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 eth0
$ ovs-vsctl add-port br0 eth1
</pre></div>
</div>
<p>and now my network seems to have melted: connectivity is unreliable (even
connectivity that doesn&#8217;t go through Open vSwitch), all the LEDs on my physical
switches are blinking, wireshark shows duplicated packets, and CPU usage is
very high.</p>
<blockquote>
<div><p>A: More than likely, you&#8217;ve looped your network.  Probably, eth0 and eth1
are connected to the same physical Ethernet switch.  This yields a scenario
where OVS receives a broadcast packet on eth0 and sends it out on eth1,
then the physical switch connected to eth1 sends the packet back on eth0,
and so on forever.  More complicated scenarios, involving a loop through
multiple switches, are possible too.</p>
<p>The solution depends on what you are trying to do:</p>
<ul>
<li><p class="first">If you added eth0 and eth1 to get higher bandwidth or higher reliability
between OVS and your physical Ethernet switch, use a bond.  The following
commands create br0 and then add eth0 and eth1 as a bond:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl add-bond br0 bond0 eth0 eth1
</pre></div>
</div>
<p>Bonds have tons of configuration options.  Please read the documentation
on the Port table in ovs-vswitchd.conf.db(5) for all the details.</p>
<p>Configuration for DPDK-enabled interfaces is slightly less
straightforward. Refer to <a class="reference internal" href="contents.html#document-intro/install/dpdk"><em>Open vSwitch with DPDK</em></a> for more
information.</p>
</li>
<li><p class="first">Perhaps you don&#8217;t actually need eth0 and eth1 to be on the same bridge.
For example, if you simply want to be able to connect each of them to
virtual machines, then you can put each of them on a bridge of its own:</p>
<blockquote>
<div><p>$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 eth0</p>
<p>$ ovs-vsctl add-br br1
$ ovs-vsctl add-port br1 eth1</p>
</div></blockquote>
<p>and then connect VMs to br0 and br1.  (A potential disadvantage is that
traffic cannot directly pass between br0 and br1.  Instead, it will go
out eth0 and come back in eth1, or vice versa.)</p>
</li>
<li><p class="first">If you have a redundant or complex network topology and you want to
prevent loops, turn on spanning tree protocol (STP).  The following
commands create br0, enable STP, and add eth0 and eth1 to the bridge.
The order is important because you don&#8217;t want have to have a loop in your
network even transiently:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl set bridge br0 stp_enable=true
$ ovs-vsctl add-port br0 eth0
$ ovs-vsctl add-port br0 eth1
</pre></div>
</div>
<p>The Open vSwitch implementation of STP is not well tested.  Report any
bugs you observe, but if you&#8217;d rather avoid acting as a beta tester then
another option might be your best shot.</p>
</li>
</ul>
</div></blockquote>
<p>Q: I can&#8217;t seem to use Open vSwitch in a wireless network.</p>
<blockquote>
<div><p>A: Wireless base stations generally only allow packets with the source MAC
address of NIC that completed the initial handshake.  Therefore, without
MAC rewriting, only a single device can communicate over a single wireless
link.</p>
<p>This isn&#8217;t specific to Open vSwitch, it&#8217;s enforced by the access point, so
the same problems will show up with the Linux bridge or any other way to do
bridging.</p>
</div></blockquote>
<p>Q: I can&#8217;t seem to add my PPP interface to an Open vSwitch bridge.</p>
<blockquote>
<div>A: PPP most commonly carries IP packets, but Open vSwitch works only with
Ethernet frames.  The correct way to interface PPP to an Ethernet network
is usually to use routing instead of switching.</div></blockquote>
<p>Q: Is there any documentation on the database tables and fields?</p>
<blockquote>
<div>A: Yes.  ovs-vswitchd.conf.db(5) is a comprehensive reference.</div></blockquote>
<p>Q: When I run ovs-dpctl I no longer see the bridges I created.  Instead, I only
see a datapath called &#8220;ovs-system&#8221;.  How can I see datapath information about a
particular bridge?</p>
<blockquote>
<div>A: In version 1.9.0, OVS switched to using a single datapath that is shared
by all bridges of that type.  The <code class="docutils literal"><span class="pre">ovs-appctl</span> <span class="pre">dpif/*</span></code> commands provide
similar functionality that is scoped by the bridge.</div></blockquote>
<p>Q: I created a GRE port using ovs-vsctl so why can&#8217;t I send traffic or see the
port in the datapath?</p>
<blockquote>
<div>A: On Linux kernels before 3.11, the OVS GRE module and Linux GRE module
cannot be loaded at the same time. It is likely that on your system the
Linux GRE module is already loaded and blocking OVS (to confirm, check
dmesg for errors regarding GRE registration). To fix this, unload all GRE
modules that appear in lsmod as well as the OVS kernel module. You can then
reload the OVS module following the directions in
<a class="reference internal" href="contents.html#document-intro/install/general"><em>Open vSwitch on Linux, FreeBSD and NetBSD</em></a> , which will ensure that dependencies are
satisfied.</div></blockquote>
<p>Q: Open vSwitch does not seem to obey my packet filter rules.</p>
<blockquote>
<div><p>A: It depends on mechanisms and configurations you want to use.</p>
<p>You cannot usefully use typical packet filters, like iptables, on physical
Ethernet ports that you add to an Open vSwitch bridge.  This is because
Open vSwitch captures packets from the interface at a layer lower below
where typical packet-filter implementations install their hooks.  (This
actually applies to any interface of type &#8220;system&#8221; that you might add to an
Open vSwitch bridge.)</p>
<p>You can usefully use typical packet filters on Open vSwitch internal ports
as they are mostly ordinary interfaces from the point of view of packet
filters.</p>
<p>For example, suppose you create a bridge br0 and add Ethernet port eth0 to
it.  Then you can usefully add iptables rules to affect the internal
interface br0, but not the physical interface eth0.  (br0 is also where you
would add an IP address, as discussed elsewhere in the FAQ.)</p>
<p>For simple filtering rules, it might be possible to achieve similar results
by installing appropriate OpenFlow flows instead.  The OVS conntrack
feature (see the &#8220;ct&#8221; action in ovs-ofctl(8)) can implement a stateful
firewall.</p>
<p>If the use of a particular packet filter setup is essential, Open vSwitch
might not be the best choice for you.  On Linux, you might want to consider
using the Linux Bridge.  (This is the only choice if you want to use
ebtables rules.)  On NetBSD, you might want to consider using the bridge(4)
with BRIDGE_IPF option.</p>
</div></blockquote>
<p>Q: It seems that Open vSwitch does nothing when I removed a port and then
immediately put it back.  For example, consider that p1 is a port of
<code class="docutils literal"><span class="pre">type=internal</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span> $ ovs-vsctl del-port br0 p1 -- \
     add-port br0 p1 -- \
     set interface p1 type=internal

A: It&#39;s an expected behaviour.

If del-port and add-port happen in a single OVSDB transaction as your
example, Open vSwitch always &quot;skips&quot; the intermediate steps.  Even if they
are done in multiple transactions, it&#39;s still allowed for Open vSwitch to
skip the intermediate steps and just implement the overall effect.  In both
cases, your example would be turned into a no-op.

If you want to make Open vSwitch actually destroy and then re-create the
port for some side effects like resetting kernel setting for the
corresponding interface, you need to separate operations into multiple
OVSDB transactions and ensure that at least the first one does not have
``--no-wait``.  In the following example, the first ovs-vsctl will block
until Open vSwitch reloads the new configuration and removes the port::

    $ ovs-vsctl del-port br0 p1
    $ ovs-vsctl add-port br0 p1 -- \
        set interface p1 type=internal
</pre></div>
</div>
<p>Q: I want to add thousands of ports to an Open vSwitch bridge, but it takes too
long (minutes or hours) to do it with ovs-vsctl.  How can I do it faster?</p>
<blockquote>
<div><p>A: If you add them one at a time with ovs-vsctl, it can take a long time to
add thousands of ports to an Open vSwitch bridge.  This is because every
invocation of ovs-vsctl first reads the current configuration from OVSDB.
As the number of ports grows, this starts to take an appreciable amount of
time, and when it is repeated thousands of times the total time becomes
significant.</p>
<p>The solution is to add the ports in one invocation of ovs-vsctl (or a small
number of them).  For example, using bash:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ cmds=; for i in {1..5000}; do cmds+=&quot; -- add-port br0 p$i&quot;; done
$ ovs-vsctl $cmds
</pre></div>
</div>
<p>takes seconds, not minutes or hours, in the OVS sandbox environment.</p>
</div></blockquote>
<p>Q: I created a bridge named br0.  My bridge shows up in &#8220;ovs-vsctl show&#8221;, but
&#8220;ovs-ofctl show br0&#8221; just prints &#8220;br0 is not a bridge or a socket&#8221;.</p>
<blockquote>
<div><p>A: Open vSwitch wasn&#8217;t able to create the bridge.  Check the ovs-vswitchd
log for details (Debian and Red Hat packaging for Open vSwitch put it in
/var/log/openvswitch/ovs-vswitchd.log).</p>
<p>In general, the Open vSwitch database reflects the desired configuration
state.  ovs-vswitchd monitors the database and, when it changes,
reconfigures the system to reflect the new desired state.  This normally
happens very quickly.  Thus, a discrepancy between the database and the
actual state indicates that ovs-vswitchd could not implement the
configuration, and so one should check the log to find out why.  (Another
possible cause is that ovs-vswitchd is not running.  This will make
ovs-vsctl commands hang, if they change the configuration, unless one
specifies <code class="docutils literal"><span class="pre">--no-wait</span></code>.)</p>
</div></blockquote>
<p>Q: I have a bridge br0.  I added a new port vif1.0, and it shows up in
&#8220;ovs-vsctl show&#8221;, but &#8220;ovs-vsctl list port&#8221; says that it has OpenFlow port
(&#8220;ofport&#8221;) -1, and &#8220;ovs-ofctl show br0&#8221; doesn&#8217;t show vif1.0 at all.</p>
<blockquote>
<div><p>A: Open vSwitch wasn&#8217;t able to create the port.  Check the ovs-vswitchd log
for details (Debian and Red Hat packaging for Open vSwitch put it in
/var/log/openvswitch/ovs-vswitchd.log).  Please see the previous question
for more information.</p>
<p>You may want to upgrade to Open vSwitch 2.3 (or later), in which ovs-vsctl
will immediately report when there is an issue creating a port.</p>
</div></blockquote>
<p>Q: I created a tap device tap0, configured an IP address on it, and added it to
a bridge, like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ tunctl -t tap0
$ ifconfig tap0 192.168.0.123
$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 tap0
</pre></div>
</div>
<p>I expected that I could then use this IP address to contact other hosts on the
network, but it doesn&#8217;t work.  Why not?</p>
<blockquote>
<div><p>A: The short answer is that this is a misuse of a &#8220;tap&#8221; device.  Use an
&#8220;internal&#8221; device implemented by Open vSwitch, which works differently and
is designed for this use.  To solve this problem with an internal device,
instead run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 int0 -- set Interface int0 type=internal
$ ifconfig int0 192.168.0.123
</pre></div>
</div>
<p>Even more simply, you can take advantage of the internal port that every
bridge has under the name of the bridge:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ifconfig br0 192.168.0.123
</pre></div>
</div>
<p>In more detail, a &#8220;tap&#8221; device is an interface between the Linux (or BSD)
network stack and a user program that opens it as a socket.  When the &#8220;tap&#8221;
device transmits a packet, it appears in the socket opened by the userspace
program.  Conversely, when the userspace program writes to the &#8220;tap&#8221;
socket, the kernel TCP/IP stack processes the packet as if it had been
received by the &#8220;tap&#8221; device.</p>
<p>Consider the configuration above.  Given this configuration, if you &#8220;ping&#8221;
an IP address in the 192.168.0.x subnet, the Linux kernel routing stack
will transmit an ARP on the tap0 device.  Open vSwitch userspace treats
&#8220;tap&#8221; devices just like any other network device; that is, it doesn&#8217;t open
them as &#8220;tap&#8221; sockets.  That means that the ARP packet will simply get
dropped.</p>
<p>You might wonder why the Open vSwitch kernel module doesn&#8217;t intercept the
ARP packet and bridge it.  After all, Open vSwitch intercepts packets on
other devices.  The answer is that Open vSwitch only intercepts <em>received</em>
packets, but this is a packet being transmitted.  The same thing happens
for all other types of network devices, except for Open vSwitch &#8220;internal&#8221;
ports.  If you, for example, add a physical Ethernet port to an OVS bridge,
configure an IP address on a physical Ethernet port, and then issue a
&#8220;ping&#8221; to an address in that subnet, the same thing happens: an ARP gets
transmitted on the physical Ethernet port and Open vSwitch never sees it.
(You should not do that, as documented at the beginning of this section.)</p>
<p>It can make sense to add a &#8220;tap&#8221; device to an Open vSwitch bridge, if some
userspace program (other than Open vSwitch) has opened the tap socket.
This is the case, for example, if the &#8220;tap&#8221; device was created by KVM (or
QEMU) to simulate a virtual NIC.  In such a case, when OVS bridges a packet
to the &#8220;tap&#8221; device, the kernel forwards that packet to KVM in userspace,
which passes it along to the VM, and in the other direction, when the VM
sends a packet, KVM writes it to the &#8220;tap&#8221; socket, which causes OVS to
receive it and bridge it to the other OVS ports.  Please note that in such
a case no IP address is configured on the &#8220;tap&#8221; device (there is normally
an IP address configured in the virtual NIC inside the VM, but this is not
visible to the host Linux kernel or to Open vSwitch).</p>
<p>There is one special case in which Open vSwitch does directly read and
write &#8220;tap&#8221; sockets.  This is an implementation detail of the Open vSwitch
userspace switch, which implements its &#8220;internal&#8221; ports as Linux (or BSD)
&#8220;tap&#8221; sockets.  In such a userspace switch, OVS receives packets sent on
the &#8220;tap&#8221; device used to implement an &#8220;internal&#8221; port by reading the
associated &#8220;tap&#8221; socket, and bridges them to the rest of the switch.  In
the other direction, OVS transmits packets bridged to the &#8220;internal&#8221; port
by writing them to the &#8220;tap&#8221; socket, causing them to be processed by the
kernel TCP/IP stack as if they had been received on the &#8220;tap&#8221; device.
Users should not need to be concerned with this implementation detail.</p>
<p>Open vSwitch has a network device type called &#8220;tap&#8221;.  This is intended only
for implementing &#8220;internal&#8221; ports in the OVS userspace switch and should
not be used otherwise.  In particular, users should not configure KVM &#8220;tap&#8221;
devices as type &#8220;tap&#8221; (use type &#8220;system&#8221;, the default, instead).</p>
</div></blockquote>
<p>Q: I observe packet loss at the beginning of RFC2544 tests on a server running
few hundred container apps bridged to OVS with traffic generated by HW traffic
generator.  How can I fix this?</p>
<blockquote>
<div><p>A: This is expected behavior on virtual switches.  RFC2544 tests were
designed for hardware switches, which don&#8217;t have caches on the fastpath
that need to be heated.  Traffic generators in order to prime the switch
use learning phase to heat the caches before sending the actual traffic in
test phase.  In case of OVS the cache is flushed quickly and to accommodate
the traffic generator&#8217;s delay between learning and test phase, the max-idle
timeout settings should be changed to 50000 ms.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl --no-wait set Open_vSwitch . other_config:max-idle=50000
</pre></div>
</div>
</div></blockquote>
<p>Q: How can I configure the bridge internal interface MTU? Why does Open vSwitch
keep changing internal ports MTU?</p>
<blockquote>
<div><p>A: By default Open vSwitch overrides the internal interfaces (e.g. br0)
MTU.  If you have just an internal interface (e.g. br0) and a physical
interface (e.g. eth0), then every change in MTU to eth0 will be reflected
to br0.  Any manual MTU configuration using <cite>ip</cite> or <cite>ifconfig</cite> on internal
interfaces is going to be overridden by Open vSwitch to match the current
bridge minimum.</p>
<p>Sometimes this behavior is not desirable, for example with tunnels.  The
MTU of an internal interface can be explicitly set using the following
command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set int br0 mtu_request=1450
</pre></div>
</div>
<p>After this, Open vSwitch will configure br0 MTU to 1450.  Since this
setting is in the database it will be persistent (compared to what happens
with <cite>ip</cite> or <cite>ifconfig</cite>).</p>
<p>The MTU configuration can be removed to restore the default behavior
with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set int br0 mtu_request=[]
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">mtu_request</span></code> column can be used to configure MTU even for physical
interfaces (e.g. eth0).</p>
</div></blockquote>
<p>Q: I just upgraded and I see a performance drop.  Why?</p>
<blockquote>
<div><p>A: The OVS kernel datapath may have been updated to a newer version than
the OVS userspace components.  Sometimes new versions of OVS kernel module
add functionality that is backwards compatible with older userspace
components but may cause a drop in performance with them.  Especially, if a
kernel module from OVS 2.1 or newer is paired with OVS userspace 1.10 or
older, there will be a performance drop for TCP traffic.</p>
<p>Updating the OVS userspace components to the latest released version should
fix the performance degradation.</p>
<p>To get the best possible performance and functionality, it is recommended
to pair the same versions of the kernel module and OVS userspace.</p>
</div></blockquote>
</div>
<span id="document-faq/openflow"></span><div class="section" id="using-openflow">
<h3>Using OpenFlow<a class="headerlink" href="#using-openflow" title="Permalink to this headline">¶</a></h3>
<p>Q: What versions of OpenFlow does Open vSwitch support?</p>
<blockquote>
<div><p>A: The following table lists the versions of OpenFlow supported by each
version of Open vSwitch:</p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Open vSwitch</th>
<th class="head">OF1.0</th>
<th class="head">OF1.1</th>
<th class="head">OF1.2</th>
<th class="head">OF1.3</th>
<th class="head">OF1.4</th>
<th class="head">OF1.5</th>
<th class="head">OF1.6</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1.9 and earlier</td>
<td>yes</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
</tr>
<tr class="row-odd"><td>1.10</td>
<td>yes</td>
<td>&#8212;</td>
<td>(*)</td>
<td>(*)</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
</tr>
<tr class="row-even"><td>1.11</td>
<td>yes</td>
<td>&#8212;</td>
<td>(*)</td>
<td>(*)</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
</tr>
<tr class="row-odd"><td>2.0</td>
<td>yes</td>
<td>(*)</td>
<td>(*)</td>
<td>(*)</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
</tr>
<tr class="row-even"><td>2.1</td>
<td>yes</td>
<td>(*)</td>
<td>(*)</td>
<td>(*)</td>
<td>&#8212;</td>
<td>&#8212;</td>
<td>&#8212;</td>
</tr>
<tr class="row-odd"><td>2.2</td>
<td>yes</td>
<td>(*)</td>
<td>(*)</td>
<td>(*)</td>
<td>(%)</td>
<td>(*)</td>
<td>&#8212;</td>
</tr>
<tr class="row-even"><td>2.3</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>(*)</td>
<td>(*)</td>
<td>&#8212;</td>
</tr>
<tr class="row-odd"><td>2.4</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>(*)</td>
<td>(*)</td>
<td>&#8212;</td>
</tr>
<tr class="row-even"><td>2.5</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>(*)</td>
<td>(*)</td>
<td>(*)</td>
</tr>
</tbody>
</table>
<p>(*) Supported, with one or more missing features.
(%) Experimental, unsafe implementation.</p>
<p>Open vSwitch 2.3 enables OpenFlow 1.0, 1.1, 1.2, and 1.3 by default in
ovs-vswitchd.  In Open vSwitch 1.10 through 2.2, OpenFlow 1.1, 1.2, and 1.3
must be enabled manually in ovs-vswitchd.</p>
<p>Some versions of OpenFlow are supported with missing features and therefore
not enabled by default: OpenFlow 1.4 and 1.5, in Open vSwitch 2.3 and
later, as well as OpenFlow 1.6 in Open vSwitch 2.5 and later.  Also, the
OpenFlow 1.6 specification is still under development and thus subject to
change.</p>
<p>In any case, the user may override the default:</p>
<ul>
<li><p class="first">To enable OpenFlow 1.0, 1.1, 1.2, and 1.3 on bridge br0:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set bridge br0 \
    protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13
</pre></div>
</div>
</li>
<li><p class="first">To enable OpenFlow 1.0, 1.1, 1.2, 1.3, 1.4, and 1.5 on bridge br0:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set bridge br0 \
    protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15
</pre></div>
</div>
</li>
<li><p class="first">To enable only OpenFlow 1.0 on bridge br0:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set bridge br0 protocols=OpenFlow10
</pre></div>
</div>
</li>
</ul>
<p>All current versions of ovs-ofctl enable only OpenFlow 1.0 by default.  Use
the -O option to enable support for later versions of OpenFlow in
ovs-ofctl.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl -O OpenFlow13 dump-flows br0
</pre></div>
</div>
<p>(Open vSwitch 2.2 had an experimental implementation of OpenFlow 1.4 that
could cause crashes.  We don&#8217;t recommend enabling it.)</p>
<p><a class="reference internal" href="contents.html#document-topics/openflow"><em>OpenFlow Support in Open vSwitch</em></a> tracks support for OpenFlow 1.1 and later features.
When support for OpenFlow 1.4 and 1.5 is solidly implemented, Open vSwitch
will enable those version by default.</p>
</div></blockquote>
<p>Q: Does Open vSwitch support MPLS?</p>
<blockquote>
<div><p>A: Before version 1.11, Open vSwitch did not support MPLS.  That is, these
versions can match on MPLS Ethernet types, but they cannot match, push, or
pop MPLS labels, nor can they look past MPLS labels into the encapsulated
packet.</p>
<p>Open vSwitch versions 1.11, 2.0, and 2.1 have very minimal support for
MPLS.  With the userspace datapath only, these versions can match, push, or
pop a single MPLS label, but they still cannot look past MPLS labels (even
after popping them) into the encapsulated packet.  Kernel datapath support
is unchanged from earlier versions.</p>
<p>Open vSwitch version 2.3 can match, push, or pop a single MPLS label and
look past the MPLS label into the encapsulated packet.  Both userspace and
kernel datapaths will be supported, but MPLS processing always happens in
userspace either way, so kernel datapath performance will be disappointing.</p>
<p>Open vSwitch version 2.4 can match, push, or pop up to 3 MPLS labels and
look past the MPLS label into the encapsulated packet.  It will have kernel
support for MPLS, yielding improved performance.</p>
</div></blockquote>
<p>Q: I&#8217;m getting &#8220;error type 45250 code 0&#8221;.  What&#8217;s that?</p>
<blockquote>
<div><p>A: This is a Open vSwitch extension to OpenFlow error codes.  Open vSwitch
uses this extension when it must report an error to an OpenFlow controller
but no standard OpenFlow error code is suitable.</p>
<p>Open vSwitch logs the errors that it sends to controllers, so the easiest
thing to do is probably to look at the ovs-vswitchd log to find out what
the error was.</p>
<p>If you want to dissect the extended error message yourself, the format is
documented in include/openflow/nicira-ext.h in the Open vSwitch source
distribution.  The extended error codes are documented in
include/openvswitch/ofp-errors.h.</p>
</div></blockquote>
<p>Q: Some of the traffic that I&#8217;d expect my OpenFlow controller to see doesn&#8217;t
actually appear through the OpenFlow connection, even though I know that it&#8217;s
going through.</p>
<blockquote>
<div><p>A: By default, Open vSwitch assumes that OpenFlow controllers are connected
&#8220;in-band&#8221;, that is, that the controllers are actually part of the network
that is being controlled.  In in-band mode, Open vSwitch sets up special
&#8220;hidden&#8221; flows to make sure that traffic can make it back and forth between
OVS and the controllers.  These hidden flows are higher priority than any
flows that can be set up through OpenFlow, and they are not visible through
normal OpenFlow flow table dumps.</p>
<p>Usually, the hidden flows are desirable and helpful, but occasionally they
can cause unexpected behavior.  You can view the full OpenFlow flow table,
including hidden flows, on bridge br0 with the command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-appctl bridge/dump-flows br0
</pre></div>
</div>
<p>to help you debug.  The hidden flows are those with priorities
greater than 65535 (the maximum priority that can be set with
OpenFlow).</p>
<p>The <code class="docutils literal"><span class="pre">Documentation/topics/design</span></code> doc describes the in-band model in
detail.</p>
<p>If your controllers are not actually in-band (e.g. they are on
localhost via 127.0.0.1, or on a separate network), then you should
configure your controllers in &#8220;out-of-band&#8221; mode.  If you have one
controller on bridge br0, then you can configure out-of-band mode
on it with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set controller br0 connection-mode=out-of-band
</pre></div>
</div>
</div></blockquote>
<p>Q: Some of the OpenFlow flows that my controller sets up don&#8217;t seem to apply to
certain traffic, especially traffic between OVS and the controller itself.</p>
<blockquote>
<div>A: See above.</div></blockquote>
<p>Q: I configured all my controllers for out-of-band control mode but &#8220;ovs-appctl
bridge/dump-flows&#8221; still shows some hidden flows.</p>
<blockquote>
<div><p>A: You probably have a remote manager configured (e.g. with &#8220;ovs-vsctl
set-manager&#8221;).  By default, Open vSwitch assumes that managers need in-band
rules set up on every bridge.  You can disable these rules on bridge br0
with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set bridge br0 other-config:disable-in-band=true
</pre></div>
</div>
<p>This actually disables in-band control entirely for the bridge, as if all
the bridge&#8217;s controllers were configured for out-of-band control.</p>
</div></blockquote>
<p>Q: My OpenFlow controller doesn&#8217;t see the VLANs that I expect.</p>
<blockquote>
<div>A: See answer under &#8220;VLANs&#8221;, above.</div></blockquote>
<p>Q: I ran <code class="docutils literal"><span class="pre">ovs-ofctl</span> <span class="pre">add-flow</span> <span class="pre">br0</span> <span class="pre">nw_dst=192.168.0.1,actions=drop</span></code> but I got a
funny message like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ofp_util|INFO|normalization changed ofp_match, details:
ofp_util|INFO| pre: nw_dst=192.168.0.1
ofp_util|INFO|post:
</pre></div>
</div>
<p>and when I ran <code class="docutils literal"><span class="pre">ovs-ofctl</span> <span class="pre">dump-flows</span> <span class="pre">br0</span></code> I saw that my nw_dst match had
disappeared, so that the flow ends up matching every packet.</p>
<blockquote>
<div><p>A: The term &#8220;normalization&#8221; in the log message means that a flow cannot
match on an L3 field without saying what L3 protocol is in use.  The
&#8220;ovs-ofctl&#8221; command above didn&#8217;t specify an L3 protocol, so the L3 field
match was dropped.</p>
<p>In this case, the L3 protocol could be IP or ARP.  A correct command for
each possibility is, respectively:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 ip,nw_dst=192.168.0.1,actions=drop
</pre></div>
</div>
<p>and:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 arp,nw_dst=192.168.0.1,actions=drop
</pre></div>
</div>
<p>Similarly, a flow cannot match on an L4 field without saying what L4
protocol is in use.  For example, the flow match <code class="docutils literal"><span class="pre">tp_src=1234</span></code> is, by
itself, meaningless and will be ignored.  Instead, to match TCP source port
1234, write <code class="docutils literal"><span class="pre">tcp,tp_src=1234</span></code>, or to match UDP source port 1234, write
<code class="docutils literal"><span class="pre">udp,tp_src=1234</span></code>.</p>
</div></blockquote>
<p>Q: How can I figure out the OpenFlow port number for a given port?</p>
<blockquote>
<div><p>A: The <code class="docutils literal"><span class="pre">OFPT_FEATURES_REQUEST</span></code> message requests an OpenFlow switch to
respond with an <code class="docutils literal"><span class="pre">OFPT_FEATURES_REPLY</span></code> that, among other information,
includes a mapping between OpenFlow port names and numbers.  From a command
prompt, <code class="docutils literal"><span class="pre">ovs-ofctl</span> <span class="pre">show</span> <span class="pre">br0</span></code> makes such a request and prints the response
for switch br0.</p>
<p>The Interface table in the Open vSwitch database also maps OpenFlow port
names to numbers.  To print the OpenFlow port number associated with
interface eth0, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl get Interface eth0 ofport
</pre></div>
</div>
<p>You can print the entire mapping with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl -- --columns=name,ofport list Interface
</pre></div>
</div>
<p>but the output mixes together interfaces from all bridges in the database,
so it may be confusing if more than one bridge exists.</p>
<p>In the Open vSwitch database, ofport value <code class="docutils literal"><span class="pre">-1</span></code> means that the interface
could not be created due to an error.  (The Open vSwitch log should
indicate the reason.)  ofport value <code class="docutils literal"><span class="pre">[]</span></code> (the empty set) means that the
interface hasn&#8217;t been created yet.  The latter is normally an intermittent
condition (unless ovs-vswitchd is not running).</p>
</div></blockquote>
<p>Q: I added some flows with my controller or with ovs-ofctl, but when I run
&#8220;ovs-dpctl dump-flows&#8221; I don&#8217;t see them.</p>
<blockquote>
<div>A: ovs-dpctl queries a kernel datapath, not an OpenFlow switch.  It won&#8217;t
display the information that you want.  You want to use <code class="docutils literal"><span class="pre">ovs-ofctl</span>
<span class="pre">dump-flows</span></code> instead.</div></blockquote>
<p>Q: It looks like each of the interfaces in my bonded port shows up as an
individual OpenFlow port.  Is that right?</p>
<blockquote>
<div><p>A: Yes, Open vSwitch makes individual bond interfaces visible as OpenFlow
ports, rather than the bond as a whole.  The interfaces are treated
together as a bond for only a few purposes:</p>
<ul class="simple">
<li>Sending a packet to the OFPP_NORMAL port.  (When an OpenFlow controller
is not configured, this happens implicitly to every packet.)</li>
<li>Mirrors configured for output to a bonded port.</li>
</ul>
<p>It would make a lot of sense for Open vSwitch to present a bond as a single
OpenFlow port.  If you want to contribute an implementation of such a
feature, please bring it up on the Open vSwitch development mailing list at
<a class="reference external" href="mailto:dev&#37;&#52;&#48;openvswitch&#46;org">dev<span>&#64;</span>openvswitch<span>&#46;</span>org</a>.</p>
</div></blockquote>
<p>Q: I have a sophisticated network setup involving Open vSwitch, VMs or multiple
hosts, and other components.  The behavior isn&#8217;t what I expect.  Help!</p>
<blockquote>
<div><p>A: To debug network behavior problems, trace the path of a packet,
hop-by-hop, from its origin in one host to a remote host.  If that&#8217;s
correct, then trace the path of the response packet back to the origin.</p>
<p>The open source tool called <code class="docutils literal"><span class="pre">plotnetcfg</span></code> can help to understand the
relationship between the networking devices on a single host.</p>
<p>Usually a simple ICMP echo request and reply (<code class="docutils literal"><span class="pre">ping</span></code>) packet is good
enough.  Start by initiating an ongoing <code class="docutils literal"><span class="pre">ping</span></code> from the origin host to a
remote host.  If you are tracking down a connectivity problem, the &#8220;ping&#8221;
will not display any successful output, but packets are still being sent.
(In this case the packets being sent are likely ARP rather than ICMP.)</p>
<p>Tools available for tracing include the following:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">tcpdump</span></code> and <code class="docutils literal"><span class="pre">wireshark</span></code> for observing hops across network devices,
such as Open vSwitch internal devices and physical wires.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">ovs-appctl</span> <span class="pre">dpif/dump-flows</span> <span class="pre">&lt;br&gt;</span></code> in Open vSwitch 1.10 and later or
<code class="docutils literal"><span class="pre">ovs-dpctl</span> <span class="pre">dump-flows</span> <span class="pre">&lt;br&gt;</span></code> in earlier versions.  These tools allow one
to observe the actions being taken on packets in ongoing flows.</p>
<p>See ovs-vswitchd(8) for <code class="docutils literal"><span class="pre">ovs-appctl</span> <span class="pre">dpif/dump-flows</span></code> documentation,
ovs-dpctl(8) for <code class="docutils literal"><span class="pre">ovs-dpctl</span> <span class="pre">dump-flows</span></code> documentation, and &#8220;Why are
there so many different ways to dump flows?&#8221; above for some background.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">ovs-appctl</span> <span class="pre">ofproto/trace</span></code> to observe the logic behind how ovs-vswitchd
treats packets.  See ovs-vswitchd(8) for documentation.  You can out more
details about a given flow that <code class="docutils literal"><span class="pre">ovs-dpctl</span> <span class="pre">dump-flows</span></code> displays, by
cutting and pasting a flow from the output into an <code class="docutils literal"><span class="pre">ovs-appctl</span>
<span class="pre">ofproto/trace</span></code> command.</p>
</li>
<li><p class="first">SPAN, RSPAN, and ERSPAN features of physical switches, to observe what
goes on at these physical hops.</p>
</li>
</ul>
<p>Starting at the origin of a given packet, observe the packet at each hop in
turn.  For example, in one plausible scenario, you might:</p>
<ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">tcpdump</span></code> the <code class="docutils literal"><span class="pre">eth</span></code> interface through which an ARP egresses a VM,
from inside the VM.</li>
<li><code class="docutils literal"><span class="pre">tcpdump</span></code> the <code class="docutils literal"><span class="pre">vif</span></code> or <code class="docutils literal"><span class="pre">tap</span></code> interface through which the ARP
ingresses the host machine.</li>
<li>Use <code class="docutils literal"><span class="pre">ovs-dpctl</span> <span class="pre">dump-flows</span></code> to spot the ARP flow and observe the host
interface through which the ARP egresses the physical machine.  You may
need to use <code class="docutils literal"><span class="pre">ovs-dpctl</span> <span class="pre">show</span></code> to interpret the port numbers.  If the
output seems surprising, you can use <code class="docutils literal"><span class="pre">ovs-appctl</span> <span class="pre">ofproto/trace</span></code> to
observe details of how ovs-vswitchd determined the actions in the
<code class="docutils literal"><span class="pre">ovs-dpctl</span> <span class="pre">dump-flows</span></code> output.</li>
<li><code class="docutils literal"><span class="pre">tcpdump</span></code> the <code class="docutils literal"><span class="pre">eth</span></code> interface through which the ARP egresses the
physical machine.</li>
<li><code class="docutils literal"><span class="pre">tcpdump</span></code> the <code class="docutils literal"><span class="pre">eth</span></code> interface through which the ARP ingresses the
physical machine, at the remote host that receives the ARP.</li>
<li>Use <code class="docutils literal"><span class="pre">ovs-dpctl</span> <span class="pre">dump-flows</span></code> to spot the ARP flow on the remote host
remote host that receives the ARP and observe the VM <code class="docutils literal"><span class="pre">vif</span></code> or <code class="docutils literal"><span class="pre">tap</span></code>
interface to which the flow is directed.  Again, <code class="docutils literal"><span class="pre">ovs-dpctl</span> <span class="pre">show</span></code> and
<code class="docutils literal"><span class="pre">ovs-appctl</span> <span class="pre">ofproto/trace</span></code> might help.</li>
<li><code class="docutils literal"><span class="pre">tcpdump</span></code> the <code class="docutils literal"><span class="pre">vif</span></code> or <code class="docutils literal"><span class="pre">tap</span></code> interface to which the ARP is
directed.</li>
<li><code class="docutils literal"><span class="pre">tcpdump</span></code> the <code class="docutils literal"><span class="pre">eth</span></code> interface through which the ARP ingresses a VM,
from inside the VM.</li>
</ol>
<p>It is likely that during one of these steps you will figure out the
problem.  If not, then follow the ARP reply back to the origin, in reverse.</p>
</div></blockquote>
<p>Q: How do I make a flow drop packets?</p>
<blockquote>
<div><p>A: To drop a packet is to receive it without forwarding it.  OpenFlow
explicitly specifies forwarding actions.  Thus, a flow with an empty set of
actions does not forward packets anywhere, causing them to be dropped.  You
can specify an empty set of actions with <code class="docutils literal"><span class="pre">actions=</span></code> on the ovs-ofctl
command line.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 priority=65535,actions=
</pre></div>
</div>
<p>would cause every packet entering switch br0 to be dropped.</p>
<p>You can write &#8220;drop&#8221; explicitly if you like.  The effect is the same.
Thus, the following command also causes every packet entering switch br0 to
be dropped:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 priority=65535,actions=drop
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">drop</span></code> is not an action, either in OpenFlow or Open vSwitch.  Rather, it
is only a way to say that there are no actions.</p>
</div></blockquote>
<p>Q: I added a flow to send packets out the ingress port, like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 in_port=2,actions=2
</pre></div>
</div>
<p>but OVS drops the packets instead.</p>
<blockquote>
<div><p>A: Yes, OpenFlow requires a switch to ignore attempts to send a packet out
its ingress port.  The rationale is that dropping these packets makes it
harder to loop the network.  Sometimes this behavior can even be
convenient, e.g. it is often the desired behavior in a flow that forwards a
packet to several ports (&#8220;floods&#8221; the packet).</p>
<p>Sometimes one really needs to send a packet out its ingress port
(&#8220;hairpin&#8221;). In this case, output to <code class="docutils literal"><span class="pre">OFPP_IN_PORT</span></code>, which in ovs-ofctl
syntax is expressed as just <code class="docutils literal"><span class="pre">in_port</span></code>, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 in_port=2,actions=in_port
</pre></div>
</div>
<p>This also works in some circumstances where the flow doesn&#8217;t match on the
input port.  For example, if you know that your switch has five ports
numbered 2 through 6, then the following will send every received packet
out every port, even its ingress port:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 actions=2,3,4,5,6,in_port
</pre></div>
</div>
<p>or, equivalently:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 actions=all,in_port
</pre></div>
</div>
<p>Sometimes, in complicated flow tables with multiple levels of <code class="docutils literal"><span class="pre">resubmit</span></code>
actions, a flow needs to output to a particular port that may or may not be
the ingress port.  It&#8217;s difficult to take advantage of <code class="docutils literal"><span class="pre">OFPP_IN_PORT</span></code> in
this situation.  To help, Open vSwitch provides, as an OpenFlow extension,
the ability to modify the in_port field.  Whatever value is currently in
the in_port field is the port to which outputs will be dropped, as well as
the destination for <code class="docutils literal"><span class="pre">OFPP_IN_PORT</span></code>.  This means that the following will
reliably output to port 2 or to ports 2 through 6, respectively:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 in_port=2,actions=load:0-&gt;NXM_OF_IN_PORT[],2
$ ovs-ofctl add-flow br0 actions=load:0-&gt;NXM_OF_IN_PORT[],2,3,4,5,6
</pre></div>
</div>
<p>If the input port is important, then one may save and restore it on the
stack:</p>
<blockquote>
<div><dl class="docutils">
<dt>$ ovs-ofctl add-flow br0 actions=push:NXM_OF_IN_PORT[],</dt>
<dd>load:0-&gt;NXM_OF_IN_PORT[],2,3,4,5,6,pop:NXM_OF_IN_PORT[]</dd>
</dl>
</div></blockquote>
</div></blockquote>
<p>Q: My bridge br0 has host 192.168.0.1 on port 1 and host 192.168.0.2 on port 2.
I set up flows to forward only traffic destined to the other host and drop
other traffic, like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>priority=5,in_port=1,ip,nw_dst=192.168.0.2,actions=2
priority=5,in_port=2,ip,nw_dst=192.168.0.1,actions=1
priority=0,actions=drop
</pre></div>
</div>
<p>But it doesn&#8217;t work&#8211;I don&#8217;t get any connectivity when I do this.  Why?</p>
<blockquote>
<div><p>A: These flows drop the ARP packets that IP hosts use to establish IP
connectivity over Ethernet.  To solve the problem, add flows to allow ARP
to pass between the hosts:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">priority</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">in_port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">arp</span><span class="p">,</span><span class="n">actions</span><span class="o">=</span><span class="mi">2</span>
<span class="n">priority</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">in_port</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">arp</span><span class="p">,</span><span class="n">actions</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>This issue can manifest other ways, too.  The following flows that match on
Ethernet addresses instead of IP addresses will also drop ARP packets,
because ARP requests are broadcast instead of being directed to a specific
host:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>priority=5,in_port=1,dl_dst=54:00:00:00:00:02,actions=2
priority=5,in_port=2,dl_dst=54:00:00:00:00:01,actions=1
priority=0,actions=drop
</pre></div>
</div>
<p>The solution already described above will also work in this case.  It may
be better to add flows to allow all multicast and broadcast traffic:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>priority=5,in_port=1,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00,actions=2
priority=5,in_port=2,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00,actions=1
</pre></div>
</div>
</div></blockquote>
<p>Q: My bridge disconnects from my controller on add-port/del-port.</p>
<blockquote>
<div><p>A: Reconfiguring your bridge can change your bridge&#8217;s datapath-id because
Open vSwitch generates datapath-id from the MAC address of one of its
ports.  In that case, Open vSwitch disconnects from controllers because
there&#8217;s no graceful way to notify controllers about the change of
datapath-id.</p>
<p>To avoid the behaviour, you can configure datapath-id manually.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set bridge br0 other-config:datapath-id=0123456789abcdef
</pre></div>
</div>
</div></blockquote>
<p>Q: My controller complains that OVS is not buffering packets.
What&#8217;s going on?</p>
<blockquote>
<div>A: &#8220;Packet buffering&#8221; is an optional OpenFlow feature, and controllers
should detect how many &#8220;buffers&#8221; an OpenFlow switch implements.  It was
recently noticed that OVS implementation of the buffering feature was not
compliant to OpenFlow specifications.  Rather than fix it and risk
controller incompatibility, the buffering feature is removed as of OVS 2.7.
Controllers are already expected to work properly in cases where the switch
can not buffer packets, but sends full packets in &#8220;packet-in&#8221; messages
instead, so this change should not affect existing users.  After the change
OVS always sends the <code class="docutils literal"><span class="pre">buffer_id</span></code> as <code class="docutils literal"><span class="pre">0xffffffff</span></code> in &#8220;packet-in&#8221;
messages and will send an error response if any other value of this field
is included in a &#8220;packet-out&#8221; or a &#8220;flow mod&#8221; sent by a controller.</div></blockquote>
<p>Q: How does OVS divide flows among buckets in an OpenFlow &#8220;select&#8221; group?</p>
<blockquote>
<div><p>A: In Open vSwitch 2.3 and earlier, Open vSwitch used the destination
Ethernet address to choose a bucket in a select group.</p>
<p>Open vSwitch 2.4 and later by default hashes the source and destination
Ethernet address, VLAN ID, Ethernet type, IPv4/v6 source and destination
address and protocol, and for TCP and SCTP only, the source and destination
ports.  The hash is &#8220;symmetric&#8221;, meaning that exchanging source and
destination addresses does not change the bucket selection.</p>
<p>Select groups in Open vSwitch 2.4 and later can be configured to use a
different hash function, using a Netronome extension to the OpenFlow 1.5+
group_mod message.  For more information, see
Documentation/group-selection-method-property.txt in the Open vSwitch
source tree.  (OpenFlow 1.5 support in Open vSwitch is still experimental.)</p>
</div></blockquote>
<p>Q: I added a flow to accept packets on VLAN 123 and output them on VLAN 456,
like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 dl_vlan=123,actions=output:1,mod_vlan_vid:456
</pre></div>
</div>
<p>but the packets are actually being output in VLAN 123.  Why?</p>
<blockquote>
<div><p>A: OpenFlow actions are executed in the order specified.  Thus, the actions
above first output the packet, then change its VLAN.  Since the output
occurs before changing the VLAN, the change in VLAN will have no visible
effect.</p>
<p>To solve this and similar problems, order actions so that changes to
headers happen before output, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 dl_vlan=123,actions=mod_vlan_vid:456,output:1
</pre></div>
</div>
</div></blockquote>
<p>Q: The &#8220;learn&#8221; action can&#8217;t learn the action I want, can you improve it?</p>
<blockquote>
<div><p>A: By itself, the &#8220;learn&#8221; action can only put two kinds of actions into the
flows that it creates: &#8220;load&#8221; and &#8220;output&#8221; actions.  If &#8220;learn&#8221; is used in
isolation, these are severe limits.</p>
<p>However, &#8220;learn&#8221; is not meant to be used in isolation.  It is a primitive
meant to be used together with other Open vSwitch features to accomplish a
task.  Its existing features are enough to accomplish most tasks.</p>
<p>Here is an outline of a typical pipeline structure that allows for
versatile behavior using &#8220;learn&#8221;:</p>
<ul class="simple">
<li>Flows in table A contain a &#8220;learn&#8221; action, that populates flows in table
L, that use a &#8220;load&#8221; action to populate register R with information about
what was learned.</li>
<li>Flows in table B contain two sequential resubmit actions: one to table L
and another one to table B+1.</li>
<li>Flows in table B+1 match on register R and act differently depending on
what the flows in table L loaded into it.</li>
</ul>
<p>This approach can be used to implement many &#8220;learn&#8221;-based features.  For
example:</p>
<ul class="simple">
<li>Resubmit to a table selected based on learned information, e.g. see:
<a class="reference external" href="https://mail.openvswitch.org/pipermail/ovs-discuss/2016-June/021694.html">https://mail.openvswitch.org/pipermail/ovs-discuss/2016-June/021694.html</a></li>
<li>MAC learning in the middle of a pipeline, as described in
<a class="reference internal" href="contents.html#document-tutorials/ovs-advanced"><em>Open vSwitch Advanced Features</em></a></li>
<li>TCP state based firewalling, by learning outgoing connections based on
SYN packets and matching them up with incoming packets.</li>
<li>At least some of the features described in T. A. Hoff, &#8220;Extending Open
vSwitch to Facilitate Creation of Stateful SDN Applications&#8221;.</li>
</ul>
</div></blockquote>
<p>Q: When using the &#8220;ct&#8221; action with FTP connections, it doesn&#8217;t seem to matter
if I set the &#8220;alg=ftp&#8221; parameter in the action. Is this required?</p>
<blockquote>
<div>A: It is advisable to use this option. Some platforms may automatically
detect and apply ALGs in the &#8220;ct&#8221; action regardless of the parameters you
provide, however this is not consistent across all implementations. The
<a class="reference external" href="http://openvswitch.org/support/dist-docs/ovs-ofctl.8.html">ovs-ofctl(8)</a>
man pages contain further details in the description of the ALG parameter.</div></blockquote>
</div>
<span id="document-faq/qos"></span><div class="section" id="quality-of-service-qos">
<h3>Quality of Service (QoS)<a class="headerlink" href="#quality-of-service-qos" title="Permalink to this headline">¶</a></h3>
<p>Q: Does OVS support Quality of Service (QoS)?</p>
<blockquote>
<div><p>A: Yes.  For traffic that egresses from a switch, OVS supports traffic
shaping; for traffic that ingresses into a switch, OVS support policing.
Policing is a simple form of quality-of-service that simply drops packets
received in excess of the configured rate.  Due to its simplicity, policing
is usually less accurate and less effective than egress traffic shaping,
which queues packets.</p>
<p>Keep in mind that ingress and egress are from the perspective of the
switch.  That means that egress shaping limits the rate at which traffic is
allowed to transmit from a physical interface, but not the rate at which
traffic will be received on a virtual machine&#8217;s VIF.  For ingress policing,
the behavior is the opposite.</p>
</div></blockquote>
<p>Q: How do I configure egress traffic shaping?</p>
<blockquote>
<div><p>A: Suppose that you want to set up bridge br0 connected to physical
Ethernet port eth0 (a 1 Gbps device) and virtual machine interfaces vif1.0
and vif2.0, and that you want to limit traffic from vif1.0 to eth0 to 10
Mbps and from vif2.0 to eth0 to 20 Mbps.  Then, you could configure the
bridge this way:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl -- \
  add-br br0 -- \
  add-port br0 eth0 -- \
  add-port br0 vif1.0 -- set interface vif1.0 ofport_request=5 -- \
  add-port br0 vif2.0 -- set interface vif2.0 ofport_request=6 -- \
  set port eth0 qos=@newqos -- \
  --id=@newqos create qos type=linux-htb \
      other-config:max-rate=1000000000 \
      queues:123=@vif10queue \
      queues:234=@vif20queue -- \
  --id=@vif10queue create queue other-config:max-rate=10000000 -- \
  --id=@vif20queue create queue other-config:max-rate=20000000
</pre></div>
</div>
<p>At this point, bridge br0 is configured with the ports and eth0 is
configured with the queues that you need for QoS, but nothing is actually
directing packets from vif1.0 or vif2.0 to the queues that we have set up
for them.  That means that all of the packets to eth0 are going to the
&#8220;default queue&#8221;, which is not what we want.</p>
<p>We use OpenFlow to direct packets from vif1.0 and vif2.0 to the queues
reserved for them:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-ofctl add-flow br0 in_port=5,actions=set_queue:123,normal
$ ovs-ofctl add-flow br0 in_port=6,actions=set_queue:234,normal
</pre></div>
</div>
<p>Each of the above flows matches on the input port, sets up the appropriate
queue (123 for vif1.0, 234 for vif2.0), and then executes the &#8220;normal&#8221;
action, which performs the same switching that Open vSwitch would have done
without any OpenFlow flows being present.  (We know that vif1.0 and vif2.0
have OpenFlow port numbers 5 and 6, respectively, because we set their
ofport_request columns above.  If we had not done that, then we would have
needed to find out their port numbers before setting up these flows.)</p>
<p>Now traffic going from vif1.0 or vif2.0 to eth0 should be rate-limited.</p>
<p>By the way, if you delete the bridge created by the above commands, with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl del-br br0
</pre></div>
</div>
<p>then that will leave one unreferenced QoS record and two unreferenced Queue
records in the Open vSwich database.  One way to clear them out, assuming
you don&#8217;t have other QoS or Queue records that you want to keep, is:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl -- --all destroy QoS -- --all destroy Queue
</pre></div>
</div>
<p>If you do want to keep some QoS or Queue records, or the Open vSwitch you
are using is older than version 1.8 (which added the <code class="docutils literal"><span class="pre">--all</span></code> option),
then you will have to destroy QoS and Queue records individually.</p>
</div></blockquote>
<p>Q: How do I configure ingress policing?</p>
<blockquote>
<div><p>A: A policing policy can be configured on an interface to drop packets that
arrive at a higher rate than the configured value.  For example, the
following commands will rate-limit traffic that vif1.0 may generate to
10Mbps:</p>
<blockquote>
<div>$ ovs-vsctl set interface vif1.0 ingress_policing_rate=10000
$ ovs-vsctl set interface vif1.0 ingress_policing_burst=8000</div></blockquote>
<p>Traffic policing can interact poorly with some network protocols and can
have surprising results.  The &#8220;Ingress Policing&#8221; section of
ovs-vswitchd.conf.db(5) discusses the issues in greater detail.</p>
</div></blockquote>
<p>Q: I configured Quality of Service (QoS) in my OpenFlow network by adding
records to the QoS and Queue table, but the results aren&#8217;t what I expect.</p>
<blockquote>
<div><p>A: Did you install OpenFlow flows that use your queues?  This is the
primary way to tell Open vSwitch which queues you want to use.  If you
don&#8217;t do this, then the default queue will be used, which will probably not
have the effect you want.</p>
<p>Refer to the previous question for an example.</p>
</div></blockquote>
<p>Q: I&#8217;d like to take advantage of some QoS feature that Open vSwitch doesn&#8217;t yet
support.  How do I do that?</p>
<blockquote>
<div>A: Open vSwitch does not implement QoS itself.  Instead, it can configure
some, but not all, of the QoS features built into the Linux kernel.  If you
need some QoS feature that OVS cannot configure itself, then the first step
is to figure out whether Linux QoS supports that feature.  If it does, then
you can submit a patch to support Open vSwitch configuration for that
feature, or you can use &#8220;tc&#8221; directly to configure the feature in Linux.
(If Linux QoS doesn&#8217;t support the feature you want, then first you have to
add that support to Linux.)</div></blockquote>
<p>Q: I configured QoS, correctly, but my measurements show that it isn&#8217;t working
as well as I expect.</p>
<blockquote>
<div><p>A: With the Linux kernel, the Open vSwitch implementation of QoS has two
aspects:</p>
<ul>
<li><p class="first">Open vSwitch configures a subset of Linux kernel QoS features, according
to what is in OVSDB.  It is possible that this code has bugs.  If you
believe that this is so, then you can configure the Linux traffic control
(QoS) stack directly with the &#8220;tc&#8221; program.  If you get better results
that way, you can send a detailed bug report to <a class="reference external" href="mailto:bugs&#37;&#52;&#48;openvswitch&#46;org">bugs<span>&#64;</span>openvswitch<span>&#46;</span>org</a>.</p>
<p>It is certain that Open vSwitch cannot configure every Linux kernel QoS
feature.  If you need some feature that OVS cannot configure, then you
can also use &#8220;tc&#8221; directly (or add that feature to OVS).</p>
</li>
<li><p class="first">The Open vSwitch implementation of OpenFlow allows flows to be directed
to particular queues.  This is pretty simple and unlikely to have serious
bugs at this point.</p>
</li>
</ul>
<p>However, most problems with QoS on Linux are not bugs in Open vSwitch at
all.  They tend to be either configuration errors (please see the earlier
questions in this section) or issues with the traffic control (QoS) stack
in Linux.  The Open vSwitch developers are not experts on Linux traffic
control.  We suggest that, if you believe you are encountering a problem
with Linux traffic control, that you consult the tc manpages (e.g. tc(8),
tc-htb(8), tc-hfsc(8)), web resources (e.g. <a class="reference external" href="http://lartc.org/">http://lartc.org/</a>), or mailing
lists (e.g. <a class="reference external" href="http://vger.kernel.org/vger-lists.html#netdev">http://vger.kernel.org/vger-lists.html#netdev</a>).</p>
</div></blockquote>
<p>Q: Does Open vSwitch support OpenFlow meters?</p>
<blockquote>
<div>A: Since version 2.0, Open vSwitch has OpenFlow protocol support for
OpenFlow meters.  There is no implementation of meters in the Open vSwitch
software switch (neither the kernel-based nor userspace switches).</div></blockquote>
</div>
<span id="document-faq/releases"></span><div class="section" id="releases">
<h3>Releases<a class="headerlink" href="#releases" title="Permalink to this headline">¶</a></h3>
<p>Q: What does it mean for an Open vSwitch release to be LTS (long-term support)?</p>
<blockquote>
<div><p>A: All official releases have been through a comprehensive testing process
and are suitable for production use.  Planned releases occur twice a year.
If a significant bug is identified in an LTS release, we will provide an
updated release that includes the fix.  Releases that are not LTS may not
be fixed and may just be supplanted by the next major release.  The current
LTS release is 2.5.x.</p>
<p>For more information on the Open vSwitch release process, refer to
<a class="reference internal" href="contents.html#document-internals/release-process"><em>Open vSwitch Release Process</em></a>.</p>
</div></blockquote>
<p>Q: What Linux kernel versions does each Open vSwitch release work with?</p>
<blockquote>
<div><p>A: The following table lists the Linux kernel versions against which the
given versions of the Open vSwitch kernel module will successfully build.
The Linux kernel versions are upstream kernel versions, so Linux kernels
modified from the upstream sources may not build in some cases even if they
are based on a supported version.  This is most notably true of Red Hat
Enterprise Linux (RHEL) kernels, which are extensively modified from
upstream.</p>
<table border="1" class="docutils">
<colgroup>
<col width="46%" />
<col width="54%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Open vSwitch</th>
<th class="head">Linux kernel</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1.4.x</td>
<td>2.6.18 to 3.2</td>
</tr>
<tr class="row-odd"><td>1.5.x</td>
<td>2.6.18 to 3.2</td>
</tr>
<tr class="row-even"><td>1.6.x</td>
<td>2.6.18 to 3.2</td>
</tr>
<tr class="row-odd"><td>1.7.x</td>
<td>2.6.18 to 3.3</td>
</tr>
<tr class="row-even"><td>1.8.x</td>
<td>2.6.18 to 3.4</td>
</tr>
<tr class="row-odd"><td>1.9.x</td>
<td>2.6.18 to 3.8</td>
</tr>
<tr class="row-even"><td>1.10.x</td>
<td>2.6.18 to 3.8</td>
</tr>
<tr class="row-odd"><td>1.11.x</td>
<td>2.6.18 to 3.8</td>
</tr>
<tr class="row-even"><td>2.0.x</td>
<td>2.6.32 to 3.10</td>
</tr>
<tr class="row-odd"><td>2.1.x</td>
<td>2.6.32 to 3.11</td>
</tr>
<tr class="row-even"><td>2.3.x</td>
<td>2.6.32 to 3.14</td>
</tr>
<tr class="row-odd"><td>2.4.x</td>
<td>2.6.32 to 4.0</td>
</tr>
<tr class="row-even"><td>2.5.x</td>
<td>2.6.32 to 4.3</td>
</tr>
<tr class="row-odd"><td>2.6.x</td>
<td>3.10 to 4.7</td>
</tr>
</tbody>
</table>
<p>Open vSwitch userspace should also work with the Linux kernel module built
into Linux 3.3 and later.</p>
<p>Open vSwitch userspace is not sensitive to the Linux kernel version.  It
should build against almost any kernel, certainly against 2.6.32 and later.</p>
</div></blockquote>
<p>Q: Are all features available with all datapaths?</p>
<blockquote>
<div><p>A: Open vSwitch supports different datapaths on different platforms.  Each
datapath has a different feature set: the following tables try to summarize
the status.</p>
<p>Supported datapaths:</p>
<dl class="docutils">
<dt>Linux upstream</dt>
<dd>The datapath implemented by the kernel module shipped with Linux
upstream.  Since features have been gradually introduced into the kernel,
the table mentions the first Linux release whose OVS module supports the
feature.</dd>
<dt>Linux OVS tree</dt>
<dd>The datapath implemented by the Linux kernel module distributed with the
OVS source tree.</dd>
<dt>Userspace</dt>
<dd>Also known as DPDK, dpif-netdev or dummy datapath. It is the only
datapath that works on NetBSD, FreeBSD and Mac OSX.</dd>
<dt>Hyper-V</dt>
<dd>Also known as the Windows datapath.</dd>
</dl>
<p>The following table lists the datapath supported features from an Open
vSwitch user&#8217;s perspective.</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="22%" />
<col width="22%" />
<col width="14%" />
<col width="11%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Feature</th>
<th class="head">Linux upstream</th>
<th class="head">Linux OVS tree</th>
<th class="head">Userspace</th>
<th class="head">Hyper-V</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>NAT</td>
<td>4.6</td>
<td>YES</td>
<td>NO</td>
<td>NO</td>
</tr>
<tr class="row-odd"><td>Connection tracking</td>
<td>4.3</td>
<td>YES</td>
<td>PARTIAL</td>
<td>PARTIAL</td>
</tr>
<tr class="row-even"><td>Tunnel - LISP</td>
<td>NO</td>
<td>YES</td>
<td>NO</td>
<td>NO</td>
</tr>
<tr class="row-odd"><td>Tunnel - STT</td>
<td>NO</td>
<td>YES</td>
<td>NO</td>
<td>YES</td>
</tr>
<tr class="row-even"><td>Tunnel - GRE</td>
<td>3.11</td>
<td>YES</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-odd"><td>Tunnel - VXLAN</td>
<td>3.12</td>
<td>YES</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-even"><td>Tunnel - Geneve</td>
<td>3.18</td>
<td>YES</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-odd"><td>Tunnel - GRE-IPv6</td>
<td>NO</td>
<td>NO</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-even"><td>Tunnel - VXLAN-IPv6</td>
<td>4.3</td>
<td>YES</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-odd"><td>Tunnel - Geneve-IPv6</td>
<td>4.4</td>
<td>YES</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-even"><td>QoS - Policing</td>
<td>YES</td>
<td>YES</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-odd"><td>QoS - Shaping</td>
<td>YES</td>
<td>YES</td>
<td>NO</td>
<td>NO</td>
</tr>
<tr class="row-even"><td>sFlow</td>
<td>YES</td>
<td>YES</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-odd"><td>IPFIX</td>
<td>3.10</td>
<td>YES</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-even"><td>Set action</td>
<td>YES</td>
<td>YES</td>
<td>YES</td>
<td>PARTIAL</td>
</tr>
<tr class="row-odd"><td>NIC Bonding</td>
<td>YES</td>
<td>YES</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-even"><td>Multiple VTEPs</td>
<td>YES</td>
<td>YES</td>
<td>YES</td>
<td>YES</td>
</tr>
</tbody>
</table>
<p>Do note, however:</p>
<ul class="simple">
<li>Only a limited set of flow fields is modifiable via the set action by the
Hyper-V datapath.</li>
</ul>
<p>The following table lists features that do not <em>directly</em> impact an Open
vSwitch user, e.g. because their absence can be hidden by the ofproto layer
(usually this comes with a performance penalty).</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="22%" />
<col width="22%" />
<col width="14%" />
<col width="11%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Feature</th>
<th class="head">Linux upstream</th>
<th class="head">Linux OVS tree</th>
<th class="head">Userspace</th>
<th class="head">Hyper-V</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SCTP flows</td>
<td>3.12</td>
<td>YES</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-odd"><td>MPLS</td>
<td>3.19</td>
<td>YES</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-even"><td>UFID</td>
<td>4.0</td>
<td>YES</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-odd"><td>Megaflows</td>
<td>3.12</td>
<td>YES</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-even"><td>Masked set action</td>
<td>4.0</td>
<td>YES</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-odd"><td>Recirculation</td>
<td>3.19</td>
<td>YES</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-even"><td>TCP flags matching</td>
<td>3.13</td>
<td>YES</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-odd"><td>Validate flow actions</td>
<td>YES</td>
<td>YES</td>
<td>N/A</td>
<td>NO</td>
</tr>
<tr class="row-even"><td>Multiple datapaths</td>
<td>YES</td>
<td>YES</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-odd"><td>Tunnel TSO - STT</td>
<td>N/A</td>
<td>YES</td>
<td>NO</td>
<td>YES</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Q: What DPDK version does each Open vSwitch release work with?</p>
<blockquote>
<div><p>A: The following table lists the DPDK version against which the given
versions of Open vSwitch will successfully build.</p>
<table border="1" class="docutils">
<colgroup>
<col width="71%" />
<col width="29%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Open vSwitch</th>
<th class="head">DPDK</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2.2.x</td>
<td>1.6</td>
</tr>
<tr class="row-odd"><td>2.3.x</td>
<td>1.6</td>
</tr>
<tr class="row-even"><td>2.4.x</td>
<td>2.0</td>
</tr>
<tr class="row-odd"><td>2.5.x</td>
<td>2.2</td>
</tr>
<tr class="row-even"><td>2.6.x</td>
<td>16.07</td>
</tr>
<tr class="row-odd"><td>2.7.x</td>
<td>16.11</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Q: I get an error like this when I configure Open vSwitch:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>configure: error: Linux kernel in &lt;dir&gt; is version &lt;x&gt;, but
version newer than &lt;y&gt; is not supported (please refer to the
FAQ for advice)
</pre></div>
</div>
<p>What should I do?</p>
<blockquote>
<div><p>A: You have the following options:</p>
<ul class="simple">
<li>Use the Linux kernel module supplied with the kernel that you are using.
(See also the following FAQ.)</li>
<li>If there is a newer released version of Open vSwitch, consider building
that one, because it may support the kernel that you are building
against.  (To find out, consult the table in the previous FAQ.)</li>
<li>The Open vSwitch &#8220;master&#8221; branch may support the kernel that you are
using, so consider building the kernel module from &#8220;master&#8221;.</li>
</ul>
<p>All versions of Open vSwitch userspace are compatible with all versions of
the Open vSwitch kernel module, so you do not have to use the kernel module
from one source along with the userspace programs from the same source.</p>
</div></blockquote>
<p>Q: What features are not available in the Open vSwitch kernel datapath that
ships as part of the upstream Linux kernel?</p>
<blockquote>
<div><p>A: The kernel module in upstream Linux does not include support for LISP.
Work is in progress to add support for LISP to the upstream Linux version
of the Open vSwitch kernel module. For now, if you need this feature, use
the kernel module from the Open vSwitch distribution instead of the
upstream Linux kernel module.</p>
<p>Certain features require kernel support to function or to have reasonable
performance. If the ovs-vswitchd log file indicates that a feature is not
supported, consider upgrading to a newer upstream Linux release or using
the kernel module paired with the userspace distribution.</p>
</div></blockquote>
<p>Q: Why do tunnels not work when using a kernel module other than the one
packaged with Open vSwitch?</p>
<blockquote>
<div><p>A: Support for tunnels was added to the upstream Linux kernel module after
the rest of Open vSwitch. As a result, some kernels may contain support for
Open vSwitch but not tunnels. The minimum kernel version that supports each
tunnel protocol is:</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Protocol</th>
<th class="head">Linux Kernel</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>GRE</td>
<td>3.11</td>
</tr>
<tr class="row-odd"><td>VXLAN</td>
<td>3.12</td>
</tr>
<tr class="row-even"><td>Geneve</td>
<td>3.18</td>
</tr>
<tr class="row-odd"><td>LISP</td>
<td>not upstream</td>
</tr>
<tr class="row-even"><td>STT</td>
<td>not upstream</td>
</tr>
</tbody>
</table>
<p>If you are using a version of the kernel that is older than the one listed
above, it is still possible to use that tunnel protocol. However, you must
compile and install the kernel module included with the Open vSwitch
distribution rather than the one on your machine. If problems persist after
doing this, check to make sure that the module that is loaded is the one
you expect.</p>
</div></blockquote>
<p>Q: Why are UDP tunnel checksums not computed for VXLAN or Geneve?</p>
<blockquote>
<div>A: Generating outer UDP checksums requires kernel support that was not part
of the initial implementation of these protocols. If using the upstream
Linux Open vSwitch module, you must use kernel 4.0 or newer. The
out-of-tree modules from Open vSwitch release 2.4 and later support UDP
checksums.</div></blockquote>
<p>Q: What features are not available when using the userspace datapath?</p>
<blockquote>
<div>A: Tunnel virtual ports are not supported, as described in the previous
answer.  It is also not possible to use queue-related actions.  On Linux
kernels before 2.6.39, maximum-sized VLAN packets may not be transmitted.</div></blockquote>
<p>Q: Should userspace or kernel be upgraded first to minimize downtime?</p>
<blockquote>
<div>A. In general, the Open vSwitch userspace should be used with the kernel
version included in the same release or with the version from upstream
Linux.  However, when upgrading between two releases of Open vSwitch it is
best to migrate userspace first to reduce the possibility of
incompatibilities.</div></blockquote>
<p>Q: What happened to the bridge compatibility feature?</p>
<blockquote>
<div><p>A: Bridge compatibility was a feature of Open vSwitch 1.9 and earlier.
When it was enabled, Open vSwitch imitated the interface of the Linux
kernel &#8220;bridge&#8221; module.  This allowed users to drop Open vSwitch into
environments designed to use the Linux kernel bridge module without
adapting the environment to use Open vSwitch.</p>
<p>Open vSwitch 1.10 and later do not support bridge compatibility.  The
feature was dropped because version 1.10 adopted a new internal
architecture that made bridge compatibility difficult to maintain.  Now
that many environments use OVS directly, it would be rarely useful in any
case.</p>
<p>To use bridge compatibility, install OVS 1.9 or earlier, including the
accompanying kernel modules (both the main and bridge compatibility
modules), following the instructions that come with the release.  Be sure
to start the ovs-brcompatd daemon.</p>
</div></blockquote>
</div>
<span id="document-faq/terminology"></span><div class="section" id="terminology">
<h3>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h3>
<p>Q: I thought Open vSwitch was a virtual Ethernet switch, but the documentation
keeps talking about bridges.  What&#8217;s a bridge?</p>
<blockquote>
<div>A: In networking, the terms &#8220;bridge&#8221; and &#8220;switch&#8221; are synonyms.  Open
vSwitch implements an Ethernet switch, which means that it is also an
Ethernet bridge.</div></blockquote>
<p>Q: What&#8217;s a VLAN?</p>
<blockquote>
<div>A: See <a class="reference internal" href="contents.html#document-faq/vlan"><em>VLANs</em></a>.</div></blockquote>
</div>
<span id="document-faq/vlan"></span><div class="section" id="vlans">
<h3>VLANs<a class="headerlink" href="#vlans" title="Permalink to this headline">¶</a></h3>
<p>Q: What&#8217;s a VLAN?</p>
<blockquote>
<div><p>A: At the simplest level, a VLAN (short for &#8220;virtual LAN&#8221;) is a way to
partition a single switch into multiple switches.  Suppose, for example,
that you have two groups of machines, group A and group B.  You want the
machines in group A to be able to talk to each other, and you want the
machine in group B to be able to talk to each other, but you don&#8217;t want the
machines in group A to be able to talk to the machines in group B.  You can
do this with two switches, by plugging the machines in group A into one
switch and the machines in group B into the other switch.</p>
<p>If you only have one switch, then you can use VLANs to do the same thing,
by configuring the ports for machines in group A as VLAN &#8220;access ports&#8221; for
one VLAN and the ports for group B as &#8220;access ports&#8221; for a different VLAN.
The switch will only forward packets between ports that are assigned to the
same VLAN, so this effectively subdivides your single switch into two
independent switches, one for each group of machines.</p>
<p>So far we haven&#8217;t said anything about VLAN headers.  With access ports,
like we&#8217;ve described so far, no VLAN header is present in the Ethernet
frame.  This means that the machines (or switches) connected to access
ports need not be aware that VLANs are involved, just like in the case
where we use two different physical switches.</p>
<p>Now suppose that you have a whole bunch of switches in your network,
instead of just one, and that some machines in group A are connected
directly to both switches 1 and 2.  To allow these machines to talk to each
other, you could add an access port for group A&#8217;s VLAN to switch 1 and
another to switch 2, and then connect an Ethernet cable between those
ports.  That works fine, but it doesn&#8217;t scale well as the number of
switches and the number of VLANs increases, because you use up a lot of
valuable switch ports just connecting together your VLANs.</p>
<p>This is where VLAN headers come in.  Instead of using one cable and two
ports per VLAN to connect a pair of switches, we configure a port on each
switch as a VLAN &#8220;trunk port&#8221;.  Packets sent and received on a trunk port
carry a VLAN header that says what VLAN the packet belongs to, so that only
two ports total are required to connect the switches, regardless of the
number of VLANs in use.  Normally, only switches (either physical or
virtual) are connected to a trunk port, not individual hosts, because
individual hosts don&#8217;t expect to see a VLAN header in the traffic that they
receive.</p>
<p>None of the above discussion says anything about particular VLAN numbers.
This is because VLAN numbers are completely arbitrary.  One must only
ensure that a given VLAN is numbered consistently throughout a network and
that different VLANs are given different numbers.  (That said, VLAN 0 is
usually synonymous with a packet that has no VLAN header, and VLAN 4095 is
reserved.)</p>
</div></blockquote>
<p>Q: VLANs don&#8217;t work.</p>
<blockquote>
<div><p>A: Many drivers in Linux kernels before version 3.3 had VLAN-related bugs.
If you are having problems with VLANs that you suspect to be driver
related, then you have several options:</p>
<ul>
<li><p class="first">Upgrade to Linux 3.3 or later.</p>
</li>
<li><p class="first">Build and install a fixed version of the particular driver that is
causing trouble, if one is available.</p>
</li>
<li><p class="first">Use a NIC whose driver does not have VLAN problems.</p>
</li>
<li><p class="first">Use &#8220;VLAN splinters&#8221;, a feature in Open vSwitch 1.4 upto 2.5 that works
around bugs in kernel drivers.  To enable VLAN splinters on interface
eth0, use the command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl set interface eth0 other-config:enable-vlan-splinters=true
</pre></div>
</div>
<p>For VLAN splinters to be effective, Open vSwitch must know which VLANs
are in use.  See the &#8220;VLAN splinters&#8221; section in the Interface table in
ovs-vswitchd.conf.db(5) for details on how Open vSwitch infers in-use
VLANs.</p>
<p>VLAN splinters increase memory use and reduce performance, so use them
only if needed.</p>
</li>
<li><p class="first">Apply the &#8220;vlan workaround&#8221; patch from the XenServer kernel patch queue,
build Open vSwitch against this patched kernel, and then use
ovs-vlan-bug-workaround(8) to enable the VLAN workaround for each
interface whose driver is buggy.</p>
<p>(This is a nontrivial exercise, so this option is included only for
completeness.)</p>
</li>
</ul>
<p>It is not always easy to tell whether a Linux kernel driver has buggy VLAN
support.  The ovs-vlan-test(8) and ovs-test(8) utilities can help you test.
See their manpages for details.  Of the two utilities, ovs-test(8) is newer
and more thorough, but ovs-vlan-test(8) may be easier to use.</p>
</div></blockquote>
<p>Q: VLANs still don&#8217;t work.  I&#8217;ve tested the driver so I know that it&#8217;s OK.</p>
<blockquote>
<div>A: Do you have VLANs enabled on the physical switch that OVS is attached
to?  Make sure that the port is configured to trunk the VLAN or VLANs that
you are using with OVS.</div></blockquote>
<p>Q: Outgoing VLAN-tagged traffic goes through OVS to my physical switch
and to its destination host, but OVS seems to drop incoming return
traffic.</p>
<blockquote>
<div><p>A: It&#8217;s possible that you have the VLAN configured on your physical switch
as the &#8220;native&#8221; VLAN.  In this mode, the switch treats incoming packets
either tagged with the native VLAN or untagged as part of the native VLAN.
It may also send outgoing packets in the native VLAN without a VLAN tag.</p>
<p>If this is the case, you have two choices:</p>
<ul>
<li><p class="first">Change the physical switch port configuration to tag packets it forwards
to OVS with the native VLAN instead of forwarding them untagged.</p>
</li>
<li><p class="first">Change the OVS configuration for the physical port to a native VLAN mode.
For example, the following sets up a bridge with port eth0 in
&#8220;native-tagged&#8221; mode in VLAN 9:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0 $ ovs-vsctl add-port br0 eth0 tag=9
vlan_mode=native-tagged
</pre></div>
</div>
<p>In this situation, &#8220;native-untagged&#8221; mode will probably work equally
well.  Refer to the documentation for the Port table in
ovs-vswitchd.conf.db(5) for more information.</p>
</li>
</ul>
</div></blockquote>
<p>Q: I added a pair of VMs on different VLANs, like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 eth0
$ ovs-vsctl add-port br0 tap0 tag=9
$ ovs-vsctl add-port br0 tap1 tag=10
</pre></div>
</div>
<p>but the VMs can&#8217;t access each other, the external network, or the Internet.</p>
<blockquote>
<div><p>A: It is to be expected that the VMs can&#8217;t access each other.  VLANs are a
means to partition a network.  When you configured tap0 and tap1 as access
ports for different VLANs, you indicated that they should be isolated from
each other.</p>
<p>As for the external network and the Internet, it seems likely that the
machines you are trying to access are not on VLAN 9 (or 10) and that the
Internet is not available on VLAN 9 (or 10).</p>
</div></blockquote>
<p>Q: I added a pair of VMs on the same VLAN, like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 eth0
$ ovs-vsctl add-port br0 tap0 tag=9
$ ovs-vsctl add-port br0 tap1 tag=9
</pre></div>
</div>
<p>The VMs can access each other, but not the external network or the Internet.</p>
<blockquote>
<div>A: It seems likely that the machines you are trying to access in the
external network are not on VLAN 9 and that the Internet is not available
on VLAN 9.  Also, ensure VLAN 9 is set up as an allowed trunk VLAN on the
upstream switch port to which eth0 is connected.</div></blockquote>
<p>Q: Can I configure an IP address on a VLAN?</p>
<blockquote>
<div><p>A: Yes.  Use an &#8220;internal port&#8221; configured as an access port.  For example,
the following configures IP address 192.168.0.7 on VLAN 9.  That is, OVS
will forward packets from eth0 to 192.168.0.7 only if they have an 802.1Q
header with VLAN 9.  Conversely, traffic forwarded from 192.168.0.7 to eth0
will be tagged with an 802.1Q header with VLAN 9:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 eth0
$ ovs-vsctl add-port br0 vlan9 tag=9 \
    -- set interface vlan9 type=internal
$ ifconfig vlan9 192.168.0.7
</pre></div>
</div>
<p>See also the following question.</p>
</div></blockquote>
<p>Q: I configured one IP address on VLAN 0 and another on VLAN 9, like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 eth0
$ ifconfig br0 192.168.0.5
$ ovs-vsctl add-port br0 vlan9 tag=9 -- set interface vlan9 type=internal
$ ifconfig vlan9 192.168.0.9
</pre></div>
</div>
<p>but other hosts that are only on VLAN 0 can reach the IP address configured on
VLAN 9.  What&#8217;s going on?</p>
<blockquote>
<div><p>A: <a class="reference external" href="https://tools.ietf.org/html/rfc1122">RFC 1122 section 3.3.4.2 &#8220;Multihoming Requirements&#8221;</a> describes two approaches to IP
address handling in Internet hosts:</p>
<ul class="simple">
<li>In the &#8220;Strong ES Model&#8221;, where an ES is a host (&#8220;End System&#8221;), an IP
address is primarily associated with a particular interface.  The host
discards packets that arrive on interface A if they are destined for an
IP address that is configured on interface B.  The host never sends
packets from interface A using a source address configured on interface
B.</li>
<li>In the &#8220;Weak ES Model&#8221;, an IP address is primarily associated with a
host.  The host accepts packets that arrive on any interface if they are
destined for any of the host&#8217;s IP addresses, even if the address is
configured on some interface other than the one on which it arrived.  The
host does not restrict itself to sending packets from an IP address
associated with the originating interface.</li>
</ul>
<p>Linux uses the weak ES model.  That means that when packets destined to the
VLAN 9 IP address arrive on eth0 and are bridged to br0, the kernel IP
stack accepts them there for the VLAN 9 IP address, even though they were
not received on vlan9, the network device for vlan9.</p>
<p>To simulate the strong ES model on Linux, one may add iptables rule to
filter packets based on source and destination address and adjust ARP
configuration with sysctls.</p>
<p>BSD uses the strong ES model.</p>
</div></blockquote>
<p>Q: My OpenFlow controller doesn&#8217;t see the VLANs that I expect.</p>
<blockquote>
<div><p>A: The configuration for VLANs in the Open vSwitch database (e.g. via
ovs-vsctl) only affects traffic that goes through Open vSwitch&#8217;s
implementation of the OpenFlow &#8220;normal switching&#8221; action.  By default, when
Open vSwitch isn&#8217;t connected to a controller and nothing has been manually
configured in the flow table, all traffic goes through the &#8220;normal
switching&#8221; action.  But, if you set up OpenFlow flows on your own, through
a controller or using ovs-ofctl or through other means, then you have to
implement VLAN handling yourself.</p>
<p>You can use &#8220;normal switching&#8221; as a component of your OpenFlow actions,
e.g. by putting &#8220;normal&#8221; into the lists of actions on ovs-ofctl or by
outputting to OFPP_NORMAL from an OpenFlow controller.  In situations where
this is not suitable, you can implement VLAN handling yourself, e.g.:</p>
<ul class="simple">
<li>If a packet comes in on an access port, and the flow table needs to send
it out on a trunk port, then the flow can add the appropriate VLAN tag
with the &#8220;mod_vlan_vid&#8221; action.</li>
<li>If a packet comes in on a trunk port, and the flow table needs to send it
out on an access port, then the flow can strip the VLAN tag with the
&#8220;strip_vlan&#8221; action.</li>
</ul>
</div></blockquote>
<p>Q: I configured ports on a bridge as access ports with different VLAN tags,
like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl set-controller br0 tcp:192.168.0.10:6653
$ ovs-vsctl add-port br0 eth0
$ ovs-vsctl add-port br0 tap0 tag=9
$ ovs-vsctl add-port br0 tap1 tag=10
</pre></div>
</div>
<p>but the VMs running behind tap0 and tap1 can still communicate, that is, they
are not isolated from each other even though they are on different VLANs.</p>
<blockquote>
<div>A: Do you have a controller configured on br0 (as the commands above do)?
If so, then this is a variant on the previous question, &#8220;My OpenFlow
controller doesn&#8217;t see the VLANs that I expect,&#8221; and you can refer to the
answer there for more information.</div></blockquote>
<p>Q: How MAC learning works with VLANs?</p>
<blockquote>
<div>A: Open vSwitch implements Independent VLAN Learning (IVL) for
<code class="docutils literal"><span class="pre">OFPP_NORMAL</span></code> action, e.g. it logically has separate learning tables for
each VLANs.</div></blockquote>
</div>
<span id="document-faq/vxlan"></span><div class="section" id="vxlans">
<h3>VXLANs<a class="headerlink" href="#vxlans" title="Permalink to this headline">¶</a></h3>
<p>Q: What&#8217;s a VXLAN?</p>
<blockquote>
<div>A: VXLAN stands for Virtual eXtensible Local Area Network, and is a means
to solve the scaling challenges of VLAN networks in a multi-tenant
environment. VXLAN is an overlay network which transports an L2 network
over an existing L3 network. For more information on VXLAN, please see <a class="reference external" href="https://tools.ietf.org/html/rfc7348">RFC
7348</a>.</div></blockquote>
<p>Q: How much of the VXLAN protocol does Open vSwitch currently support?</p>
<blockquote>
<div>A: Open vSwitch currently supports the framing format for packets on the
wire. There is currently no support for the multicast aspects of VXLAN.  To
get around the lack of multicast support, it is possible to pre-provision
MAC to IP address mappings either manually or from a controller.</div></blockquote>
<p>Q: What destination UDP port does the VXLAN implementation in Open vSwitch
use?</p>
<blockquote>
<div><p>A: By default, Open vSwitch will use the assigned IANA port for VXLAN,
which is 4789. However, it is possible to configure the destination UDP
port manually on a per-VXLAN tunnel basis. An example of this configuration
is provided below.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ovs-vsctl add-br br0
$ ovs-vsctl add-port br0 vxlan1 -- set interface vxlan1 type=vxlan \
    options:remote_ip=192.168.1.2 options:key=flow options:dst_port=8472
</pre></div>
</div>
</div></blockquote>
</div>
</div>
</div>
<span id="document-internals/index"></span><div class="section" id="open-vswitch-internals">
<h2>Open vSwitch Internals<a class="headerlink" href="#open-vswitch-internals" title="Permalink to this headline">¶</a></h2>
<p>Information for people who want to know more about the Open vSwitch project
itself and how they might involved.</p>
<div class="toctree-wrapper compound">
<span id="document-internals/contributing/index"></span><div class="section" id="contributing-to-open-vswitch">
<h3>Contributing to Open vSwitch<a class="headerlink" href="#contributing-to-open-vswitch" title="Permalink to this headline">¶</a></h3>
<p>The below guides provide information on contributing to Open vSwitch itself.</p>
<div class="toctree-wrapper compound">
<span id="document-internals/contributing/submitting-patches"></span><div class="section" id="submitting-patches">
<h4>Submitting Patches<a class="headerlink" href="#submitting-patches" title="Permalink to this headline">¶</a></h4>
<p>Send changes to Open vSwitch as patches to <a class="reference external" href="mailto:dev&#37;&#52;&#48;openvswitch&#46;org">dev<span>&#64;</span>openvswitch<span>&#46;</span>org</a>.  One patch per
email.  More details are included below.</p>
<p>If you are using Git, then <cite>git format-patch</cite> takes care of most of the
mechanics described below for you.</p>
<div class="section" id="before-you-start">
<h5>Before You Start<a class="headerlink" href="#before-you-start" title="Permalink to this headline">¶</a></h5>
<p>Before you send patches at all, make sure that each patch makes sense.  In
particular:</p>
<ul class="simple">
<li>A given patch should not break anything, even if later patches fix the
problems that it causes.  The source tree should still build and work after
each patch is applied.  (This enables <cite>git bisect</cite> to work best.)</li>
<li>A patch should make one logical change.  Don&#8217;t make multiple, logically
unconnected changes to disparate subsystems in a single patch.</li>
<li>A patch that adds or removes user-visible features should also update the
appropriate user documentation or manpages.  Check &#8220;Feature Deprecation
Guidelines&#8221; section in this document if you intend to remove user-visible
feature.</li>
</ul>
<p>Testing is also important:</p>
<ul class="simple">
<li>A patch that modifies existing code should be tested with <code class="docutils literal"><span class="pre">make</span>
<span class="pre">check</span></code> before submission.  Refer to the <cite>install guide</cite>, under &#8220;Self-Tests&#8221;,
for more information.</li>
<li>A patch that adds or deletes files should also be tested with <code class="docutils literal"><span class="pre">make</span>
<span class="pre">distcheck</span></code> before submission.</li>
<li>A patch that modifies Linux kernel code should be at least build-tested on
various Linux kernel versions before submission.  I suggest versions 3.10 and
whatever the current latest release version is at the time.</li>
<li>A patch that modifies the ofproto or vswitchd code should be tested in at
least simple cases before submission.</li>
<li>A patch that modifies xenserver code should be tested on XenServer before
submission.</li>
</ul>
<p>If you are using GitHub, then you may utilize the travis-ci.org CI build system
by linking your GitHub repository to it. This will run some of the above tests
automatically when you push changes to your repository.  See the &#8220;Continuous
Integration with Travis-CI&#8221; in the <cite>install guide</cite> for details on how to set it
up.</p>
</div>
<div class="section" id="email-subject">
<h5>Email Subject<a class="headerlink" href="#email-subject" title="Permalink to this headline">¶</a></h5>
<p>The subject line of your email should be in the following format:</p>
<blockquote>
<div>[PATCH &lt;n&gt;/&lt;m&gt;] &lt;area&gt;: &lt;summary&gt;</div></blockquote>
<p>Where:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">[PATCH</span> <span class="pre">&lt;n&gt;/&lt;m&gt;]</span></code>:</dt>
<dd>indicates that this is the nth of a series of m patches.  It helps reviewers
to read patches in the correct order.  You may omit this prefix if you are
sending only one patch.</dd>
<dt><code class="docutils literal"><span class="pre">&lt;area&gt;</span></code>:</dt>
<dd>indicates the area of the Open vSwitch to which the change applies (often the
name of a source file or a directory).  You may omit it if the change crosses
multiple distinct pieces of code.</dd>
</dl>
<p><code class="docutils literal"><span class="pre">&lt;summary&gt;</span></code>:</p>
<blockquote>
<div>briefly describes the change.  Use the the imperative form,
e.g. &#8220;Force SNAT for multiple gateway routers.&#8221; or &#8220;Fix daemon exit
for bad datapaths or flows.&#8221;  Try to keep the summary short, about
50 characters wide.</div></blockquote>
<p>The subject, minus the <code class="docutils literal"><span class="pre">[PATCH</span> <span class="pre">&lt;n&gt;/&lt;m&gt;]</span></code> prefix, becomes the first line of
the commit&#8217;s change log message.</p>
</div>
<div class="section" id="description">
<h5>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h5>
<p>The body of the email should start with a more thorough description of the
change.  This becomes the body of the commit message, following the subject.
There is no need to duplicate the summary given in the subject.</p>
<p>Please limit lines in the description to 75 characters in width.  That
allows the description to format properly even when indented (e.g. by
&#8220;git log&#8221; or in email quotations).</p>
<p>The description should include:</p>
<ul class="simple">
<li>The rationale for the change.</li>
<li>Design description and rationale (but this might be better added as code
comments).</li>
<li>Testing that you performed (or testing that should be done but you could not
for whatever reason).</li>
<li>Tags (see below).</li>
</ul>
<p>There is no need to describe what the patch actually changed, if the reader can
see it for himself.</p>
<p>If the patch refers to a commit already in the Open vSwitch repository, please
include both the commit number and the subject of the patch, e.g. &#8216;commit
632d136c (vswitch: Remove restriction on datapath names.)&#8217;.</p>
<p>If you, the person sending the patch, did not write the patch yourself, then
the very first line of the body should take the form <code class="docutils literal"><span class="pre">From:</span> <span class="pre">&lt;author</span> <span class="pre">name&gt;</span>
<span class="pre">&lt;author</span> <span class="pre">email&gt;</span></code>, followed by a blank line.  This will automatically cause the
named author to be credited with authorship in the repository.</p>
</div>
<div class="section" id="tags">
<h5>Tags<a class="headerlink" href="#tags" title="Permalink to this headline">¶</a></h5>
<p>The description ends with a series of tags, written one to a line as the last
paragraph of the email.  Each tag indicates some property of the patch in an
easily machine-parseable manner.</p>
<p>Examples of common tags follow.</p>
<p><code class="docutils literal"><span class="pre">Signed-off-by:</span> <span class="pre">Author</span> <span class="pre">Name</span> <span class="pre">&lt;author.name&#64;email.address...&gt;</span></code></p>
<blockquote>
<div><p>Informally, this indicates that Author Name is the author or submitter of a
patch and has the authority to submit it under the terms of the license.  The
formal meaning is to agree to the Developer&#8217;s Certificate of Origin (see
below).</p>
<p>If the author and submitter are different, each must sign off.  If the patch
has more than one author, all must sign off.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Signed-off-by: Author Name &lt;author.name@email.address...&gt;
Signed-off-by: Submitter Name &lt;submitter.name@email.address...&gt;
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">Co-authored-by:</span> <span class="pre">Author</span> <span class="pre">Name</span> <span class="pre">&lt;author.name&#64;email.address...&gt;</span></code></p>
<blockquote>
<div>Git can only record a single person as the author of a given patch.  In the
rare event that a patch has multiple authors, one must be given the credit in
Git and the others must be credited via Co-authored-by: tags.  (All
co-authors must also sign off.)</div></blockquote>
<p><code class="docutils literal"><span class="pre">Acked-by:</span> <span class="pre">Reviewer</span> <span class="pre">Name</span> <span class="pre">&lt;reviewer.name&#64;email.address...&gt;</span></code></p>
<blockquote>
<div><p>Reviewers will often give an <code class="docutils literal"><span class="pre">Acked-by:</span></code> tag to code of which they approve.
It is polite for the submitter to add the tag before posting the next version
of the patch or applying the patch to the repository.  Quality reviewing is
hard work, so this gives a small amount of credit to the reviewer.</p>
<p>Not all reviewers give <code class="docutils literal"><span class="pre">Acked-by:</span></code> tags when they provide positive reviews.
It&#8217;s customary only to add tags from reviewers who actually provide them
explicitly.</p>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">Tested-by:</span> <span class="pre">Tester</span> <span class="pre">Name</span> <span class="pre">&lt;reviewer.name&#64;email.address...&gt;</span></code></p>
<blockquote>
<div>When someone tests a patch, it is customary to add a Tested-by: tag
indicating that.  It&#8217;s rare for a tester to actually provide the tag; usually
the patch submitter makes the tag himself in response to an email indicating
successful testing results.</div></blockquote>
<p><code class="docutils literal"><span class="pre">Tested-at:</span> <span class="pre">&lt;URL&gt;</span></code></p>
<blockquote>
<div><p>When a test report is publicly available, this provides a way to reference
it.  Typical &lt;URL&gt;s would be build logs from autobuilders or references to
mailing list archives.</p>
<p>Some autobuilders only retain their logs for a limited amount of time.  It is
less useful to cite these because they may be dead links for a developer
reading the commit message months or years later.</p>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">Reported-by:</span> <span class="pre">Reporter</span> <span class="pre">Name</span> <span class="pre">&lt;reporter.name&#64;email.address...&gt;</span></code></p>
<blockquote>
<div><p>When a patch fixes a bug reported by some person, please credit the reporter
in the commit log in this fashion.  Please also add the reporter&#8217;s name and
email address to the list of people who provided helpful bug reports in the
AUTHORS file at the top of the source tree.</p>
<p>Fairly often, the reporter of a bug also tests the fix.  Occasionally one
sees a combined &#8220;Reported-and-tested-by:&#8221; tag used to indicate this.  It is
also acceptable, and more common, to include both tags separately.</p>
<p>(If a bug report is received privately, it might not always be appropriate to
publicly credit the reporter.  If in doubt, please ask the reporter.)</p>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">Requested-by:</span> <span class="pre">Requester</span> <span class="pre">Name</span> <span class="pre">&lt;requester.name&#64;email.address...&gt;</span></code></p>
<blockquote>
<div><p>When a patch implements a request or a suggestion made by some
person, please credit that person in the commit log in this
fashion.  For a helpful suggestion, please also add the
person&#8217;s name and email address to the list of people who
provided suggestions in the AUTHORS file at the top of the
source tree.</p>
<p>(If a suggestion or a request is received privately, it might
not always be appropriate to publicly give credit.  If in
doubt, please ask.)</p>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">Suggested-by:</span> <span class="pre">Suggester</span> <span class="pre">Name</span> <span class="pre">&lt;suggester.name&#64;email.address...&gt;</span></code></p>
<blockquote>
<div>See <code class="docutils literal"><span class="pre">Requested-by:</span></code>.</div></blockquote>
<p><code class="docutils literal"><span class="pre">CC:</span> <span class="pre">Person</span> <span class="pre">&lt;name&#64;email&gt;</span></code></p>
<blockquote>
<div>This is a way to tag a patch for the attention of a person
when no more specific tag is appropriate.  One use is to
request a review from a particular person.  It doesn&#8217;t make
sense to include the same person in CC and another tag, so
e.g. if someone who is CCed later provides an Acked-by, add
the Acked-by and remove the CC at the same time.</div></blockquote>
<p><code class="docutils literal"><span class="pre">Reported-at:</span> <span class="pre">&lt;URL&gt;</span></code></p>
<blockquote>
<div><p>If a patch fixes or is otherwise related to a bug reported in
a public bug tracker, please include a reference to the bug in
the form of a URL to the specific bug, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Reported-at: https://bugs.debian.org/743635
</pre></div>
</div>
<p>This is also an appropriate way to refer to bug report emails
in public email archives, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Reported-at: http://openvswitch.org/pipermail/dev/2014-June/040952.html
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">Submitted-at:</span> <span class="pre">&lt;URL&gt;</span></code></p>
<blockquote>
<div><p>If a patch was submitted somewhere other than the Open vSwitch
development mailing list, such as a GitHub pull request, this header can
be used to reference the source.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Submitted-at: https://github.com/openvswitch/ovs/pull/92
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">VMware-BZ:</span> <span class="pre">#1234567</span></code></p>
<blockquote>
<div>If a patch fixes or is otherwise related to a bug reported in
a private bug tracker, you may include some tracking ID for
the bug for your own reference.  Please include some
identifier to make the origin clear, e.g. &#8220;VMware-BZ&#8221; refers
to VMware&#8217;s internal Bugzilla instance and &#8220;ONF-JIRA&#8221; refers
to the Open Networking Foundation&#8217;s JIRA bug tracker.</div></blockquote>
<p><code class="docutils literal"><span class="pre">ONF-JIRA:</span> <span class="pre">EXT-12345</span></code></p>
<blockquote>
<div>See <code class="docutils literal"><span class="pre">VMware-BZ:</span></code>.</div></blockquote>
<p><code class="docutils literal"><span class="pre">Bug</span> <span class="pre">#1234567.</span></code></p>
<blockquote>
<div>These are obsolete forms of VMware-BZ: that can still be seen
in old change log entries.  (They are obsolete because they do
not tell the reader what bug tracker is referred to.)</div></blockquote>
<p><code class="docutils literal"><span class="pre">Issue:</span> <span class="pre">1234567</span></code></p>
<blockquote>
<div>See <code class="docutils literal"><span class="pre">Bug:</span></code>.</div></blockquote>
<p><code class="docutils literal"><span class="pre">Fixes:</span> <span class="pre">63bc9fb1c69f</span> <span class="pre">(“packets:</span> <span class="pre">Reorder</span> <span class="pre">CS_*</span> <span class="pre">flags</span> <span class="pre">to</span> <span class="pre">remove</span> <span class="pre">gap.”)</span></code></p>
<blockquote>
<div><p>If you would like to record which commit introduced a bug being fixed,
you may do that with a “Fixes” header.  This assists in determining
which OVS releases have the bug, so the patch can be applied to all
affected versions.  The easiest way to generate the header in the
proper format is with this git command.  This command also CCs the
author of the commit being fixed, which makes sense unless the
author also made the fix or is already named in another tag:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ git log -1 --pretty=format:&quot;CC: %an &lt;%ae&gt;%nFixes: %h (\&quot;%s\&quot;)&quot; \
  --abbrev=12 COMMIT_REF
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">Vulnerability:</span> <span class="pre">CVE-2016-2074</span></code></p>
<blockquote>
<div><p>Specifies that the patch fixes or is otherwise related to a
security vulnerability with the given CVE identifier.  Other
identifiers in public vulnerability databases are also
suitable.</p>
<p>If the vulnerability was reported publicly, then it is also
appropriate to cite the URL to the report in a Reported-at
tag.  Use a Reported-by tag to acknowledge the reporters.</p>
</div></blockquote>
</div>
<div class="section" id="developer-s-certificate-of-origin">
<h5>Developer&#8217;s Certificate of Origin<a class="headerlink" href="#developer-s-certificate-of-origin" title="Permalink to this headline">¶</a></h5>
<p>To help track the author of a patch as well as the submission chain, and be
clear that the developer has authority to submit a patch for inclusion in
openvswitch please sign off your work.  The sign off certifies the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Developer&#39;s Certificate of Origin 1.1

By making a contribution to this project, I certify that:

(a) The contribution was created in whole or in part by me and I
    have the right to submit it under the open source license
    indicated in the file; or

(b) The contribution is based upon previous work that, to the best
    of my knowledge, is covered under an appropriate open source
    license and I have the right under that license to submit that
    work with modifications, whether created in whole or in part
    by me, under the same open source license (unless I am
    permitted to submit under a different license), as indicated
    in the file; or

(c) The contribution was provided directly to me by some other
    person who certified (a), (b) or (c) and I have not modified
    it.

(d) I understand and agree that this project and the contribution
    are public and that a record of the contribution (including all
    personal information I submit with it, including my sign-off) is
    maintained indefinitely and may be redistributed consistent with
    this project or the open source license(s) involved.
</pre></div>
</div>
<p>See also <a class="reference external" href="http://developercertificate.org/">http://developercertificate.org/</a>.</p>
</div>
<div class="section" id="feature-deprecation-guidelines">
<h5>Feature Deprecation Guidelines<a class="headerlink" href="#feature-deprecation-guidelines" title="Permalink to this headline">¶</a></h5>
<p>Open vSwitch is intended to be user friendly.  This means that under normal
circumstances we don&#8217;t abruptly remove features from OVS that some users might
still be using.  Otherwise, if we would, then we would possibly break our user
setup when they upgrade and would receive bug reports.</p>
<p>Typical process to deprecate a feature in Open vSwitch is to:</p>
<ol class="loweralpha simple">
<li>Mention deprecation of a feature in the NEWS file.  Also, mention expected
release or absolute time when this feature would be removed from OVS
altogether.  Don&#8217;t use relative time (e.g. &#8220;in 6 months&#8221;) because that is
not clearly interpretable.</li>
<li>If Open vSwitch is configured to use deprecated feature it should print
a warning message to the log files clearly indicating that feature is
deprecated and that use of it should be avoided.</li>
<li>If this feature is mentioned in man pages, then add &#8220;Deprecated&#8221; keyword
to it.</li>
</ol>
<p>Also, if there is alternative feature to the one that is about to be marked as
deprecated, then mention it in (a), (b) and (c) as well.</p>
<p>Remember to follow-up and actually remove the feature from OVS codebase once
deprecation grace period has expired and users had opportunity to use at least
one OVS release that would have informed them about feature deprecation!</p>
</div>
<div class="section" id="comments">
<h5>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h5>
<p>If you want to include any comments in your email that should not be part of
the commit&#8217;s change log message, put them after the description, separated by a
line that contains just <code class="docutils literal"><span class="pre">---</span></code>.  It may be helpful to include a diffstat here
for changes that touch multiple files.</p>
</div>
<div class="section" id="patch">
<h5>Patch<a class="headerlink" href="#patch" title="Permalink to this headline">¶</a></h5>
<p>The patch should be in the body of the email following the description,
separated by a blank line.</p>
<p>Patches should be in <code class="docutils literal"><span class="pre">diff</span> <span class="pre">-up</span></code> format.  We recommend that you use Git to
produce your patches, in which case you should use the <code class="docutils literal"><span class="pre">-M</span> <span class="pre">-C</span></code> options to
<code class="docutils literal"><span class="pre">git</span> <span class="pre">diff</span></code> (or other Git tools) if your patch renames or copies files.
<a class="reference external" href="http://savannah.nongnu.org/projects/quilt">Quilt</a> might be useful if you do
not want to use Git.</p>
<p>Patches should be inline in the email message.  Some email clients corrupt
white space or wrap lines in patches.  There are hints on how to configure many
email clients to avoid this problem on <a class="reference external" href="https://static.lwn.net/kerneldoc/process/email-clients.html">kernel.org</a>.  If you
cannot convince your email client not to mangle patches, then sending the patch
as an attachment is a second choice.</p>
<p>Follow the style used in the code that you are modifying. <a class="reference internal" href="contents.html#document-internals/contributing/coding-style"><em>Open vSwitch Coding Style</em></a>
file describes the coding style used in most of Open vSwitch. Use Linux kernel
coding style for Linux kernel code.</p>
<p>If your code is non-datapath code, you may use the <code class="docutils literal"><span class="pre">utilities/checkpatch.py</span></code>
utility as a quick check for certain commonly occuring mistakes (improper
leading/trailing whitespace, missing signoffs, some improper formatted patch
files).  For linux datapath code, it is a good idea to use the linux script
<code class="docutils literal"><span class="pre">checkpatch.pl</span></code>.</p>
</div>
<div class="section" id="example">
<h5>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><div class="highlight"><pre><span></span>From fa29a1c2c17682879e79a21bb0cdd5bbe67fa7c0 Mon Sep 17 00:00:00 2001
From: Jesse Gross &lt;jesse@nicira.com&gt;
Date: Thu, 8 Dec 2011 13:17:24 -0800
Subject: [PATCH] datapath: Alphabetize include/net/ipv6.h compat header.

Signed-off-by: Jesse Gross &lt;jesse@nicira.com&gt;
---
 datapath/linux/Modules.mk |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/datapath/linux/Modules.mk b/datapath/linux/Modules.mk
index fdd952e..f6cb88e 100644
--- a/datapath/linux/Modules.mk
+++ b/datapath/linux/Modules.mk
@@ -56,11 +56,11 @@ openvswitch_headers += \
    linux/compat/include/net/dst.h \
    linux/compat/include/net/genetlink.h \
    linux/compat/include/net/ip.h \
+   linux/compat/include/net/ipv6.h \
    linux/compat/include/net/net_namespace.h \
    linux/compat/include/net/netlink.h \
    linux/compat/include/net/protocol.h \
    linux/compat/include/net/route.h \
-   linux/compat/include/net/ipv6.h \
    linux/compat/genetlink.inc

 both_modules += brcompat
--
1.7.7.3
</pre></div>
</div>
</div>
</div>
<span id="document-internals/contributing/coding-style"></span><div class="section" id="open-vswitch-coding-style">
<h4>Open vSwitch Coding Style<a class="headerlink" href="#open-vswitch-coding-style" title="Permalink to this headline">¶</a></h4>
<p>This file describes the coding style used in most C files in the Open vSwitch
distribution. However, Linux kernel code datapath directory follows the Linux
kernel&#8217;s established coding conventions. For the Windows kernel datapath code,
use the coding style described in <a class="reference internal" href="contents.html#document-internals/contributing/coding-style-windows"><em>Open vSwitch Windows Datapath Coding Style</em></a>.</p>
<p>The following GNU indent options approximate this style.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">npro</span> <span class="o">-</span><span class="n">bad</span> <span class="o">-</span><span class="n">bap</span> <span class="o">-</span><span class="n">bbb</span> <span class="o">-</span><span class="n">br</span> <span class="o">-</span><span class="n">blf</span> <span class="o">-</span><span class="n">brs</span> <span class="o">-</span><span class="n">cdw</span> <span class="o">-</span><span class="n">ce</span> <span class="o">-</span><span class="n">fca</span> <span class="o">-</span><span class="n">cli0</span> <span class="o">-</span><span class="n">npcs</span> <span class="o">-</span><span class="n">i4</span> <span class="o">-</span><span class="n">l79</span> \
<span class="o">-</span><span class="n">lc79</span> <span class="o">-</span><span class="n">nbfda</span> <span class="o">-</span><span class="n">nut</span> <span class="o">-</span><span class="n">saf</span> <span class="o">-</span><span class="n">sai</span> <span class="o">-</span><span class="n">saw</span> <span class="o">-</span><span class="n">sbi4</span> <span class="o">-</span><span class="n">sc</span> <span class="o">-</span><span class="n">sob</span> <span class="o">-</span><span class="n">st</span> <span class="o">-</span><span class="n">ncdb</span> <span class="o">-</span><span class="n">pi4</span> <span class="o">-</span><span class="n">cs</span> <span class="o">-</span><span class="n">bs</span> \
<span class="o">-</span><span class="n">di1</span> <span class="o">-</span><span class="n">lp</span> <span class="o">-</span><span class="n">il0</span> <span class="o">-</span><span class="n">hnl</span>
</pre></div>
</div>
<div class="section" id="basics">
<span id="id1"></span><h5>Basics<a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Limit lines to 79 characters.</li>
<li>Use form feeds (control+L) to divide long source files into logical pieces. A
form feed should appear as the only character on a line.</li>
<li>Do not use tabs for indentation.</li>
<li>Avoid trailing spaces on lines.</li>
</ul>
</div>
<div class="section" id="naming">
<span id="id2"></span><h5>Naming<a class="headerlink" href="#naming" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Use names that explain the purpose of a function or object.</li>
<li>Use underscores to separate words in an identifier: <code class="docutils literal"><span class="pre">multi_word_name</span></code>.</li>
<li>Use lowercase for most names. Use uppercase for macros, macro parameters,
and members of enumerations.</li>
<li>Give arrays names that are plural.</li>
<li>Pick a unique name prefix (ending with an underscore) for each
module, and apply that prefix to all of that module&#8217;s externally
visible names. Names of macro parameters, struct and union members,
and parameters in function prototypes are not considered externally
visible for this purpose.</li>
<li>Do not use names that begin with <code class="docutils literal"><span class="pre">_</span></code>. If you need a name for &#8220;internal use
only&#8221;, use <code class="docutils literal"><span class="pre">__</span></code> as a suffix instead of a prefix.</li>
<li>Avoid negative names: <code class="docutils literal"><span class="pre">found</span></code> is a better name than <code class="docutils literal"><span class="pre">not_found</span></code>.</li>
<li>In names, a <code class="docutils literal"><span class="pre">size</span></code> is a count of bytes, a <code class="docutils literal"><span class="pre">length</span></code> is a count of
characters.  A buffer has size, but a string has length. The length of a
string does not include the null terminator, but the size of the buffer that
contains the string does.</li>
</ul>
</div>
<div class="section" id="comments">
<span id="id3"></span><h5>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h5>
<p>Comments should be written as full sentences that start with a capital letter
and end with a period. Put two spaces between sentences.</p>
<p>Write block comments as shown below. You may put the <code class="docutils literal"><span class="pre">/*</span></code> and <code class="docutils literal"><span class="pre">*/</span></code> on the
same line as comment text if you prefer.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>/*
 * We redirect stderr to /dev/null because we often want to remove all
 * traffic control configuration on a port so its in a known state.  If
 * this done when there is no such configuration, tc complains, so we just
 * always ignore it.
 */
</pre></div>
</div>
<p>Each function and each variable declared outside a function, and each struct,
union, and typedef declaration should be preceded by a comment. See <a class="reference internal" href="#functions">functions</a>
below for function comment guidelines.</p>
<p>Each struct and union member should each have an inline comment that explains
its meaning. structs and unions with many members should be additionally
divided into logical groups of members by block comments, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>/* An event that will wake the following call to poll_block(). */
struct poll_waiter {
    /* Set when the waiter is created. */
    struct ovs_list node;       /* Element in global waiters list. */
    int fd;                     /* File descriptor. */
    short int events;           /* Events to wait for (POLLIN, POLLOUT). */
    poll_fd_func *function;     /* Callback function, if any, or null. */
    void *aux;                  /* Argument to callback function. */
    struct backtrace *backtrace; /* Event that created waiter, or null. */

    /* Set only when poll_block() is called. */
    struct pollfd *pollfd;      /* Pointer to element of the pollfds array
                                   (null if added from a callback). */
};
</pre></div>
</div>
<p>Use <code class="docutils literal"><span class="pre">XXX</span></code> or <code class="docutils literal"><span class="pre">FIXME</span></code> comments to mark code that needs work.</p>
<p>Don&#8217;t use <code class="docutils literal"><span class="pre">//</span></code> comments.</p>
<p>Don&#8217;t comment out or #if 0 out code. Just remove it. The code that was there
will still be in version control history.</p>
</div>
<div class="section" id="functions">
<span id="id4"></span><h5>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h5>
<p>Put the return type, function name, and the braces that surround the function&#8217;s
code on separate lines, all starting in column 0.</p>
<p>Before each function definition, write a comment that describes the function&#8217;s
purpose, including each parameter, the return value, and side effects.
References to argument names should be given in single-quotes, e.g. &#8216;arg&#8217;. The
comment should not include the function name, nor need it follow any formal
structure. The comment does not need to describe how a function does its work,
unless this information is needed to use the function correctly (this is often
better done with comments <em>inside</em> the function).</p>
<p>Simple static functions do not need a comment.</p>
<p>Within a file, non-static functions should come first, in the order that they
are declared in the header file, followed by static functions.  Static
functions should be in one or more separate pages (separated by form feed
characters) in logical groups. A commonly useful way to divide groups is by
&#8220;level&#8221;, with high-level functions first, followed by groups of progressively
lower-level functions. This makes it easy for the program&#8217;s reader to see the
top-down structure by reading from top to bottom.</p>
<p>All function declarations and definitions should include a prototype.  Empty
parentheses, e.g. <code class="docutils literal"><span class="pre">int</span> <span class="pre">foo();</span></code>, do not include a prototype (they state that
the function&#8217;s parameters are unknown); write <code class="docutils literal"><span class="pre">void</span></code> in parentheses instead,
e.g. <code class="docutils literal"><span class="pre">int</span> <span class="pre">foo(void);</span></code>.</p>
<p>Prototypes for static functions should either all go at the top of the file,
separated into groups by blank lines, or they should appear at the top of each
page of functions. Don&#8217;t comment individual prototypes, but a comment on each
group of prototypes is often appropriate.</p>
<p>In the absence of good reasons for another order, the following parameter order
is preferred. One notable exception is that data parameters and their
corresponding size parameters should be paired.</p>
<ol class="arabic simple">
<li>The primary object being manipulated, if any (equivalent to the &#8220;this&#8221;
pointer in C++).</li>
<li>Input-only parameters.</li>
<li>Input/output parameters.</li>
<li>Output-only parameters.</li>
<li>Status parameter.</li>
</ol>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>```
/* Stores the features supported by &#39;netdev&#39; into each of &#39;*current&#39;,
 * &#39;*advertised&#39;, &#39;*supported&#39;, and &#39;*peer&#39; that are non-null.  Each value
 * is a bitmap of &quot;enum ofp_port_features&quot; bits, in host byte order.
 * Returns 0 if successful, otherwise a positive errno value.  On failure,
 * all of the passed-in values are set to 0. */
int
netdev_get_features(struct netdev *netdev,
                    uint32_t *current, uint32_t *advertised,
                    uint32_t *supported, uint32_t *peer)
{
    ...
}
```
</pre></div>
</div>
<p>Functions that destroy an instance of a dynamically-allocated type should
accept and ignore a null pointer argument. Code that calls such a function
(including the C standard library function <code class="docutils literal"><span class="pre">free()</span></code>) should omit a
null-pointer check. We find that this usually makes code easier to read.</p>
<p>Functions in <code class="docutils literal"><span class="pre">.c</span></code> files should not normally be marked <code class="docutils literal"><span class="pre">inline</span></code>, because it
does not usually help code generation and it does suppress compilers warnings
about unused functions. (Functions defined in .h usually should be marked
inline.)</p>
</div>
<div class="section" id="function-prototypes">
<span id="id5"></span><h5>Function Prototypes<a class="headerlink" href="#function-prototypes" title="Permalink to this headline">¶</a></h5>
<p>Put the return type and function name on the same line in a function prototype:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>static const struct option_class *get_option_class(int code);
</pre></div>
</div>
<p>Omit parameter names from function prototypes when the names do not give useful
information, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>int netdev_get_mtu(const struct netdev *, int *mtup);
</pre></div>
</div>
</div>
<div class="section" id="statements">
<h5>Statements<a class="headerlink" href="#statements" title="Permalink to this headline">¶</a></h5>
<p>Indent each level of code with 4 spaces. Use BSD-style brace placement:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>if (a()) {
    b();
    d();
}
</pre></div>
</div>
<p>Put a space between <code class="docutils literal"><span class="pre">if</span></code>, <code class="docutils literal"><span class="pre">while</span></code>, <code class="docutils literal"><span class="pre">for</span></code>, etc. and the expressions that
follow them.</p>
<p>Enclose single statements in braces:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>if (a &gt; b) {
    return a;
} else {
    return b;
}
</pre></div>
</div>
<p>Use comments and blank lines to divide long functions into logical groups of
statements.</p>
<p>Avoid assignments inside <code class="docutils literal"><span class="pre">if</span></code> and <code class="docutils literal"><span class="pre">while</span></code> conditions.</p>
<p>Do not put gratuitous parentheses around the expression in a return statement,
that is, write <code class="docutils literal"><span class="pre">return</span> <span class="pre">0;</span></code> and not <code class="docutils literal"><span class="pre">return(0);</span></code></p>
<p>Write only one statement per line.</p>
<p>Indent <code class="docutils literal"><span class="pre">switch</span></code> statements like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>switch (conn-&gt;state) {
case S_RECV:
    error = run_connection_input(conn);
    break;

case S_PROCESS:
    error = 0;
    break;

case S_SEND:
    error = run_connection_output(conn);
    break;

default:
    OVS_NOT_REACHED();
}
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">switch</span></code> statements with very short, uniform cases may use an abbreviated
style:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>switch (code) {
case 200: return &quot;OK&quot;;
case 201: return &quot;Created&quot;;
case 202: return &quot;Accepted&quot;;
case 204: return &quot;No Content&quot;;
default: return &quot;Unknown&quot;;
}
</pre></div>
</div>
<p>Use <code class="docutils literal"><span class="pre">for</span> <span class="pre">(;;)</span></code> to write an infinite loop.</p>
<p>In an if/else construct where one branch is the &#8220;normal&#8221; or &#8220;common&#8221; case and
the other branch is the &#8220;uncommon&#8221; or &#8220;error&#8221; case, put the common case after
the &#8220;if&#8221;, not the &#8220;else&#8221;. This is a form of documentation. It also places the
most important code in sequential order without forcing the reader to visually
skip past less important details. (Some compilers also assume that the &#8220;if&#8221;
branch is the more common case, so this can be a real form of optimization as
well.)</p>
</div>
<div class="section" id="return-values">
<h5>Return Values<a class="headerlink" href="#return-values" title="Permalink to this headline">¶</a></h5>
<p>For functions that return a success or failure indication, prefer one of the
following return value conventions:</p>
<ul class="simple">
<li>An <code class="docutils literal"><span class="pre">int</span></code> where 0 indicates success and a positive errno value indicates a
reason for failure.</li>
<li>A <code class="docutils literal"><span class="pre">bool</span></code> where true indicates success and false indicates failure.</li>
</ul>
</div>
<div class="section" id="macros">
<h5>Macros<a class="headerlink" href="#macros" title="Permalink to this headline">¶</a></h5>
<p>Don&#8217;t define an object-like macro if an enum can be used instead.</p>
<p>Don&#8217;t define a function-like macro if a &#8220;static inline&#8221; function can be used
instead.</p>
<p>If a macro&#8217;s definition contains multiple statements, enclose them with <code class="docutils literal"><span class="pre">do</span> <span class="pre">{</span>
<span class="pre">...</span> <span class="pre">}</span> <span class="pre">while</span> <span class="pre">(0)</span></code> to allow them to work properly in all syntactic
circumstances.</p>
<p>Do use macros to eliminate the need to update different parts of a single file
in parallel, e.g. a list of enums and an array that gives the name of each
enum. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>/* Logging importance levels. */
#define VLOG_LEVELS                             \
    VLOG_LEVEL(EMER, LOG_ALERT)                 \
    VLOG_LEVEL(ERR, LOG_ERR)                    \
    VLOG_LEVEL(WARN, LOG_WARNING)               \
    VLOG_LEVEL(INFO, LOG_NOTICE)                \
    VLOG_LEVEL(DBG, LOG_DEBUG)
enum vlog_level {
#define VLOG_LEVEL(NAME, SYSLOG_LEVEL) VLL_##NAME,
    VLOG_LEVELS
#undef VLOG_LEVEL
    VLL_N_LEVELS
};

/* Name for each logging level. */
static const char *level_names[VLL_N_LEVELS] = {
#define VLOG_LEVEL(NAME, SYSLOG_LEVEL) #NAME,
    VLOG_LEVELS
#undef VLOG_LEVEL
};
</pre></div>
</div>
</div>
<div class="section" id="thread-safety-annotations">
<h5>Thread Safety Annotations<a class="headerlink" href="#thread-safety-annotations" title="Permalink to this headline">¶</a></h5>
<p>Use the macros in <code class="docutils literal"><span class="pre">lib/compiler.h</span></code> to annotate locking requirements. For
example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>static struct ovs_mutex mutex = OVS_MUTEX_INITIALIZER;
static struct ovs_rwlock rwlock = OVS_RWLOCK_INITIALIZER;

void function_require_plain_mutex(void) OVS_REQUIRES(mutex);
void function_require_rwlock(void) OVS_REQ_RDLOCK(rwlock);
</pre></div>
</div>
<p>Pass lock objects, not their addresses, to the annotation macros. (Thus we have
<code class="docutils literal"><span class="pre">OVS_REQUIRES(mutex)</span></code> above, not <code class="docutils literal"><span class="pre">OVS_REQUIRES(&amp;mutex)</span></code>.)</p>
</div>
<div class="section" id="source-files">
<span id="id6"></span><h5>Source Files<a class="headerlink" href="#source-files" title="Permalink to this headline">¶</a></h5>
<p>Each source file should state its license in a comment at the very top,
followed by a comment explaining the purpose of the code that is in that file.
The comment should explain how the code in the file relates to code in other
files. The goal is to allow a programmer to quickly figure out where a given
module fits into the larger system.</p>
<p>The first non-comment line in a .c source file should be:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">#include &lt;config.h&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">#include</span></code> directives should appear in the following order:</p>
<ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">#include</span> <span class="pre">&lt;config.h&gt;</span></code></li>
<li>The module&#8217;s own headers, if any. Including this before any other header
(besides ) ensures that the module&#8217;s header file is self-contained (see
<a class="reference internal" href="#header-files">header files</a> below).</li>
<li>Standard C library headers and other system headers, preferably in
alphabetical order. (Occasionally one encounters a set of system headers
that must be included in a particular order, in which case that order must
take precedence.)</li>
<li>Open vSwitch headers, in alphabetical order. Use <code class="docutils literal"><span class="pre">&quot;&quot;</span></code>, not <code class="docutils literal"><span class="pre">&lt;&gt;</span></code>, to
specify Open vSwitch header names.</li>
</ol>
</div>
<div class="section" id="header-files">
<span id="id7"></span><h5>Header Files<a class="headerlink" href="#header-files" title="Permalink to this headline">¶</a></h5>
<p>Each header file should start with its license, as described under <a class="reference internal" href="#source-files">source
files</a> above, followed by a &#8220;header guard&#8221; to make the header file idempotent,
like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">#ifndef NETDEV_H</span>
<span class="c1">#define NETDEV_H 1</span>

<span class="o">...</span>

<span class="c1">#endif /* netdev.h */</span>
</pre></div>
</div>
<p>Header files should be self-contained; that is, they should <code class="docutils literal"><span class="pre">#include</span></code> whatever
additional headers are required, without requiring the client to <code class="docutils literal"><span class="pre">#include</span></code>
them for it.</p>
<p>Don&#8217;t define the members of a struct or union in a header file, unless client
code is actually intended to access them directly or if the definition is
otherwise actually needed (e.g. inline functions defined in the header need
them).</p>
<p>Similarly, don&#8217;t <code class="docutils literal"><span class="pre">#include</span></code> a header file just for the declaration of a
struct or union tag (e.g. just for <code class="docutils literal"><span class="pre">struct</span> <span class="pre">;</span></code>). Just declare the tag
yourself.  This reduces the number of header file dependencies.</p>
</div>
<div class="section" id="types">
<h5>Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h5>
<p>Use typedefs sparingly. Code is clearer if the actual type is visible at the
point of declaration. Do not, in general, declare a typedef for a struct,
union, or enum. Do not declare a typedef for a pointer type, because this can
be very confusing to the reader.</p>
<p>A function type is a good use for a typedef because it can clarify code.  The
type should be a function type, not a pointer-to-function type. That way, the
typedef name can be used to declare function prototypes. (It cannot be used for
function definitions, because that is explicitly prohibited by C89 and C99.)</p>
<p>You may assume that <code class="docutils literal"><span class="pre">char</span></code> is exactly 8 bits and that <code class="docutils literal"><span class="pre">int</span></code> and <code class="docutils literal"><span class="pre">long</span></code>
are at least 32 bits.</p>
<p>Don&#8217;t assume that <code class="docutils literal"><span class="pre">long</span></code> is big enough to hold a pointer. If you need to cast
a pointer to an integer, use <code class="docutils literal"><span class="pre">intptr_t</span></code> or <code class="docutils literal"><span class="pre">uintptr_t</span></code> from .</p>
<p>Use the <code class="docutils literal"><span class="pre">int_t</span></code> and <code class="docutils literal"><span class="pre">uint_t</span></code> types from for exact-width integer types. Use
the <code class="docutils literal"><span class="pre">PRId</span></code>, <code class="docutils literal"><span class="pre">PRIu</span></code>, and <code class="docutils literal"><span class="pre">PRIx</span></code> macros from for formatting them with
<code class="docutils literal"><span class="pre">printf()</span></code> and related functions.</p>
<p>For compatibility with antique <code class="docutils literal"><span class="pre">printf()</span></code> implementations:</p>
<ul class="simple">
<li>Instead of <code class="docutils literal"><span class="pre">&quot;%zu&quot;</span></code>, use <code class="docutils literal"><span class="pre">&quot;%&quot;PRIuSIZE</span></code>.</li>
<li>Instead of <code class="docutils literal"><span class="pre">&quot;%td&quot;</span></code>, use <code class="docutils literal"><span class="pre">&quot;%&quot;PRIdPTR</span></code>.</li>
<li>Instead of <code class="docutils literal"><span class="pre">&quot;%ju&quot;</span></code>, use <code class="docutils literal"><span class="pre">&quot;%&quot;PRIuMAX</span></code>.</li>
</ul>
<p>Other variants exist for different radixes. For example, use <code class="docutils literal"><span class="pre">&quot;%&quot;PRIxSIZE</span></code>
instead of <code class="docutils literal"><span class="pre">&quot;%zx&quot;</span></code> or <code class="docutils literal"><span class="pre">&quot;%x&quot;</span></code> instead of <code class="docutils literal"><span class="pre">&quot;%hhx&quot;</span></code>.</p>
<p>Also, instead of <code class="docutils literal"><span class="pre">&quot;%hhd&quot;</span></code>, use <code class="docutils literal"><span class="pre">&quot;%d&quot;</span></code>. Be cautious substituting <code class="docutils literal"><span class="pre">&quot;%u&quot;</span></code>,
<code class="docutils literal"><span class="pre">&quot;%x&quot;</span></code>, and <code class="docutils literal"><span class="pre">&quot;%o&quot;</span></code> for the corresponding versions with <code class="docutils literal"><span class="pre">&quot;hh&quot;</span></code>: cast the
argument to unsigned char if necessary, because <code class="docutils literal"><span class="pre">printf(&quot;%hhu&quot;,</span> <span class="pre">-1)</span></code> prints
255 but <code class="docutils literal"><span class="pre">printf(&quot;%u&quot;,</span> <span class="pre">-1)</span></code> prints 4294967295.</p>
<p>Use bit-fields sparingly. Do not use bit-fields for layout of network
protocol fields or in other circumstances where the exact format is
important.</p>
<p>Declare bit-fields to be signed or unsigned integer types or _Bool (aka
bool). Do <em>not</em> declare bit-fields of type <code class="docutils literal"><span class="pre">int</span></code>: C99 allows these to be
either signed or unsigned according to the compiler&#8217;s whim. (A 1-bit bit-field
of type <code class="docutils literal"><span class="pre">int</span></code> may have a range of -1...0!)</p>
<p>Try to order structure members such that they pack well on a system with 2-byte
<code class="docutils literal"><span class="pre">short</span></code>, 4-byte <code class="docutils literal"><span class="pre">int</span></code>, and 4- or 8-byte <code class="docutils literal"><span class="pre">long</span></code> and pointer types.  Prefer
clear organization over size optimization unless you are convinced there is a
size or speed benefit.</p>
<p>Pointer declarators bind to the variable name, not the type name. Write
<code class="docutils literal"><span class="pre">int</span> <span class="pre">*x</span></code>, not <code class="docutils literal"><span class="pre">int*</span> <span class="pre">x</span></code> and definitely not <code class="docutils literal"><span class="pre">int</span> <span class="pre">*</span> <span class="pre">x</span></code>.</p>
</div>
<div class="section" id="expressions">
<h5>Expressions<a class="headerlink" href="#expressions" title="Permalink to this headline">¶</a></h5>
<p>Put one space on each side of infix binary and ternary operators:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>* / %
+ -
&lt;&lt; &gt;&gt;
&lt; &lt;= &gt; &gt;=
== !=
&amp;
^
|
&amp;&amp;
||
?:
= += -= *= /= %= &amp;= ^= |= &lt;&lt;= &gt;&gt;=
</pre></div>
</div>
<p>Avoid comma operators.</p>
<p>Do not put any white space around postfix, prefix, or grouping operators:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>() [] -&gt; .
! ~ ++ -- + - * &amp;
</pre></div>
</div>
<p>Exception 1: Put a space after (but not before) the &#8220;sizeof&#8221; keyword.</p>
<p>Exception 2: Put a space between the () used in a cast and the expression whose
type is cast: <code class="docutils literal"><span class="pre">(void</span> <span class="pre">\*)</span> <span class="pre">0</span></code>.</p>
<p>Break long lines before the ternary operators ? and :, rather than after
them, e.g.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>return (out_port != VIGP_CONTROL_PATH
        ? alpheus_output_port(dp, skb, out_port)
        : alpheus_output_control(dp, skb, fwd_save_skb(skb),
                                 VIGR_ACTION));
</pre></div>
</div>
<p>Do not parenthesize the operands of <code class="docutils literal"><span class="pre">&amp;&amp;</span></code> and <code class="docutils literal"><span class="pre">||</span></code> unless operator
precedence makes it necessary, or unless the operands are themselves
expressions that use <code class="docutils literal"><span class="pre">&amp;&amp;</span></code> and <code class="docutils literal"><span class="pre">||</span></code>. Thus:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>if (!isdigit((unsigned char)s[0])
    || !isdigit((unsigned char)s[1])
    || !isdigit((unsigned char)s[2])) {
    printf(&quot;string %s does not start with 3-digit code\n&quot;, s);
}
</pre></div>
</div>
<p>but</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>if (rule &amp;&amp; (!best || rule-&gt;priority &gt; best-&gt;priority)) {
    best = rule;
}
</pre></div>
</div>
<p>Do parenthesize a subexpression that must be split across more than one line,
e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>*idxp = ((l1_idx &lt;&lt; PORT_ARRAY_L1_SHIFT)
         | (l2_idx &lt;&lt; PORT_ARRAY_L2_SHIFT)
         | (l3_idx &lt;&lt; PORT_ARRAY_L3_SHIFT));
</pre></div>
</div>
<p>Try to avoid casts. Don&#8217;t cast the return value of malloc().</p>
<p>The &#8220;sizeof&#8221; operator is unique among C operators in that it accepts two very
different kinds of operands: an expression or a type. In general, prefer to
specify an expression, e.g. <code class="docutils literal"><span class="pre">int</span> <span class="pre">*x</span> <span class="pre">=</span> <span class="pre">xmalloc(sizeof</span> <span class="pre">*\</span> <span class="pre">x);</span></code>. When the
operand of sizeof is an expression, there is no need to parenthesize that
operand, and please don&#8217;t.</p>
<p>Use the <code class="docutils literal"><span class="pre">ARRAY_SIZE</span></code> macro from <code class="docutils literal"><span class="pre">lib/util.h</span></code> to calculate the number of
elements in an array.</p>
<p>When using a relational operator like <code class="docutils literal"><span class="pre">&lt;</span></code> or <code class="docutils literal"><span class="pre">==</span></code>, put an expression or
variable argument on the left and a constant argument on the right, e.g.
<code class="docutils literal"><span class="pre">x</span> <span class="pre">==</span> <span class="pre">0</span></code>, <em>not</em> <code class="docutils literal"><span class="pre">0</span> <span class="pre">==</span> <span class="pre">x</span></code>.</p>
</div>
<div class="section" id="blank-lines">
<h5>Blank Lines<a class="headerlink" href="#blank-lines" title="Permalink to this headline">¶</a></h5>
<p>Put one blank line between top-level definitions of functions and global
variables.</p>
</div>
<div class="section" id="c-dialect">
<h5>C DIALECT<a class="headerlink" href="#c-dialect" title="Permalink to this headline">¶</a></h5>
<p>Most C99 features are OK because they are widely implemented:</p>
<ul>
<li><p class="first">Flexible array members (e.g. <code class="docutils literal"><span class="pre">struct</span> <span class="pre">{</span> <span class="pre">int</span> <span class="pre">foo[];</span> <span class="pre">}</span></code>).</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">static</span> <span class="pre">inline</span></code> functions (but no other forms of <code class="docutils literal"><span class="pre">inline</span></code>, for which GCC
and C99 have differing interpretations).</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">long</span> <span class="pre">long</span></code></p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">bool</span></code> and <code class="docutils literal"><span class="pre">&lt;stdbool.h&gt;</span></code>, but don&#8217;t assume that bool or _Bool can only
take on the values 0 or 1, because this behavior can&#8217;t be simulated on C89
compilers.</p>
<p>Also, don&#8217;t assume that a conversion to <code class="docutils literal"><span class="pre">bool</span></code> or <code class="docutils literal"><span class="pre">_Bool</span></code> follows C99
semantics, i.e. use <code class="docutils literal"><span class="pre">(bool)(some_value</span> <span class="pre">!=</span> <span class="pre">0)</span></code> rather than
<code class="docutils literal"><span class="pre">(bool)some_value</span></code>. The latter might produce unexpected results on non-C99
environments. For example, if bool is implemented as a typedef of char and
<code class="docutils literal"><span class="pre">some_value</span> <span class="pre">=</span> <span class="pre">0x10000000</span></code>.</p>
</li>
<li><p class="first">Designated initializers (e.g. <code class="docutils literal"><span class="pre">struct</span> <span class="pre">foo</span> <span class="pre">foo</span> <span class="pre">=</span> <span class="pre">{.a</span> <span class="pre">=</span> <span class="pre">1};</span></code> and <code class="docutils literal"><span class="pre">int</span>
<span class="pre">a[]</span> <span class="pre">=</span> <span class="pre">{[2]</span> <span class="pre">=</span> <span class="pre">5};</span></code>).</p>
</li>
<li><p class="first">Mixing of declarations and code within a block. Please use this
judiciously; keep declarations nicely grouped together in the
beginning of a block if possible.</p>
</li>
<li><p class="first">Use of declarations in iteration statements (e.g. <code class="docutils literal"><span class="pre">for</span> <span class="pre">(int</span> <span class="pre">i</span> <span class="pre">=</span> <span class="pre">0;</span> <span class="pre">i</span>
<span class="pre">&lt;</span> <span class="pre">10;</span> <span class="pre">i++)</span></code>).</p>
</li>
<li><p class="first">Use of a trailing comma in an enum declaration (e.g. <code class="docutils literal"><span class="pre">enum</span> <span class="pre">{</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">1,</span>
<span class="pre">};</span></code>).</p>
</li>
</ul>
<p>As a matter of style, avoid <code class="docutils literal"><span class="pre">//</span></code> comments.</p>
<p>Avoid using GCC or Clang extensions unless you also add a fallback for other
compilers. You can, however, use C99 features or GCC extensions also supported
by Clang in code that compiles only on GNU/Linux (such as
<code class="docutils literal"><span class="pre">lib/netdev-linux.c</span></code>), because GCC is the system compiler there.</p>
</div>
<div class="section" id="python">
<h5>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h5>
<p>When introducing new Python code, try to follow Python&#8217;s <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">PEP 8</a> style. Consider running the
<code class="docutils literal"><span class="pre">pep8</span></code> or <code class="docutils literal"><span class="pre">flake8</span></code> tool against your code to find issues.</p>
</div>
<div class="section" id="libraries">
<h5>Libraries<a class="headerlink" href="#libraries" title="Permalink to this headline">¶</a></h5>
<p>When introducing a new library, follow
<a class="reference internal" href="contents.html#document-internals/contributing/libopenvswitch-abi"><em>Open vSwitch Library ABI guide</em></a></p>
</div>
</div>
<span id="document-internals/contributing/coding-style-windows"></span><div class="section" id="open-vswitch-windows-datapath-coding-style">
<h4>Open vSwitch Windows Datapath Coding Style<a class="headerlink" href="#open-vswitch-windows-datapath-coding-style" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="contents.html#document-internals/contributing/coding-style"><em>coding style</em></a> guide gives the flexiblity for each
platform to use its own coding style for the kernel datapath.  This file
describes the specific coding style used in most of the C files in the Windows
kernel datapath of the Open vSwitch distribution.</p>
<p>Most of the coding conventions applicable for the Open vSwitch distribution are
applicable to the Windows kernel datapath as well.  There are some exceptions
and new guidlines owing to the commonly followed practices in Windows
kernel/driver code.  They are noted as follows:</p>
<div class="section" id="basics">
<h5>Basics<a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p class="first">Limit lines to 79 characters.</p>
<p>Many times, this is not possible due to long names of functions and it is
fine to go beyond the characters limit.  One common example is when calling
into NDIS functions.</p>
</li>
</ul>
</div>
<div class="section" id="types">
<h5>Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h5>
<p>Use data types defined by Windows for most of the code.  This is a common
practice in Windows driver code, and it makes integrating with the data
structures and functions defined by Windows easier.  Example: <code class="docutils literal"><span class="pre">DWORD</span></code> and
<code class="docutils literal"><span class="pre">BOOLEAN</span></code>.</p>
<p>Use caution in portions of the code that interface with the OVS userspace.  OVS
userspace does not use Windows specific data types, and when copying data back
and forth between kernel and userspace, care should be exercised.</p>
</div>
<div class="section" id="naming">
<h5>Naming<a class="headerlink" href="#naming" title="Permalink to this headline">¶</a></h5>
<p>It is common practice to use camel casing for naming variables, functions and
files in Windows.  For types, especially structures, unions and enums, using
all upper case letters with words seprated by &#8216;_&#8217; is common. These practices
can be used for OVS Windows datapath.  However, use the following guidelines:</p>
<ul class="simple">
<li>Use lower case to begin the name of a variable.</li>
<li>Do not use &#8216;_&#8217; to begin the name of the variable. &#8216;_&#8217; is to be used to begin
the parameters of a pre-processor macro.</li>
<li>Use upper case to begin the name of a function, enum, file name etc.</li>
<li>Static functions whose scope is limited to the file they are defined in can
be prefixed with &#8216;_&#8217;. This is not mandatory though.</li>
<li>For types, use all upper case for all letters with words separated by &#8216;_&#8217;. If
camel casing is preferred, use  upper case for the first letter.</li>
<li>It is a common practice to define a pointer type by prefixing the letter &#8216;P&#8217;
to a data type.  The same practice can be followed here as well.</li>
</ul>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>static __inline BOOLEAN
OvsDetectTunnelRxPkt(POVS_FORWARDING_CONTEXT ovsFwdCtx,
                     POVS_FLOW_KEY flowKey)
{
    POVS_VPORT_ENTRY tunnelVport = NULL;

    if (!flowKey-&gt;ipKey.nwFrag &amp;&amp;
        flowKey-&gt;ipKey.nwProto == IPPROTO_UDP &amp;&amp;
        flowKey-&gt;ipKey.l4.tpDst == VXLAN_UDP_PORT_NBO) {
        tunnelVport = OvsGetTunnelVport(OVSWIN_VPORT_TYPE_VXLAN);
        ovsActionStats.rxVxlan++;
    } else {
        return FALSE;
    }

    if (tunnelVport) {
        ASSERT(ovsFwdCtx-&gt;tunnelRxNic == NULL);
        ovsFwdCtx-&gt;tunnelRxNic = tunnelVport;
        return TRUE;
    }

    return FALSE;
}
</pre></div>
</div>
<p>For declaring variables of pointer type, use of the pointer data type prefixed
with &#8216;P&#8217; is preferred over using &#8216;*&#8217;. This is not mandatory though, and is only
prescribed since it is a common practice in Windows.</p>
<p>Example, #1 is preferred over #2 though #2 is also equally correct:</p>
<ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">PNET_BUFFER_LIST</span> <span class="pre">curNbl;</span></code></li>
<li><code class="docutils literal"><span class="pre">NET_BUFFER_LIST</span> <span class="pre">*curNbl;</span></code></li>
</ol>
</div>
<div class="section" id="comments">
<h5>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h5>
<p>Comments should be written as full sentences that start with a capital letter
and end with a period.  Putting two spaces between sentances is not necessary.</p>
<p><code class="docutils literal"><span class="pre">//</span></code> can be used for comments as long as the comment is a single line
comment.  For block comments, use <code class="docutils literal"><span class="pre">/*</span> <span class="pre">*/</span></code> comments</p>
</div>
<div class="section" id="functions">
<h5>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h5>
<p>Put the return type, function name, and the braces that surround the function&#8217;s
code on separate lines, all starting in column 0.</p>
<p>Before each function definition, write a comment that describes the function&#8217;s
purpose, including each parameter, the return value, and side effects.
References to argument names should be given in single-quotes, e.g. &#8216;arg&#8217;.  The
comment should not include the function name, nor need it follow any formal
structure.  The comment does not need to describe how a function does its work,
unless this information is needed to use the function correctly (this is often
better done with comments <em>inside</em> the function).</p>
<p>Mention any side effects that the function has that are not obvious based on
the name of the function or based on the workflow it is called from.</p>
<p>In the interest of keeping comments describing functions similar in structure,
use the following template.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>/*
 *----------------------------------------------------------------------------
 * Any description of the function, arguments, return types, assumptions and
 * side effects.
 *----------------------------------------------------------------------------
 */
</pre></div>
</div>
</div>
<div class="section" id="source-files">
<h5>Source Files<a class="headerlink" href="#source-files" title="Permalink to this headline">¶</a></h5>
<p>Each source file should state its license in a comment at the very top,
followed by a comment explaining the purpose of the code that is in that file.
The comment should explain how the code in the file relates to code in other
files.  The goal is to allow a programmer to quickly figure out where a given
module fits into the larger system.</p>
<p>The first non-comment line in a .c source file should be:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">#include &lt;precomp.h&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">#include</span></code> directives should appear in the following order:</p>
<ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">#include</span> <span class="pre">&lt;precomp.h&gt;</span></code></li>
<li>The module&#8217;s own headers, if any.  Including this before any other header
(besides <code class="docutils literal"><span class="pre">&lt;precomp.h&gt;</span></code>) ensures that the module&#8217;s header file is
self-contained (see <em>Header Files</em>) below.</li>
<li>Standard C library headers and other system headers, preferably in
alphabetical order.  (Occasionally one encounters a set of system headers
that must be included in a particular order, in which case that order must
take precedence.)</li>
<li>Open vSwitch headers, in alphabetical order.  Use <code class="docutils literal"><span class="pre">&quot;&quot;</span></code>, not <code class="docutils literal"><span class="pre">&lt;&gt;</span></code>, to
specify Open vSwitch header names.</li>
</ol>
</div>
</div>
<span id="document-internals/contributing/documentation-style"></span><div class="section" id="open-vswitch-documentation-style">
<h4>Open vSwitch Documentation Style<a class="headerlink" href="#open-vswitch-documentation-style" title="Permalink to this headline">¶</a></h4>
<p>This file describes the documentation style used in all documentation found in
Open vSwitch. Documentation includes any documents found in <code class="docutils literal"><span class="pre">Documentation</span></code>
along with any <code class="docutils literal"><span class="pre">README</span></code>, <code class="docutils literal"><span class="pre">MAINTAINERS</span></code>, or generally <code class="docutils literal"><span class="pre">rst</span></code> suffixed
documents found in the project tree.</p>
<div class="section" id="restructuredtext-vs-sphinx">
<h5>reStructuredText vs. Sphinx<a class="headerlink" href="#restructuredtext-vs-sphinx" title="Permalink to this headline">¶</a></h5>
<p><a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText (reST)</a> is the syntax, while <a class="reference external" href="http://www.sphinx-doc.org/">Sphinx</a> is a documentation
generator.  Sphinx introduces a number of extensions to reST, like the
<code class="docutils literal"><span class="pre">:ref:</span></code> role, which can and should be used in documentation, but these will
not work correctly on GitHub. As such, these extensions should not be used in
any documentation in the root level, such as the <code class="docutils literal"><span class="pre">README</span></code>.</p>
</div>
<div class="section" id="rest-conventions">
<h5>reST Conventions<a class="headerlink" href="#rest-conventions" title="Permalink to this headline">¶</a></h5>
<div class="section" id="basics">
<h6>Basics<a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h6>
<p>Many of the basic documentation guidelines match those of the
<a class="reference internal" href="contents.html#document-internals/contributing/coding-style"><em>Open vSwitch Coding Style</em></a>.</p>
<ul>
<li><p class="first">Use reStructuredText (reST) for all documentation.</p>
<p>Sphinx extensions can be used, but only for documentation in the
<code class="docutils literal"><span class="pre">Documentation</span></code> folder.</p>
</li>
<li><p class="first">Limit lines at 79 characters.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An exception to this rule is text within code-block elements that cannot
be wrapped and links within references.</p>
</div>
</li>
<li><p class="first">Use spaces for indenation.</p>
</li>
<li><p class="first">Match indentation levels.</p>
<p>A change in indentation level usually signifies a change in content nesting,
by either closing the existing level or introducing a new level.</p>
</li>
<li><p class="first">Avoid trailing spaces on lines.</p>
</li>
<li><p class="first">Include a license (see this file) in all docs.</p>
</li>
<li><p class="first">Most importantly, always build and display documentation before submitting
changes! Docs aren&#8217;t unit testable, so visible inspection is necessary.</p>
</li>
</ul>
</div>
<div class="section" id="file-names">
<h6>File Names<a class="headerlink" href="#file-names" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p class="first">Use hyphens as space delimiters. For example: <code class="docutils literal"><span class="pre">my-readme-document.rst</span></code></p>
</li>
<li><p class="first">Use lowercase filenames.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An exception to this rule is any documents found in the root-level of the
project.</p>
</div>
</li>
</ul>
</div>
<div class="section" id="titles">
<h6>Titles<a class="headerlink" href="#titles" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p class="first">Use the following headers levels.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">=======</span></code>  Heading 0 (reserved for the title in a document)</div>
<div class="line"><code class="docutils literal"><span class="pre">-------</span></code>  Heading 1</div>
<div class="line"><code class="docutils literal"><span class="pre">~~~~~~~</span></code>  Heading 2</div>
<div class="line"><code class="docutils literal"><span class="pre">+++++++</span></code>  Heading 3</div>
<div class="line"><code class="docutils literal"><span class="pre">'''''''</span></code>  Heading 4</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Avoid using lower heading levels by rewriting and reorganizing the
information.</p>
</div>
</li>
<li><p class="first">Under- and overlines should be of the same length as that of the heading
text.</p>
</li>
<li><p class="first">Use &#8220;title case&#8221; for headers.</p>
</li>
</ul>
</div>
<div class="section" id="code">
<h6>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Use <code class="docutils literal"><span class="pre">::</span></code>, the <code class="docutils literal"><span class="pre">code</span></code> role or the <code class="docutils literal"><span class="pre">code-block::</span> <span class="pre">&lt;syntax&gt;</span></code> role to prefix
code. The <code class="docutils literal"><span class="pre">code-block::</span> <span class="pre">&lt;syntax&gt;</span></code> format is preferred as this provides
syntax highlighting for non-Python languages, such as Bash or PowerShell.</li>
<li>Prefix commands with <code class="docutils literal"><span class="pre">$</span></code>.</li>
<li>Where possible, include fully-working snippets of code. If there
pre-requisites, explain what they are and how to achieve them.</li>
</ul>
</div>
<div class="section" id="admonitions">
<h6>Admonitions<a class="headerlink" href="#admonitions" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p class="first">Use admonitions to call attention to important information.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>.. note::

   This is a sample callout for some useful tip or trick.
</pre></div>
</div>
<p>Example admonitions include: <code class="docutils literal"><span class="pre">warning</span></code>, <code class="docutils literal"><span class="pre">important</span></code>, <code class="docutils literal"><span class="pre">note</span></code>, <code class="docutils literal"><span class="pre">tip</span></code> or
<code class="docutils literal"><span class="pre">seealso</span></code>.</p>
</li>
<li><p class="first">Use notes sparingly. Avoid having more than one per subsection.</p>
</li>
</ul>
</div>
<div class="section" id="tables">
<h6>Tables<a class="headerlink" href="#tables" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Use either graphic tables, list tables or CSV tables.</li>
</ul>
<div class="section" id="graphic-tables">
<h7>Graphic tables<a class="headerlink" href="#graphic-tables" title="Permalink to this headline">¶</a></h7>
<div class="highlight-python"><div class="highlight"><pre><span></span>.. table:: OVS-Linux kernel compatibility

  ============ ==============
  Open vSwitch Linux kernel
  ============ ==============
  1.4.x        2.6.18 to 3.2
  1.5.x        2.6.18 to 3.2
  1.6.x        2.6.18 to 3.2
  ============ ==============
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>.. table:: OVS-Linux kernel compatibility

  +--------------+---------------+
  | Open vSwitch | Linux kernel  |
  +==============+===============+
  | 1.4.x        | 2.6.18 to 3.2 |
  +--------------+---------------+
  | 1.5.x        | 2.6.18 to 3.2 |
  +--------------+---------------+
  | 1.6.x        | 2.6.18 to 3.2 |
  +--------------+---------------+
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">table</span></code> role - <code class="docutils literal"><span class="pre">..</span> <span class="pre">table::</span> <span class="pre">&lt;name&gt;</span></code> -  can be safely omitted.</p>
</div>
</div>
<div class="section" id="list-tables">
<h7>List tables<a class="headerlink" href="#list-tables" title="Permalink to this headline">¶</a></h7>
<div class="highlight-python"><div class="highlight"><pre><span></span>.. list-table:: OVS-Linux kernel compatibility
   :widths: 10 15
   :header-rows: 1

   * - Open vSwitch
     - Linux kernel
   * - 1.4.x
     - 2.6.18 to 3.2
   * - 1.5.x
     - 2.6.18 to 3.2
   * - 1.6.x
     - 2.6.18 to 3.2
</pre></div>
</div>
</div>
<div class="section" id="csv-tables">
<h7>CSV tables<a class="headerlink" href="#csv-tables" title="Permalink to this headline">¶</a></h7>
<div class="highlight-python"><div class="highlight"><pre><span></span>.. csv-table:: OVS-Linux kernel compatibility
   :header: Open vSwitch, Linux kernel
   :widths: 10 15

   1.4.x, 2.6.18 to 3.2
   1.5.x, 2.6.18 to 3.2
   1.6.x, 2.6.18 to 3.2
</pre></div>
</div>
</div>
</div>
<div class="section" id="cross-referencing">
<h6>Cross-referencing<a class="headerlink" href="#cross-referencing" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p class="first">To link to an external file or document, include as a link.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Here&#39;s a `link &lt;http://openvswitch.org&gt;`__ to the Open vSwitch website.


Here&#39;s a `link`_ in reference style.

.. _link: http://openvswitch.org
</pre></div>
</div>
</li>
<li><p class="first">You can also use citations.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Refer to the Open vSwitch documentation [1]_.

References
----------

.. [1]: http://openvswitch.org
</pre></div>
</div>
</li>
<li><p class="first">To cross-reference another doc, use the <code class="docutils literal"><span class="pre">doc</span></code> role.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Here is a link to the :doc:`/README.rst`
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is a Sphinx extension. Do not use this in any top-level documents.</p>
</div>
</li>
<li><p class="first">To cross-reference an arbitrary location in a doc, use the <code class="docutils literal"><span class="pre">ref</span></code> role.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>.. _sample-crossref

Title
~~~~~

Hello, world.

Another Title
~~~~~~~~~~~~~

Here is a cross-reference to :ref:`sample-crossref`.
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is a Sphinx extension. Do not use this in any top-level documents.</p>
</div>
</li>
</ul>
</div>
<div class="section" id="figures-and-other-media">
<h6>Figures and Other Media<a class="headerlink" href="#figures-and-other-media" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p class="first">All images should be in PNG format and compressed where possible. For PNG
files, use OptiPNG and AdvanceCOMP&#8217;s <code class="docutils literal"><span class="pre">advpng</span></code>:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ optipng -o7 -zm1-9 -i0 -strip all &lt;path_to_png&gt;
$ advpng -z4 &lt;path_to_png&gt;
</pre></div>
</div>
</li>
<li><p class="first">Any ASCII text &#8220;images&#8221; should be included in code-blocks to preserve
formatting</p>
</li>
<li><p class="first">Include other reStructuredText verbatim in a current document</p>
</li>
</ul>
</div>
<div class="section" id="comments">
<h6>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p class="first">Comments are indicated by means of the <code class="docutils literal"><span class="pre">..</span></code> marker.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>.. TODO(stephenfin) This section needs some work. This TODO will not
   appear in the final generated document, however.
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="writing-style">
<h5>Writing Style<a class="headerlink" href="#writing-style" title="Permalink to this headline">¶</a></h5>
<p>Follow these guidelines to ensure readability and consistency of the Open
vSwitch documentation. These guidelines are based on the <a class="reference external" href="http://www.redbooks.ibm.com/Redbooks.nsf/ibmpressisbn/9780132101301?Open">IBM Style Guide</a>.</p>
<ul>
<li><p class="first">Use standard US English</p>
<p>Use a spelling and grammar checking tool as necessary.</p>
</li>
<li><p class="first">Expand initialisms and acronyms on first usage.</p>
<p>Commonly used terms like CPU or RAM are allowed.</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Do not use</th>
<th class="head">Do use</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>OVS is a virtual switch. OVS has...</td>
<td>Open vSwitch (OVS) is a virtual switch. OVS has...</td>
</tr>
<tr class="row-odd"><td>The VTEP emulator is...</td>
<td>The Virtual Tunnel Endpoint (VTEP) emulator is...</td>
</tr>
</tbody>
</table>
</li>
<li><p class="first">Write in the active voice</p>
<p>The subject should do the verb&#8217;s action, rather than be acted upon.</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Do not use</th>
<th class="head">Do use</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>A bridge is created by you</td>
<td>Create a bridge</td>
</tr>
</tbody>
</table>
</li>
<li><p class="first">Write in the present tense</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Do not use</th>
<th class="head">Do use</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Once the bridge is created, you can create a port</td>
<td>Once the bridge is created, create a port</td>
</tr>
</tbody>
</table>
</li>
<li><p class="first">Write in second person</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Do not use</th>
<th class="head">Do use</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>To create a bridge, the user runs:</td>
<td>To create a bridge, run:</td>
</tr>
</tbody>
</table>
</li>
<li><p class="first">Keep sentences short and consise</p>
</li>
<li><p class="first">Eliminate needless politeness</p>
<p>Avoid &#8220;please&#8221; and &#8220;thank you&#8221;</p>
</li>
</ul>
</div>
<div class="section" id="helpful-tools">
<h5>Helpful Tools<a class="headerlink" href="#helpful-tools" title="Permalink to this headline">¶</a></h5>
<p>There are a number of tools, online and offline, which can be used to preview
documents are you edit them:</p>
<ul>
<li><p class="first"><a class="reference external" href="http://rst.ninjs.org/">rst.ninjs.org</a></p>
<p>An online rST editor/previewer</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/retext-project/retext">ReText</a></p>
<p>A simple but powerful editor for Markdown and reStructuredText. ReText is
written in Python.</p>
</li>
<li><p class="first"><a class="reference external" href="https://mg.pov.lt/restview/">restview</a></p>
<p>A viewer for ReStructuredText documents that renders them on the fly.</p>
</li>
</ul>
</div>
<div class="section" id="useful-links">
<h5>Useful Links<a class="headerlink" href="#useful-links" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="http://docutils.sourceforge.net/docs/user/rst/quickref.html">Quick reStructuredText</a></li>
<li><a class="reference external" href="http://sphinx.readthedocs.io/en/latest/rest.html">Sphinx Documentation</a></li>
</ul>
</div>
</div>
<span id="document-internals/contributing/libopenvswitch-abi"></span><div class="section" id="open-vswitch-library-abi-updates">
<h4>Open vSwitch Library ABI Updates<a class="headerlink" href="#open-vswitch-library-abi-updates" title="Permalink to this headline">¶</a></h4>
<p>This file describes the manner in which the Open vSwitch shared library
manages different ABI and API revisions.  This document aims to describe
the background, goals, and concrete mechanisms used to export code-space
functionality so that it may be shared between multiple applications.</p>
<div class="section" id="definitions">
<span id="id1"></span><h5>Definitions<a class="headerlink" href="#definitions" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils" id="id3">
<caption><span class="caption-text">Definitions for terms appearing in this document</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Term</th>
<th class="head">Definition</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ABI</td>
<td>Abbreviation of Application Binary Interface</td>
</tr>
<tr class="row-odd"><td>API</td>
<td>Abbreviation of Application Programming Interface</td>
</tr>
<tr class="row-even"><td>Application Binary Interface</td>
<td>The low-level runtime interface exposed
by an object file.</td>
</tr>
<tr class="row-odd"><td>Application Programming Interface</td>
<td>The source-code interface descriptions
intended for use in multiple translation units when compiling.</td>
</tr>
<tr class="row-even"><td>Code library</td>
<td>A collection of function implementations and definitions
intended to be exported and called through a well-defined interface.</td>
</tr>
<tr class="row-odd"><td>Shared Library</td>
<td>A code library which is imported at run time.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="overview">
<span id="id2"></span><h5>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h5>
<p>C and C++ applications often use &#8216;external&#8217; functionality, such as printing
specialized data types or parsing messages, which has been exported for common
use.  There are many possible ways for applications to call such external
functionality, for instance by including an appropriate inline definition which
the compiler can emit as code in each function it appears.  One such way of
exporting and importing such functionality is through the use of a library
of code.</p>
<p>When a compiler builds object code from source files to produce object code,
the results are binary data arranged with specific calling conventions,
alignments, and order suitable for a run-time environment or linker.  This
result defines a specific ABI.</p>
<p>As library of code develops and its exported interfaces change over time, the
resulting ABI may change as well.  Therefore, care must be taken to ensure the
changes made to libraries of code are effectively communicated to applications
which use them.  This includes informing the applications when incompatible
changes are made.</p>
<p>The Open vSwitch project exports much of its functionality through multiple
such libraries of code.  These libraries are intended for multiple applications
to import and use.  As the Open vSwitch project continues to evolve and change,
its exported code will evolve as well.  To ensure that applications linking to
these libraries are aware of these changes, Open vSwitch employs libtool
version stamps.</p>
</div>
<div class="section" id="abi-policy">
<span id="policies"></span><h5>ABI Policy<a class="headerlink" href="#abi-policy" title="Permalink to this headline">¶</a></h5>
<p>Open vSwitch will export the ABI version at the time of release, such that the
library name will be the major version, and the rest of the release version
information will be conveyed with a libtool interface version.</p>
<p>The intent is for Open vSwitch to maintain an ABI stability for each minor
revision only (so that Open vSwitch release 2.5 carries a guarantee for all
2.5.ZZ micro-releases).  This means that any porting effort to stable branches
must take not to disrupt the existing ABI.  Each new &#8216;minor-level&#8217; release
bumps the libtool &#8216;current&#8217; version, which informs the linker of a backwards
incompatible interface, signaling that libraries exposed by Open vSwitch 2.6
will not maintain ABI stability with Open vSwitch 2.5.</p>
</div>
<div class="section" id="coding">
<h5>Coding<a class="headerlink" href="#coding" title="Permalink to this headline">¶</a></h5>
<p>At build time, if building shared libraries by passing the <cite>&#8211;enable-shared</cite>
arguments to <cite>./configure</cite>, version information is extracted from
the <code class="docutils literal"><span class="pre">$PACKAGE_VERSION</span></code> automake variable and formatted into the appropriate
arguments.  These get exported for use in Makefiles as <code class="docutils literal"><span class="pre">$OVS_LTINFO</span></code>, and
passed to each exported library along with other <code class="docutils literal"><span class="pre">LDFLAGS</span></code>.</p>
<p>Therefore, when adding a new library to the build system, these version flags
should be included with the <code class="docutils literal"><span class="pre">$LDFLAGS</span></code> variable.  Nothing else needs to be
done.</p>
<p>Changing an exported function definition (from a file in, for instance
<cite>lib/*.h</cite>) is only permitted from minor release to minor release.  Likewise
changes to library data structures should only occur from minor release to
minor release.</p>
</div>
</div>
</div>
</div>
<span id="document-internals/mailing-lists"></span><div class="section" id="mailing-lists">
<h3>Mailing Lists<a class="headerlink" href="#mailing-lists" title="Permalink to this headline">¶</a></h3>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Report security issues <strong>only</strong> to <a class="reference external" href="mailto:security&#37;&#52;&#48;openvswitch&#46;org">security<span>&#64;</span>openvswitch<span>&#46;</span>org</a>. For more
information, refer to our <a class="reference internal" href="contents.html#document-internals/security"><em>security policies</em></a>.</p>
</div>
<div class="section" id="ovs-announce">
<h4>ovs-announce<a class="headerlink" href="#ovs-announce" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference external" href="ovs-announce&#64;openvwitch.org">ovs-announce</a> mailing list is used to announce new versions of Open
vSwitch and is extremely low-volume. <a class="reference external" href="https://mail.openvswitch.org/mailman/listinfo/ovs-announce/">(subscribe)</a> <a class="reference external" href="https://mail.openvswitch.org/pipermail/ovs-announce/">(archives)</a></p>
</div>
<div class="section" id="ovs-discuss">
<h4>ovs-discuss<a class="headerlink" href="#ovs-discuss" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference external" href="ovs-discuss&#64;openvwitch.org">ovs-discuss</a> mailing list is used to discuss plans and design decisions
for Open vSwitch. It is also an appropriate place for user questions.
<a class="reference external" href="https://mail.openvswitch.org/mailman/listinfo/ovs-discuss/">(subscribe)</a> <a class="reference external" href="https://mail.openvswitch.org/pipermail/ovs-discuss/">(archives)</a></p>
</div>
<div class="section" id="ovs-dev">
<h4>ovs-dev<a class="headerlink" href="#ovs-dev" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference external" href="ovs-dev&#64;openvwitch.org">ovs-dev</a> mailing list is used to discuss development and review code
before being committed. <a class="reference external" href="https://mail.openvswitch.org/mailman/listinfo/ovs-dev/">(subscribe)</a> <a class="reference external" href="https://mail.openvswitch.org/pipermail/ovs-dev/">(archives)</a></p>
</div>
<div class="section" id="ovs-git">
<h4>ovs-git<a class="headerlink" href="#ovs-git" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference external" href="ovs-git&#64;openvwitch.org">ovs-git</a> mailing list hooks into Open vSwitch&#8217;s version control system
to receive commits. <a class="reference external" href="https://mail.openvswitch.org/mailman/listinfo/ovs-git/">(subscribe)</a> <a class="reference external" href="https://mail.openvswitch.org/pipermail/ovs-git/">(archives)</a></p>
</div>
<div class="section" id="ovs-build">
<h4>ovs-build<a class="headerlink" href="#ovs-build" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference external" href="ovs-build&#64;openvwitch.org">ovs-build</a> mailing list hooks into Open vSwitch&#8217;s continuous integration
system to receive build reports. <a class="reference external" href="https://mail.openvswitch.org/mailman/listinfo/ovs-build/">(subscribe)</a> <a class="reference external" href="https://mail.openvswitch.org/pipermail/ovs-build/">(archives)</a></p>
</div>
<div class="section" id="bugs">
<h4>bugs<a class="headerlink" href="#bugs" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference external" href="bugs&#64;openvswitch.org">bugs</a> mailing list is an alias for the discuss mailing list.</p>
</div>
<div class="section" id="security">
<h4>security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference external" href="security&#64;ovs.org">security</a> mailing list is for submitting security vulnerabilities to the
security team.</p>
</div>
</div>
<span id="document-internals/patchwork"></span><div class="section" id="patchwork">
<h3>Patchwork<a class="headerlink" href="#patchwork" title="Permalink to this headline">¶</a></h3>
<p>Open vSwitch uses <a class="reference external" href="https://github.com/getpatchwork/patchwork">Patchwork</a> to track the status of patches sent to the
<a class="reference internal" href="contents.html#document-internals/mailing-lists"><em>ovs-dev mailing list</em></a>. The Open vSwitch Patchwork
instance can be found on <a class="reference external" href="https://patchwork.ozlabs.org/project/openvswitch/list/">ozlabs.org</a>. The <code class="docutils literal"><span class="pre">pwclientrc</span></code> file, required for
<em>pwclient</em>, can be found on the <a class="reference external" href="https://patchwork.ozlabs.org/project/openvswitch/">project page</a></p>
<p>Patchwork provides a number of useful features for developers working on Open
vSwitch:</p>
<ul class="simple">
<li>Tracking the lifecycle of patches (accepted, rejected, under-review, ...)</li>
<li>Assigning reviewers (delegates) to patches</li>
<li>Downloading/applying patches via the web UI or the XML-RPC API (see
<a class="reference internal" href="#pwclient"><span>pwclient</span></a>)</li>
<li>A usable UI for viewing patch discussions</li>
</ul>
<div class="section" id="pwclient">
<span id="id4"></span><h4>pwclient<a class="headerlink" href="#pwclient" title="Permalink to this headline">¶</a></h4>
<p>The <em>pwclient</em> tool provides an way to download and apply patches, change the
state of patches in Patchwork, and more. You can download <em>pwclient</em> from
<a class="reference external" href="https://patchwork.ozlabs.org/pwclient/">here</a>. Once downloaded, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ pwclient help
</pre></div>
</div>
<p>to get more information about the functionality pwclient provides.</p>
</div>
</div>
<span id="document-internals/release-process"></span><div class="section" id="open-vswitch-release-process">
<h3>Open vSwitch Release Process<a class="headerlink" href="#open-vswitch-release-process" title="Permalink to this headline">¶</a></h3>
<p>This document describes the process ordinarily used for Open vSwitch
development and release.  Exceptions are sometimes necessary, so all of the
statements here should be taken as subject to change through rough consensus of
Open vSwitch contributors, obtained through public discussion on, e.g., ovs-dev
or the #openvswitch IRC channel.</p>
<div class="section" id="release-strategy">
<h4>Release Strategy<a class="headerlink" href="#release-strategy" title="Permalink to this headline">¶</a></h4>
<p>Open vSwitch feature development takes place on the &#8220;master&#8221; branch.
Ordinarily, new features are rebased against master and applied directly.  For
features that take significant development, sometimes it is more appropriate to
merge a separate branch into master; please discuss this on ovs-dev in advance.</p>
<p>Periodically, the OVS developers fork a branch from master to become an
official release.  These release branches are named for expected release
number, e.g. &#8220;branch-2.3&#8221; for the branch that will yield Open vSwitch 2.3.x.
Release branches should receive only bug fixes, not new features.  Bug fixes
applied to release branches should be backports of corresponding bug fixes to
the master branch, except for bugs present only on release branches (which are
rare in practice).</p>
<p>Sometimes there can be exceptions to the rule that a release branch receives
only bug fixes.  In particular, after a release branch is created, but before
the first actual release from that branch, it can be appropriate to add
features.  Like bug fixes, new features on release branches should be backports
of the corresponding commits on the master branch.  Features to be added to
release branches should be limited in scope and risk and discussed on ovs-dev
before creating the branch.</p>
<p>After a period of testing and stabilization, and rough consensus obtained from
contributors that the release is ready, the developers release the .0 release
on its branch, e.g. 2.3.0 for branch-2.3.  To make the actual release, a
developer pushes a signed tag named, e.g. v2.3.0, to the Open vSwitch
repository, makes a release tarball available on openvswitch.org, and posts a
release announcement to ovs-announce.</p>
<p>As a number of bug fixes accumulate, or after important bugs or vulnerabilities
are fixed, the OVS developers may make additional releases from a branch:
2.3.1, 2.3.2, and so on.  The process is the same for these additional release
as for a .0 release.</p>
<p>At most two release branches are formally maintained at any given time: the
latest release and the latest release designed as LTS.  An LTS release is one
that the OVS project has designated as being maintained for a longer period of
time.  Currently, an LTS release is maintained until the next LTS is chosen.
There is not currently a strict guideline on how often a new LTS release is
chosen, but so far it has been about every 2 years.  That could change based on
the current state of OVS development.  For example, we do not want to designate
a new release as LTS that includes disruptive internal changes, as that may
make it harder to support for a longer period of time.  Discussion about
choosing the next LTS release occurs on the OVS development mailing list.</p>
</div>
<div class="section" id="release-numbering">
<h4>Release Numbering<a class="headerlink" href="#release-numbering" title="Permalink to this headline">¶</a></h4>
<p>The version number on master should normally end in .90.  This indicates that
the Open vSwitch version is &#8220;almost&#8221; the next version to branch.</p>
<p>Forking master into branch-x.y requires two commits to master.  The first is
titled &#8220;Prepare for x.y.0&#8221; and increments the version number to x.y.  This is
the initial commit on branch-x.y.  The second is titled &#8220;Prepare for post-x.y.0
(x.y.90)&#8221; and increments the version number to x.y.90.</p>
<p>The version number on a release branch is x.y.z, where z is initially 0.
Making a release requires two commits.  The first is titled <em>Set release dates
for x.y.z.</em> and updates NEWS and debian/changelog to specify the release date
of the new release.  This commit is the one made into a tarball and tagged.
The second is titled <em>Prepare for x.y.(z+1).</em> and increments the version number
and adds a blank item to NEWS with an unspecified date.</p>
</div>
<div class="section" id="release-scheduling">
<h4>Release Scheduling<a class="headerlink" href="#release-scheduling" title="Permalink to this headline">¶</a></h4>
<p>Open vSwitch makes releases at the following six-month cadence, which of course
is subject to change.</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="29%" />
<col width="48%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Time (months)</strong></td>
<td><strong>Approximate Dates</strong></td>
<td><strong>Event</strong></td>
</tr>
<tr class="row-even"><td>T</td>
<td>Mar 1, Sep 1</td>
<td>Release cycle for version x.y begins</td>
</tr>
<tr class="row-odd"><td>T + 4</td>
<td>Jul 1, Jan 1</td>
<td>branch-x.y forks from master</td>
</tr>
<tr class="row-even"><td>T + 5.5</td>
<td>Aug 15, Feb 15</td>
<td>branch-x.y released as version x.y.0</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="contact">
<h4>Contact<a class="headerlink" href="#contact" title="Permalink to this headline">¶</a></h4>
<p>Use <a class="reference external" href="mailto:dev&#37;&#52;&#48;openvswitch&#46;org">dev<span>&#64;</span>openvswitch<span>&#46;</span>org</a> to discuss the Open vSwitch development and release
process.</p>
</div>
</div>
<span id="document-internals/bugs"></span><div class="section" id="reporting-bugs-in-open-vswitch">
<h3>Reporting Bugs in Open vSwitch<a class="headerlink" href="#reporting-bugs-in-open-vswitch" title="Permalink to this headline">¶</a></h3>
<p>We are eager to hear from users about problems that they have encountered with
Open vSwitch. This file documents how best to report bugs so as to ensure that
they can be fixed as quickly as possible.</p>
<p>Please report bugs by sending email to <a class="reference external" href="mailto:bugs&#37;&#52;&#48;openvswitch&#46;org">bugs<span>&#64;</span>openvswitch<span>&#46;</span>org</a>.</p>
<p>For reporting security vulnerabilities, please read <a class="reference internal" href="contents.html#document-internals/security"><em>Open vSwitch&#8217;s Security Process</em></a>.</p>
<p>The most important parts of your bug report are the following:</p>
<ul class="simple">
<li>What you did that make the problem appear.</li>
<li>What you expected to happen.</li>
<li>What actually happened.</li>
</ul>
<p>Please also include the following information:</p>
<ul class="simple">
<li>The Open vSwitch version number (as output by <code class="docutils literal"><span class="pre">ovs-vswitchd</span> <span class="pre">--version</span></code>).</li>
<li>The Git commit number (as output by <code class="docutils literal"><span class="pre">git</span> <span class="pre">rev-parse</span> <span class="pre">HEAD</span></code>), if you built
from a Git snapshot.</li>
<li>Any local patches or changes you have applied (if any).</li>
</ul>
<p>The following are also handy sometimes:</p>
<ul class="simple">
<li>The kernel version on which Open vSwitch is running (from <code class="docutils literal"><span class="pre">/proc/version</span></code>)
and the distribution and version number of your OS (e.g. &#8220;Centos 5.0&#8221;).</li>
<li>The contents of the vswitchd configuration database (usually
<code class="docutils literal"><span class="pre">/etc/openvswitch/conf.db</span></code>).</li>
<li>The output of <code class="docutils literal"><span class="pre">ovs-dpctl</span> <span class="pre">show</span></code>.</li>
<li>If you have Open vSwitch configured to connect to an OpenFlow
controller, the output of <code class="docutils literal"><span class="pre">ovs-ofctl</span> <span class="pre">show</span> <span class="pre">&lt;bridge&gt;</span></code> for each
<code class="docutils literal"><span class="pre">&lt;bridge&gt;</span></code> configured in the vswitchd configuration database.</li>
<li>A fix or workaround, if you have one.</li>
<li>Any other information that you think might be relevant.</li>
</ul>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last"><a class="reference external" href="mailto:bugs&#37;&#52;&#48;openvswitch&#46;org">bugs<span>&#64;</span>openvswitch<span>&#46;</span>org</a> is a public mailing list, to which anyone can subscribe,
so do not include confidential information in your bug report.</p>
</div>
</div>
<span id="document-internals/security"></span><div class="section" id="open-vswitch-s-security-process">
<h3>Open vSwitch&#8217;s Security Process<a class="headerlink" href="#open-vswitch-s-security-process" title="Permalink to this headline">¶</a></h3>
<p>This is a proposed security vulnerability reporting and handling process for
Open vSwitch. It is based on the OpenStack vulnerability management process
described at <a class="reference external" href="https://wiki.openstack.org/wiki/Vulnerability_Management">https://wiki.openstack.org/wiki/Vulnerability_Management</a>.</p>
<p>The OVS security team coordinates vulnerability management using the
ovs-security mailing list. Membership in the security team and subscription to
its mailing list consists of a small number of trustworthy people, as
determined by rough consensus of the Open vSwitch committers on the
ovs-committers mailing list. The Open vSwitch security team should include Open
vSwitch committers, to ensure prompt and accurate vulnerability assessments and
patch review.</p>
<p>We encourage everyone involved in the security process to GPG-sign their
emails. We additionally encourage GPG-encrypting one-on-one conversations as
part of the security process.</p>
<div class="section" id="what-is-a-vulnerability">
<h4>What is a vulnerability?<a class="headerlink" href="#what-is-a-vulnerability" title="Permalink to this headline">¶</a></h4>
<p>All vulnerabilities are bugs, but not every bug is a vulnerability.
Vulnerabilities compromise one or more of:</p>
<ul class="simple">
<li>Confidentiality (personal or corporate confidential data).</li>
<li>Integrity (trustworthiness and correctness).</li>
<li>Availability (uptime and service).</li>
</ul>
<p>Here are some examples of vulnerabilities to which one would expect to apply
this process:</p>
<ul class="simple">
<li>A crafted packet that causes a kernel or userspace crash (Availability).</li>
<li>A flow translation bug that misforwards traffic in a way likely to hop over
security boundaries (Integrity).</li>
<li>An OpenFlow protocol bug that allows a controller to read arbitrary files
from the file system (Confidentiality).</li>
<li>Misuse of the OpenSSL library that allows bypassing certificate checks
(Integrity).</li>
<li>A bug (memory corruption, overflow, ...) that allows one to modify the
behaviour of OVS through external configuration interfaces such as OVSDB
(Integrity).</li>
<li>Privileged information is exposed to unprivileged users (Confidentiality).</li>
</ul>
<p>If in doubt, please do use the vulnerability management process. At worst, the
response will be to report the bug through the usual channels.</p>
</div>
<div class="section" id="step-1-reception">
<h4>Step 1: Reception<a class="headerlink" href="#step-1-reception" title="Permalink to this headline">¶</a></h4>
<p>To report an Open vSwitch vulnerability, send an email to the ovs-security
mailing list (see <a class="reference internal" href="#contact">contact</a> at the end of this document). A security team
member should reply to the reporter acknowledging that the report has been
received.</p>
<p>Consider reporting the information mentioned in <a class="reference internal" href="contents.html#document-internals/bugs"><em>Reporting Bugs in Open vSwitch</em></a>, where relevant.</p>
<p>Reporters may ask for a GPG key while initiating contact with the security team
to deliver more sensitive reports.</p>
<p>The Linux kernel has <a class="reference external" href="https://static.lwn.net/kerneldoc/admin-guide/security-bugs.html">its own vulnerability management process</a>.  Handling
of vulnerabilities that affect both the Open vSwitch tree and the upstream
Linux kernel should be reported through both processes.  Send your report as a
single email to both the kernel and OVS security teams to allow those teams to
most easily coordinate among themselves.</p>
</div>
<div class="section" id="step-2-assessment">
<h4>Step 2: Assessment<a class="headerlink" href="#step-2-assessment" title="Permalink to this headline">¶</a></h4>
<p>The security team should discuss the vulnerability. The reporter should be
included in the discussion (via &#8220;CC&#8221;) to an appropriate degree.</p>
<p>The assessment should determine which Open vSwitch versions are affected (e.g.
every version, only the latest release, only unreleased versions), the
privilege required to take advantage of the vulnerability (e.g. any network
user, any local L2 network user, any local system user, connected OpenFlow
controllers), the severity of the vulnerability, and how the vulnerability may
be mitigated (e.g. by disabling a feature).</p>
<p>The treatment of the vulnerability could end here if the team determines that
it is not a realistic vulnerability.</p>
</div>
<div class="section" id="step-3a-document">
<h4>Step 3a: Document<a class="headerlink" href="#step-3a-document" title="Permalink to this headline">¶</a></h4>
<p>The security team develops a security advisory document. The security team may,
at its discretion, include the reporter (via &#8220;CC&#8221;) in developing the security
advisory document, but in any case should accept feedback from the reporter
before finalizing the document. When the document is final, the security team
should obtain a CVE for the vulnerability from a CNA
(<a class="reference external" href="https://cve.mitre.org/cve/cna.html">https://cve.mitre.org/cve/cna.html</a>).</p>
<p>The document credits the reporter and describes the vulnerability, including
all of the relevant information from the assessment in step 2.  Suitable
sections for the document include:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>* Title: The CVE identifier, a short description of the
  vulnerability.  The title should mention Open vSwitch.

  In email, the title becomes the subject.  Pre-release advisories
  are often passed around in encrypted email, which have plaintext
  subjects, so the title should not be too specific.

* Description: A few paragraphs describing the general
  characteristics of the vulnerability, including the versions of
  Open vSwitch that are vulnerable, the kind of attack that
  exposes the vulnerability, and potential consequences of the
  attack.

  The description should re-state the CVE identifier, in case the
  subject is lost when an advisory is sent over email.

* Mitigation: How an Open vSwitch administrator can minimize the
  potential for exploitation of the vulnerability, before applying
  a fix.  If no mitigation is possible or recommended, explain
  why, to reduce the chance that at-risk users believe they are
  not at risk.

* Fix: Describe how to fix the vulnerability, perhaps in terms of
  applying a source patch.  The patch or patches themselves, if
  included in the email, should be at the very end of the advisory
  to reduce the risk that a reader would stop reading at this
  point.

* Recommendation: A concise description of the security team&#39;s
  recommendation to users.

* Acknowledgments: Thank the reporters.

* Vulnerability Check: A step-by-step procedure by which a user
  can determine whether an installed copy of Open vSwitch is
  vulnerable.

  The procedure should clearly describe how to interpret the
  results, including expected results in vulnerable and
  not-vulnerable cases.  Thus, procedures that produce clear and
  easily distinguished results are preferred.

  The procedure should assume as little understanding of Open
  vSwitch as possible, to make it more likely that a competent
  administrator who does not specialize in Open vSwitch can
  perform it successfully.

  The procedure should have minimal dependencies on tools that are
  not widely installed.

  Given a choice, the procedure should be one that takes at least
  some work to turn into a useful exploit.  For example, a
  procedure based on &quot;ovs-appctl&quot; commands, which require local
  administrator access, is preferred to one that sends test
  packets to a machine, which only requires network connectivity.

  The section should say which operating systems it is designed
  for.  If the procedure is likely to be specific to particular
  architectures (e.g. x86-64, i386), it should state on which ones
  it has been tested.

  This section should state the risks of the procedure.  For
  example, if it can crash Open vSwitch or disrupt packet
  forwarding, say so.

  It is more useful to explain how to check an installed and
  running Open vSwitch than one built locally from source, but if
  it is easy to use the procedure from a sandbox environment, it
  can be helpful to explain how to do so.

* Patch: If a patch or patches are available, and it is practical
  to include them in the email, put them at the end.  Format them
  as described in :doc:`contributing/submitting-patches`, that is, as
  output by &quot;git format-patch&quot;.

  The patch subjects should include the version for which they are
  suited, e.g. &quot;[PATCH branch-2.3]&quot; for a patch against Open
  vSwitch 2.3.x.  If there are multiple patches for multiple
  versions of Open vSwitch, put them in separate sections with
  clear titles.

  Multiple patches for a single version of Open vSwitch, that must
  be stacked on top of each other to fix a single vulnerability,
  are undesirable because users are less likely to apply all of
  them correctly and in the correct order.

  Each patch should include a Vulnerability tag with the CVE
  identifier, a Reported-by tag or tags to credit the reporters,
  and a Signed-off-by tag to acknowledge the Developer&#39;s
  Certificate of Origin.  It should also include other appropriate
  tags, such as Acked-by tags obtained during review.
</pre></div>
</div>
<p><a class="reference external" href="https://mail.openvswitch.org/pipermail/ovs-announce/2016-March/000082.html">CVE-2016-2074</a>
is an example advisory document.</p>
</div>
<div class="section" id="step-3b-fix">
<h4>Step 3b: Fix<a class="headerlink" href="#step-3b-fix" title="Permalink to this headline">¶</a></h4>
<p>Steps 3a and 3b may proceed in parallel.</p>
<p>The security team develops and obtains (private) reviews for patches that fix
the vulnerability. If necessary, the security team pulls in additional
developers, who must agree to maintain confidentiality.</p>
</div>
<div class="section" id="step-4-embargoed-disclosure">
<h4>Step 4: Embargoed Disclosure<a class="headerlink" href="#step-4-embargoed-disclosure" title="Permalink to this headline">¶</a></h4>
<p>The security advisory and patches are sent to downstream stakeholders, with an
embargo date and time set from the time sent. Downstream stakeholders are
expected not to deploy or disclose patches until the embargo is passed.</p>
<p>A disclosure date is negotiated by the security team working with the bug
submitter as well as vendors. However, the Open vSwitch security team holds the
final say when setting a disclosure date. The timeframe for disclosure is from
immediate (esp. if it&#8217;s already publicly known) to a few weeks. As a basic
default policy, we expect report date to disclosure date to be 10 to 15
business days.</p>
<p>Operating system vendors are obvious downstream stakeholders. It may not be
necessary to be too choosy about who to include: any major Open vSwitch user
who is interested and can be considered trustworthy enough could be included.
To become a downstream stakeholder, email the ovs-security mailing list.</p>
<p>If the vulnerability is already public, skip this step.</p>
</div>
<div class="section" id="step-5-public-disclosure">
<h4>Step 5: Public Disclosure<a class="headerlink" href="#step-5-public-disclosure" title="Permalink to this headline">¶</a></h4>
<p>When the embargo expires, push the (reviewed) patches to appropriate branches,
post the patches to the ovs-dev mailing list (noting that they have already
been reviewed and applied), post the security advisory to appropriate mailing
lists (ovs-announce, ovs-discuss), and post the security advisory on the Open
vSwitch webpage.</p>
<p>When the patch is applied to LTS (long-term support) branches, a new version
should be released.</p>
<p>The security advisory should be GPG-signed by a security team member with a key
that is in a public web of trust.</p>
<div class="section" id="contact">
<span id="id1"></span><h5>Contact<a class="headerlink" href="#contact" title="Permalink to this headline">¶</a></h5>
<p>Report security vulnerabilities to the ovs-security mailing list:
<a class="reference external" href="mailto:security&#37;&#52;&#48;openvswitch&#46;org">security<span>&#64;</span>openvswitch<span>&#46;</span>org</a></p>
<p>Report problems with this document to the ovs-bugs mailing list:
<a class="reference external" href="mailto:bugs&#37;&#52;&#48;openvswitch&#46;org">bugs<span>&#64;</span>openvswitch<span>&#46;</span>org</a></p>
</div>
</div>
</div>
<span id="document-internals/committer-responsibilities"></span><div class="section" id="expectations-for-developers-with-open-vswitch-repo-access">
<h3>Expectations for Developers with Open vSwitch Repo Access<a class="headerlink" href="#expectations-for-developers-with-open-vswitch-repo-access" title="Permalink to this headline">¶</a></h3>
<div class="section" id="pre-requisites">
<h4>Pre-requisites<a class="headerlink" href="#pre-requisites" title="Permalink to this headline">¶</a></h4>
<p>Be familar with the guidlines and standards defined in
<a class="reference internal" href="contents.html#document-internals/contributing/index"><em>Contributing to Open vSwitch</em></a>.</p>
</div>
<div class="section" id="review">
<h4>Review<a class="headerlink" href="#review" title="Permalink to this headline">¶</a></h4>
<p>Code (yours or others&#8217;) must be reviewed publicly (by you or others) before you
push it to the repository. With one exception (see below), every change needs
at least one review.</p>
<p>If one or more people know an area of code particularly well, code that affects
that area should ordinarily get a review from one of them.</p>
<p>The riskier, more subtle, or more complicated the change, the more careful the
review required. When a change needs careful review, use good judgment
regarding the quality of reviews. If a change adds 1000 lines of new code, and
a review posted 5 minutes later says just &#8220;Looks good,&#8221; then this is probably
not a quality review.</p>
<p>(The size of a change is correlated with the amount of care needed in review,
but it is not strictly tied to it. A search and replace across many files may
not need much review, but one-line optimization changes can have widespread
implications.)</p>
<p>Your own small changes to fix a recently broken build (&#8220;make&#8221;) or tests (&#8220;make
check&#8221;), that you believe to be visible to a large number of developers, may be
checked in without review. If you are not sure, ask for review. If you do push
a build fix without review, send the patch to ovs-dev afterward as usual,
indicating in the email that you have already pushed it.</p>
<p>Regularly review submitted code in areas where you have expertise. Consider
reviewing other code as well.</p>
</div>
<div class="section" id="git-conventions">
<h4>Git conventions<a class="headerlink" href="#git-conventions" title="Permalink to this headline">¶</a></h4>
<p>Do not push merge commits to the Git repository without prior discussion on
ovs-dev.</p>
<p>If you apply a change (yours or another&#8217;s) then it is your responsibility to
handle any resulting problems, especially broken builds and other regressions.
If it is someone else&#8217;s change, then you can ask the original submitter to
address it. Regardless, you need to ensure that the problem is fixed in a
timely way. The definition of &#8220;timely&#8221; depends on the severity of the problem.</p>
<p>If a bug is present on master and other branches, fix it on master first, then
backport the fix to other branches. Straightforward backports do not require
additional review (beyond that for the fix on master).</p>
<p>Feature development should be done only on master. Occasionally it makes sense
to add a feature to the most recent release branch, before the first actual
release of that branch. These should be handled in the same way as bug fixes,
that is, first implemented on master and then backported.</p>
<p>Keep the authorship of a commit clear by maintaining a correct list of
&#8220;Signed-off-by:&#8221;s. If a confusing situation comes up, as it occasionally does,
bring it up on the mailing list. If you explain the use of &#8220;Signed-off-by:&#8221; to
a new developer, explain not just how but why, since the intended meaning of
&#8220;Signed-off-by:&#8221; is more important than the syntax. As part of your
explanation, quote or provide a URL to the Developer&#8217;s Certificate of Origin in
<a class="reference internal" href="contents.html#document-internals/contributing/submitting-patches"><em>Submitting Patches</em></a>.</p>
<p>Use Reported-by: and Tested-by: tags in commit messages to indicate the
source of a bug report.</p>
<p>Keep the <code class="docutils literal"><span class="pre">AUTHORS.rst</span></code> file up to date.</p>
</div>
</div>
<span id="document-internals/committer-grant-revocation"></span><div class="section" id="ovs-committer-grant-revocation-policy">
<h3>OVS Committer Grant/Revocation Policy<a class="headerlink" href="#ovs-committer-grant-revocation-policy" title="Permalink to this headline">¶</a></h3>
<p>An OVS committer is a participant in the project with the ability to commit
code directly to the master repository. Commit access grants a broad ability to
affect the progress of the project as presented by its most important artifact,
the code and related resources that produce working binaries of Open vSwitch.
As such it represents a significant level of trust in an individual&#8217;s
commitment to working with other committers and the community at large for the
benefit of the project. It can not be granted lightly and, in the worst case,
must be revocable if the trust placed in an individual was inappropriate.</p>
<p>This document suggests guidelines for granting and revoking commit access. It
is intended to provide a framework for evaluation of such decisions without
specifying deterministic rules that wouldn&#8217;t be sensitive to the nuance of
specific situations. In the end the decision to grant or revoke committer
privileges is a judgment call made by the existing set of committers.</p>
<div class="section" id="granting-commit-access">
<h4>Granting Commit Access<a class="headerlink" href="#granting-commit-access" title="Permalink to this headline">¶</a></h4>
<p>Granting commit access should be considered when a candidate has demonstrated
the following in their interaction with the project:</p>
<ul class="simple">
<li>Contribution of significant new features through the patch submission
process where:<ul>
<li>Submissions are free of obvious critical defects</li>
<li>Submissions do not typically require many iterations of improvement
to be accepted</li>
</ul>
</li>
<li>Consistent participation in code review of other&#8217;s patches, including
existing committers, with comments consistent with the overall project
standards</li>
<li>Assistance to those in the community who are less knowledgeable through
active participation in project forums such as the ovs-discuss mailing list.</li>
<li>Plans for sustained contribution to the project compatible with the project&#8217;s
direction as viewed by current committers.</li>
<li>Commitment to meet the expectations described in the &#8220;Expectations of
Developer&#8217;s with Open vSwitch Access&#8221;</li>
</ul>
<p>The process to grant commit access to a candidate is simple:</p>
<ul class="simple">
<li>An existing committer nominates the candidate by sending an email to all
existing committers with information substantiating the contributions of the
candidate in the areas described above.</li>
<li>All existing committers discuss the pros and cons of granting commit
access to the candidate in the email thread.</li>
<li>When the discussion has converged or a reasonable time has elapsed without
discussion developing (e.g. a few business days) the nominator calls for a
final decision on the candidate with a followup email to the thread.</li>
<li>Each committer may vote yes, no, or abstain by replying to the email thread.
A failure to reply is an implicit abstention.</li>
<li>After votes from all existing committers have been collected or a reasonable
time has elapsed for them to be provided (e.g. a couple of business days) the
votes are evaluated. To be granted commit access the candidate must receive
yes votes from a majority of the existing committers and zero no votes. Since
a no vote is effectively a veto of the candidate it should be accompanied by
a reason for the vote.</li>
<li>The nominator summarizes the result of the vote in an email to all existing
committers.</li>
<li>If the vote to grant commit access passed, the candidate is contacted with an
invitation to become a committer to the project which asks them to agree to
the committer expectations documented on the project web site.</li>
<li>If the candidate agrees access is granted by setting up commit access to the
repos on github.</li>
</ul>
</div>
<div class="section" id="revoking-commit-access">
<h4>Revoking Commit Access<a class="headerlink" href="#revoking-commit-access" title="Permalink to this headline">¶</a></h4>
<p>There are two situations in which commit access might be revoked.</p>
<p>The straightforward situation is a committer who is no longer active in the
project and has no plans to become active in the near future. The process in
this case is:</p>
<ul class="simple">
<li>Any time after a committer has been inactive for more than 6 months any other
committer to the project may identify that committer as a candidate for
revocation of commit access due to inactivity.</li>
<li>The plans of revocation should be sent in a private email to the candidate.</li>
<li>If the candidate for removal states plans to continue participating no action
is taken and this process terminates.</li>
<li>If the candidate replies they no longer require commit access then commit
access is removed and a notification is sent to the candidate and all
existing committers.</li>
<li>If the candidate can not be reached within 1 week of the first attempting to
contact this process continues.</li>
<li>A message proposing removal of commit access is sent to the candidate and all
other committers.<ul>
<li>If the candidate for removal states plans to continue participating no
action is taken.</li>
<li>If the candidate replies they no longer require commit access then their
access is removed.</li>
<li>If the candidate can not be reached within 2 months of the second
attempting to contact them, access is removed.</li>
</ul>
</li>
<li>In any case, where access is removed, this fact is published through an email
to all existing committers (including the candidate for removal).</li>
</ul>
<p>The more difficult situation is a committer who is behaving in a manner that is
viewed as detrimental to the future of the project by other committers. This is
a delicate situation with the potential for the creation of division within the
greater community and should be handled with care. The process in this case is:</p>
<ul class="simple">
<li>Discuss the behavior of concern with the individual privately and explain why
you believe it is detrimental to the project. Stick to the facts and keep the
email professional. Avoid personal attacks and the temptation to hypothesize
about unknowable information such as the other&#8217;s motivations. Make it clear
that you would prefer not to discuss the behavior more widely but will have
to raise it with other contributors if it does not change. Ideally the
behavior is eliminated and no further action is required. If not,</li>
<li>Start an email thread with all committers, including the source of the
behavior, describing the behavior and the reason it is detrimental to the
project. The message should have the same tone as the private discussion and
should generally repeat the same points covered in that discussion. The
person whose behavior is being questioned should not be surprised by anything
presented in this discussion. Ideally the wider discussion provides more
perspective to all participants and the issue is resolved. If not,</li>
<li>Start an email thread with all committers except the source of the
detrimental behavior requesting a vote on revocation of commit
rights. Cite the discussion among all committers and describe all the
reasons why it was not resolved satisfactorily. This email should be
carefully written with the knowledge that the reasoning it contains
may be published to the larger community to justify the decision.</li>
<li>Each committer may vote yes, no, or abstain by replying to the email
thread. A failure to reply is an implicit abstention.</li>
<li>After all votes have been collected or a reasonable time has elapsed
for them to be provided (e.g. a couple of business days) the votes
are evaluated. For the request to revoke commit access for the
candidate to pass it must receive yes votes from two thirds of the
existing committers.</li>
<li>anyone that votes no must provide their reasoning, and</li>
<li>if the proposal passes then counter-arguments for the reasoning in no
votes should also be documented along with the initial reasons the
revocation was proposed. Ideally there should be no new
counter-arguments supplied in a no vote as all concerns should have
surfaced in the discussion before the vote.</li>
<li>The original person to propose revocation summarizes the result of
the vote in an email to all existing committers excepting the
candidate for removal.</li>
<li>If the vote to revoke commit access passes, access is removed and the
candidate for revocation is informed of that fact and the reasons for
it as documented in the email requesting the revocation vote.</li>
<li>Ideally the revoked committer peacefully leaves the community and no
further action is required. However, there is a distinct possibility
that he/she will try to generate support for his/her point of view
within the larger community. In this case the reasoning for removing
commit access as described in the request for a vote will be
published to the community.</li>
</ul>
</div>
<div class="section" id="changing-the-policy">
<h4>Changing the Policy<a class="headerlink" href="#changing-the-policy" title="Permalink to this headline">¶</a></h4>
<p>The process for changing the policy is:</p>
<ul class="simple">
<li>Propose the changes to the policy in an email to all current committers and
request discussion.</li>
<li>After an appropriate period of discussion (a few days) update the proposal
based on feedback if required and resend it to all current committers with a
request for a formal vote.</li>
<li>After all votes have been collected or a reasonable time has elapsed for them
to be provided (e.g. a couple of business days) the votes are evaluated. For
the request to modify the policy to pass it must receive yes votes from two
thirds of the existing committers.</li>
</ul>
<div class="section" id="template-emails">
<h5>Template Emails<a class="headerlink" href="#template-emails" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="nomination-to-grant-commit-access">
<h4>Nomination to Grant Commit Access<a class="headerlink" href="#nomination-to-grant-commit-access" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>I would like to nominate <em>[candidate]</em> for commit access. I believe
<em>[he/she]</em> has met the conditions for commit access described in the
committer grant policy on the project web site in the following ways:</p>
<p><em>[list of requirements &amp; evidence]</em></p>
<p>Please reply to all in this message thread with your comments and
questions. If that discussion concludes favorably I will request a formal
vote on the nomination in a few days.</p>
</div></blockquote>
</div>
<div class="section" id="vote-to-grant-commit-access">
<h4>Vote to Grant Commit Access<a class="headerlink" href="#vote-to-grant-commit-access" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>I nominated <em>[candidate]</em> for commit access on <em>[date]</em>. Having allowed
sufficient time for discussion it&#8217;s now time to formally vote on the
proposal.</p>
<p>Please reply to all in this thread with your vote of: YES, NO, or ABSTAIN.
A failure to reply will be counted as an abstention. If you vote NO, by our
policy you must include the reasons for that vote in your reply. The
deadline for votes is <em>[date and time]</em>.</p>
<p>If a majority of committers vote YES and there are zero NO votes commit
access will be granted.</p>
</div></blockquote>
</div>
<div class="section" id="vote-results-for-grant-of-commit-access">
<h4>Vote Results for Grant of Commit Access<a class="headerlink" href="#vote-results-for-grant-of-commit-access" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>The voting period for granting to commit access to <em>[candidate]</em> initiated
at <em>[date and time]</em> is now closed with the following results:</p>
<p>YES: <em>[count of yes votes]</em> (<em>[% of voters]</em>)</p>
<p>NO: <em>[count of no votes]</em> (<em>[% of voters]</em>)</p>
<p>ABSTAIN: <em>[count of abstentions]</em> (<em>[% of voters]</em>)</p>
<p>Based on these results commit access <em>[is/is NOT]</em> granted.</p>
</div></blockquote>
</div>
<div class="section" id="invitation-to-accepted-committer">
<h4>Invitation to Accepted Committer<a class="headerlink" href="#invitation-to-accepted-committer" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Due to your sustained contributions to the Open vSwitch (OVS) project we
would like to provide you with commit access to the project repository.
Developers with commit access must agree to fulfill specific
responsibilities described in the source repository:</p>
<blockquote>
<div>/Documentation/internals/committer-responsibilities.rst</div></blockquote>
<p>Please let us know if you would like to accept commit access and if so that
you agree to fulfill these responsibilities. Once we receive your response
we&#8217;ll set up access. We&#8217;re looking forward continuing to work together to
advance the Open vSwitch project.</p>
</div></blockquote>
</div>
<div class="section" id="proposal-to-remove-commit-access-for-inactivity">
<h4>Proposal to Remove Commit Access for Inactivity<a class="headerlink" href="#proposal-to-remove-commit-access-for-inactivity" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Committer <em>[candidate]</em> has been inactive for <em>[duration]</em>. I have
attempted to privately contacted <em>[him/her]</em> and <em>[he/she]</em> could not be
reached.</p>
<p>Based on this I would like to formally propose removal of commit access.
If a response to this message documenting the reasons to retain commit
access is not received by <em>[date]</em> access will be removed.</p>
</div></blockquote>
</div>
<div class="section" id="notification-of-commit-removal-for-inactivity">
<h4>Notification of Commit Removal for Inactivity<a class="headerlink" href="#notification-of-commit-removal-for-inactivity" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>Committer <em>[candidate]</em> has been inactive for <em>[duration]</em>. <em>[He/she]</em>
<em>[stated no commit access is required/failed to respond]</em> to the formal
proposal to remove access on <em>[date]</em>. Commit access has now been removed.</div></blockquote>
</div>
<div class="section" id="proposal-to-revoke-commit-access-for-detrimental-behavior">
<h4>Proposal to Revoke Commit Access for Detrimental Behavior<a class="headerlink" href="#proposal-to-revoke-commit-access-for-detrimental-behavior" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>I regret that I feel compelled to propose revocation of commit access for
<em>[candidate]</em>. I have privately discussed with <em>[him/her]</em> the following
reasons I believe <em>[his/her]</em> actions are detrimental to the project and we
have failed to come to a mutual understanding:</p>
<p><em>[List of reasons and supporting evidence]</em></p>
<p>Please reply to all in this thread with your thoughts on this proposal.  I
plan to formally propose a vote on the proposal on or after <em>[date and
time]</em>.</p>
<p>It is important to get all discussion points both for and against the
proposal on the table during the discussion period prior to the vote.
Please make it a high priority to respond to this proposal with your
thoughts.</p>
</div></blockquote>
</div>
<div class="section" id="vote-to-revoke-commit-access">
<h4>Vote to Revoke Commit Access<a class="headerlink" href="#vote-to-revoke-commit-access" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>I nominated <em>[candidate]</em> for revocation of commit access on <em>[date]</em>.
Having allowed sufficient time for discussion it&#8217;s now time to formally
vote on the proposal.</p>
<p>Please reply to all in this thread with your vote of: YES, NO, or ABSTAIN.
A failure to reply will be counted as an abstention. If you vote NO, by our
policy you must include the reasons for that vote in your reply. The
deadline for votes is <em>[date and time]</em>.</p>
<p>If 2/3rds of committers vote YES commit access will be revoked.</p>
<p>The following reasons for revocation have been given in the original
proposal or during discussion:</p>
<p><em>[list of reasons to remove access]</em></p>
<p>The following reasons for retaining access were discussed:</p>
<p><em>[list of reasons to retain access]</em></p>
<p>The counter-argument for each reason for retaining access is:</p>
<p><em>[list of counter-arguments for retaining access]</em></p>
</div></blockquote>
</div>
<div class="section" id="vote-results-for-revocation-of-commit-access">
<h4>Vote Results for Revocation of Commit Access<a class="headerlink" href="#vote-results-for-revocation-of-commit-access" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>The voting period for revoking the commit access of <em>[candidate]</em> initiated
at <em>[date and time]</em> is now closed with the following results:</p>
<ul class="simple">
<li>YES: <em>[count of yes votes]</em> (<em>[% of voters]</em>)</li>
<li>NO: <em>[count of no votes]</em> (<em>[% of voters]</em>)</li>
<li>ABSTAIN: <em>[count of abstentions]</em> (<em>[% of voters]</em>)</li>
</ul>
<p>Based on these results commit access <em>[is/is NOT]</em> revoked. The following
reasons for retaining commit access were proposed in NO votes:</p>
<p><em>[list of reasons]</em></p>
<p>The counter-arguments for each of these reasons are:</p>
<p><em>[list of counter-arguments]</em></p>
</div></blockquote>
</div>
<div class="section" id="notification-of-commit-revocation-for-detrimental-behavior">
<h4>Notification of Commit Revocation for Detrimental Behavior<a class="headerlink" href="#notification-of-commit-revocation-for-detrimental-behavior" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>After private discussion with you and careful consideration of the
situation, the other committers to the Open vSwitch (OVS) project have
concluded that it is in the best interest of the project that your commit
access to the project repositories be revoked and this has now occurred.</p>
<p>The reasons for this decision are:</p>
<p><em>[list of reasons for removing access]</em></p>
<p>While your goals and those of the project no longer appear to be aligned we
greatly appreciate all the work you have done for the project and wish you
continued success in your future work.</p>
</div></blockquote>
</div>
</div>
<span id="document-internals/authors"></span><div class="section" id="authors">
<h3>Authors<a class="headerlink" href="#authors" title="Permalink to this headline">¶</a></h3>
<p>The following people authored or signed off on commits in the Open
vSwitch source code or webpage version control repository.</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Email</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Aaron Conole</td>
<td><a class="reference external" href="mailto:aconole&#37;&#52;&#48;redhat&#46;com">aconole<span>&#64;</span>redhat<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Aaron Rosen</td>
<td><a class="reference external" href="mailto:arosen&#37;&#52;&#48;clemson&#46;edu">arosen<span>&#64;</span>clemson<span>&#46;</span>edu</a></td>
</tr>
<tr class="row-even"><td>Alexander Duyck</td>
<td><a class="reference external" href="mailto:alexander&#46;h&#46;duyck&#37;&#52;&#48;redhat&#46;com">alexander<span>&#46;</span>h<span>&#46;</span>duyck<span>&#64;</span>redhat<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Alexandru Copot</td>
<td><a class="reference external" href="mailto:alex&#46;mihai&#46;c&#37;&#52;&#48;gmail&#46;com">alex<span>&#46;</span>mihai<span>&#46;</span>c<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Alexei Starovoitov</td>
<td><a class="reference external" href="mailto:ast&#37;&#52;&#48;plumgrid&#46;com">ast<span>&#64;</span>plumgrid<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Alexey I. Froloff</td>
<td><a class="reference external" href="mailto:raorn&#37;&#52;&#48;raorn&#46;name">raorn<span>&#64;</span>raorn<span>&#46;</span>name</a></td>
</tr>
<tr class="row-even"><td>Alex Wang</td>
<td><a class="reference external" href="mailto:ee07b291&#37;&#52;&#48;gmail&#46;com">ee07b291<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Alfredo Finelli</td>
<td><a class="reference external" href="mailto:alf&#37;&#52;&#48;computationes&#46;de">alf<span>&#64;</span>computationes<span>&#46;</span>de</a></td>
</tr>
<tr class="row-even"><td>Alin Balutoiu</td>
<td><a class="reference external" href="mailto:abalutoiu&#37;&#52;&#48;cloudbasesolutions&#46;com">abalutoiu<span>&#64;</span>cloudbasesolutions<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Alin Serdean</td>
<td><a class="reference external" href="mailto:aserdean&#37;&#52;&#48;cloudbasesolutions&#46;com">aserdean<span>&#64;</span>cloudbasesolutions<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Ambika Arora</td>
<td><a class="reference external" href="mailto:ambika&#46;arora&#37;&#52;&#48;tcs&#46;com">ambika<span>&#46;</span>arora<span>&#64;</span>tcs<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Amit Bose</td>
<td><a class="reference external" href="mailto:bose&#37;&#52;&#48;noironetworks&#46;com">bose<span>&#64;</span>noironetworks<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Amitabha Biswas</td>
<td><a class="reference external" href="mailto:azbiswas&#37;&#52;&#48;gmail&#46;com">azbiswas<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Anand Kumar</td>
<td><a class="reference external" href="mailto:kumaranand&#37;&#52;&#48;vmware&#46;com">kumaranand<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Andrew Evans</td>
<td><a class="reference external" href="mailto:aevans&#37;&#52;&#48;nicira&#46;com">aevans<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Andrew Beekhof</td>
<td><a class="reference external" href="mailto:abeekhof&#37;&#52;&#48;redhat&#46;com">abeekhof<span>&#64;</span>redhat<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Andrew Kampjes</td>
<td><a class="reference external" href="mailto:a&#46;kampjes&#37;&#52;&#48;gmail&#46;com">a<span>&#46;</span>kampjes<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Andrew Lambeth</td>
<td><a class="reference external" href="mailto:wal&#37;&#52;&#48;nicira&#46;com">wal<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Andy Hill</td>
<td><a class="reference external" href="mailto:hillad&#37;&#52;&#48;gmail&#46;com">hillad<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Andy Southgate</td>
<td><a class="reference external" href="mailto:andy&#46;southgate&#37;&#52;&#48;citrix&#46;com">andy<span>&#46;</span>southgate<span>&#64;</span>citrix<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Andy Zhou</td>
<td><a class="reference external" href="mailto:azhou&#37;&#52;&#48;ovn&#46;org">azhou<span>&#64;</span>ovn<span>&#46;</span>org</a></td>
</tr>
<tr class="row-odd"><td>Ankur Sharma</td>
<td><a class="reference external" href="mailto:ankursharma&#37;&#52;&#48;vmware&#46;com">ankursharma<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Anoob Soman</td>
<td><a class="reference external" href="mailto:anoob&#46;soman&#37;&#52;&#48;citrix&#46;com">anoob<span>&#46;</span>soman<span>&#64;</span>citrix<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Ansis Atteka</td>
<td><a class="reference external" href="mailto:aatteka&#37;&#52;&#48;nicira&#46;com">aatteka<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Antonio Fischetti</td>
<td><a class="reference external" href="mailto:antonio&#46;fischetti&#37;&#52;&#48;intel&#46;com">antonio<span>&#46;</span>fischetti<span>&#64;</span>intel<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Anupam Chanda</td>
<td><a class="reference external" href="mailto:achanda&#37;&#52;&#48;nicira&#46;com">achanda<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Ariel Tubaltsev</td>
<td><a class="reference external" href="mailto:atubaltsev&#37;&#52;&#48;vmware&#46;com">atubaltsev<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Arnoldo Lutz</td>
<td><a class="reference external" href="mailto:arnoldo&#46;lutz&#46;guevara&#37;&#52;&#48;hpe&#46;com">arnoldo<span>&#46;</span>lutz<span>&#46;</span>guevara<span>&#64;</span>hpe<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Arun Sharma</td>
<td><a class="reference external" href="mailto:arun&#46;sharma&#37;&#52;&#48;calsoftinc&#46;com">arun<span>&#46;</span>sharma<span>&#64;</span>calsoftinc<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Aryan TaheriMonfared</td>
<td><a class="reference external" href="mailto:aryan&#46;taherimonfared&#37;&#52;&#48;uis&#46;no">aryan<span>&#46;</span>taherimonfared<span>&#64;</span>uis<span>&#46;</span>no</a></td>
</tr>
<tr class="row-even"><td>Ashwin Swaminathan</td>
<td><a class="reference external" href="mailto:ashwinds&#37;&#52;&#48;arista&#46;com">ashwinds<span>&#64;</span>arista<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Babu Shanmugam</td>
<td><a class="reference external" href="mailto:bschanmu&#37;&#52;&#48;redhat&#46;com">bschanmu<span>&#64;</span>redhat<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Ben Pfaff</td>
<td><a class="reference external" href="mailto:blp&#37;&#52;&#48;ovn&#46;org">blp<span>&#64;</span>ovn<span>&#46;</span>org</a></td>
</tr>
<tr class="row-odd"><td>Ben Warren</td>
<td><a class="reference external" href="mailto:ben&#37;&#52;&#48;skyportsystems&#46;com">ben<span>&#64;</span>skyportsystems<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Benli Ye</td>
<td><a class="reference external" href="mailto:daniely&#37;&#52;&#48;vmware&#46;com">daniely<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Bert Vermeulen</td>
<td><a class="reference external" href="mailto:bert&#37;&#52;&#48;biot&#46;com">bert<span>&#64;</span>biot<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Bhanuprakash Bodireddy</td>
<td><a class="reference external" href="mailto:bhanuprakash&#46;bodireddy&#37;&#52;&#48;intel&#46;com">bhanuprakash<span>&#46;</span>bodireddy<span>&#64;</span>intel<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Billy O&#8217;Mahony</td>
<td><a class="reference external" href="mailto:billy&#46;o&#46;mahony&#37;&#52;&#48;intel&#46;com">billy<span>&#46;</span>o<span>&#46;</span>mahony<span>&#64;</span>intel<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Binbin Xu</td>
<td><a class="reference external" href="mailto:xu&#46;binbin1&#37;&#52;&#48;zte&#46;com&#46;cn">xu<span>&#46;</span>binbin1<span>&#64;</span>zte<span>&#46;</span>com<span>&#46;</span>cn</a></td>
</tr>
<tr class="row-odd"><td>Brian Kruger</td>
<td><a class="reference external" href="mailto:bkruger+ovsdev&#37;&#52;&#48;gmail&#46;com">bkruger+ovsdev<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Bruce Davie</td>
<td><a class="reference external" href="mailto:bsd&#37;&#52;&#48;nicira&#46;com">bsd<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Bryan Phillippe</td>
<td><a class="reference external" href="mailto:bp&#37;&#52;&#48;toroki&#46;com">bp<span>&#64;</span>toroki<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Carlo Andreotti</td>
<td><a class="reference external" href="mailto:c&#46;andreotti&#37;&#52;&#48;m3s&#46;it">c<span>&#46;</span>andreotti<span>&#64;</span>m3s<span>&#46;</span>it</a></td>
</tr>
<tr class="row-odd"><td>Casey Barker</td>
<td><a class="reference external" href="mailto:crbarker&#37;&#52;&#48;google&#46;com">crbarker<span>&#64;</span>google<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Chandra Sekhar Vejendla</td>
<td><a class="reference external" href="mailto:csvejend&#37;&#52;&#48;us&#46;ibm&#46;com">csvejend<span>&#64;</span>us<span>&#46;</span>ibm<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Christoph Jaeger</td>
<td><a class="reference external" href="mailto:cj&#37;&#52;&#48;linux&#46;com">cj<span>&#64;</span>linux<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Chris Wright</td>
<td><a class="reference external" href="mailto:chrisw&#37;&#52;&#48;sous-sol&#46;org">chrisw<span>&#64;</span>sous-sol<span>&#46;</span>org</a></td>
</tr>
<tr class="row-odd"><td>Chuck Short</td>
<td><a class="reference external" href="mailto:zulcss&#37;&#52;&#48;ubuntu&#46;com">zulcss<span>&#64;</span>ubuntu<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Ciara Loftus</td>
<td><a class="reference external" href="mailto:ciara&#46;loftus&#37;&#52;&#48;intel&#46;com">ciara<span>&#46;</span>loftus<span>&#64;</span>intel<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Cong Wang</td>
<td><a class="reference external" href="mailto:amwang&#37;&#52;&#48;redhat&#46;com">amwang<span>&#64;</span>redhat<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Conner Herriges</td>
<td><a class="reference external" href="mailto:conner&#46;herriges&#37;&#52;&#48;ibm&#46;com">conner<span>&#46;</span>herriges<span>&#64;</span>ibm<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Damien Millescamps</td>
<td><a class="reference external" href="mailto:damien&#46;millescamps&#37;&#52;&#48;6wind&#46;com">damien<span>&#46;</span>millescamps<span>&#64;</span>6wind<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Dan Carpenter</td>
<td><a class="reference external" href="mailto:dan&#46;carpenter&#37;&#52;&#48;oracle&#46;com">dan<span>&#46;</span>carpenter<span>&#64;</span>oracle<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Dan McGregor</td>
<td><a class="reference external" href="mailto:dan&#46;mcgregor&#37;&#52;&#48;usask&#46;ca">dan<span>&#46;</span>mcgregor<span>&#64;</span>usask<span>&#46;</span>ca</a></td>
</tr>
<tr class="row-even"><td>Dan Wendlandt</td>
<td><a class="reference external" href="mailto:dan&#37;&#52;&#48;nicira&#46;com">dan<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Daniel Borkmann</td>
<td><a class="reference external" href="mailto:dborkman&#37;&#52;&#48;redhat&#46;com">dborkman<span>&#64;</span>redhat<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Daniel Hiltgen</td>
<td><a class="reference external" href="mailto:daniel&#37;&#52;&#48;netkine&#46;com">daniel<span>&#64;</span>netkine<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Daniel Roman</td>
<td><a class="reference external" href="mailto:droman&#37;&#52;&#48;nicira&#46;com">droman<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Daniele Di Proietto</td>
<td><a class="reference external" href="mailto:daniele&#46;di&#46;proietto&#37;&#52;&#48;gmail&#46;com">daniele<span>&#46;</span>di<span>&#46;</span>proietto<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Daniele Venturino</td>
<td><a class="reference external" href="mailto:daniele&#46;venturino&#37;&#52;&#48;m3s&#46;it">daniele<span>&#46;</span>venturino<span>&#64;</span>m3s<span>&#46;</span>it</a></td>
</tr>
<tr class="row-even"><td>Danny Kukawka</td>
<td><a class="reference external" href="mailto:danny&#46;kukawka&#37;&#52;&#48;bisect&#46;de">danny<span>&#46;</span>kukawka<span>&#64;</span>bisect<span>&#46;</span>de</a></td>
</tr>
<tr class="row-odd"><td>Darrell Ball</td>
<td><a class="reference external" href="mailto:dlu998&#37;&#52;&#48;gmail&#46;com">dlu998<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Dave Tucker</td>
<td><a class="reference external" href="mailto:dave&#37;&#52;&#48;dtucker&#46;co&#46;uk">dave<span>&#64;</span>dtucker<span>&#46;</span>co<span>&#46;</span>uk</a></td>
</tr>
<tr class="row-odd"><td>David Erickson</td>
<td><a class="reference external" href="mailto:derickso&#37;&#52;&#48;stanford&#46;edu">derickso<span>&#64;</span>stanford<span>&#46;</span>edu</a></td>
</tr>
<tr class="row-even"><td>David Hill</td>
<td><a class="reference external" href="mailto:dhill&#37;&#52;&#48;redhat&#46;com">dhill<span>&#64;</span>redhat<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>David S. Miller</td>
<td><a class="reference external" href="mailto:davem&#37;&#52;&#48;davemloft&#46;net">davem<span>&#64;</span>davemloft<span>&#46;</span>net</a></td>
</tr>
<tr class="row-even"><td>David Yang</td>
<td><a class="reference external" href="mailto:davidy&#37;&#52;&#48;vmware&#46;com">davidy<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Dennis Sam</td>
<td><a class="reference external" href="mailto:dsam&#37;&#52;&#48;arista&#46;com">dsam<span>&#64;</span>arista<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Devendra Naga</td>
<td><a class="reference external" href="mailto:devendra&#46;aaru&#37;&#52;&#48;gmail&#46;com">devendra<span>&#46;</span>aaru<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Dmitry Krivenok</td>
<td><a class="reference external" href="mailto:krivenok&#46;dmitry&#37;&#52;&#48;gmail&#46;com">krivenok<span>&#46;</span>dmitry<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Dominic Curran</td>
<td><a class="reference external" href="mailto:dominic&#46;curran&#37;&#52;&#48;citrix&#46;com">dominic<span>&#46;</span>curran<span>&#64;</span>citrix<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Dongdong</td>
<td><a class="reference external" href="mailto:dongdong1&#37;&#52;&#48;huawei&#46;com">dongdong1<span>&#64;</span>huawei<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Dongjun</td>
<td><a class="reference external" href="mailto:dongj&#37;&#52;&#48;dtdream&#46;com">dongj<span>&#64;</span>dtdream<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Duffie Cooley</td>
<td><a class="reference external" href="mailto:dcooley&#37;&#52;&#48;nicira&#46;com">dcooley<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Dustin Lundquist</td>
<td><a class="reference external" href="mailto:dustin&#37;&#52;&#48;null-ptr&#46;net">dustin<span>&#64;</span>null-ptr<span>&#46;</span>net</a></td>
</tr>
<tr class="row-odd"><td>Ed Maste</td>
<td><a class="reference external" href="mailto:emaste&#37;&#52;&#48;freebsd&#46;org">emaste<span>&#64;</span>freebsd<span>&#46;</span>org</a></td>
</tr>
<tr class="row-even"><td>Ed Swierk</td>
<td><a class="reference external" href="mailto:eswierk&#37;&#52;&#48;skyportsystems&#46;com">eswierk<span>&#64;</span>skyportsystems<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Edouard Bourguignon</td>
<td><a class="reference external" href="mailto:madko&#37;&#52;&#48;linuxed&#46;net">madko<span>&#64;</span>linuxed<span>&#46;</span>net</a></td>
</tr>
<tr class="row-even"><td>Eelco Chaudron</td>
<td><a class="reference external" href="mailto:echaudro&#37;&#52;&#48;redhat&#46;com">echaudro<span>&#64;</span>redhat<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Esteban Rodriguez Betancourt</td>
<td><a class="reference external" href="mailto:estebarb&#37;&#52;&#48;hpe&#46;com">estebarb<span>&#64;</span>hpe<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Aymerich Edward</td>
<td><a class="reference external" href="mailto:edward&#46;aymerich&#37;&#52;&#48;hpe&#46;com">edward<span>&#46;</span>aymerich<span>&#64;</span>hpe<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Edward Tomasz Napierała</td>
<td><a class="reference external" href="mailto:trasz&#37;&#52;&#48;freebsd&#46;org">trasz<span>&#64;</span>freebsd<span>&#46;</span>org</a></td>
</tr>
<tr class="row-even"><td>Eitan Eliahu</td>
<td><a class="reference external" href="mailto:eliahue&#37;&#52;&#48;vmware&#46;com">eliahue<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Eohyung Lee</td>
<td><a class="reference external" href="mailto:liquidnuker&#37;&#52;&#48;gmail&#46;com">liquidnuker<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Eric Garver</td>
<td><a class="reference external" href="mailto:e&#37;&#52;&#48;erig&#46;me">e<span>&#64;</span>erig<span>&#46;</span>me</a></td>
</tr>
<tr class="row-odd"><td>Eric Sesterhenn</td>
<td><a class="reference external" href="mailto:eric&#46;sesterhenn&#37;&#52;&#48;lsexperts&#46;de">eric<span>&#46;</span>sesterhenn<span>&#64;</span>lsexperts<span>&#46;</span>de</a></td>
</tr>
<tr class="row-even"><td>Ethan J. Jackson</td>
<td><a class="reference external" href="mailto:ejj&#37;&#52;&#48;eecs&#46;berkeley&#46;edu">ejj<span>&#64;</span>eecs<span>&#46;</span>berkeley<span>&#46;</span>edu</a></td>
</tr>
<tr class="row-odd"><td>Ethan Rahn</td>
<td><a class="reference external" href="mailto:erahn&#37;&#52;&#48;arista&#46;com">erahn<span>&#64;</span>arista<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Eziz Durdyyev</td>
<td><a class="reference external" href="mailto:ezizdurdy&#37;&#52;&#48;gmail&#46;com">ezizdurdy<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Flavio Fernandes</td>
<td><a class="reference external" href="mailto:flavio&#37;&#52;&#48;flaviof&#46;com">flavio<span>&#64;</span>flaviof<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Flavio Leitner</td>
<td><a class="reference external" href="mailto:fbl&#37;&#52;&#48;redhat&#46;com">fbl<span>&#64;</span>redhat<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Francesco Fusco</td>
<td><a class="reference external" href="mailto:ffusco&#37;&#52;&#48;redhat&#46;com">ffusco<span>&#64;</span>redhat<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>FUJITA Tomonori</td>
<td><a class="reference external" href="mailto:fujita&#46;tomonori&#37;&#52;&#48;lab&#46;ntt&#46;co&#46;jp">fujita<span>&#46;</span>tomonori<span>&#64;</span>lab<span>&#46;</span>ntt<span>&#46;</span>co<span>&#46;</span>jp</a></td>
</tr>
<tr class="row-odd"><td>Gabe Beged-Dov</td>
<td><a class="reference external" href="mailto:gabe&#37;&#52;&#48;begeddov&#46;com">gabe<span>&#64;</span>begeddov<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Gaetano Catalli</td>
<td><a class="reference external" href="mailto:gaetano&#46;catalli&#37;&#52;&#48;gmail&#46;com">gaetano<span>&#46;</span>catalli<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Gal Sagie</td>
<td><a class="reference external" href="mailto:gal&#46;sagie&#37;&#52;&#48;gmail&#46;com">gal<span>&#46;</span>sagie<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Genevieve LEsperance</td>
<td><a class="reference external" href="mailto:glesperance&#37;&#52;&#48;pivotal&#46;io">glesperance<span>&#64;</span>pivotal<span>&#46;</span>io</a></td>
</tr>
<tr class="row-odd"><td>Geoffrey Wossum</td>
<td><a class="reference external" href="mailto:gwossum&#37;&#52;&#48;acm&#46;org">gwossum<span>&#64;</span>acm<span>&#46;</span>org</a></td>
</tr>
<tr class="row-even"><td>Gianluca Merlo</td>
<td><a class="reference external" href="mailto:gianluca&#46;merlo&#37;&#52;&#48;gmail&#46;com">gianluca<span>&#46;</span>merlo<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Giuseppe Lettieri</td>
<td><a class="reference external" href="mailto:g&#46;lettieri&#37;&#52;&#48;iet&#46;unipi&#46;it">g<span>&#46;</span>lettieri<span>&#64;</span>iet<span>&#46;</span>unipi<span>&#46;</span>it</a></td>
</tr>
<tr class="row-even"><td>Glen Gibb</td>
<td><a class="reference external" href="mailto:grg&#37;&#52;&#48;stanford&#46;edu">grg<span>&#64;</span>stanford<span>&#46;</span>edu</a></td>
</tr>
<tr class="row-odd"><td>Guoshuai Li</td>
<td><a class="reference external" href="mailto:ligs&#37;&#52;&#48;dtdream&#46;com">ligs<span>&#64;</span>dtdream<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Guolin Yang</td>
<td><a class="reference external" href="mailto:gyang&#37;&#52;&#48;nicira&#46;com">gyang<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Guru Chaitanya Perakam</td>
<td><a class="reference external" href="mailto:gperakam&#37;&#52;&#48;Brocade&#46;com">gperakam<span>&#64;</span>Brocade<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Gurucharan Shetty</td>
<td><a class="reference external" href="mailto:guru&#37;&#52;&#48;ovn&#46;org">guru<span>&#64;</span>ovn<span>&#46;</span>org</a></td>
</tr>
<tr class="row-odd"><td>Han Zhou</td>
<td><a class="reference external" href="mailto:zhouhan&#37;&#52;&#48;gmail&#46;com">zhouhan<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Henry Mai</td>
<td><a class="reference external" href="mailto:hmai&#37;&#52;&#48;nicira&#46;com">hmai<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Hao Zheng</td>
<td><a class="reference external" href="mailto:hzheng&#37;&#52;&#48;nicira&#46;com">hzheng<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Helmut Schaa</td>
<td><a class="reference external" href="mailto:helmut&#46;schaa&#37;&#52;&#48;googlemail&#46;com">helmut<span>&#46;</span>schaa<span>&#64;</span>googlemail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Hiteshi Kalra</td>
<td><a class="reference external" href="mailto:hiteshi&#46;kalra&#37;&#52;&#48;tcs&#46;com">hiteshi<span>&#46;</span>kalra<span>&#64;</span>tcs<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Huanle Han</td>
<td><a class="reference external" href="mailto:hanxueluo&#37;&#52;&#48;gmail&#46;com">hanxueluo<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Hui Kang</td>
<td><a class="reference external" href="mailto:kangh&#37;&#52;&#48;us&#46;ibm&#46;com">kangh<span>&#64;</span>us<span>&#46;</span>ibm<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Ian Campbell</td>
<td><a class="reference external" href="mailto:Ian&#46;Campbell&#37;&#52;&#48;citrix&#46;com">Ian<span>&#46;</span>Campbell<span>&#64;</span>citrix<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Ian Stokes</td>
<td><a class="reference external" href="mailto:ian&#46;stokes&#37;&#52;&#48;intel&#46;com">ian<span>&#46;</span>stokes<span>&#64;</span>intel<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Ilya Maximets</td>
<td><a class="reference external" href="mailto:i&#46;maximets&#37;&#52;&#48;samsung&#46;com">i<span>&#46;</span>maximets<span>&#64;</span>samsung<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Isaku Yamahata</td>
<td><a class="reference external" href="mailto:yamahata&#37;&#52;&#48;valinux&#46;co&#46;jp">yamahata<span>&#64;</span>valinux<span>&#46;</span>co<span>&#46;</span>jp</a></td>
</tr>
<tr class="row-even"><td>James P.</td>
<td><a class="reference external" href="mailto:roampune&#37;&#52;&#48;gmail&#46;com">roampune<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>James Page</td>
<td><a class="reference external" href="mailto:james&#46;page&#37;&#52;&#48;ubuntu&#46;com">james<span>&#46;</span>page<span>&#64;</span>ubuntu<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Jamie Lennox</td>
<td><a class="reference external" href="mailto:jamielennox&#37;&#52;&#48;gmail&#46;com">jamielennox<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Jan Scheurich</td>
<td><a class="reference external" href="mailto:jan&#46;scheurich&#37;&#52;&#48;ericsson&#46;com">jan<span>&#46;</span>scheurich<span>&#64;</span>ericsson<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Jan Vansteenkiste</td>
<td><a class="reference external" href="mailto:jan&#37;&#52;&#48;vstone&#46;eu">jan<span>&#64;</span>vstone<span>&#46;</span>eu</a></td>
</tr>
<tr class="row-odd"><td>Jarno Rajahalme</td>
<td><a class="reference external" href="mailto:jarno&#37;&#52;&#48;ovn&#46;org">jarno<span>&#64;</span>ovn<span>&#46;</span>org</a></td>
</tr>
<tr class="row-even"><td>Jason Kölker</td>
<td><a class="reference external" href="mailto:jason&#37;&#52;&#48;koelker&#46;net">jason<span>&#64;</span>koelker<span>&#46;</span>net</a></td>
</tr>
<tr class="row-odd"><td>Jasper Capel</td>
<td><a class="reference external" href="mailto:jasper&#37;&#52;&#48;capel&#46;tv">jasper<span>&#64;</span>capel<span>&#46;</span>tv</a></td>
</tr>
<tr class="row-even"><td>Jean Tourrilhes</td>
<td><a class="reference external" href="mailto:jt&#37;&#52;&#48;hpl&#46;hp&#46;com">jt<span>&#64;</span>hpl<span>&#46;</span>hp<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Jeremy Stribling</td>
<td><a class="reference external" href="mailto:strib&#37;&#52;&#48;nicira&#46;com">strib<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Jeroen van Bemmel</td>
<td><a class="reference external" href="mailto:jvb127&#37;&#52;&#48;gmail&#46;com">jvb127<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Jesse Gross</td>
<td><a class="reference external" href="mailto:jesse&#37;&#52;&#48;kernel&#46;org">jesse<span>&#64;</span>kernel<span>&#46;</span>org</a></td>
</tr>
<tr class="row-even"><td>Jian Li</td>
<td><a class="reference external" href="mailto:lijian&#37;&#52;&#48;ooclab&#46;com">lijian<span>&#64;</span>ooclab<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Jing Ai</td>
<td><a class="reference external" href="mailto:jinga&#37;&#52;&#48;google&#46;com">jinga<span>&#64;</span>google<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Jiri Benc</td>
<td><a class="reference external" href="mailto:jbenc&#37;&#52;&#48;redhat&#46;com">jbenc<span>&#64;</span>redhat<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Joe Perches</td>
<td><a class="reference external" href="mailto:joe&#37;&#52;&#48;perches&#46;com">joe<span>&#64;</span>perches<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Joe Stringer</td>
<td><a class="reference external" href="mailto:joe&#37;&#52;&#48;ovn&#46;org">joe<span>&#64;</span>ovn<span>&#46;</span>org</a></td>
</tr>
<tr class="row-odd"><td>Jonathan Vestin</td>
<td><a class="reference external" href="mailto:jonavest&#37;&#52;&#48;kau&#46;se">jonavest<span>&#64;</span>kau<span>&#46;</span>se</a></td>
</tr>
<tr class="row-even"><td>Jun Nakajima</td>
<td><a class="reference external" href="mailto:jun&#46;nakajima&#37;&#52;&#48;intel&#46;com">jun<span>&#46;</span>nakajima<span>&#64;</span>intel<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>JunoZhu</td>
<td><a class="reference external" href="mailto:zhunatuzi&#37;&#52;&#48;gmail&#46;com">zhunatuzi<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Justin Pettit</td>
<td><a class="reference external" href="mailto:jpettit&#37;&#52;&#48;ovn&#46;org">jpettit<span>&#64;</span>ovn<span>&#46;</span>org</a></td>
</tr>
<tr class="row-odd"><td>Keith Amidon</td>
<td><a class="reference external" href="mailto:keith&#37;&#52;&#48;nicira&#46;com">keith<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Ken Ajiro</td>
<td><a class="reference external" href="mailto:ajiro&#37;&#52;&#48;mxw&#46;nes&#46;nec&#46;co&#46;jp">ajiro<span>&#64;</span>mxw<span>&#46;</span>nes<span>&#46;</span>nec<span>&#46;</span>co<span>&#46;</span>jp</a></td>
</tr>
<tr class="row-odd"><td>Kenneth Duda</td>
<td><a class="reference external" href="mailto:kduda&#37;&#52;&#48;arista&#46;com">kduda<span>&#64;</span>arista<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Kentaro Ebisawa</td>
<td><a class="reference external" href="mailto:ebiken&#46;g&#37;&#52;&#48;gmail&#46;com">ebiken<span>&#46;</span>g<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Kevin Lo</td>
<td><a class="reference external" href="mailto:kevlo&#37;&#52;&#48;FreeBSD&#46;org">kevlo<span>&#64;</span>FreeBSD<span>&#46;</span>org</a></td>
</tr>
<tr class="row-even"><td>Kevin Traynor</td>
<td><a class="reference external" href="mailto:kevin&#46;traynor&#37;&#52;&#48;intel&#46;com">kevin<span>&#46;</span>traynor<span>&#64;</span>intel<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Kmindg G</td>
<td><a class="reference external" href="mailto:kmindg&#37;&#52;&#48;gmail&#46;com">kmindg<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Krishna Kondaka</td>
<td><a class="reference external" href="mailto:kkondaka&#37;&#52;&#48;vmware&#46;com">kkondaka<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Kyle Mestery</td>
<td><a class="reference external" href="mailto:mestery&#37;&#52;&#48;mestery&#46;com">mestery<span>&#64;</span>mestery<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Kyle Upton</td>
<td><a class="reference external" href="mailto:kupton&#37;&#52;&#48;baymicrosystems&#46;com">kupton<span>&#64;</span>baymicrosystems<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Lance Richardson</td>
<td><a class="reference external" href="mailto:lrichard&#37;&#52;&#48;redhat&#46;com">lrichard<span>&#64;</span>redhat<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Lars Kellogg-Stedman</td>
<td><a class="reference external" href="mailto:lars&#37;&#52;&#48;redhat&#46;com">lars<span>&#64;</span>redhat<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Lei Huang</td>
<td><a class="reference external" href="mailto:huang&#46;f&#46;lei&#37;&#52;&#48;gmail&#46;com">huang<span>&#46;</span>f<span>&#46;</span>lei<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Leo Alterman</td>
<td><a class="reference external" href="mailto:lalterman&#37;&#52;&#48;nicira&#46;com">lalterman<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Lilijun</td>
<td><a class="reference external" href="mailto:jerry&#46;lilijun&#37;&#52;&#48;huawei&#46;com">jerry<span>&#46;</span>lilijun<span>&#64;</span>huawei<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Linda Sun</td>
<td><a class="reference external" href="mailto:lsun&#37;&#52;&#48;vmware&#46;com">lsun<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Lior Neudorfer</td>
<td><a class="reference external" href="mailto:lior&#37;&#52;&#48;guardicore&#46;com">lior<span>&#64;</span>guardicore<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Lorand Jakab</td>
<td><a class="reference external" href="mailto:lojakab&#37;&#52;&#48;cisco&#46;com">lojakab<span>&#64;</span>cisco<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Luca Giraudo</td>
<td><a class="reference external" href="mailto:lgiraudo&#37;&#52;&#48;nicira&#46;com">lgiraudo<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Lucian Petrut</td>
<td><a class="reference external" href="mailto:lpetrut&#37;&#52;&#48;cloudbasesolutions&#46;com">lpetrut<span>&#64;</span>cloudbasesolutions<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Luigi Rizzo</td>
<td><a class="reference external" href="mailto:rizzo&#37;&#52;&#48;iet&#46;unipi&#46;it">rizzo<span>&#64;</span>iet<span>&#46;</span>unipi<span>&#46;</span>it</a></td>
</tr>
<tr class="row-even"><td>Luis E. P.</td>
<td><a class="reference external" href="mailto:l31g&#37;&#52;&#48;hotmail&#46;com">l31g<span>&#64;</span>hotmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Lukasz Rzasik</td>
<td><a class="reference external" href="mailto:lukasz&#46;rzasik&#37;&#52;&#48;gmail&#46;com">lukasz<span>&#46;</span>rzasik<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Madhu Challa</td>
<td><a class="reference external" href="mailto:challa&#37;&#52;&#48;noironetworks&#46;com">challa<span>&#64;</span>noironetworks<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Marcin Mirecki</td>
<td><a class="reference external" href="mailto:mmirecki&#37;&#52;&#48;redhat&#46;com">mmirecki<span>&#64;</span>redhat<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Mario Cabrera</td>
<td><a class="reference external" href="mailto:mario&#46;cabrera&#37;&#52;&#48;hpe&#46;com">mario<span>&#46;</span>cabrera<span>&#64;</span>hpe<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Mark D. Gray</td>
<td><a class="reference external" href="mailto:mark&#46;d&#46;gray&#37;&#52;&#48;intel&#46;com">mark<span>&#46;</span>d<span>&#46;</span>gray<span>&#64;</span>intel<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Mark Hamilton</td>
<td><a class="reference external" href="mailto:mhamilton&#37;&#52;&#48;nicira&#46;com">mhamilton<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Mark Kavanagh</td>
<td><a class="reference external" href="mailto:mark&#46;b&#46;kavanagh&#37;&#52;&#48;intel&#46;com">mark<span>&#46;</span>b<span>&#46;</span>kavanagh<span>&#64;</span>intel<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Mark Maglana</td>
<td><a class="reference external" href="mailto:mmaglana&#37;&#52;&#48;gmail&#46;com">mmaglana<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Markos Chandras</td>
<td><a class="reference external" href="mailto:mchandras&#37;&#52;&#48;suse&#46;de">mchandras<span>&#64;</span>suse<span>&#46;</span>de</a></td>
</tr>
<tr class="row-even"><td>Martin Casado</td>
<td><a class="reference external" href="mailto:casado&#37;&#52;&#48;nicira&#46;com">casado<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Martino Fornasa</td>
<td><a class="reference external" href="mailto:mf&#37;&#52;&#48;fornasa&#46;it">mf<span>&#64;</span>fornasa<span>&#46;</span>it</a></td>
</tr>
<tr class="row-even"><td>Maryam Tahhan</td>
<td><a class="reference external" href="mailto:maryam&#46;tahhan&#37;&#52;&#48;intel&#46;com">maryam<span>&#46;</span>tahhan<span>&#64;</span>intel<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Mauricio Vásquez</td>
<td><a class="reference external" href="mailto:mauricio&#46;vasquezbernal&#37;&#52;&#48;studenti&#46;polito&#46;it">mauricio<span>&#46;</span>vasquezbernal<span>&#64;</span>studenti<span>&#46;</span>polito<span>&#46;</span>it</a></td>
</tr>
<tr class="row-even"><td>Maxime Coquelin</td>
<td><a class="reference external" href="mailto:maxime&#46;coquelin&#37;&#52;&#48;redhat&#46;com">maxime<span>&#46;</span>coquelin<span>&#64;</span>redhat<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Mehak Mahajan</td>
<td><a class="reference external" href="mailto:mmahajan&#37;&#52;&#48;nicira&#46;com">mmahajan<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Michael Arnaldi</td>
<td><a class="reference external" href="mailto:arnaldimichael&#37;&#52;&#48;gmail&#46;com">arnaldimichael<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Michal Weglicki</td>
<td><a class="reference external" href="mailto:michalx&#46;weglicki&#37;&#52;&#48;intel&#46;com">michalx<span>&#46;</span>weglicki<span>&#64;</span>intel<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Mijo Safradin</td>
<td><a class="reference external" href="mailto:mijo&#37;&#52;&#48;linux&#46;vnet&#46;ibm&#46;com">mijo<span>&#64;</span>linux<span>&#46;</span>vnet<span>&#46;</span>ibm<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Minoru TAKAHASHI</td>
<td><a class="reference external" href="mailto:takahashi&#46;minoru7&#37;&#52;&#48;gmail&#46;com">takahashi<span>&#46;</span>minoru7<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Murphy McCauley</td>
<td><a class="reference external" href="mailto:murphy&#46;mccauley&#37;&#52;&#48;gmail&#46;com">murphy<span>&#46;</span>mccauley<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Natasha Gude</td>
<td><a class="reference external" href="mailto:natasha&#37;&#52;&#48;nicira&#46;com">natasha<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Neil McKee</td>
<td><a class="reference external" href="mailto:neil&#46;mckee&#37;&#52;&#48;inmon&#46;com">neil<span>&#46;</span>mckee<span>&#64;</span>inmon<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Neil Zhu</td>
<td><a class="reference external" href="mailto:zhuj&#37;&#52;&#48;centecnetworks&#46;com">zhuj<span>&#64;</span>centecnetworks<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Nimay Desai</td>
<td><a class="reference external" href="mailto:nimaydesai1&#37;&#52;&#48;gmail&#46;com">nimaydesai1<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Nithin Raju</td>
<td><a class="reference external" href="mailto:nithin&#37;&#52;&#48;vmware&#46;com">nithin<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Niti Rohilla</td>
<td><a class="reference external" href="mailto:niti&#46;rohilla&#37;&#52;&#48;tcs&#46;com">niti<span>&#46;</span>rohilla<span>&#64;</span>tcs<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Numan Siddique</td>
<td><a class="reference external" href="mailto:nusiddiq&#37;&#52;&#48;redhat&#46;com">nusiddiq<span>&#64;</span>redhat<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Ofer Ben-Yacov</td>
<td><a class="reference external" href="mailto:ofer&#46;benyacov&#37;&#52;&#48;gmail&#46;com">ofer<span>&#46;</span>benyacov<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Ori Shoshan</td>
<td><a class="reference external" href="mailto:ori&#46;shoshan&#37;&#52;&#48;guardicore&#46;com">ori<span>&#46;</span>shoshan<span>&#64;</span>guardicore<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Padmanabhan Krishnan</td>
<td><a class="reference external" href="mailto:kprad1&#37;&#52;&#48;yahoo&#46;com">kprad1<span>&#64;</span>yahoo<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Panu Matilainen</td>
<td><a class="reference external" href="mailto:pmatilai&#37;&#52;&#48;redhat&#46;com">pmatilai<span>&#64;</span>redhat<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Paraneetharan Chandrasekaran</td>
<td><a class="reference external" href="mailto:paraneetharanc&#37;&#52;&#48;gmail&#46;com">paraneetharanc<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Paul Boca</td>
<td><a class="reference external" href="mailto:pboca&#37;&#52;&#48;cloudbasesolutions&#46;com">pboca<span>&#64;</span>cloudbasesolutions<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Paul Fazzone</td>
<td><a class="reference external" href="mailto:pfazzone&#37;&#52;&#48;nicira&#46;com">pfazzone<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Paul Ingram</td>
<td><a class="reference external" href="mailto:paul&#37;&#52;&#48;nicira&#46;com">paul<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Paul-Emmanuel Raoul</td>
<td><a class="reference external" href="mailto:skyper&#37;&#52;&#48;skyplabs&#46;net">skyper<span>&#64;</span>skyplabs<span>&#46;</span>net</a></td>
</tr>
<tr class="row-odd"><td>Pavithra Ramesh</td>
<td><a class="reference external" href="mailto:paramesh&#37;&#52;&#48;vmware&#46;com">paramesh<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Philippe Jung</td>
<td><a class="reference external" href="mailto:phil&#46;jung&#37;&#52;&#48;free&#46;fr">phil<span>&#46;</span>jung<span>&#64;</span>free<span>&#46;</span>fr</a></td>
</tr>
<tr class="row-odd"><td>Pim van den Berg</td>
<td><a class="reference external" href="mailto:pim&#37;&#52;&#48;nethuis&#46;nl">pim<span>&#64;</span>nethuis<span>&#46;</span>nl</a></td>
</tr>
<tr class="row-even"><td>pritesh</td>
<td><a class="reference external" href="mailto:pritesh&#46;kothari&#37;&#52;&#48;cisco&#46;com">pritesh<span>&#46;</span>kothari<span>&#64;</span>cisco<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Pravin B Shelar</td>
<td><a class="reference external" href="mailto:pshelar&#37;&#52;&#48;nicira&#46;com">pshelar<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Quentin Monnet</td>
<td><a class="reference external" href="mailto:quentin&#46;monnet&#37;&#52;&#48;6wind&#46;com">quentin<span>&#46;</span>monnet<span>&#64;</span>6wind<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Raju Subramanian</td>
<td><a class="reference external" href="mailto:rsubramanian&#37;&#52;&#48;nicira&#46;com">rsubramanian<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Rami Rosen</td>
<td><a class="reference external" href="mailto:ramirose&#37;&#52;&#48;gmail&#46;com">ramirose<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Ramu Ramamurthy</td>
<td><a class="reference external" href="mailto:ramu&#46;ramamurthy&#37;&#52;&#48;us&#46;ibm&#46;com">ramu<span>&#46;</span>ramamurthy<span>&#64;</span>us<span>&#46;</span>ibm<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Randall Sharo</td>
<td><a class="reference external" href="mailto:andall&#46;sharo&#37;&#52;&#48;navy&#46;mil">andall<span>&#46;</span>sharo<span>&#64;</span>navy<span>&#46;</span>mil</a></td>
</tr>
<tr class="row-odd"><td>Ravi Kerur</td>
<td><a class="reference external" href="mailto:Ravi&#46;Kerur&#37;&#52;&#48;telekom&#46;com">Ravi<span>&#46;</span>Kerur<span>&#64;</span>telekom<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Reid Price</td>
<td><a class="reference external" href="mailto:reid&#37;&#52;&#48;nicira&#46;com">reid<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Remko Tronçon</td>
<td><a class="reference external" href="mailto:git&#37;&#52;&#48;el-tramo&#46;be">git<span>&#64;</span>el-tramo<span>&#46;</span>be</a></td>
</tr>
<tr class="row-even"><td>Rich Lane</td>
<td><a class="reference external" href="mailto:rlane&#37;&#52;&#48;bigswitch&#46;com">rlane<span>&#64;</span>bigswitch<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Rishi Bamba</td>
<td><a class="reference external" href="mailto:rishi&#46;bamba&#37;&#52;&#48;tcs&#46;com">rishi<span>&#46;</span>bamba<span>&#64;</span>tcs<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Rob Adams</td>
<td><a class="reference external" href="mailto:readams&#37;&#52;&#48;readams&#46;net">readams<span>&#64;</span>readams<span>&#46;</span>net</a></td>
</tr>
<tr class="row-odd"><td>Robert Åkerblom-Andersson</td>
<td><a class="reference external" href="mailto:Robert&#46;nr1&#37;&#52;&#48;gmail&#46;com">Robert<span>&#46;</span>nr1<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Rob Hoes</td>
<td><a class="reference external" href="mailto:rob&#46;hoes&#37;&#52;&#48;citrix&#46;com">rob<span>&#46;</span>hoes<span>&#64;</span>citrix<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Roi Dayan</td>
<td><a class="reference external" href="mailto:roid&#37;&#52;&#48;mellanox&#46;com">roid<span>&#64;</span>mellanox<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Romain Lenglet</td>
<td><a class="reference external" href="mailto:romain&#46;lenglet&#37;&#52;&#48;berabera&#46;info">romain<span>&#46;</span>lenglet<span>&#64;</span>berabera<span>&#46;</span>info</a></td>
</tr>
<tr class="row-odd"><td>Russell Bryant</td>
<td><a class="reference external" href="mailto:russell&#37;&#52;&#48;ovn&#46;org">russell<span>&#64;</span>ovn<span>&#46;</span>org</a></td>
</tr>
<tr class="row-even"><td>RYAN D. MOATS</td>
<td><a class="reference external" href="mailto:rmoats&#37;&#52;&#48;us&#46;ibm&#46;com">rmoats<span>&#64;</span>us<span>&#46;</span>ibm<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Ryan Wilson</td>
<td><a class="reference external" href="mailto:wryan&#37;&#52;&#48;nicira&#46;com">wryan<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Sairam Venugopal</td>
<td><a class="reference external" href="mailto:vsairam&#37;&#52;&#48;vmware&#46;com">vsairam<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Sajjad Lateef</td>
<td><a class="reference external" href="mailto:slateef&#37;&#52;&#48;nicira&#46;com">slateef<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Saloni Jain</td>
<td><a class="reference external" href="mailto:saloni&#46;jain&#37;&#52;&#48;tcs&#46;com">saloni<span>&#46;</span>jain<span>&#64;</span>tcs<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Samuel Ghinet</td>
<td><a class="reference external" href="mailto:sghinet&#37;&#52;&#48;cloudbasesolutions&#46;com">sghinet<span>&#64;</span>cloudbasesolutions<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Sanjay Sane</td>
<td><a class="reference external" href="mailto:ssane&#37;&#52;&#48;nicira&#46;com">ssane<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Saurabh Mohan</td>
<td><a class="reference external" href="mailto:saurabh&#37;&#52;&#48;cplanenetworks&#46;com">saurabh<span>&#64;</span>cplanenetworks<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Saurabh Shah</td>
<td><a class="reference external" href="mailto:ssaurabh&#37;&#52;&#48;nicira&#46;com">ssaurabh<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Saurabh Shrivastava</td>
<td><a class="reference external" href="mailto:saurabh&#46;shrivastava&#37;&#52;&#48;nuagenetworks&#46;net">saurabh<span>&#46;</span>shrivastava<span>&#64;</span>nuagenetworks<span>&#46;</span>net</a></td>
</tr>
<tr class="row-even"><td>Scott Lowe</td>
<td><a class="reference external" href="mailto:scott&#46;lowe&#37;&#52;&#48;scottlowe&#46;org">scott<span>&#46;</span>lowe<span>&#64;</span>scottlowe<span>&#46;</span>org</a></td>
</tr>
<tr class="row-odd"><td>Scott Mann</td>
<td><a class="reference external" href="mailto:sdmnix&#37;&#52;&#48;gmail&#46;com">sdmnix<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Selvamuthukumar</td>
<td><a class="reference external" href="mailto:smkumar&#37;&#52;&#48;merunetworks&#46;com">smkumar<span>&#64;</span>merunetworks<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Sha Zhang</td>
<td><a class="reference external" href="mailto:zhangsha&#46;zhang&#37;&#52;&#48;huawei&#46;com">zhangsha<span>&#46;</span>zhang<span>&#64;</span>huawei<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Shad Ansari</td>
<td><a class="reference external" href="mailto:shad&#46;ansari&#37;&#52;&#48;hpe&#46;com">shad<span>&#46;</span>ansari<span>&#64;</span>hpe<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Shan Wei</td>
<td><a class="reference external" href="mailto:davidshan&#37;&#52;&#48;tencent&#46;com">davidshan<span>&#64;</span>tencent<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Shashank Ram</td>
<td><a class="reference external" href="mailto:rams&#37;&#52;&#48;vmware&#46;com">rams<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Shashwat Srivastava</td>
<td><a class="reference external" href="mailto:shashwat&#46;srivastava&#37;&#52;&#48;tcs&#46;com">shashwat<span>&#46;</span>srivastava<span>&#64;</span>tcs<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Shih-Hao Li</td>
<td><a class="reference external" href="mailto:shli&#37;&#52;&#48;nicira&#46;com">shli<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Shu Shen</td>
<td><a class="reference external" href="mailto:shu&#46;shen&#37;&#52;&#48;radisys&#46;com">shu<span>&#46;</span>shen<span>&#64;</span>radisys<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Simon Horman</td>
<td><a class="reference external" href="mailto:horms&#37;&#52;&#48;verge&#46;net&#46;au">horms<span>&#64;</span>verge<span>&#46;</span>net<span>&#46;</span>au</a></td>
</tr>
<tr class="row-odd"><td>Simon Horman</td>
<td><a class="reference external" href="mailto:simon&#46;horman&#37;&#52;&#48;netronome&#46;com">simon<span>&#46;</span>horman<span>&#64;</span>netronome<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Sorin Vinturis</td>
<td><a class="reference external" href="mailto:svinturis&#37;&#52;&#48;cloudbasesolutions&#46;com">svinturis<span>&#64;</span>cloudbasesolutions<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Steffen Gebert</td>
<td><a class="reference external" href="mailto:steffen&#46;gebert&#37;&#52;&#48;informatik&#46;uni-wuerzburg&#46;de">steffen<span>&#46;</span>gebert<span>&#64;</span>informatik<span>&#46;</span>uni-wuerzburg<span>&#46;</span>de</a></td>
</tr>
<tr class="row-even"><td>Sten Spans</td>
<td><a class="reference external" href="mailto:sten&#37;&#52;&#48;blinkenlights&#46;nl">sten<span>&#64;</span>blinkenlights<span>&#46;</span>nl</a></td>
</tr>
<tr class="row-odd"><td>Stephane A. Sezer</td>
<td><a class="reference external" href="mailto:sas&#37;&#52;&#48;cd80&#46;net">sas<span>&#64;</span>cd80<span>&#46;</span>net</a></td>
</tr>
<tr class="row-even"><td>Stephen Finucane</td>
<td><a class="reference external" href="mailto:stephen&#37;&#52;&#48;that&#46;guru">stephen<span>&#64;</span>that<span>&#46;</span>guru</a></td>
</tr>
<tr class="row-odd"><td>Steve Ruan</td>
<td><a class="reference external" href="mailto:ruansx&#37;&#52;&#48;cn&#46;ibm&#46;com">ruansx<span>&#64;</span>cn<span>&#46;</span>ibm<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Sugesh Chandran</td>
<td><a class="reference external" href="mailto:sugesh&#46;chandran&#37;&#52;&#48;intel&#46;com">sugesh<span>&#46;</span>chandran<span>&#64;</span>intel<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>SUGYO Kazushi</td>
<td><a class="reference external" href="mailto:sugyo&#46;org&#37;&#52;&#48;gmail&#46;com">sugyo<span>&#46;</span>org<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Tadaaki Nagao</td>
<td><a class="reference external" href="mailto:nagao&#37;&#52;&#48;stratosphere&#46;co&#46;jp">nagao<span>&#64;</span>stratosphere<span>&#46;</span>co<span>&#46;</span>jp</a></td>
</tr>
<tr class="row-odd"><td>Terry Wilson</td>
<td><a class="reference external" href="mailto:twilson&#37;&#52;&#48;redhat&#46;com">twilson<span>&#64;</span>redhat<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Tetsuo NAKAGAWA</td>
<td><a class="reference external" href="mailto:nakagawa&#37;&#52;&#48;mxc&#46;nes&#46;nec&#46;co&#46;jp">nakagawa<span>&#64;</span>mxc<span>&#46;</span>nes<span>&#46;</span>nec<span>&#46;</span>co<span>&#46;</span>jp</a></td>
</tr>
<tr class="row-odd"><td>Thadeu Lima de Souza Cascardo</td>
<td><a class="reference external" href="mailto:cascardo&#37;&#52;&#48;redhat&#46;com">cascardo<span>&#64;</span>redhat<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Thomas F. Herbert</td>
<td><a class="reference external" href="mailto:thomasfherbert&#37;&#52;&#48;gmail&#46;com">thomasfherbert<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Thomas Goirand</td>
<td><a class="reference external" href="mailto:zigo&#37;&#52;&#48;debian&#46;org">zigo<span>&#64;</span>debian<span>&#46;</span>org</a></td>
</tr>
<tr class="row-even"><td>Thomas Graf</td>
<td><a class="reference external" href="mailto:tgraf&#37;&#52;&#48;noironetworks&#46;com">tgraf<span>&#64;</span>noironetworks<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Thomas Lacroix</td>
<td><a class="reference external" href="mailto:thomas&#46;lacroix&#37;&#52;&#48;citrix&#46;com">thomas<span>&#46;</span>lacroix<span>&#64;</span>citrix<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Timo Puha</td>
<td><a class="reference external" href="mailto:timox&#46;puha&#37;&#52;&#48;intel&#46;com">timox<span>&#46;</span>puha<span>&#64;</span>intel<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Todd Deshane</td>
<td><a class="reference external" href="mailto:deshantm&#37;&#52;&#48;gmail&#46;com">deshantm<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Tom Everman</td>
<td><a class="reference external" href="mailto:teverman&#37;&#52;&#48;google&#46;com">teverman<span>&#64;</span>google<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Torgny Lindberg</td>
<td><a class="reference external" href="mailto:torgny&#46;lindberg&#37;&#52;&#48;ericsson&#46;com">torgny<span>&#46;</span>lindberg<span>&#64;</span>ericsson<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Tsvi Slonim</td>
<td><a class="reference external" href="mailto:tsvi&#37;&#52;&#48;toroki&#46;com">tsvi<span>&#64;</span>toroki<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Tuan Nguyen</td>
<td><a class="reference external" href="mailto:tuan&#46;nguyen&#37;&#52;&#48;veriksystems&#46;com">tuan<span>&#46;</span>nguyen<span>&#64;</span>veriksystems<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Tyler Coumbes</td>
<td><a class="reference external" href="mailto:coumbes&#37;&#52;&#48;gmail&#46;com">coumbes<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Valient Gough</td>
<td><a class="reference external" href="mailto:vgough&#37;&#52;&#48;pobox&#46;com">vgough<span>&#64;</span>pobox<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Vivien Bernet-Rollande</td>
<td><a class="reference external" href="mailto:vbr&#37;&#52;&#48;soprive&#46;net">vbr<span>&#64;</span>soprive<span>&#46;</span>net</a></td>
</tr>
<tr class="row-odd"><td>Wang Sheng-Hui</td>
<td><a class="reference external" href="mailto:shhuiw&#37;&#52;&#48;gmail&#46;com">shhuiw<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Wei Li</td>
<td><a class="reference external" href="mailto:liw&#37;&#52;&#48;dtdream&#46;com">liw<span>&#64;</span>dtdream<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Wei Yongjun</td>
<td><a class="reference external" href="mailto:yjwei&#37;&#52;&#48;cn&#46;fujitsu&#46;com">yjwei<span>&#64;</span>cn<span>&#46;</span>fujitsu<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Wenyu Zhang</td>
<td><a class="reference external" href="mailto:wenyuz&#37;&#52;&#48;vmware&#46;com">wenyuz<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>William Fulton</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>William Tu</td>
<td><a class="reference external" href="mailto:u9012063&#37;&#52;&#48;gmail&#46;com">u9012063<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>YAMAMOTO Takashi</td>
<td><a class="reference external" href="mailto:yamamoto&#37;&#52;&#48;midokura&#46;com">yamamoto<span>&#64;</span>midokura<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Yasuhito Takamiya</td>
<td><a class="reference external" href="mailto:yasuhito&#37;&#52;&#48;gmail&#46;com">yasuhito<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Yi-Hung Wei</td>
<td><a class="reference external" href="mailto:yihung&#46;wei&#37;&#52;&#48;gmail&#46;com">yihung<span>&#46;</span>wei<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Yin Lin</td>
<td><a class="reference external" href="mailto:linyi&#37;&#52;&#48;vmware&#46;com">linyi<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Yu Zhiguo</td>
<td><a class="reference external" href="mailto:yuzg&#37;&#52;&#48;cn&#46;fujitsu&#46;com">yuzg<span>&#64;</span>cn<span>&#46;</span>fujitsu<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Yuanhan Liu</td>
<td><a class="reference external" href="mailto:yuanhan&#46;liu&#37;&#52;&#48;linux&#46;intel&#46;com">yuanhan<span>&#46;</span>liu<span>&#64;</span>linux<span>&#46;</span>intel<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>ZhengLingyun</td>
<td><a class="reference external" href="mailto:konghuarukhr&#37;&#52;&#48;163&#46;com">konghuarukhr<span>&#64;</span>163<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Zoltán Balogh</td>
<td><a class="reference external" href="mailto:zoltan&#46;balogh&#37;&#52;&#48;ericsson&#46;com">zoltan<span>&#46;</span>balogh<span>&#64;</span>ericsson<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Zoltan Kiss</td>
<td><a class="reference external" href="mailto:zoltan&#46;kiss&#37;&#52;&#48;citrix&#46;com">zoltan<span>&#46;</span>kiss<span>&#64;</span>citrix<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Zhi Yong Wu</td>
<td><a class="reference external" href="mailto:zwu&#46;kernel&#37;&#52;&#48;gmail&#46;com">zwu<span>&#46;</span>kernel<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Zang MingJie</td>
<td><a class="reference external" href="mailto:zealot0630&#37;&#52;&#48;gmail&#46;com">zealot0630<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>nickcooper-zhangtonghao</td>
<td><a class="reference external" href="mailto:nickcooper-zhangtonghao&#37;&#52;&#48;opencloud&#46;tech">nickcooper-zhangtonghao<span>&#64;</span>opencloud<span>&#46;</span>tech</a></td>
</tr>
<tr class="row-odd"><td>wisd0me</td>
<td><a class="reference external" href="mailto:ak47izatool&#37;&#52;&#48;gmail&#46;com">ak47izatool<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>xushengping</td>
<td><a class="reference external" href="mailto:shengping&#46;xu&#37;&#52;&#48;huawei&#46;com">shengping<span>&#46;</span>xu<span>&#64;</span>huawei<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>yinpeijun</td>
<td><a class="reference external" href="mailto:yinpeijun&#37;&#52;&#48;huawei&#46;com">yinpeijun<span>&#64;</span>huawei<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>zangchuanqiang</td>
<td><a class="reference external" href="mailto:zangchuanqiang&#37;&#52;&#48;huawei&#46;com">zangchuanqiang<span>&#64;</span>huawei<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>zhaojingjing</td>
<td><a class="reference external" href="mailto:zhao&#46;jingjing1&#37;&#52;&#48;zte&#46;com&#46;cn">zhao<span>&#46;</span>jingjing1<span>&#64;</span>zte<span>&#46;</span>com<span>&#46;</span>cn</a></td>
</tr>
</tbody>
</table>
<p>The following additional people are mentioned in commit logs as having
provided helpful bug reports or suggestions.</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Email</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Aaron M. Ucko</td>
<td><a class="reference external" href="mailto:ucko&#37;&#52;&#48;debian&#46;org">ucko<span>&#64;</span>debian<span>&#46;</span>org</a></td>
</tr>
<tr class="row-odd"><td>Abhinav Singhal</td>
<td><a class="reference external" href="mailto:Abhinav&#46;Singhal&#37;&#52;&#48;spirent&#46;com">Abhinav<span>&#46;</span>Singhal<span>&#64;</span>spirent<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Adam Heath</td>
<td><a class="reference external" href="mailto:doogie&#37;&#52;&#48;brainfood&#46;com">doogie<span>&#64;</span>brainfood<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Ahmed Bilal</td>
<td><a class="reference external" href="mailto:numan252&#37;&#52;&#48;gmail&#46;com">numan252<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Alan Shieh</td>
<td><a class="reference external" href="mailto:ashieh&#37;&#52;&#48;nicira&#46;com">ashieh<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Alban Browaeys</td>
<td><a class="reference external" href="mailto:prahal&#37;&#52;&#48;yahoo&#46;com">prahal<span>&#64;</span>yahoo<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Alex Yip</td>
<td><a class="reference external" href="mailto:alex&#37;&#52;&#48;nicira&#46;com">alex<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Alexey I. Froloff</td>
<td><a class="reference external" href="mailto:raorn&#37;&#52;&#48;altlinux&#46;org">raorn<span>&#64;</span>altlinux<span>&#46;</span>org</a></td>
</tr>
<tr class="row-even"><td>Amar Padmanabhan</td>
<td><a class="reference external" href="mailto:amar&#37;&#52;&#48;nicira&#46;com">amar<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Amey Bhide</td>
<td><a class="reference external" href="mailto:abhide&#37;&#52;&#48;nicira&#46;com">abhide<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Amre Shakimov</td>
<td><a class="reference external" href="mailto:ashakimov&#37;&#52;&#48;vmware&#46;com">ashakimov<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>André Ruß</td>
<td><a class="reference external" href="mailto:andre&#46;russ&#37;&#52;&#48;hybris&#46;com">andre<span>&#46;</span>russ<span>&#64;</span>hybris<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Andreas Beckmann</td>
<td><a class="reference external" href="mailto:debian&#37;&#52;&#48;abeckmann&#46;de">debian<span>&#64;</span>abeckmann<span>&#46;</span>de</a></td>
</tr>
<tr class="row-odd"><td>Andrei Andone</td>
<td><a class="reference external" href="mailto:andrei&#46;andone&#37;&#52;&#48;softvision&#46;ro">andrei<span>&#46;</span>andone<span>&#64;</span>softvision<span>&#46;</span>ro</a></td>
</tr>
<tr class="row-even"><td>Andrey Korolyov</td>
<td><a class="reference external" href="mailto:andrey&#37;&#52;&#48;xdel&#46;ru">andrey<span>&#64;</span>xdel<span>&#46;</span>ru</a></td>
</tr>
<tr class="row-odd"><td>Anshuman Manral</td>
<td><a class="reference external" href="mailto:anshuman&#46;manral&#37;&#52;&#48;outlook&#46;com">anshuman<span>&#46;</span>manral<span>&#64;</span>outlook<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Anton Matsiuk</td>
<td><a class="reference external" href="mailto:anton&#46;matsiuk&#37;&#52;&#48;gmail&#46;com">anton<span>&#46;</span>matsiuk<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Anup Khadka</td>
<td><a class="reference external" href="mailto:khadka&#46;py&#37;&#52;&#48;gmail&#46;com">khadka<span>&#46;</span>py<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Anuprem Chalvadi</td>
<td><a class="reference external" href="mailto:achalvadi&#37;&#52;&#48;vmware&#46;com">achalvadi<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Ariel Tubaltsev</td>
<td><a class="reference external" href="mailto:atubaltsev&#37;&#52;&#48;vmware&#46;com">atubaltsev<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Arkajit Ghosh</td>
<td><a class="reference external" href="mailto:arkajit&#46;ghosh&#37;&#52;&#48;tcs&#46;com">arkajit<span>&#46;</span>ghosh<span>&#64;</span>tcs<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Atzm Watanabe</td>
<td><a class="reference external" href="mailto:atzm&#37;&#52;&#48;stratosphere&#46;co&#46;jp">atzm<span>&#64;</span>stratosphere<span>&#46;</span>co<span>&#46;</span>jp</a></td>
</tr>
<tr class="row-even"><td>Aurélien Poulain</td>
<td><a class="reference external" href="mailto:aurepoulain&#37;&#52;&#48;viacesi&#46;fr">aurepoulain<span>&#64;</span>viacesi<span>&#46;</span>fr</a></td>
</tr>
<tr class="row-odd"><td>Bastian Blank</td>
<td><a class="reference external" href="mailto:waldi&#37;&#52;&#48;debian&#46;org">waldi<span>&#64;</span>debian<span>&#46;</span>org</a></td>
</tr>
<tr class="row-even"><td>Ben Basler</td>
<td><a class="reference external" href="mailto:bbasler&#37;&#52;&#48;nicira&#46;com">bbasler<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Bhargava Shastry</td>
<td><a class="reference external" href="mailto:bshastry&#37;&#52;&#48;sec&#46;t-labs&#46;tu-berlin&#46;de">bshastry<span>&#64;</span>sec<span>&#46;</span>t-labs<span>&#46;</span>tu-berlin<span>&#46;</span>de</a></td>
</tr>
<tr class="row-even"><td>Bob Ball</td>
<td><a class="reference external" href="mailto:bob&#46;ball&#37;&#52;&#48;citrix&#46;com">bob<span>&#46;</span>ball<span>&#64;</span>citrix<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Brad Hall</td>
<td><a class="reference external" href="mailto:brad&#37;&#52;&#48;nicira&#46;com">brad<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Brandon Heller</td>
<td><a class="reference external" href="mailto:brandonh&#37;&#52;&#48;stanford&#46;edu">brandonh<span>&#64;</span>stanford<span>&#46;</span>edu</a></td>
</tr>
<tr class="row-odd"><td>Brendan Kelley</td>
<td><a class="reference external" href="mailto:bkelley&#37;&#52;&#48;nicira&#46;com">bkelley<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Brent Salisbury</td>
<td><a class="reference external" href="mailto:brent&#46;salisbury&#37;&#52;&#48;gmail&#46;com">brent<span>&#46;</span>salisbury<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Brian Field</td>
<td><a class="reference external" href="mailto:Brian_Field&#37;&#52;&#48;cable&#46;comcast&#46;com">Brian_Field<span>&#64;</span>cable<span>&#46;</span>comcast<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Bryan Fulton</td>
<td><a class="reference external" href="mailto:bryan&#37;&#52;&#48;nicira&#46;com">bryan<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Bryan Osoro</td>
<td><a class="reference external" href="mailto:bosoro&#37;&#52;&#48;nicira&#46;com">bosoro<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Cedric Hobbs</td>
<td><a class="reference external" href="mailto:cedric&#37;&#52;&#48;nicira&#46;com">cedric<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Chris Hydon</td>
<td><a class="reference external" href="mailto:chydon&#37;&#52;&#48;aristanetworks&#46;com">chydon<span>&#64;</span>aristanetworks<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Christian Stigen Larsen</td>
<td><a class="reference external" href="mailto:cslarsen&#37;&#52;&#48;gmail&#46;com">cslarsen<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Christopher Paggen</td>
<td><a class="reference external" href="mailto:cpaggen&#37;&#52;&#48;cisco&#46;com">cpaggen<span>&#64;</span>cisco<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Chunhe Li</td>
<td><a class="reference external" href="mailto:lichunhe&#37;&#52;&#48;huawei&#46;com">lichunhe<span>&#64;</span>huawei<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Daniel Badea</td>
<td><a class="reference external" href="mailto:daniel&#46;badea&#37;&#52;&#48;windriver&#46;com">daniel<span>&#46;</span>badea<span>&#64;</span>windriver<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Darragh O&#8217;Reilly</td>
<td><a class="reference external" href="mailto:darragh&#46;oreilly&#37;&#52;&#48;hpe&#46;com">darragh<span>&#46;</span>oreilly<span>&#64;</span>hpe<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Dave Walker</td>
<td><a class="reference external" href="mailto:DaveWalker&#37;&#52;&#48;ubuntu&#46;com">DaveWalker<span>&#64;</span>ubuntu<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>David Evans</td>
<td><a class="reference external" href="mailto:davidjoshuaevans&#37;&#52;&#48;gmail&#46;com">davidjoshuaevans<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>David Palma</td>
<td><a class="reference external" href="mailto:palma&#37;&#52;&#48;onesource&#46;pt">palma<span>&#64;</span>onesource<span>&#46;</span>pt</a></td>
</tr>
<tr class="row-even"><td>Derek Cormier</td>
<td><a class="reference external" href="mailto:derek&#46;cormier&#37;&#52;&#48;lab&#46;ntt&#46;co&#46;jp">derek<span>&#46;</span>cormier<span>&#64;</span>lab<span>&#46;</span>ntt<span>&#46;</span>co<span>&#46;</span>jp</a></td>
</tr>
<tr class="row-odd"><td>Dhaval Badiani</td>
<td><a class="reference external" href="mailto:dbadiani&#37;&#52;&#48;vmware&#46;com">dbadiani<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>DK Moon</td>
<td><a class="reference external" href="mailto:dkmoon&#37;&#52;&#48;nicira&#46;com">dkmoon<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Ding Zhi</td>
<td><a class="reference external" href="mailto:zhi&#46;ding&#37;&#52;&#48;6wind&#46;com">zhi<span>&#46;</span>ding<span>&#64;</span>6wind<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Dong Jun</td>
<td><a class="reference external" href="mailto:dongj&#37;&#52;&#48;dtdream&#46;com">dongj<span>&#64;</span>dtdream<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Dustin Spinhirne</td>
<td><a class="reference external" href="mailto:dspinhirne&#37;&#52;&#48;vmware&#46;com">dspinhirne<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Edwin Chiu</td>
<td><a class="reference external" href="mailto:echiu&#37;&#52;&#48;vmware&#46;com">echiu<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Eivind Bulie Haanaes</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>Enas Ahmad</td>
<td><a class="reference external" href="mailto:enas&#46;ahmad&#37;&#52;&#48;kaust&#46;edu&#46;sa">enas<span>&#46;</span>ahmad<span>&#64;</span>kaust<span>&#46;</span>edu<span>&#46;</span>sa</a></td>
</tr>
<tr class="row-odd"><td>Eric Lopez</td>
<td><a class="reference external" href="mailto:elopez&#37;&#52;&#48;nicira&#46;com">elopez<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Frido Roose</td>
<td><a class="reference external" href="mailto:fr&#46;roose&#37;&#52;&#48;gmail&#46;com">fr<span>&#46;</span>roose<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Gaetano Catalli</td>
<td><a class="reference external" href="mailto:gaetano&#46;catalli&#37;&#52;&#48;gmail&#46;com">gaetano<span>&#46;</span>catalli<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Gavin Remaley</td>
<td><a class="reference external" href="mailto:gavin_remaley&#37;&#52;&#48;selinc&#46;com">gavin_remaley<span>&#64;</span>selinc<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>George Shuklin</td>
<td><a class="reference external" href="mailto:amarao&#37;&#52;&#48;desunote&#46;ru">amarao<span>&#64;</span>desunote<span>&#46;</span>ru</a></td>
</tr>
<tr class="row-even"><td>Gerald Rogers</td>
<td><a class="reference external" href="mailto:gerald&#46;rogers&#37;&#52;&#48;intel&#46;com">gerald<span>&#46;</span>rogers<span>&#64;</span>intel<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Ghanem Bahri</td>
<td><a class="reference external" href="mailto:bahri&#46;ghanem&#37;&#52;&#48;gmail&#46;com">bahri<span>&#46;</span>ghanem<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Giuseppe de Candia</td>
<td><a class="reference external" href="mailto:giuseppe&#46;decandia&#37;&#52;&#48;gmail&#46;com">giuseppe<span>&#46;</span>decandia<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Gordon Good</td>
<td><a class="reference external" href="mailto:ggood&#37;&#52;&#48;nicira&#46;com">ggood<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Greg Dahlman</td>
<td><a class="reference external" href="mailto:gdahlman&#37;&#52;&#48;hotmail&#46;com">gdahlman<span>&#64;</span>hotmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Gregor Schaffrath</td>
<td><a class="reference external" href="mailto:grsch&#37;&#52;&#48;net&#46;t-labs&#46;tu-berlin&#46;de">grsch<span>&#64;</span>net<span>&#46;</span>t-labs<span>&#46;</span>tu-berlin<span>&#46;</span>de</a></td>
</tr>
<tr class="row-even"><td>Gregory Smith</td>
<td><a class="reference external" href="mailto:gasmith&#37;&#52;&#48;nutanix&#46;com">gasmith<span>&#64;</span>nutanix<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Guolin Yang</td>
<td><a class="reference external" href="mailto:gyang&#37;&#52;&#48;vmware&#46;com">gyang<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Gur Stavi</td>
<td><a class="reference external" href="mailto:gstavi&#37;&#52;&#48;mrv&#46;com">gstavi<span>&#64;</span>mrv<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Hari Sasank Bhamidipalli</td>
<td><a class="reference external" href="mailto:hbhamidi&#37;&#52;&#48;cisco&#46;com">hbhamidi<span>&#64;</span>cisco<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Hassan Khan</td>
<td><a class="reference external" href="mailto:hassan&#46;khan&#37;&#52;&#48;seecs&#46;edu&#46;pk">hassan<span>&#46;</span>khan<span>&#64;</span>seecs<span>&#46;</span>edu<span>&#46;</span>pk</a></td>
</tr>
<tr class="row-odd"><td>Hector Oron</td>
<td><a class="reference external" href="mailto:hector&#46;oron&#37;&#52;&#48;gmail&#46;com">hector<span>&#46;</span>oron<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Hemanth Kumar Mantri</td>
<td><a class="reference external" href="mailto:mantri&#37;&#52;&#48;nutanix&#46;com">mantri<span>&#64;</span>nutanix<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Henrik Amren</td>
<td><a class="reference external" href="mailto:henrik&#37;&#52;&#48;nicira&#46;com">henrik<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Hiroshi Tanaka</td>
<td><a class="reference external" href="mailto:htanaka&#37;&#52;&#48;nicira&#46;com">htanaka<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Hiroshi Miyata</td>
<td><a class="reference external" href="mailto:miyahiro&#46;dazu&#37;&#52;&#48;gmail&#46;com">miyahiro<span>&#46;</span>dazu<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Hsin-Yi Shen</td>
<td><a class="reference external" href="mailto:shenh&#37;&#52;&#48;vmware&#46;com">shenh<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Hyojoon Kim</td>
<td><a class="reference external" href="mailto:joonk&#37;&#52;&#48;gatech&#46;edu">joonk<span>&#64;</span>gatech<span>&#46;</span>edu</a></td>
</tr>
<tr class="row-even"><td>Igor Ganichev</td>
<td><a class="reference external" href="mailto:iganichev&#37;&#52;&#48;nicira&#46;com">iganichev<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Igor Sever</td>
<td><a class="reference external" href="mailto:igor&#37;&#52;&#48;xorops&#46;com">igor<span>&#64;</span>xorops<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Jacob Cherkas</td>
<td><a class="reference external" href="mailto:jcherkas&#37;&#52;&#48;nicira&#46;com">jcherkas<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Jad Naous</td>
<td><a class="reference external" href="mailto:jnaous&#37;&#52;&#48;gmail&#46;com">jnaous<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Jamal Hadi Salim</td>
<td><a class="reference external" href="mailto:hadi&#37;&#52;&#48;cyberus&#46;ca">hadi<span>&#64;</span>cyberus<span>&#46;</span>ca</a></td>
</tr>
<tr class="row-odd"><td>James Schmidt</td>
<td><a class="reference external" href="mailto:jschmidt&#37;&#52;&#48;nicira&#46;com">jschmidt<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Jan Medved</td>
<td><a class="reference external" href="mailto:jmedved&#37;&#52;&#48;juniper&#46;net">jmedved<span>&#64;</span>juniper<span>&#46;</span>net</a></td>
</tr>
<tr class="row-odd"><td>Janis Hamme</td>
<td><a class="reference external" href="mailto:janis&#46;hamme&#37;&#52;&#48;student&#46;kit&#46;edu">janis<span>&#46;</span>hamme<span>&#64;</span>student<span>&#46;</span>kit<span>&#46;</span>edu</a></td>
</tr>
<tr class="row-even"><td>Jari Sundell</td>
<td><a class="reference external" href="mailto:sundell&#46;software&#37;&#52;&#48;gmail&#46;com">sundell<span>&#46;</span>software<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Javier Albornz</td>
<td><a class="reference external" href="mailto:javier&#46;albornoz&#37;&#52;&#48;hpe&#46;com">javier<span>&#46;</span>albornoz<span>&#64;</span>hpe<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Jed Daniels</td>
<td><a class="reference external" href="mailto:openvswitch&#37;&#52;&#48;jeddaniels&#46;com">openvswitch<span>&#64;</span>jeddaniels<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Jeff Merrick</td>
<td><a class="reference external" href="mailto:jmerrick&#37;&#52;&#48;vmware&#46;com">jmerrick<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Jeongkeun Lee</td>
<td><a class="reference external" href="mailto:jklee&#37;&#52;&#48;hp&#46;com">jklee<span>&#64;</span>hp<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Jian Qiu</td>
<td><a class="reference external" href="mailto:swordqiu&#37;&#52;&#48;gmail&#46;com">swordqiu<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Joan Cirer</td>
<td><a class="reference external" href="mailto:joan&#37;&#52;&#48;ev0&#46;net">joan<span>&#64;</span>ev0<span>&#46;</span>net</a></td>
</tr>
<tr class="row-odd"><td>John Darrington</td>
<td><a class="reference external" href="mailto:john&#37;&#52;&#48;darrington&#46;wattle&#46;id&#46;au">john<span>&#64;</span>darrington<span>&#46;</span>wattle<span>&#46;</span>id<span>&#46;</span>au</a></td>
</tr>
<tr class="row-even"><td>John Galgay</td>
<td><a class="reference external" href="mailto:john&#37;&#52;&#48;galgay&#46;net">john<span>&#64;</span>galgay<span>&#46;</span>net</a></td>
</tr>
<tr class="row-odd"><td>John Hurley</td>
<td><a class="reference external" href="mailto:john&#46;hurley&#37;&#52;&#48;netronome&#46;com">john<span>&#46;</span>hurley<span>&#64;</span>netronome<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>John Reumann</td>
<td><a class="reference external" href="mailto:nofutznetworks&#37;&#52;&#48;gmail&#46;com">nofutznetworks<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Kashyap Thimmaraju</td>
<td><a class="reference external" href="mailto:kashyap&#46;thimmaraju&#37;&#52;&#48;sec&#46;t-labs&#46;tu-berlin&#46;de">kashyap<span>&#46;</span>thimmaraju<span>&#64;</span>sec<span>&#46;</span>t-labs<span>&#46;</span>tu-berlin<span>&#46;</span>de</a></td>
</tr>
<tr class="row-even"><td>Keith Holleman</td>
<td><a class="reference external" href="mailto:hollemanietf&#37;&#52;&#48;gmail&#46;com">hollemanietf<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Kevin Lin</td>
<td><a class="reference external" href="mailto:kevinlin&#37;&#52;&#48;berkeley&#46;edu">kevinlin<span>&#64;</span>berkeley<span>&#46;</span>edu</a></td>
</tr>
<tr class="row-even"><td>K 華</td>
<td><a class="reference external" href="mailto:k940545&#37;&#52;&#48;hotmail&#46;com">k940545<span>&#64;</span>hotmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Kevin Mancuso</td>
<td><a class="reference external" href="mailto:kevin&#46;mancuso&#37;&#52;&#48;rackspace&#46;com">kevin<span>&#46;</span>mancuso<span>&#64;</span>rackspace<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Kiran Shanbhog</td>
<td><a class="reference external" href="mailto:kiran&#37;&#52;&#48;vmware&#46;com">kiran<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Kirill Kabardin</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>Kirkland Spector</td>
<td><a class="reference external" href="mailto:kspector&#37;&#52;&#48;salesforce&#46;com">kspector<span>&#64;</span>salesforce<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Koichi Yagishita</td>
<td><a class="reference external" href="mailto:yagishita&#46;koichi&#37;&#52;&#48;jrc&#46;co&#46;jp">yagishita<span>&#46;</span>koichi<span>&#64;</span>jrc<span>&#46;</span>co<span>&#46;</span>jp</a></td>
</tr>
<tr class="row-even"><td>Konstantin Khorenko</td>
<td><a class="reference external" href="mailto:khorenko&#37;&#52;&#48;openvz&#46;org">khorenko<span>&#64;</span>openvz<span>&#46;</span>org</a></td>
</tr>
<tr class="row-odd"><td>Kris zhang</td>
<td><a class="reference external" href="mailto:zhang&#46;kris&#37;&#52;&#48;gmail&#46;com">zhang<span>&#46;</span>kris<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Krishna Miriyala</td>
<td><a class="reference external" href="mailto:krishna&#37;&#52;&#48;nicira&#46;com">krishna<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Krishna Mohan Elluru</td>
<td><a class="reference external" href="mailto:elluru&#46;kri&#46;mohan&#37;&#52;&#48;hpe&#46;com">elluru<span>&#46;</span>kri<span>&#46;</span>mohan<span>&#64;</span>hpe<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>László Sürü</td>
<td><a class="reference external" href="mailto:laszlo&#46;suru&#37;&#52;&#48;ericsson&#46;com">laszlo<span>&#46;</span>suru<span>&#64;</span>ericsson<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Len Gao</td>
<td><a class="reference external" href="mailto:leng&#37;&#52;&#48;vmware&#46;com">leng<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Logan Rosen</td>
<td><a class="reference external" href="mailto:logatronico&#37;&#52;&#48;gmail&#46;com">logatronico<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Luca Falavigna</td>
<td><a class="reference external" href="mailto:dktrkranz&#37;&#52;&#48;debian&#46;org">dktrkranz<span>&#64;</span>debian<span>&#46;</span>org</a></td>
</tr>
<tr class="row-even"><td>Luiz Henrique Ozaki</td>
<td><a class="reference external" href="mailto:luiz&#46;ozaki&#37;&#52;&#48;gmail&#46;com">luiz<span>&#46;</span>ozaki<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Manpreet Singh</td>
<td><a class="reference external" href="mailto:er&#46;manpreet25&#37;&#52;&#48;gmail&#46;com">er<span>&#46;</span>manpreet25<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Marco d&#8217;Itri</td>
<td><a class="reference external" href="mailto:md&#37;&#52;&#48;Linux&#46;IT">md<span>&#64;</span>Linux<span>&#46;</span>IT</a></td>
</tr>
<tr class="row-odd"><td>Martin Vizvary</td>
<td><a class="reference external" href="mailto:vizvary&#37;&#52;&#48;ics&#46;muni&#46;cz">vizvary<span>&#64;</span>ics<span>&#46;</span>muni<span>&#46;</span>cz</a></td>
</tr>
<tr class="row-even"><td>Marvin Pascual</td>
<td><a class="reference external" href="mailto:marvin&#37;&#52;&#48;pascual&#46;com&#46;ph">marvin<span>&#64;</span>pascual<span>&#46;</span>com<span>&#46;</span>ph</a></td>
</tr>
<tr class="row-odd"><td>Maxime Brun</td>
<td><a class="reference external" href="mailto:m&#46;brun&#37;&#52;&#48;alphalink&#46;fr">m<span>&#46;</span>brun<span>&#64;</span>alphalink<span>&#46;</span>fr</a></td>
</tr>
<tr class="row-even"><td>Madhu Venugopal</td>
<td><a class="reference external" href="mailto:mavenugo&#37;&#52;&#48;gmail&#46;com">mavenugo<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Michael A. Collins</td>
<td><a class="reference external" href="mailto:mike&#46;a&#46;collins&#37;&#52;&#48;ark-net&#46;org">mike<span>&#46;</span>a<span>&#46;</span>collins<span>&#64;</span>ark-net<span>&#46;</span>org</a></td>
</tr>
<tr class="row-even"><td>Michael Hu</td>
<td><a class="reference external" href="mailto:mhu&#37;&#52;&#48;nicira&#46;com">mhu<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Michael J. Smalley</td>
<td><a class="reference external" href="mailto:michaeljsmalley&#37;&#52;&#48;gmail&#46;com">michaeljsmalley<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Michael Mao</td>
<td><a class="reference external" href="mailto:mmao&#37;&#52;&#48;nicira&#46;com">mmao<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Michael Shigorin</td>
<td><a class="reference external" href="mailto:mike&#37;&#52;&#48;osdn&#46;org&#46;ua">mike<span>&#64;</span>osdn<span>&#46;</span>org<span>&#46;</span>ua</a></td>
</tr>
<tr class="row-even"><td>Mihir Gangar</td>
<td><a class="reference external" href="mailto:gangarm&#37;&#52;&#48;vmware&#46;com">gangarm<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Mike Bursell</td>
<td><a class="reference external" href="mailto:mike&#46;bursell&#37;&#52;&#48;citrix&#46;com">mike<span>&#46;</span>bursell<span>&#64;</span>citrix<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Mike Kruze</td>
<td><a class="reference external" href="mailto:mkruze&#37;&#52;&#48;nicira&#46;com">mkruze<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Mike Qing</td>
<td><a class="reference external" href="mailto:mqing&#37;&#52;&#48;vmware&#46;com">mqing<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Min Chen</td>
<td><a class="reference external" href="mailto:ustcer&#46;tonychan&#37;&#52;&#48;gmail&#46;com">ustcer<span>&#46;</span>tonychan<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Mikael Doverhag</td>
<td><a class="reference external" href="mailto:mdoverhag&#37;&#52;&#48;nicira&#46;com">mdoverhag<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Mrinmoy Das</td>
<td><a class="reference external" href="mailto:mrdas&#37;&#52;&#48;ixiacom&#46;com">mrdas<span>&#64;</span>ixiacom<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Muhammad Shahbaz</td>
<td><a class="reference external" href="mailto:mshahbaz&#37;&#52;&#48;cs&#46;princeton&#46;edu">mshahbaz<span>&#64;</span>cs<span>&#46;</span>princeton<span>&#46;</span>edu</a></td>
</tr>
<tr class="row-even"><td>Murali R</td>
<td><a class="reference external" href="mailto:muralirdev&#37;&#52;&#48;gmail&#46;com">muralirdev<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Nagi Reddy Jonnala</td>
<td><a class="reference external" href="mailto:njonnala&#37;&#52;&#48;Brocade&#46;com">njonnala<span>&#64;</span>Brocade<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Niels van Adrichem</td>
<td><a class="reference external" href="mailto:N&#46;L&#46;M&#46;vanAdrichem&#37;&#52;&#48;tudelft&#46;nl">N<span>&#46;</span>L<span>&#46;</span>M<span>&#46;</span>vanAdrichem<span>&#64;</span>tudelft<span>&#46;</span>nl</a></td>
</tr>
<tr class="row-odd"><td>Niklas Andersson</td>
<td><a class="reference external" href="mailto:nandersson&#37;&#52;&#48;nicira&#46;com">nandersson<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Pankaj Thakkar</td>
<td><a class="reference external" href="mailto:thakkar&#37;&#52;&#48;nicira&#46;com">thakkar<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Pasi Kärkkäinen</td>
<td><a class="reference external" href="mailto:pasik&#37;&#52;&#48;iki&#46;fi">pasik<span>&#64;</span>iki<span>&#46;</span>fi</a></td>
</tr>
<tr class="row-even"><td>Patrik Andersson R</td>
<td><a class="reference external" href="mailto:patrik&#46;r&#46;andersson&#37;&#52;&#48;ericsson&#46;com">patrik<span>&#46;</span>r<span>&#46;</span>andersson<span>&#64;</span>ericsson<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Paulo Cravero</td>
<td><a class="reference external" href="mailto:pcravero&#37;&#52;&#48;as2594&#46;net">pcravero<span>&#64;</span>as2594<span>&#46;</span>net</a></td>
</tr>
<tr class="row-even"><td>Pawan Shukla</td>
<td><a class="reference external" href="mailto:shuklap&#37;&#52;&#48;vmware&#46;com">shuklap<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Peter Amidon</td>
<td><a class="reference external" href="mailto:peter&#37;&#52;&#48;picnicpark&#46;org">peter<span>&#64;</span>picnicpark<span>&#46;</span>org</a></td>
</tr>
<tr class="row-even"><td>Peter Balland</td>
<td><a class="reference external" href="mailto:peter&#37;&#52;&#48;nicira&#46;com">peter<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Peter Phaal</td>
<td><a class="reference external" href="mailto:peter&#46;phaal&#37;&#52;&#48;inmon&#46;com">peter<span>&#46;</span>phaal<span>&#64;</span>inmon<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Prabina Pattnaik</td>
<td><a class="reference external" href="mailto:Prabina&#46;Pattnaik&#37;&#52;&#48;nechclst&#46;in">Prabina<span>&#46;</span>Pattnaik<span>&#64;</span>nechclst<span>&#46;</span>in</a></td>
</tr>
<tr class="row-odd"><td>Pratap Reddy</td>
<td><a class="reference external" href="mailto:preddy&#37;&#52;&#48;nicira&#46;com">preddy<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Ralf Heiringhoff</td>
<td><a class="reference external" href="mailto:ralf&#37;&#52;&#48;frosty-geek&#46;net">ralf<span>&#64;</span>frosty-geek<span>&#46;</span>net</a></td>
</tr>
<tr class="row-odd"><td>Ram Jothikumar</td>
<td><a class="reference external" href="mailto:rjothikumar&#37;&#52;&#48;nicira&#46;com">rjothikumar<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Ramana Reddy</td>
<td><a class="reference external" href="mailto:gtvrreddy&#37;&#52;&#48;gmail&#46;com">gtvrreddy<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Ray Li</td>
<td><a class="reference external" href="mailto:rayli1107&#37;&#52;&#48;gmail&#46;com">rayli1107<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Richard Theis</td>
<td><a class="reference external" href="mailto:rtheis&#37;&#52;&#48;us&#46;ibm&#46;com">rtheis<span>&#64;</span>us<span>&#46;</span>ibm<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>RishiRaj Maulick</td>
<td><a class="reference external" href="mailto:rishi&#46;raj2509&#37;&#52;&#48;gmail&#46;com">rishi<span>&#46;</span>raj2509<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Rob Sherwood</td>
<td><a class="reference external" href="mailto:rob&#46;sherwood&#37;&#52;&#48;bigswitch&#46;com">rob<span>&#46;</span>sherwood<span>&#64;</span>bigswitch<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Robert Strickler</td>
<td><a class="reference external" href="mailto:anomalyst&#37;&#52;&#48;gmail&#46;com">anomalyst<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Roger Leigh</td>
<td><a class="reference external" href="mailto:rleigh&#37;&#52;&#48;codelibre&#46;net">rleigh<span>&#64;</span>codelibre<span>&#46;</span>net</a></td>
</tr>
<tr class="row-odd"><td>Rogério Vinhal Nunes</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>Roman Sokolkov</td>
<td><a class="reference external" href="mailto:rsokolkov&#37;&#52;&#48;gmail&#46;com">rsokolkov<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Ronaldo A. Ferreira</td>
<td><a class="reference external" href="mailto:ronaldof&#37;&#52;&#48;CS&#46;Princeton&#46;EDU">ronaldof<span>&#64;</span>CS<span>&#46;</span>Princeton<span>&#46;</span>EDU</a></td>
</tr>
<tr class="row-even"><td>Ronny L. Bull</td>
<td><a class="reference external" href="mailto:bullrl&#37;&#52;&#48;clarkson&#46;edu">bullrl<span>&#64;</span>clarkson<span>&#46;</span>edu</a></td>
</tr>
<tr class="row-odd"><td>Sandeep Kumar</td>
<td><a class="reference external" href="mailto:sandeep&#46;kumar16&#37;&#52;&#48;tcs&#46;com">sandeep<span>&#46;</span>kumar16<span>&#64;</span>tcs<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Sander Eikelenboom</td>
<td><a class="reference external" href="mailto:linux&#37;&#52;&#48;eikelenboom&#46;it">linux<span>&#64;</span>eikelenboom<span>&#46;</span>it</a></td>
</tr>
<tr class="row-odd"><td>Saul St. John</td>
<td><a class="reference external" href="mailto:sstjohn&#37;&#52;&#48;cs&#46;wisc&#46;edu">sstjohn<span>&#64;</span>cs<span>&#46;</span>wisc<span>&#46;</span>edu</a></td>
</tr>
<tr class="row-even"><td>Scott Hendricks</td>
<td><a class="reference external" href="mailto:shendricks&#37;&#52;&#48;nicira&#46;com">shendricks<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Sean Brady</td>
<td><a class="reference external" href="mailto:sbrady&#37;&#52;&#48;gtfservices&#46;com">sbrady<span>&#64;</span>gtfservices<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Sebastian Andrzej Siewior</td>
<td><a class="reference external" href="mailto:sebastian&#37;&#52;&#48;breakpoint&#46;cc">sebastian<span>&#64;</span>breakpoint<span>&#46;</span>cc</a></td>
</tr>
<tr class="row-odd"><td>Sébastien RICCIO</td>
<td><a class="reference external" href="mailto:sr&#37;&#52;&#48;swisscenter&#46;com">sr<span>&#64;</span>swisscenter<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Simon Jouet</td>
<td><a class="reference external" href="mailto:simon&#46;jouet&#37;&#52;&#48;gmail&#46;com">simon<span>&#46;</span>jouet<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Spiro Kourtessis</td>
<td><a class="reference external" href="mailto:spiro&#37;&#52;&#48;vmware&#46;com">spiro<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Sridhar Samudrala</td>
<td><a class="reference external" href="mailto:samudrala&#46;sridhar&#37;&#52;&#48;gmail&#46;com">samudrala<span>&#46;</span>sridhar<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Srini Seetharaman</td>
<td><a class="reference external" href="mailto:seethara&#37;&#52;&#48;stanford&#46;edu">seethara<span>&#64;</span>stanford<span>&#46;</span>edu</a></td>
</tr>
<tr class="row-even"><td>Sabyasachi Sengupta</td>
<td><a class="reference external" href="mailto:Sabyasachi&#46;Sengupta&#37;&#52;&#48;alcatel-lucent&#46;com">Sabyasachi<span>&#46;</span>Sengupta<span>&#64;</span>alcatel-lucent<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Salvatore Cambria</td>
<td><a class="reference external" href="mailto:salvatore&#46;cambria&#37;&#52;&#48;citrix&#46;com">salvatore<span>&#46;</span>cambria<span>&#64;</span>citrix<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Soner Sevinc</td>
<td><a class="reference external" href="mailto:sevincs&#37;&#52;&#48;vmware&#46;com">sevincs<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Stephen Hemminger</td>
<td><a class="reference external" href="mailto:shemminger&#37;&#52;&#48;vyatta&#46;com">shemminger<span>&#64;</span>vyatta<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Stuart Cardall</td>
<td><a class="reference external" href="mailto:developer&#37;&#52;&#48;it-offshore&#46;co&#46;uk">developer<span>&#64;</span>it-offshore<span>&#46;</span>co<span>&#46;</span>uk</a></td>
</tr>
<tr class="row-odd"><td>Suganya Ramachandran</td>
<td><a class="reference external" href="mailto:suganyar&#37;&#52;&#48;vmware&#46;com">suganyar<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Taekho Nam</td>
<td><a class="reference external" href="mailto:thnam&#37;&#52;&#48;smartx&#46;kr">thnam<span>&#64;</span>smartx<span>&#46;</span>kr</a></td>
</tr>
<tr class="row-odd"><td>Takayuki HAMA</td>
<td><a class="reference external" href="mailto:t-hama&#37;&#52;&#48;cb&#46;jp&#46;nec&#46;com">t-hama<span>&#64;</span>cb<span>&#46;</span>jp<span>&#46;</span>nec<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Teemu Koponen</td>
<td><a class="reference external" href="mailto:koponen&#37;&#52;&#48;nicira&#46;com">koponen<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Thomas Morin</td>
<td><a class="reference external" href="mailto:thomas&#46;morin&#37;&#52;&#48;orange&#46;com">thomas<span>&#46;</span>morin<span>&#64;</span>orange<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Timothy Chen</td>
<td><a class="reference external" href="mailto:tchen&#37;&#52;&#48;nicira&#46;com">tchen<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Torbjorn Tornkvist</td>
<td><a class="reference external" href="mailto:kruskakli&#37;&#52;&#48;gmail&#46;com">kruskakli<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Tytus Kurek</td>
<td><a class="reference external" href="mailto:Tytus&#46;Kurek&#37;&#52;&#48;pega&#46;com">Tytus<span>&#46;</span>Kurek<span>&#64;</span>pega<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Valentin Bud</td>
<td><a class="reference external" href="mailto:valentin&#37;&#52;&#48;hackaserver&#46;com">valentin<span>&#64;</span>hackaserver<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Vasiliy Tolstov</td>
<td><a class="reference external" href="mailto:v&#46;tolstov&#37;&#52;&#48;selfip&#46;ru">v<span>&#46;</span>tolstov<span>&#64;</span>selfip<span>&#46;</span>ru</a></td>
</tr>
<tr class="row-odd"><td>Vasu Dasari</td>
<td><a class="reference external" href="mailto:vdasari&#37;&#52;&#48;gmail&#46;com">vdasari<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Vinllen Chen</td>
<td><a class="reference external" href="mailto:cvinllen&#37;&#52;&#48;gmail&#46;com">cvinllen<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Vishal Swarankar</td>
<td><a class="reference external" href="mailto:vishal&#46;swarnkar&#37;&#52;&#48;gmail&#46;com">vishal<span>&#46;</span>swarnkar<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Vjekoslav Brajkovic</td>
<td><a class="reference external" href="mailto:balkan&#37;&#52;&#48;cs&#46;washington&#46;edu">balkan<span>&#64;</span>cs<span>&#46;</span>washington<span>&#46;</span>edu</a></td>
</tr>
<tr class="row-odd"><td>Voravit T.</td>
<td><a class="reference external" href="mailto:voravit&#37;&#52;&#48;kth&#46;se">voravit<span>&#64;</span>kth<span>&#46;</span>se</a></td>
</tr>
<tr class="row-even"><td>Yeming Zhao</td>
<td><a class="reference external" href="mailto:zhaoyeming&#37;&#52;&#48;gmail&#46;com">zhaoyeming<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Yi Ba</td>
<td><a class="reference external" href="mailto:yby&#46;developer&#37;&#52;&#48;yahoo&#46;com">yby<span>&#46;</span>developer<span>&#64;</span>yahoo<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Ying Chen</td>
<td><a class="reference external" href="mailto:yingchen&#37;&#52;&#48;vmware&#46;com">yingchen<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Yongqiang Liu</td>
<td><a class="reference external" href="mailto:liuyq7809&#37;&#52;&#48;gmail&#46;com">liuyq7809<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>ZHANG Zhiming</td>
<td><a class="reference external" href="mailto:zhangzhiming&#37;&#52;&#48;yunshan&#46;net&#46;cn">zhangzhiming<span>&#64;</span>yunshan<span>&#46;</span>net<span>&#46;</span>cn</a></td>
</tr>
<tr class="row-odd"><td>Zhangguanghui</td>
<td><a class="reference external" href="mailto:zhang&#46;guanghui&#37;&#52;&#48;h3c&#46;com">zhang<span>&#46;</span>guanghui<span>&#64;</span>h3c<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Ziyou Wang</td>
<td><a class="reference external" href="mailto:ziyouw&#37;&#52;&#48;vmware&#46;com">ziyouw<span>&#64;</span>vmware<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Zoltán Balogh</td>
<td><a class="reference external" href="mailto:zoltan&#46;balogh&#37;&#52;&#48;ericsson&#46;com">zoltan<span>&#46;</span>balogh<span>&#64;</span>ericsson<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>ankur dwivedi</td>
<td><a class="reference external" href="mailto:ankurengg2003&#37;&#52;&#48;gmail&#46;com">ankurengg2003<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>chen zhang</td>
<td><a class="reference external" href="mailto:3zhangchen9211&#37;&#52;&#48;gmail&#46;com">3zhangchen9211<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>james hopper</td>
<td><a class="reference external" href="mailto:jameshopper&#37;&#52;&#48;email&#46;com">jameshopper<span>&#64;</span>email<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>kk yap</td>
<td><a class="reference external" href="mailto:yapkke&#37;&#52;&#48;stanford&#46;edu">yapkke<span>&#64;</span>stanford<span>&#46;</span>edu</a></td>
</tr>
<tr class="row-even"><td>likunyun</td>
<td><a class="reference external" href="mailto:kunyunli&#37;&#52;&#48;hotmail&#46;com">kunyunli<span>&#64;</span>hotmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>meishengxin</td>
<td><a class="reference external" href="mailto:meishengxin&#37;&#52;&#48;huawei&#46;com">meishengxin<span>&#64;</span>huawei<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>neeraj mehta</td>
<td><a class="reference external" href="mailto:mehtaneeraj07&#37;&#52;&#48;gmail&#46;com">mehtaneeraj07<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>rahim entezari</td>
<td><a class="reference external" href="mailto:rahim&#46;entezari&#37;&#52;&#48;gmail&#46;com">rahim<span>&#46;</span>entezari<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>weizj</td>
<td><a class="reference external" href="mailto:34965317&#37;&#52;&#48;qq&#46;com">34965317<span>&#64;</span>qq<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>俊 赵</td>
<td><a class="reference external" href="mailto:zhaojun12&#37;&#52;&#48;outlook&#46;com">zhaojun12<span>&#64;</span>outlook<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>冯全树(Crab)</td>
<td><a class="reference external" href="mailto:fqs888&#37;&#52;&#48;126&#46;com">fqs888<span>&#64;</span>126<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>张东亚</td>
<td><a class="reference external" href="mailto:fortitude&#46;zhang&#37;&#52;&#48;gmail&#46;com">fortitude<span>&#46;</span>zhang<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>胡靖飞</td>
<td><a class="reference external" href="mailto:hujingfei914&#37;&#52;&#48;msn&#46;com">hujingfei914<span>&#64;</span>msn<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>张伟</td>
<td><a class="reference external" href="mailto:zhangwqh&#37;&#52;&#48;126&#46;com">zhangwqh<span>&#64;</span>126<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>张强</td>
<td><a class="reference external" href="mailto:zhangqiang&#37;&#52;&#48;meizu&#46;com">zhangqiang<span>&#64;</span>meizu<span>&#46;</span>com</a></td>
</tr>
</tbody>
</table>
<p>Thanks to all Open vSwitch contributors.  If you are not listed above
but believe that you should be, please write to <a class="reference external" href="mailto:dev&#37;&#52;&#48;openvswitch&#46;org">dev<span>&#64;</span>openvswitch<span>&#46;</span>org</a>.</p>
</div>
<span id="document-internals/maintainers"></span><div class="section" id="committers">
<h3>Committers<a class="headerlink" href="#committers" title="Permalink to this headline">¶</a></h3>
<p>Open vSwitch committers are the people who have been granted access to push
changes to to the Open vSwitch git repository.</p>
<p>The responsibilities of an Open vSwitch committer are documented
<a class="reference external" href="Documentation/committer-responsibilities.rst">here</a>.</p>
<p>The process for adding or removing committers is documented
<a class="reference external" href="Documentation/committer-grant-revocation.rst">here</a>.</p>
<p>This is the current list of Open vSwitch committers:</p>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-text">OVS Maintainers</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Email</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Alex Wang</td>
<td><a class="reference external" href="mailto:ee07b291&#37;&#52;&#48;gmail&#46;com">ee07b291<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Andy Zhou</td>
<td><a class="reference external" href="mailto:azhou&#37;&#52;&#48;ovn&#46;org">azhou<span>&#64;</span>ovn<span>&#46;</span>org</a></td>
</tr>
<tr class="row-even"><td>Ansis Atteka</td>
<td><a class="reference external" href="mailto:aatteka&#37;&#52;&#48;nicira&#46;com">aatteka<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Ben Pfaff</td>
<td><a class="reference external" href="mailto:blp&#37;&#52;&#48;ovn&#46;org">blp<span>&#64;</span>ovn<span>&#46;</span>org</a></td>
</tr>
<tr class="row-even"><td>Daniele Di Proietto</td>
<td><a class="reference external" href="mailto:daniele&#46;di&#46;proietto&#37;&#52;&#48;gmail&#46;com">daniele<span>&#46;</span>di<span>&#46;</span>proietto<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>Ethan J. Jackson</td>
<td><a class="reference external" href="mailto:ejj&#37;&#52;&#48;eecs&#46;berkeley&#46;edu">ejj<span>&#64;</span>eecs<span>&#46;</span>berkeley<span>&#46;</span>edu</a></td>
</tr>
<tr class="row-even"><td>Gurucharan Shetty</td>
<td><a class="reference external" href="mailto:guru&#37;&#52;&#48;ovn&#46;org">guru<span>&#64;</span>ovn<span>&#46;</span>org</a></td>
</tr>
<tr class="row-odd"><td>Jarno Rajahalme</td>
<td><a class="reference external" href="mailto:jarno&#37;&#52;&#48;ovn&#46;org">jarno<span>&#64;</span>ovn<span>&#46;</span>org</a></td>
</tr>
<tr class="row-even"><td>Jesse Gross</td>
<td><a class="reference external" href="mailto:jesse&#37;&#52;&#48;kernel&#46;org">jesse<span>&#64;</span>kernel<span>&#46;</span>org</a></td>
</tr>
<tr class="row-odd"><td>Joe Stringer</td>
<td><a class="reference external" href="mailto:joe&#37;&#52;&#48;ovn&#46;org">joe<span>&#64;</span>ovn<span>&#46;</span>org</a></td>
</tr>
<tr class="row-even"><td>Justin Pettit</td>
<td><a class="reference external" href="mailto:jpettit&#37;&#52;&#48;ovn&#46;org">jpettit<span>&#64;</span>ovn<span>&#46;</span>org</a></td>
</tr>
<tr class="row-odd"><td>Pravin B Shelar</td>
<td><a class="reference external" href="mailto:pshelar&#37;&#52;&#48;nicira&#46;com">pshelar<span>&#64;</span>nicira<span>&#46;</span>com</a></td>
</tr>
<tr class="row-even"><td>Russell Bryant</td>
<td><a class="reference external" href="mailto:russell&#37;&#52;&#48;ovn&#46;org">russell<span>&#64;</span>ovn<span>&#46;</span>org</a></td>
</tr>
<tr class="row-odd"><td>Simon Horman</td>
<td><a class="reference external" href="mailto:horms&#37;&#52;&#48;ovn&#46;org">horms<span>&#64;</span>ovn<span>&#46;</span>org</a></td>
</tr>
<tr class="row-even"><td>Thomas Graf</td>
<td><a class="reference external" href="mailto:tgraf&#37;&#52;&#48;noironetworks&#46;com">tgraf<span>&#64;</span>noironetworks<span>&#46;</span>com</a></td>
</tr>
<tr class="row-odd"><td>YAMAMOTO Takashi</td>
<td><a class="reference external" href="mailto:yamamoto&#37;&#52;&#48;midokura&#46;com">yamamoto<span>&#64;</span>midokura<span>&#46;</span>com</a></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>


        <div class="browse">
          
          
        </div>
      </div>
      <div class="col-1-3">
        <div class="widget">
          <form class="search" action="search.html" method="get">
            <input type="text" name="q" placeholder="Search 2.6 documentation" /><button type="submit"></button>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
        </div>
        <div class="widget">
          <div class="widget-title">
            Contents
          </div>
          <div class="widget-body">
            <ul>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-index">Open vSwitch Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-intro/index">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-tutorials/index">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-topics/index">Deep Dive</a></li>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-howto/index">How-to Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-ref/index">Reference Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-faq/index">Open vSwitch FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-internals/index">Open vSwitch Internals</a></li>
</ul>

          </div>
        </div>
        <div class="widget">
          <div class="widget-title">
            Browse
          </div>
          <div class="widget-body">
            <ul>
            </ul>
          </div>
        </div>
        <div class="widget">
          <div class="widget-title">
            Navigation
          </div>
          <div class="widget-body">
            <ul>
              <li class="nav-item nav-item-0">
                <a href="contents.html#document-contents">Open vSwitch 2.6.0 documentation</a>
                  <ul><li>Open vSwitch 2.6.0 documentation</li></ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  <div>
</main>

<footer role="contentinfo">
  <div class="cp--footer collaborative-projects">
    <div class="gray-diagonal">
      <div class="container">
        <p>&copy; 2016 A Linux Foundation Collaborative Project. All Rights Reserved.</p>
        <p>Linux Foundation is a registered trademark of The Linux Foundation. Linux is a registered <a href="http://www.linuxfoundation.org/programs/legal/trademark" title="Linux Mark Institute">trademark</a> of Linus Torvalds. Open vSwitch and OvS are trademarks of The Linux Foundation.</p>
        <p>Please see our <a href="http://www.linuxfoundation.org/privacy">privacy policy</a> and <a href="http://www.linuxfoundation.org/terms">terms of use</a>.</p>
      </div>
    </div>
  </div>
</footer>

  </body>
</html>